<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/49/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-N043_Cookie" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/09/N043_Cookie/" class="article-date">
  <time datetime="2018-02-09T08:02:49.000Z" itemprop="datePublished">2018-02-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/09/N043_Cookie/">Cookie</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="什么是Cookie"><a href="#什么是Cookie" class="headerlink" title="什么是Cookie"></a>什么是Cookie</h3><p><a href="https://zh.wikipedia.org/wiki/Cookie" target="_blank" rel="noopener">Cookie维基百科</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/22396872?refer=study-fe" target="_blank" rel="noopener">方大文章</a></p>
<h3 id="出现场景"><a href="#出现场景" class="headerlink" title="出现场景"></a>出现场景</h3><p>登陆注册</p>
<ol>
<li>在你登录成功的一瞬间，后台设置cookie</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// node.js后端设置响应头</span><br><span class="line">// 假如你的登录邮箱是 </span><br><span class="line">let email = &apos;trustfor@sian.cn&apos;;</span><br><span class="line">//登录成功设置响应头</span><br><span class="line">response.setHeader(&apos;Set-Cookie&apos;:&apos;sign_in_email=$&#123;email&#125;&apos;)</span><br></pre></td></tr></table></figure>
<p>你可以在浏览器里看到你设置的响应头 (Response Headers)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie:sign_in_email=trustfor@sian.cn</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>只有被设置了Cookie,你每次访问同一域名下资源都会在请求头里传递 Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:sign_in_email=trustfor@sian.cn</span><br></pre></td></tr></table></figure>
</li>
<li><p>后台得到Cookie就知道用户是谁了</p>
<blockquote>
<h4 id="将Cookie映射到生活中"><a href="#将Cookie映射到生活中" class="headerlink" title="将Cookie映射到生活中"></a>将Cookie映射到生活中</h4></blockquote>
</li>
</ol>
<blockquote>
<ul>
<li>你去公园，公园给你发了个票，票的有效期是2天 </li>
<li>假设你中途离开了公园，下午再次进入你就需要提供你的门票<ul>
<li>即使你是去看公园里的狗，也得有门票才行</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Cookie的特点"><a href="#Cookie的特点" class="headerlink" title="Cookie的特点"></a>Cookie的特点</h3><ol>
<li>服务器通过Set-Cookie 响应头设置 Cookie</li>
<li>浏览器得到Cookie之后，每次请求都要带上Cookie</li>
<li>服务器读取Cookie 就知道登录用户的信息(email)</li>
</ol>
<blockquote>
<h3 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h3></blockquote>
<p>我在Chrome登录了并得到了Cookie,用Safari访问Safari会带上Cookie吗？</p>
<blockquote>
<h5 id="No，北京动物园和天津动物园的门票你觉得能一样吗？"><a href="#No，北京动物园和天津动物园的门票你觉得能一样吗？" class="headerlink" title="No，北京动物园和天津动物园的门票你觉得能一样吗？"></a>No，北京动物园和天津动物园的门票你觉得能一样吗？</h5></blockquote>
<blockquote>
<h3 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h3></blockquote>
<blockquote>
<h5 id="Cookie-存在哪，你的硬盘上-如果是票当然是你的口袋里"><a href="#Cookie-存在哪，你的硬盘上-如果是票当然是你的口袋里" class="headerlink" title="Cookie 存在哪，你的硬盘上(如果是票当然是你的口袋里)"></a>Cookie 存在哪，你的硬盘上(如果是票当然是你的口袋里)</h5></blockquote>
<blockquote>
<h3 id="问题3"><a href="#问题3" class="headerlink" title="问题3"></a>问题3</h3></blockquote>
<p>票能作假吗？</p>
<blockquote>
<h5 id="可以，只要你稍微有一点前端知识就可以伪造Cookie"><a href="#可以，只要你稍微有一点前端知识就可以伪造Cookie" class="headerlink" title="可以，只要你稍微有一点前端知识就可以伪造Cookie"></a>可以，只要你稍微有一点前端知识就可以伪造Cookie</h5><h5 id="如果是Chrome你可以F12–-gt-Application–-gt-Cookies就能修改了"><a href="#如果是Chrome你可以F12–-gt-Application–-gt-Cookies就能修改了" class="headerlink" title="如果是Chrome你可以F12–&gt;Application–&gt;Cookies就能修改了"></a>如果是Chrome你可以F12–&gt;Application–&gt;Cookies就能修改了</h5></blockquote>
<blockquote>
<h3 id="问题4"><a href="#问题4" class="headerlink" title="问题4"></a>问题4</h3></blockquote>
<p>Cookie 有有效期吗？</p>
<blockquote>
<h5 id="当然有了，你见过7天免登陆吗？"><a href="#当然有了，你见过7天免登陆吗？" class="headerlink" title="当然有了，你见过7天免登陆吗？"></a>当然有了，你见过7天免登陆吗？</h5><h5 id="默认有效期20分钟，防止别人拿着你的票查看你隐私信息，"><a href="#默认有效期20分钟，防止别人拿着你的票查看你隐私信息，" class="headerlink" title="默认有效期20分钟，防止别人拿着你的票查看你隐私信息，"></a>默认有效期20分钟，防止别人拿着你的票查看你隐私信息，</h5></blockquote>
<blockquote>
<h3 id="问题5"><a href="#问题5" class="headerlink" title="问题5"></a>问题5</h3></blockquote>
<p>Cookie 遵守同源策略吗？</p>
<blockquote>
<h5 id="也有，不过跟-AJAX-的同源策略稍微有些不同。"><a href="#也有，不过跟-AJAX-的同源策略稍微有些不同。" class="headerlink" title="也有，不过跟 AJAX 的同源策略稍微有些不同。"></a>也有，不过跟 AJAX 的同源策略稍微有些不同。</h5><h5 id="当请求-qq-com-下的资源时，浏览器会默认带上-qq-com-对应的-Cookie，不会带上-baidu-com-对应的-Cookie"><a href="#当请求-qq-com-下的资源时，浏览器会默认带上-qq-com-对应的-Cookie，不会带上-baidu-com-对应的-Cookie" class="headerlink" title="当请求 qq.com 下的资源时，浏览器会默认带上 qq.com 对应的 Cookie，不会带上 baidu.com 对应的 Cookie"></a>当请求 qq.com 下的资源时，浏览器会默认带上 qq.com 对应的 Cookie，不会带上 baidu.com 对应的 Cookie</h5><h5 id="当请求-v-qq-com-下的资源时，浏览器不仅会带上-v-qq-com-的Cookie，还会带上-qq-com-的-Cookie"><a href="#当请求-v-qq-com-下的资源时，浏览器不仅会带上-v-qq-com-的Cookie，还会带上-qq-com-的-Cookie" class="headerlink" title="当请求 v.qq.com 下的资源时，浏览器不仅会带上 v.qq.com 的Cookie，还会带上 qq.com 的 Cookie"></a>当请求 v.qq.com 下的资源时，浏览器不仅会带上 v.qq.com 的Cookie，还会带上 qq.com 的 Cookie</h5><h5 id="另外-Cookie-还可以根据路径做限制，请自行了解，这个功能用得比较少。"><a href="#另外-Cookie-还可以根据路径做限制，请自行了解，这个功能用得比较少。" class="headerlink" title="另外 Cookie 还可以根据路径做限制，请自行了解，这个功能用得比较少。"></a>另外 Cookie 还可以根据路径做限制，请自行了解，这个功能用得比较少。</h5></blockquote>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><blockquote>
<p>这里的场景是非常非常简单的，后台设置cookie肯定不会拿你的邮箱，这样太好冒充了</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/09/N043_Cookie/" data-id="ckl3ypv19007ssi91y73ob12g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N038_面向对象编程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/10/N038_面向对象编程/" class="article-date">
  <time datetime="2017-12-10T07:43:46.000Z" itemprop="datePublished">2017-12-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/10/N038_面向对象编程/">面向对象编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript" target="_blank" rel="noopener">面向对象 MDN</a></p>
<p>JavaScript面向对象编程</p>
<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><h4 id="如果你在公司-var-a-1-是要被离职的"><a href="#如果你在公司-var-a-1-是要被离职的" class="headerlink" title="如果你在公司 var a = 1;是要被离职的"></a>如果你在公司 var a = 1;是要被离职的</h4><blockquote>
<p>因为你不知道 a以前是什么</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 全局命名空间</span><br><span class="line">var MYAPP = MYAPP || &#123;&#125;;</span><br><span class="line">//等价于</span><br><span class="line">if(MYAPP)&#123;</span><br><span class="line">    var MYAPP = MYAPP</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    var MYAPP = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码技巧  先看看表达式的值是什么</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1 || 2     //1</span><br><span class="line"> </span><br><span class="line">1 &amp;&amp; 2 &amp;&amp; 3  //3</span><br><span class="line"></span><br><span class="line">0||null||undefined||1  //1</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a || b </span><br><span class="line"></span><br><span class="line">c &amp;&amp; d</span><br><span class="line"></span><br><span class="line">//它们的值基本不可能是 true / false</span><br><span class="line">//五个falsy值</span><br><span class="line"></span><br><span class="line">//  0 NaN &apos;&apos;  null undefined</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1 &amp;&amp; 0  // 0</span><br><span class="line"></span><br><span class="line">1 &amp;&amp; 0 &amp;&amp; 2  // 0</span><br><span class="line"></span><br><span class="line">1 &amp;&amp; 0 &amp;&amp; console.log(3)  //打印3不会执行  会返回  0</span><br><span class="line"></span><br><span class="line">1 &amp;&amp; 2 &amp;&amp; 3  // 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0 || undefined || null || 1   // 1</span><br><span class="line"></span><br><span class="line">0 || undefined || null || 1 || 0 || null  // 1</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="回到之前的命名空间写法"><a href="#回到之前的命名空间写法" class="headerlink" title="回到之前的命名空间写法"></a>回到之前的命名空间写法</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var app = &#123;&#125;//危险代码</span><br><span class="line"></span><br><span class="line">if(app)&#123;</span><br><span class="line">    //app = app 这句可以不写 是废话</span><br><span class="line">&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    app = &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 安全写法</span><br><span class="line"></span><br><span class="line">var app2 = app2 || &#123;&#125;</span><br><span class="line"></span><br><span class="line">if(app2)&#123;</span><br><span class="line">    app2 = app2</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    app2 = &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="this复习"><a href="#this复习" class="headerlink" title="this复习"></a>this复习</h3><blockquote>
<p>待更新。。。。</p>
</blockquote>
<h3 id="new是做啥的"><a href="#new是做啥的" class="headerlink" title="new是做啥的"></a>new是做啥的</h3><blockquote>
<h3 id="当我们需要100个士兵-就要写100次"><a href="#当我们需要100个士兵-就要写100次" class="headerlink" title="当我们需要100个士兵 就要写100次"></a>当我们需要100个士兵 就要写100次</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var 士兵们 = [];</span><br><span class="line">var 士兵 ;</span><br><span class="line">for(var i=0;i&lt;100;i++)&#123;</span><br><span class="line">    士兵 = &#123;</span><br><span class="line">      ID: i, // 用于区分每个士兵</span><br><span class="line">      兵种:&quot;美国大兵&quot;,</span><br><span class="line">      攻击力:5,</span><br><span class="line">      生命值:42, </span><br><span class="line">      行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">      奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">      死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">      攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">      防御:function()&#123; /*护脸*/       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    士兵们.push(士兵)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这样是很耗内存的因为 每个士兵自己都有 这些方法  但这些方法内容是一样的 就会出现500个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">防御:function()&#123; /*护脸*/       &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="士兵共有属性"><a href="#士兵共有属性" class="headerlink" title="士兵共有属性"></a>士兵共有属性</h4><blockquote>
<p><strong> </strong>proto__ __ 这样</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var 士兵共有属性 = &#123;</span><br><span class="line">    兵种:&quot;美国大兵&quot;,</span><br><span class="line">    攻击力:5,</span><br><span class="line">    行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">    奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">    死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">    攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">    防御:function()&#123; /*护脸*/       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 士兵们 = [];</span><br><span class="line">var 士兵 ;</span><br><span class="line">for(var i=0;i&lt;100;i++)&#123;</span><br><span class="line">    士兵 = &#123;</span><br><span class="line">      ID: i, // 用于区分每个士兵</span><br><span class="line">      生命值:42</span><br><span class="line">    &#125;</span><br><span class="line">    /*实际工作中不要这样写__proto__ 不是标准属性*/</span><br><span class="line">    </span><br><span class="line">    士兵.__proto__ = 士兵共有属性</span><br><span class="line">    </span><br><span class="line">    士兵们.push(士兵)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样你会感觉士兵和 士兵共有属性很松散</p>
</blockquote>
<h4 id="使用函数把-士兵-和-士兵共有属性-包裹起来"><a href="#使用函数把-士兵-和-士兵共有属性-包裹起来" class="headerlink" title="使用函数把 士兵 和 士兵共有属性 包裹起来"></a>使用函数把 士兵 和 士兵共有属性 包裹起来</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var 士兵共有属性 = &#123;</span><br><span class="line">    兵种:&quot;美国大兵&quot;,</span><br><span class="line">    攻击力:5,</span><br><span class="line">    行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">    奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">    死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">    攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">    防御:function()&#123; /*护脸*/       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function create士兵(id)&#123;</span><br><span class="line">    var 士兵 = &#123;</span><br><span class="line">        ID:i,//</span><br><span class="line">        生命值:42</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    士兵.__proto__ = 士兵共有属性</span><br><span class="line">    </span><br><span class="line">    return 士兵 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//创建士兵</span><br><span class="line">var 士兵们 = [];</span><br><span class="line">var 士兵 ;</span><br><span class="line">for(var i=0;i&lt;100;i++)&#123;</span><br><span class="line">    士兵们.push( create士兵(i) )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="这样-create士兵-和-士兵共有属性还是没太大关联性"><a href="#这样-create士兵-和-士兵共有属性还是没太大关联性" class="headerlink" title="这样 create士兵 和 士兵共有属性还是没太大关联性"></a>这样 create士兵 和 士兵共有属性还是没太大关联性</h3></blockquote>
<h4 id="把-“士兵的共有属性”-放到-“create士兵”-的属性-里"><a href="#把-“士兵的共有属性”-放到-“create士兵”-的属性-里" class="headerlink" title="把 “士兵的共有属性” 放到 “create士兵” 的属性 里"></a>把 “士兵的共有属性” 放到 “create士兵” 的属性 里</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function create士兵(id)&#123;</span><br><span class="line">    var 士兵 = &#123;</span><br><span class="line">        ID:i,//</span><br><span class="line">        生命值:42</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    士兵.__proto__ = create士兵.士兵共有属性</span><br><span class="line">    </span><br><span class="line">    return 士兵 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">create士兵.士兵共有属性 = &#123;</span><br><span class="line">    兵种:&quot;美国大兵&quot;,</span><br><span class="line">    攻击力:5,</span><br><span class="line">    行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">    奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">    死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">    攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">    防御:function()&#123; /*护脸*/       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="JS之父的关怀"><a href="#JS之父的关怀" class="headerlink" title="JS之父的关怀"></a>JS之父的关怀</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function 士兵(id)&#123;</span><br><span class="line">    //step1</span><br><span class="line">    //var temp = &#123;&#125;</span><br><span class="line">    //step2</span><br><span class="line">    //this = temp </span><br><span class="line">    //step3</span><br><span class="line">    //this.__proto__ = create士兵.prototype</span><br><span class="line">    this.ID = id;</span><br><span class="line">    this.生命值 = 42</span><br><span class="line">    //step4</span><br><span class="line">    //return this </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">士兵.prototype = &#123;</span><br><span class="line">    constructor:士兵,</span><br><span class="line">    兵种:&quot;美国大兵&quot;,</span><br><span class="line">    攻击力:5,</span><br><span class="line">    行走:function()&#123; /*走俩步的代码*/&#125;,</span><br><span class="line">    奔跑:function()&#123; /*狂奔的代码*/  &#125;,</span><br><span class="line">    死亡:function()&#123; /*Go die*/    &#125;,</span><br><span class="line">    攻击:function()&#123; /*糊他熊脸*/   &#125;,</span><br><span class="line">    防御:function()&#123; /*护脸*/       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你要做的事情 就是 加个new</span><br><span class="line"></span><br><span class="line">var 士兵 = new 士兵(id);</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="原理-new-士兵-之后"><a href="#原理-new-士兵-之后" class="headerlink" title="原理 new 士兵()之后"></a>原理 new 士兵()之后</h3></blockquote>
<ol>
<li>生成一个临时对象 temp</li>
<li>然后用 this指向 这个临时对象 temp</li>
<li>然后让this的原型 等于这个函数的prototype</li>
<li>而且也不用return 这个事 也帮你做了 帮你返回this </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var obj =new Object()</span><br><span class="line"></span><br><span class="line">自有属性  空</span><br><span class="line">obj.__proto__ === Object.prototype</span><br><span class="line"></span><br><span class="line">var array = new Array(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;)</span><br><span class="line">自有属性  0:&apos;a&apos; 1:&apos;b&apos; 2:&apos;c&apos; length:3</span><br><span class="line">array.__proto__ === Array.prototype</span><br><span class="line">Array.prototype.__proto__ === Object.prototype</span><br><span class="line"></span><br><span class="line">var fn =new Function(&apos;x&apos;,&apos;y&apos;,&apos;return x+y&apos;)</span><br><span class="line">自有属性 length:2 不可见函数体: &apos;return x+y&apos;</span><br><span class="line">fn.__proto__ === Function.prototype</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Array is  a Function</span><br><span class="line">Array = function()&#123;...&#125;</span><br><span class="line">Array.__proto__ === Function.prototype</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/10/N038_面向对象编程/" data-id="ckl3ypv16007ksi91jzcjgk9o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N037_CRM之从零搭建一个数据库系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/09/N037_CRM之从零搭建一个数据库系统/" class="article-date">
  <time datetime="2017-12-09T07:43:46.000Z" itemprop="datePublished">2017-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/09/N037_CRM之从零搭建一个数据库系统/">CRM之从零搭建一个数据库系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="引入LeanCloud"><a href="#引入LeanCloud" class="headerlink" title="引入LeanCloud"></a>引入LeanCloud</h3><p>在 <a href="https://leancloud.cn/" target="_blank" rel="noopener">https://leancloud.cn/</a> 上注册一个账户。</p>
<blockquote>
<p>前端很少涉及数据库 把数据永久的保存在一个地方 跨设备访问数据</p>
</blockquote>
<blockquote>
<p>阿里云最低配的30元/月</p>
</blockquote>
<blockquote>
<h3 id="leancloud这是一个将服务器能力免费给你用的网站"><a href="#leancloud这是一个将服务器能力免费给你用的网站" class="headerlink" title="leancloud这是一个将服务器能力免费给你用的网站"></a>leancloud这是一个将服务器能力免费给你用的网站</h3></blockquote>
<h4 id="注册的时候有一点要注意-至少8位密码-包含数字大写小写字母"><a href="#注册的时候有一点要注意-至少8位密码-包含数字大写小写字母" class="headerlink" title="注册的时候有一点要注意 至少8位密码 包含数字大写小写字母"></a>注册的时候有一点要注意 至少8位密码 包含数字大写小写字母</h4><h4 id="一个自带数据库和增删改查（CRUD）功能的后台系统。"><a href="#一个自带数据库和增删改查（CRUD）功能的后台系统。" class="headerlink" title="一个自带数据库和增删改查（CRUD）功能的后台系统。"></a>一个自带数据库和增删改查（CRUD）功能的后台系统。</h4><p>拥有：</p>
<ol>
<li>登录注册、手机验证码功能（收费）</li>
<li>存储任意信息</li>
<li>读取任意信息</li>
<li>搜索任意信息</li>
<li>删除任意信息</li>
<li>更新任意信息</li>
</ol>
<p>等功能。</p>
<h4 id="没有见过的东西？！"><a href="#没有见过的东西？！" class="headerlink" title="没有见过的东西？！"></a>没有见过的东西？！</h4><blockquote>
<p>不要慌，使用 Copy-Run-Modify 套路即可。</p>
</blockquote>
<blockquote>
<p>演示如何使用 LeanCloud 存一个 Hello World</p>
</blockquote>
<ol>
<li>创建一个应用 cv-20180128</li>
<li>引入 av-min.js，得到 window.AV</li>
<li>初始化 AV 对象（代码直接拷）</li>
<li>新建一条数据（代码直接拷）</li>
</ol>
<ul>
<li>创建你的应用之后</li>
<li>点击右上角帮助/快速入门  </li>
<li>选择我们的语言 js</li>
<li>然后开始看文档 copy</li>
</ul>
<h4 id="先引入cdn-验证是否成功"><a href="#先引入cdn-验证是否成功" class="headerlink" title="先引入cdn 验证是否成功"></a>先引入cdn 验证是否成功</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;//cdn1.lncld.net/static/js/3.5.0/av-min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">//F12 </span><br><span class="line">console.log(AV) //不报错代表成功</span><br></pre></td></tr></table></figure>
<h3 id="注意每个应用有自己的key-不要使用我的key"><a href="#注意每个应用有自己的key-不要使用我的key" class="headerlink" title="注意每个应用有自己的key 不要使用我的key"></a>注意每个应用有自己的key 不要使用我的key</h3><blockquote>
<p>加入留言模块</p>
</blockquote>
<h4 id="message-js"><a href="#message-js" class="headerlink" title="message.js"></a>message.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var APP_ID = &apos;fqJwht8RtYXK5nVQ1uaDjUc5-gzGzoHsz&apos;;</span><br><span class="line">var APP_KEY = &apos;rLVeL79CM0mAVV6GNa27xDpb&apos;;</span><br><span class="line"></span><br><span class="line">AV.init(&#123;</span><br><span class="line">  appId: APP_ID,</span><br><span class="line">  appKey: APP_KEY</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(&apos;ok&apos;) //成功打印代表成功了</span><br></pre></td></tr></table></figure>
<h4 id="验证-你的应用跟我不一样"><a href="#验证-你的应用跟我不一样" class="headerlink" title="验证 你的应用跟我不一样"></a>验证 你的应用跟我不一样</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping &quot;fqjwht8r.api.lncld.net&quot;</span><br></pre></td></tr></table></figure>
<h4 id="ping成功后在继续测试"><a href="#ping成功后在继续测试" class="headerlink" title="ping成功后在继续测试"></a>ping成功后在继续测试</h4><blockquote>
<p>然后在项目中编写如下测试代码：</p>
</blockquote>
<h4 id="message-js-1"><a href="#message-js-1" class="headerlink" title="message.js"></a>message.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//创建了  TestObject表</span><br><span class="line">var TestObject = AV.Object.extend(&apos;TestObject&apos;);</span><br><span class="line">// 在表中创建一行数据</span><br><span class="line">var testObject = new TestObject();</span><br><span class="line">// 数据的内容是 words:&apos;Hello World&apos; 保存</span><br><span class="line">// 如果保存成功，则允许alert</span><br><span class="line">testObject.save(&#123;</span><br><span class="line">  words: &apos;Hello World!&apos;</span><br><span class="line">&#125;).then(function(object) &#123;</span><br><span class="line">  alert(&apos;LeanCloud Rocks!&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://leancloud.cn/dashboard/data.html?appid=fqJwht8RtYXK5nVQ1uaDjUc5-gzGzoHsz#/TestObject" target="_blank" rel="noopener">控制台 &gt; 存储 &gt; 数据 &gt; TestObject</a>你会看到变化</p>
</blockquote>
<h4 id="CRM之-M"><a href="#CRM之-M" class="headerlink" title="CRM之 M"></a>CRM之 M</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var hjx = AV.Object.extend(&apos;Hjx&apos;);</span><br><span class="line">var obj = new hjx();</span><br><span class="line">obj.save(&#123;</span><br><span class="line">  words: &apos;hi&apos;</span><br><span class="line">&#125;).then(function(object) &#123;</span><br><span class="line">  alert(&apos;LeanCloud Rocks!&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>刷新你会发现多了个Hjx的表</p>
</blockquote>
<h4 id="再次修改"><a href="#再次修改" class="headerlink" title="再次修改"></a>再次修改</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var hjx = AV.Object.extend(&apos;Hjx&apos;);</span><br><span class="line">var obj = new hjx();</span><br><span class="line">obj.save(&#123;</span><br><span class="line">  words: &apos;hi&apos;,</span><br><span class="line">  xxxx:&apos;sdfjklsdjflsdjkfadklas&apos;,</span><br><span class="line">&#125;).then(function(object) &#123;</span><br><span class="line">  alert(&apos;LeanCloud Rocks!&apos;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>刷新之后你会发现 Hjx里 多了一列 xxxx 这就是数据库</p>
</blockquote>
<h4 id="套路"><a href="#套路" class="headerlink" title="套路"></a>套路</h4><ol>
<li>创建一个应用 cv-20180128</li>
<li>引入av-main.js得到window.AV</li>
<li>初始化 AV 对象 (代码直接拷)</li>
<li>新建一条数据(代码直接拷)</li>
</ol>
<h4 id="添加section留言模块"><a href="#添加section留言模块" class="headerlink" title="添加section留言模块"></a>添加section留言模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;section&gt;</span><br><span class="line">    &lt;h2&gt;留言&lt;/h2&gt;</span><br><span class="line">    &lt;form id=&quot;postMessageForm&quot; style=&quot;width:700px;margin:50px auto;&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;content&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/section&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">var APP_ID = &apos;fqJwht8RtYXK5nVQ1uaDjUc5-gzGzoHsz&apos;;</span><br><span class="line">var APP_KEY = &apos;rLVeL79CM0mAVV6GNa27xDpb&apos;;</span><br><span class="line"></span><br><span class="line">AV.init(&#123;</span><br><span class="line">  appId: APP_ID,</span><br><span class="line">  appKey: APP_KEY</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let myForm = document.querySelector(&apos;#postMessageForm&apos;)</span><br><span class="line"></span><br><span class="line">myForm.addEventListener(&apos;submit&apos;,function(e)&#123;</span><br><span class="line">    e.preventDefault(); //防止刷新页面</span><br><span class="line">    let content = myForm.querySelector(&apos;input[name=content]&apos;).value;</span><br><span class="line">    var Message = AV.Object.extend(&apos;Message&apos;);</span><br><span class="line">    var message = new Message();</span><br><span class="line">    message.save(&#123;</span><br><span class="line">        &apos;content&apos;:content,</span><br><span class="line">    &#125;).then(function(object) &#123;</span><br><span class="line">        alert(&apos;存入成功&apos;)</span><br><span class="line">        console.log(object)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// var hjx = AV.Object.extend(&apos;Hjx&apos;);</span><br><span class="line">// var obj = new hjx();</span><br><span class="line">// obj.save(&#123;</span><br><span class="line">//   words: &apos;hi&apos;,</span><br><span class="line">//   xxxx:&apos;sdfjklsdjflsdjkfadklas&apos;,</span><br><span class="line">// &#125;).then(function(object) &#123;</span><br><span class="line">//   console.log(object)</span><br><span class="line">// &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="技术细节-监听submit同时能监听用户点回车"><a href="#技术细节-监听submit同时能监听用户点回车" class="headerlink" title="技术细节 监听submit同时能监听用户点回车"></a>技术细节 监听submit同时能监听用户点回车</h5><blockquote>
<p>如果你不这么写就要这样写</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let btn = myForm.querySelector(&apos;input[type=submit]&apos;)</span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;&#125;);</span><br><span class="line">let input = myForm.querySelector(&apos;input[name=content]&apos;)</span><br><span class="line">input.addEventListener(&apos;keypress&apos;,function(e)&#123;</span><br><span class="line">    if(e.keyCode === 13)&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://sltrust.github.io/cv/028mycv.html" target="_blank" rel="noopener">MVC版简历message模块为mvc分离的</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/09/N037_CRM之从零搭建一个数据库系统/" data-id="ckl3ypv17007nsi917fqnih9c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N036_MVC之VC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/08/N036_MVC之VC/" class="article-date">
  <time datetime="2017-12-08T07:43:46.000Z" itemprop="datePublished">2017-12-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/08/N036_MVC之VC/">MVC之VC</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="项目引入链接如下"><a href="#项目引入链接如下" class="headerlink" title="项目引入链接如下"></a>项目引入链接如下</h2><p><a href="https://sltrust.github.io/cv/017mycv_show_animate.html" target="_blank" rel="noopener">基础版代码</a></p>
<p><a href="https://sltrust.github.io/cv/020mycv.html" target="_blank" rel="noopener">引入轮播后</a></p>
<p><a href="https://sltrust.github.io/cv/021mycv.html" target="_blank" rel="noopener">模块化之后</a></p>
<p><a href="https://sltrust.github.io/cv/022mycv_mvc.html" target="_blank" rel="noopener">立即执行函数的使用避免全局污染</a></p>
<p><a href="https://sltrust.github.io/cv/023mycv_mvc.html" target="_blank" rel="noopener">模块间通信与闭包的使用</a></p>
<p><a href="https://sltrust.github.io/cv/024mycv_mvc.html" target="_blank" rel="noopener">初步提取view和controller</a></p>
<p><a href="https://sltrust.github.io/cv/025mycv_mvc.html" target="_blank" rel="noopener">进阶后的vc</a></p>
<h3 id="引入轮播"><a href="#引入轮播" class="headerlink" title="引入轮播"></a>引入轮播</h3><blockquote>
<p>在啥都不清楚下引入 swiper </p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note036_1.png" alt></p>
<p><a href="http://idangero.us/swiper/demos/" target="_blank" rel="noopener">swiper插件</a></p>
<h4 id="get-Started"><a href="#get-Started" class="headerlink" title="get Started"></a>get Started</h4><ol>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install swiper //安装这个swiper 或者直接用cdn的链接</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入相关文件</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;path/to/swiper.min.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;script src=&quot;path/to/swiper.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>添加页面模板html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Slider main container --&gt;</span><br><span class="line">&lt;div class=&quot;swiper-container&quot;&gt;</span><br><span class="line">    &lt;!-- Additional required wrapper --&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-wrapper&quot;&gt;</span><br><span class="line">        &lt;!-- Slides --&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-slide&quot;&gt;Slide 1&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-slide&quot;&gt;Slide 2&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-slide&quot;&gt;Slide 3&lt;/div&gt;</span><br><span class="line">        ...</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- If we need pagination --&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-pagination&quot;&gt;&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- If we need navigation buttons --&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-button-prev&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-button-next&quot;&gt;&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- If we need scrollbar --&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-scrollbar&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>加入样式文件</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.swiper-container &#123;</span><br><span class="line">    width: 600px;</span><br><span class="line">    height: 300px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>初始化JS代码</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var mySwiper = new Swiper (&apos;.swiper-container&apos;, &#123;</span><br><span class="line">    // Optional parameters</span><br><span class="line">    direction: &apos;vertical&apos;,</span><br><span class="line">    loop: true,</span><br><span class="line"></span><br><span class="line">    // If we need pagination</span><br><span class="line">    pagination: &#123;</span><br><span class="line">        el: &apos;.swiper-pagination&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // Navigation arrows</span><br><span class="line">    navigation: &#123;</span><br><span class="line">        nextEl: &apos;.swiper-button-next&apos;,</span><br><span class="line">        prevEl: &apos;.swiper-button-prev&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // And if we need scrollbar</span><br><span class="line">    scrollbar: &#123;</span><br><span class="line">        el: &apos;.swiper-scrollbar&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h4 id="美化你的作品集-肯定不能直接截图你的作品除非很好看"><a href="#美化你的作品集-肯定不能直接截图你的作品除非很好看" class="headerlink" title="美化你的作品集 肯定不能直接截图你的作品除非很好看"></a>美化你的作品集 肯定不能直接截图你的作品除非很好看</h4><blockquote>
<p><a href="https://unsplash.com/" target="_blank" rel="noopener">https://unsplash.com/</a>  去这里搜你作品的关键字 一定能找到你要的精美图片</p>
</blockquote>
<blockquote>
<p>注意图片的比例 如果是轮播要一致</p>
</blockquote>
<blockquote>
<p>不要吝惜你原来无用的代码直接删掉</p>
</blockquote>
<blockquote>
<p>不断的调修磨你的作品集样式 调到你觉得满意为止</p>
</blockquote>
<p><a href="https://sltrust.github.io/cv/020mycv.html" target="_blank" rel="noopener">代码链接</a></p>
<h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><ol>
<li><p>将style里的CSS放到一个地方 main.css</p>
</li>
<li><p>将如下的各个功能独立成对应的js模块</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.0/js/swiper.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/tween.js/17.1.1/Tween.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">     var mySwiper = new Swiper (&apos;.swiper-container&apos;, &#123;</span><br><span class="line">        // Optional parameters</span><br><span class="line">        //direction: &apos;vertical&apos;,</span><br><span class="line">        loop: true,</span><br><span class="line"></span><br><span class="line">        // If we need pagination</span><br><span class="line">        pagination: &#123;</span><br><span class="line">        el: &apos;.swiper-pagination&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // Navigation arrows</span><br><span class="line">        navigation: &#123;</span><br><span class="line">        nextEl: &apos;.swiper-button-next&apos;,</span><br><span class="line">        prevEl: &apos;.swiper-button-prev&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    siteWelcome.classList.remove(&apos;active&apos;);</span><br><span class="line">    // setTimeout(function()&#123;</span><br><span class="line">    //     siteWelcome.classList.remove(&apos;active&apos;);</span><br><span class="line">    // &#125;,100);</span><br><span class="line"></span><br><span class="line">    //给每个模块添加偏移距离的样式    然后当页面滚到对应模块时 去除该样式</span><br><span class="line">    let specialTags = document.querySelectorAll(&apos;[data-x]&apos;);</span><br><span class="line">    for(let i=0;i&lt;specialTags.length;i++)&#123;</span><br><span class="line">        specialTags[i].classList.add(&apos;offset&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        yyy();</span><br><span class="line">    &#125;, 0);</span><br><span class="line"></span><br><span class="line">    window.onscroll = function()&#123;</span><br><span class="line">        //console.log(window.scrollY)</span><br><span class="line">        // 添加粘性导航</span><br><span class="line">        if(window.scrollY&gt;0)&#123;</span><br><span class="line">            topNavBar.classList.add(&apos;sticky&apos;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            topNavBar.classList.remove(&apos;sticky&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        yyy();</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function yyy()&#123;</span><br><span class="line">        //滚动到对应位置  高亮对应标签      </span><br><span class="line">        let specialTags = document.querySelectorAll(&apos;[data-x]&apos;);</span><br><span class="line">        //找到现在位置距离顶部最近的那个</span><br><span class="line">        let minIndex = 0; </span><br><span class="line">        for(let i=1;i&lt;specialTags.length;i++)&#123;</span><br><span class="line">            //console.log(specialTags[i].offsetTop)</span><br><span class="line">            if(Math.abs(specialTags[i].offsetTop -window.scrollY) &lt; Math.abs(specialTags[minIndex].offsetTop -window.scrollY))&#123;</span><br><span class="line">                minIndex = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //每个出现的模块添加过渡效果   该元素就是离顶部最近的模块  移除偏移的样式</span><br><span class="line">        specialTags[minIndex].classList.remove(&apos;offset&apos;);</span><br><span class="line">        </span><br><span class="line">        //选中当前模块对应的a标签</span><br><span class="line">        let id = specialTags[minIndex].id;</span><br><span class="line">        let aTag = document.querySelector(&apos;a[href=&quot;#&apos;+id+&apos;&quot;]&apos;);</span><br><span class="line">        //找到aTag的爸爸 就是 li 给它加 active 同时去除其他li的active</span><br><span class="line">        let li = aTag.parentNode;</span><br><span class="line">        let aLi = li.parentNode.children;</span><br><span class="line">        for(var i=0;i&lt;aLi.length;i++)&#123;</span><br><span class="line">            // aLi[i].classList.remove(&apos;active&apos;);</span><br><span class="line">            //操作两个 样式</span><br><span class="line">            aLi[i].classList.remove(&apos;highlight&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        //li.classList.add(&apos;active&apos;);</span><br><span class="line">        li.classList.add(&apos;highlight&apos;);</span><br><span class="line">        // **解决bug的关键在于不要让两个不相干的动作操作同一个样式</span><br><span class="line">        //此时已经有bug了  </span><br><span class="line">        //  当前位置高亮了 但是 鼠标移入移出后  就不高亮了  因为移入移出和 滚动都是操作一个active</span><br><span class="line">        //滚动到技能时候 虽然选中了  但是他的列表出现了</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //这样找只有子菜单的li有 边框效果  ==》找所有li</span><br><span class="line">    // let liTags = document.getElementsByClassName(&apos;menuTigger&apos;);</span><br><span class="line">    let liTags = document.querySelectorAll(&apos;nav.menu &gt; ul &gt; li&apos;);</span><br><span class="line">    //监听含有子菜单的topNavBar menu</span><br><span class="line">    for(let i=0;i&lt;liTags.length;i++)&#123;</span><br><span class="line">        liTags[i].onmouseenter = function(e)&#123;</span><br><span class="line">            let li = e.currentTarget;</span><br><span class="line">            li.classList.add(&apos;active&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        liTags[i].onmouseleave = function(e)&#123;</span><br><span class="line">            let li = e.currentTarget;</span><br><span class="line">            li.classList.remove(&apos;active&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function animate(time) &#123;</span><br><span class="line">        requestAnimationFrame(animate);</span><br><span class="line">        TWEEN.update(time);</span><br><span class="line">    &#125;</span><br><span class="line">    requestAnimationFrame(animate);</span><br><span class="line"></span><br><span class="line">    //监听导航菜单定位到对应位置</span><br><span class="line">    let aTags = document.querySelectorAll(&apos;nav.menu &gt; ul &gt; li &gt; a&apos;);</span><br><span class="line">    for(let i=0;i&lt;aTags.length;i++)&#123;</span><br><span class="line">        aTags[i].onclick = function(e)&#123;</span><br><span class="line">            //阻止默认行为  就是a标签的 锚点</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            let a = e.currentTarget;</span><br><span class="line">            let href = a.getAttribute(&apos;href&apos;);</span><br><span class="line">            let element = document.querySelector(href);</span><br><span class="line">           </span><br><span class="line">            let top = element.offsetTop;</span><br><span class="line">            //当前位置</span><br><span class="line">            let currentTop = window.scrollY;</span><br><span class="line">            //目标点</span><br><span class="line">            let targetTop = top - 80;</span><br><span class="line">            //总路程</span><br><span class="line">            let s = targetTop - currentTop;</span><br><span class="line">            //总时间   因为路程可能是负数  但是 时间不能是负的</span><br><span class="line">            let t = Math.abs((s/100)*300);</span><br><span class="line">            t = t&gt;500?500:t;</span><br><span class="line">            var coords = &#123; x:currentTop&#125;; </span><br><span class="line">            var tween = new TWEEN.Tween(coords) </span><br><span class="line">                    .to(&#123; x: targetTop &#125;,t) </span><br><span class="line">                    .easing(TWEEN.Easing.Quadratic.Out) </span><br><span class="line">                    .onUpdate(function() &#123; </span><br><span class="line">                        window.scrollTo(0,coords.x);</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="模块化之后"><a href="#模块化之后" class="headerlink" title="模块化之后"></a>模块化之后</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.1.0/js/swiper.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/tween.js/17.1.1/Tween.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./js/init-swiper.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./js/auto-slide-up.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./js/sticky-topbar.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./js/smoothly-navigation.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><a href="https://sltrust.github.io/cv/021mycv.html" target="_blank" rel="noopener">代码链接</a></p>
<h4 id="立即执行函数的使用"><a href="#立即执行函数的使用" class="headerlink" title="立即执行函数的使用"></a>立即执行函数的使用</h4><h3 id="auto-slide-up-js"><a href="#auto-slide-up-js" class="headerlink" title="auto-slide-up.js"></a>auto-slide-up.js</h3><blockquote>
<p>里有这样一个变量 specialTags  只要在其他js里重新赋值这个js里的代码就有问题了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let specialTags = document.querySelectorAll(&apos;[data-x]&apos;);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其他js文件里  specialTags = ‘我偏手贱改这个值’ 上面就废了</p>
</blockquote>
<h3 id="错误示范使用花括号包裹你的代码-gt-这是错的-js里没有块级作用域"><a href="#错误示范使用花括号包裹你的代码-gt-这是错的-js里没有块级作用域" class="headerlink" title="错误示范使用花括号包裹你的代码 ==&gt;这是错的 js里没有块级作用域"></a>错误示范使用花括号包裹你的代码 ==&gt;这是错的 js里没有块级作用域</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    var mySwiper = new Swiper (&apos;.swiper-container&apos;, &#123;</span><br><span class="line">       ...</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用函数作用域"><a href="#使用函数作用域" class="headerlink" title="使用函数作用域"></a>使用函数作用域</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function xxx()&#123;</span><br><span class="line">    模块的代码</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xxx.call();</span><br></pre></td></tr></table></figure>
<h3 id="新的问题是-这个函数”xxx”又成了全局变量也是会被污染"><a href="#新的问题是-这个函数”xxx”又成了全局变量也是会被污染" class="headerlink" title="新的问题是  这个函数”xxx”又成了全局变量也是会被污染"></a>新的问题是  这个函数”xxx”又成了全局变量也是会被污染</h3><blockquote>
<p>匿名函数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 这样会报错  这样会报错  这样会报错 </span><br><span class="line">function()&#123;</span><br><span class="line">    模块的代码</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">  模块的代码</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<ol>
<li>我们不想要全局变量</li>
<li>我们要使用局部变量</li>
<li>ES5里，只有函数有局部变量</li>
<li>于是我们声明了一个 function xxx,然后xxx.call()</li>
<li>这个时候xxx是全局变量(全局函数)</li>
<li>所以我们不能给这个函数名字</li>
<li>function(){}.call() </li>
<li>但是chrome不支持直接这样调用会报错</li>
<li><p>试出来一个方法可以不报错 </p>
<h4 id="推荐第一种"><a href="#推荐第一种" class="headerlink" title="推荐第一种"></a>推荐第一种</h4><ul>
<li>(1) !function(){}.call() 用来改变函数的返回值但是我们根本不在乎这个返回值</li>
<li><p>(2) (function(){}).call() 在函数外面加个()</p>
<blockquote>
<p>第二种有bug   </p>
</blockquote>
</li>
<li><p>(3) fn31231231231231212.call() 不推荐  随机数的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a  </span><br><span class="line">()</span><br><span class="line"></span><br><span class="line">// 等价于  a()</span><br><span class="line"></span><br><span class="line">xxx </span><br><span class="line">(function()&#123;&#125;).call() 相当于调用xxx 报错  所以不推荐</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p><a href="https://sltrust.github.io/cv/022mycv_mvc.html" target="_blank" rel="noopener">立即执行函数的使用避免全局污染</a></p>
<h3 id="闭包的使用"><a href="#闭包的使用" class="headerlink" title="闭包的使用"></a>闭包的使用</h3><blockquote>
<h3 id="模块间通信-mod1想访问-mod2的变量"><a href="#模块间通信-mod1想访问-mod2的变量" class="headerlink" title="模块间通信  mod1想访问 mod2的变量"></a>模块间通信  mod1想访问 mod2的变量</h3></blockquote>
<blockquote>
<p>js引入</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;./js3/module_1.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;./js3/module_2.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="module-1-js"><a href="#module-1-js" class="headerlink" title="module_1.js"></a>module_1.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var person = window.person = &#123;</span><br><span class="line">        name:&apos;hjx&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<h4 id="module-2-js"><a href="#module-2-js" class="headerlink" title="module_2.js"></a>module_2.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var person = window.person;</span><br><span class="line">    console.log(person);</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<h4 id="闭包的使用-1"><a href="#闭包的使用-1" class="headerlink" title="闭包的使用"></a>闭包的使用</h4><blockquote>
<h3 id="module-1-1-js"><a href="#module-1-1-js" class="headerlink" title="module_1_1.js"></a>module_1_1.js</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var person = window.person = &#123;</span><br><span class="line">        name:&apos;hjx&apos;,</span><br><span class="line">        age:18</span><br><span class="line">    &#125;</span><br><span class="line">    window.personAgeGrowUp = function()&#123;</span><br><span class="line">        person.age += 1;</span><br><span class="line">        return person.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="module-2-2-js"><a href="#module-2-2-js" class="headerlink" title="module_2_2.js"></a>module_2_2.js</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var newAge = window.personAgeGrowUp();</span><br><span class="line">    console.log(newAge)</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<ol>
<li>立即执行函数使得 person 无法被外部访问</li>
<li>闭包使得匿名函数可以操作 person</li>
<li>window.personAgeGrowUp 保存了匿名函数的地址</li>
<li>任何地方都可以使用 window.personAgeGrowUp<br>=&gt;任何地方都可以使用 window.personAgeGrowUp 操作person<br> ，但是不能直接访问person</li>
</ol>
<p><a href="https://sltrust.github.io/cv/023mycv_mvc.html" target="_blank" rel="noopener">代码链接</a></p>
<h3 id="MVC的V和C"><a href="#MVC的V和C" class="headerlink" title="MVC的V和C"></a>MVC的V和C</h3><p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note036_2.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--作品集的轮播   这就是view --&gt;</span><br><span class="line">&lt;div id=&quot;mySlides&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-container&quot;&gt;</span><br><span class="line">        &lt;!-- Additional required wrapper --&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-wrapper&quot;&gt;</span><br><span class="line">            &lt;!-- Slides --&gt;</span><br><span class="line">            &lt;img src=&quot;./images/nav-page.jpg&quot; class=&quot;swiper-slide&quot; alt=&quot;&quot;&gt;</span><br><span class="line">            &lt;img src=&quot;./images/canvas.png&quot; class=&quot;swiper-slide&quot; alt=&quot;&quot;&gt;</span><br><span class="line">            &lt;img src=&quot;./images/slides.png&quot; class=&quot;swiper-slide&quot; alt=&quot;&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- If we need pagination --&gt;</span><br><span class="line">        &lt;div class=&quot;swiper-pagination&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-button-prev&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;swiper-button-next&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    //提取view</span><br><span class="line">    var view = document.querySelector(&apos;#mySlides&apos;);</span><br><span class="line">    var mySwiper = new Swiper (view.querySelector(&apos;.swiper-container&apos;), &#123;</span><br><span class="line">            loop: true,</span><br><span class="line">            pagination: &#123;</span><br><span class="line">            el: &apos;.swiper-pagination&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line">        navigation: &#123;</span><br><span class="line">            nextEl: &apos;.swiper-button-next&apos;,</span><br><span class="line">            prevEl: &apos;.swiper-button-prev&apos;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其他的模块同样提取view </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var view = document.querySelector(&apos;#topNavBar&apos;);</span><br><span class="line">    window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">        if(window.scrollY&gt;0)&#123;</span><br><span class="line">            view.classList.add(&apos;sticky&apos;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<h3 id="添加controller"><a href="#添加controller" class="headerlink" title="添加controller"></a>添加controller</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var view = document.querySelector(&apos;#topNavBar&apos;);</span><br><span class="line">    var controller = function(view)&#123;</span><br><span class="line">        window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">            if(window.scrollY&gt;0)&#123;</span><br><span class="line">                view.classList.add(&apos;sticky&apos;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    controller.call(null,view)</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其余模块同上</p>
</blockquote>
<p><a href="https://sltrust.github.io/cv/024mycv_mvc.html" target="_blank" rel="noopener">代码链接</a></p>
<h4 id="sticky-topbar-js"><a href="#sticky-topbar-js" class="headerlink" title="sticky-topbar.js"></a>sticky-topbar.js</h4><blockquote>
<p>初级版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var view = document.querySelector(&apos;#topNavBar&apos;);</span><br><span class="line">    var controller = function(view)&#123;</span><br><span class="line">        window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">            if(window.scrollY&gt;0)&#123;</span><br><span class="line">                view.classList.add(&apos;sticky&apos;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    controller.call(null,view);</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>进阶一点</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var controller = &#123;</span><br><span class="line">    view:null,</span><br><span class="line">    init:function(view)&#123;</span><br><span class="line">        this.view = view;</span><br><span class="line">        window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">            if(window.scrollY&gt;0)&#123;</span><br><span class="line">                view.classList.add(&apos;sticky&apos;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">controller.init.call(null,view);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次进阶一点点 bindEvents里面的this有问题传递的是window</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var controller = &#123;</span><br><span class="line">    view:null,</span><br><span class="line">    init:function(view)&#123;</span><br><span class="line">        this.view = view;</span><br><span class="line">        this.bindEvents();</span><br><span class="line">        //this.bindEvents.call(this)</span><br><span class="line">    &#125;,</span><br><span class="line">    bindEvents:function()&#123;</span><br><span class="line">        var view = this.view;</span><br><span class="line">        window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">            if(window.scrollY&gt;0)&#123;</span><br><span class="line">                view.classList.add(&apos;sticky&apos;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">controller.init.call(null,view);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次进阶一点点2 bindEvents里面的this有问题传递的是window</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">!function()&#123;</span><br><span class="line">    var view = document.querySelector(&apos;#topNavBar&apos;);</span><br><span class="line">    var controller = &#123;</span><br><span class="line">        view:null,</span><br><span class="line">        init:function(view)&#123;</span><br><span class="line">            this.view = view;</span><br><span class="line">            this.bindEvents();</span><br><span class="line">            //this.bindEvents.call(this)</span><br><span class="line">        &#125;,</span><br><span class="line">        bindEvents:function()&#123;</span><br><span class="line">            var view = this.view;</span><br><span class="line">            window.addEventListener(&apos;scroll&apos;,function()&#123;</span><br><span class="line">                console.log(this)</span><br><span class="line">                var view = this.view;</span><br><span class="line">                if(window.scrollY&gt;0)&#123;</span><br><span class="line">                    this.active();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    this.deactive();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).bind(this);</span><br><span class="line">            //箭头函数没有this</span><br><span class="line">        &#125;,</span><br><span class="line">        active:function()&#123;</span><br><span class="line">            this.view.classList.add(&apos;sticky&apos;);</span><br><span class="line">        &#125;,</span><br><span class="line">        deactive:function()&#123;</span><br><span class="line">            view.classList.remove(&apos;sticky&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    controller.init(view);</span><br><span class="line">&#125;.call()</span><br></pre></td></tr></table></figure>
<h4 id="解决this问题-使用箭头函数"><a href="#解决this问题-使用箭头函数" class="headerlink" title="解决this问题 使用箭头函数"></a>解决this问题 使用箭头函数</h4><blockquote>
<p>示例代码 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var f = ()=&gt; console.log(this);</span><br><span class="line"></span><br><span class="line">f() //window</span><br><span class="line">f.call(&#123;name:&apos;hjx&apos;&#125;) // window</span><br></pre></td></tr></table></figure>
<h3 id="箭头函数内外this不变"><a href="#箭头函数内外this不变" class="headerlink" title="箭头函数内外this不变"></a>箭头函数内外this不变</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bindEvents:function()&#123;</span><br><span class="line">    var view = this.view;</span><br><span class="line">    window.addEventListener(&apos;scroll&apos;,()=&gt;&#123;</span><br><span class="line">        if(window.scrollY&gt;0)&#123;</span><br><span class="line">            this.active();</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            this.deactive();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    //箭头函数没有this</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://sltrust.github.io/cv/025mycv_mvc.html" target="_blank" rel="noopener">代码链接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/08/N036_MVC之VC/" data-id="ckl3ypv15007isi91vt1kfals" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N035_自己实现AJAX" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/07/N035_自己实现AJAX/" class="article-date">
  <time datetime="2017-12-07T07:43:46.000Z" itemprop="datePublished">2017-12-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/07/N035_自己实现AJAX/">自己实现AJAX</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let request = new XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">request.open(&apos;get&apos;,&apos;/xxx&apos;);</span><br><span class="line"></span><br><span class="line">request.send();</span><br><span class="line"></span><br><span class="line">request.onreadystatechange = function()&#123;</span><br><span class="line">    if(request.readyState === 4)&#123;</span><br><span class="line">        if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">            console.log(request.responseText);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(request.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="request-open-‘请求方式’-url-可选参数"><a href="#request-open-‘请求方式’-url-可选参数" class="headerlink" title="request.open(‘请求方式’,url,[可选参数]);"></a>request.open(‘请求方式’,url,[可选参数]);</h3><blockquote>
<h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.open(&apos;get&apos;,&apos;/xxx&apos;);</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h4 id="post"><a href="#post" class="headerlink" title="post"></a>post</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.open(&apos;post&apos;,&apos;/xxx&apos;);</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="request-setHeaders-key-value"><a href="#request-setHeaders-key-value" class="headerlink" title="request.setHeaders(key,value);"></a>request.setHeaders(key,value);</h3><blockquote>
<h4 id="自己设置请求第二部分"><a href="#自己设置请求第二部分" class="headerlink" title="自己设置请求第二部分"></a>自己设置请求第二部分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let request = new XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">request.open(&apos;get&apos;,&apos;/xxx&apos;);</span><br><span class="line"></span><br><span class="line">request.setRequestHeader(&apos;name&apos;,&apos;hjx&apos;);</span><br><span class="line">request.setRequestHeader(&apos;Content-Type&apos;,&apos;x-www-form-urlencoded&apos;);</span><br><span class="line"></span><br><span class="line">request.send();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note035_1.png" alt></p>
<h3 id="request-send-‘你设置的内容’"><a href="#request-send-‘你设置的内容’" class="headerlink" title="request.send(‘你设置的内容’);"></a>request.send(‘你设置的内容’);</h3><blockquote>
<h4 id="设置请求的第四部分"><a href="#设置请求的第四部分" class="headerlink" title="设置请求的第四部分"></a>设置请求的第四部分</h4></blockquote>
<blockquote>
<h4 id="注意-如果是get方式-第四部分是不可见的"><a href="#注意-如果是get方式-第四部分是不可见的" class="headerlink" title="注意:如果是get方式  第四部分是不可见的"></a>注意:如果是get方式  第四部分是不可见的</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let request = new XMLHttpRequest();</span><br><span class="line">            </span><br><span class="line">request.open(&apos;post&apos;,&apos;/xxx&apos;);</span><br><span class="line">request.setRequestHeader(&apos;name&apos;,&apos;hjx&apos;);</span><br><span class="line">request.setRequestHeader(&apos;Content-Type&apos;,&apos;x-www-form-urlencoded&apos;);</span><br><span class="line"></span><br><span class="line">request.send(&apos;我偏要设置请求的第四部分&apos;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note035_2.png" alt></p>
<h3 id="客户端获取服务器的响应部分"><a href="#客户端获取服务器的响应部分" class="headerlink" title="客户端获取服务器的响应部分"></a>客户端获取服务器的响应部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">request.onreadystatechange = function()&#123;</span><br><span class="line">    if(request.readyState === 4)&#123;</span><br><span class="line">        if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">            console.log(request.status);</span><br><span class="line">            console.log(request.statusText);</span><br><span class="line">            console.log(request.getAllResponseHeaders());</span><br><span class="line">            console.log(request.responseText);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(request.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol>
<li>JS可以任意设置请求 Header 吗？<ul>
<li>第一部分 request.open(‘get’,’/xxx’)</li>
<li>第二部分 request.setRequestHeader(‘name’,’hjx’);</li>
<li>第四部分 request.send(‘a=1&amp;b=2’);</li>
</ul>
</li>
<li>JS可以获取响应的所有部分 吗？<ul>
<li>第一部分 request.status/request.statusText</li>
<li>第二部分 request.getResponseHeader()/request.getAllResponseHeaders()</li>
<li>第四部分 request.responseText</li>
</ul>
</li>
</ol>
<h4 id="jQuery-ajax"><a href="#jQuery-ajax" class="headerlink" title="jQuery.ajax()"></a>jQuery.ajax()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">window.jQyery = function(nodeOrSelector)&#123;</span><br><span class="line">    let nodes = &#123;&#125;; </span><br><span class="line">    /************省略非本次知识的重点*************/</span><br><span class="line">    &#125;</span><br><span class="line">    return nodes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">window.jQuery.ajax = function()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">window.$ = window.jQuery;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note035_3.png" alt></p>
<h3 id="先搞出ajax的函数体"><a href="#先搞出ajax的函数体" class="headerlink" title="先搞出ajax的函数体"></a>先搞出ajax的函数体</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(url,method,body,successFn,failFn)&#123;</span><br><span class="line"></span><br><span class="line">    let request = new XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    request.open(method,url);</span><br><span class="line">    </span><br><span class="line">    request.send(body);</span><br><span class="line"></span><br><span class="line">    request.onreadystatechange = function()&#123;</span><br><span class="line">        if(request.readyState === 4)&#123;</span><br><span class="line">            if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                successFn.call(undefined,request.responseText)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                failFn.call(undefined,request)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    window.jQuery.ajax(</span><br><span class="line">        &apos;/xxx&apos;,</span><br><span class="line">        &apos;get&apos;,</span><br><span class="line">        &apos;a=1&amp;b=2&apos;,</span><br><span class="line">        (res)=&gt;&#123;console.log(res)&#125;,</span><br><span class="line">        (err)=&gt;&#123;console.log()&#125;</span><br><span class="line">    );</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="你睡了一晚上，第二天基本ajax里的参数你基本就忘光了"><a href="#你睡了一晚上，第二天基本ajax里的参数你基本就忘光了" class="headerlink" title="你睡了一晚上，第二天基本ajax里的参数你基本就忘光了"></a>你睡了一晚上，第二天基本ajax里的参数你基本就忘光了</h3><blockquote>
<p>优化一下</p>
</blockquote>
<h4 id="提取参数"><a href="#提取参数" class="headerlink" title="提取参数"></a>提取参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(options)&#123;</span><br><span class="line">    let url = options.url;</span><br><span class="line">    let method = options.method;</span><br><span class="line">    let body = options.body;</span><br><span class="line">    let successFn = options.successFn;</span><br><span class="line">    let failFn = options.failFn;</span><br><span class="line">    let request = new XMLHttpRequest();</span><br><span class="line">    request.open(method,url);</span><br><span class="line">    request.send(body);</span><br><span class="line">    request.onreadystatechange = function()&#123;</span><br><span class="line">        if(request.readyState === 4)&#123;</span><br><span class="line">            if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                successFn.call(undefined,request.responseText)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                failFn.call(undefined,request.status)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    window.jQuery.ajax(&#123;</span><br><span class="line">        url:&apos;/xxx&apos;,</span><br><span class="line">        method:&apos;get&apos;,</span><br><span class="line">        body:&apos;a=1&amp;b=2&apos;,</span><br><span class="line">        successFn:(res)=&gt;&#123;console.log(res)&#125;,</span><br><span class="line">        failFn:(err)=&gt;&#123;console.log()&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="如果我想设置请求头咋办？"><a href="#如果我想设置请求头咋办？" class="headerlink" title="如果我想设置请求头咋办？"></a>如果我想设置请求头咋办？</h4><blockquote>
<p>继续添加往options上挂载key就好了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(options)&#123;</span><br><span class="line">    let url = options.url;</span><br><span class="line">    let method = options.method;</span><br><span class="line">    //继续设置参数</span><br><span class="line">    let headers = options.headers;</span><br><span class="line">    let body = options.body;</span><br><span class="line">    let successFn = options.successFn;</span><br><span class="line">    let failFn = options.failFn;</span><br><span class="line">    let request = new XMLHttpRequest();</span><br><span class="line">    request.open(method,url);</span><br><span class="line">    for(let key in headers)&#123;</span><br><span class="line">        let value = headers[key];</span><br><span class="line">        request.setRequestHeader(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    request.send(body);</span><br><span class="line">    request.onreadystatechange = function()&#123;</span><br><span class="line">        if(request.readyState === 4)&#123;</span><br><span class="line">            if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                successFn.call(undefined,request.responseText)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                failFn.call(undefined,request.status)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    window.jQuery.ajax(&#123;</span><br><span class="line">        url:&apos;/xxx&apos;,</span><br><span class="line">        method:&apos;get&apos;,</span><br><span class="line">        headers:&#123;</span><br><span class="line">            &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded&apos;,</span><br><span class="line">            &apos;name&apos;:&apos;hjx&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        body:&apos;a=1&amp;b=2&apos;,</span><br><span class="line">        successFn:(res)=&gt;&#123;console.log(res)&#125;,</span><br><span class="line">        failFn:(err)=&gt;&#123;console.log()&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="借鉴jQuery-ajax-url-settings-接受一个或者两个参数"><a href="#借鉴jQuery-ajax-url-settings-接受一个或者两个参数" class="headerlink" title="借鉴jQuery.ajax(url[,settings])　接受一个或者两个参数"></a>借鉴jQuery.ajax(url[,settings])　接受一个或者两个参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(options)&#123;</span><br><span class="line">    let url;</span><br><span class="line">    if(arguments.length===1)&#123;</span><br><span class="line">        url = options.url;</span><br><span class="line">       </span><br><span class="line">    &#125;else if(arguments.length===2)&#123;</span><br><span class="line">        url = arguments[0];</span><br><span class="line">        options = arguments[1];</span><br><span class="line">    &#125;</span><br><span class="line">    let method = options.method;</span><br><span class="line">    let headers = options.headers;</span><br><span class="line">    let body = options.body;</span><br><span class="line">    let successFn = options.successFn;</span><br><span class="line">    let failFn = options.failFn;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    window.jQuery.ajax(</span><br><span class="line">        &apos;/xxx&apos;,</span><br><span class="line">        &#123;</span><br><span class="line">            method:&apos;get&apos;,</span><br><span class="line">            headers:&#123;</span><br><span class="line">                &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded&apos;,</span><br><span class="line">                &apos;name&apos;:&apos;hjx&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            body:&apos;a=1&amp;b=2&apos;,</span><br><span class="line">            successFn:(res)=&gt;&#123;console.log(res)&#125;,</span><br><span class="line">            failFn:(err)=&gt;&#123;console.log()&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ES6的方式写以上代码"><a href="#ES6的方式写以上代码" class="headerlink" title="ES6的方式写以上代码"></a>ES6的方式写以上代码</h4><blockquote>
<p>恢复只接收一个参数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(options)&#123;</span><br><span class="line">    //ES6解构赋值</span><br><span class="line">    let &#123;url,method,body,successFn,failFn,headers&#125; = options;</span><br><span class="line"></span><br><span class="line">    let request = new XMLHttpRequest();</span><br><span class="line">    request.open(method,url);</span><br><span class="line">    for(let key in headers)&#123;</span><br><span class="line">        let value = headers[key];</span><br><span class="line">        request.setRequestHeader(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    request.send(body);</span><br><span class="line">    request.onreadystatechange = function()&#123;</span><br><span class="line">        if(request.readyState === 4)&#123;</span><br><span class="line">            if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                successFn.call(undefined,request.responseText)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                failFn.call(undefined,request.status)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="更进一步的优化"><a href="#更进一步的优化" class="headerlink" title="更进一步的优化"></a>更进一步的优化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    //ES6解构赋值</span><br><span class="line">window.jQuery.ajax = function( &#123;url,method,body,successFn,failFn,headers&#125;)&#123;</span><br><span class="line">    let request = new XMLHttpRequest();</span><br><span class="line">    request.open(method,url);</span><br><span class="line">    for(let key in headers)&#123;</span><br><span class="line">        let value = headers[key];</span><br><span class="line">        request.setRequestHeader(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    request.send(body);</span><br><span class="line">    request.onreadystatechange = function()&#123;</span><br><span class="line">        if(request.readyState === 4)&#123;</span><br><span class="line">            if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                successFn.call(undefined,request.responseText)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                failFn.call(undefined,request.status)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ES6方式交换a和b的值"><a href="#ES6方式交换a和b的值" class="headerlink" title="ES6方式交换a和b的值"></a>ES6方式交换a和b的值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//以前的方式</span><br><span class="line">var a = 1;</span><br><span class="line">var b = 2;</span><br><span class="line">var temp = a;</span><br><span class="line">a = b;</span><br><span class="line">b = temp;</span><br><span class="line">//ES6方式</span><br><span class="line">var x = 1;</span><br><span class="line">var y = 2;</span><br><span class="line">[x,y] = [y,x];</span><br></pre></td></tr></table></figure>
<h4 id="ES6-把x的值当作key"><a href="#ES6-把x的值当作key" class="headerlink" title="ES6 把x的值当作key"></a>ES6 把x的值当作key</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//以前</span><br><span class="line">var x = &apos;???&apos;;</span><br><span class="line">var o = &#123;&#125;;</span><br><span class="line">o[x]= true;</span><br><span class="line"></span><br><span class="line">//ES6</span><br><span class="line">var x = &apos;???&apos;;</span><br><span class="line">var o = &#123;</span><br><span class="line">    [x]:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Promise规范"><a href="#Promise规范" class="headerlink" title="Promise规范"></a>Promise规范</h3><blockquote>
<p>jQuery已经实现的方式</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    url:&apos;/xxx&apos;,</span><br><span class="line">    method:&apos;get&apos;</span><br><span class="line">&#125;).then(</span><br><span class="line">        (res)=&gt;&#123;console.log(res) return &apos;成功&apos;;&#125;,</span><br><span class="line">        (err)=&gt;&#123;console.log(err)&#125; return &apos;失败&apos;;&#125;)</span><br><span class="line">  .then(</span><br><span class="line">        (res)=&gt;&#123;console.log(res)&#125;, //这里的res就是 如果上一个成功了 它的返回值</span><br><span class="line">        (err)=&gt;&#123;console.log(err)&#125;) // 同上</span><br></pre></td></tr></table></figure>
<h3 id="Promise版本的ajax"><a href="#Promise版本的ajax" class="headerlink" title="Promise版本的ajax"></a>Promise版本的ajax</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">window.jQuery.ajax = function(&#123;url,method,body,headers&#125;)&#123;</span><br><span class="line">    return new Promise(function(resolve,reject)&#123;</span><br><span class="line">        //ES6解构赋值</span><br><span class="line">        let request = new XMLHttpRequest();</span><br><span class="line">        request.open(method,url);</span><br><span class="line">        for(let key in headers)&#123;</span><br><span class="line">            let value = headers[key];</span><br><span class="line">            request.setRequestHeader(key,value);</span><br><span class="line">        &#125;</span><br><span class="line">        request.send(body);</span><br><span class="line">        request.onreadystatechange = function()&#123;</span><br><span class="line">            if(request.readyState === 4)&#123;</span><br><span class="line">                if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">                    resolve.call(undefined,request.responseText)</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    reject.call(undefined,request.status)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    window.jQuery.ajax(&#123;</span><br><span class="line">            url:&apos;/xxx&apos;,</span><br><span class="line">            method:&apos;get&apos;,</span><br><span class="line">            headers:&#123;</span><br><span class="line">                &apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded&apos;,</span><br><span class="line">                &apos;name&apos;:&apos;hjx&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            body:&apos;a=1&amp;b=2&apos;</span><br><span class="line">        &#125;).then(</span><br><span class="line">                (res)=&gt;&#123;console.log(res)&#125;,</span><br><span class="line">                (err)=&gt;&#123;console.log(err)&#125;</span><br><span class="line">            )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/07/N035_自己实现AJAX/" data-id="ckl3ypv14007fsi91fhon50vl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N034_AJAX是什么鬼" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/05/N034_AJAX是什么鬼/" class="article-date">
  <time datetime="2017-12-05T07:41:58.000Z" itemprop="datePublished">2017-12-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/05/N034_AJAX是什么鬼/">AJAX是什么鬼</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h2><h3 id="请先确保你有node-或自己开一个wamp服务器否则别往下看了-浪费时间"><a href="#请先确保你有node-或自己开一个wamp服务器否则别往下看了-浪费时间" class="headerlink" title="请先确保你有node 或自己开一个wamp服务器否则别往下看了 浪费时间"></a>请先确保你有node 或自己开一个wamp服务器否则别往下看了 浪费时间</h3><blockquote>
<p>if(你有node)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安装请用</span><br><span class="line">npm install  -g http-server     </span><br><span class="line">卸载请用</span><br><span class="line">npm uninstall  -g http-server</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir demo 创建目录</span><br><span class="line">cd demo    切换目录</span><br><span class="line">touch index.html  创建一个html文件</span><br></pre></td></tr></table></figure>
<h4 id="如何发请求"><a href="#如何发请求" class="headerlink" title="如何发请求"></a>如何发请求</h4><blockquote>
<p>form发请求</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;xxx&quot; method=&quot;get&quot; target=&quot;aa&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;password&quot; value=&quot;222&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt; </span><br><span class="line">&lt;iframe src=&quot;&quot; name=&quot;aa&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
</blockquote>
<ol>
<li><p>开启你的服务器 </p>
<ul>
<li><p>如果安装了 http-server  你就在demo目录  ！ demo目录 ! demo目录 ! 打开终端 </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http-server -c-1</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果是wamp 你就开启服务器就行了 在你指定的端口 demo要放在wamp指定的www文件夹里</p>
</li>
</ul>
</li>
<li><p>把给你的url 在 chrome 里打开 </p>
</li>
<li>请按F12 / 打开调试</li>
<li>点击 Network</li>
<li>点击提交按钮</li>
<li><p>你会看到出现如下一行内容  请点击<br><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note034_1.png" alt></p>
</li>
<li><p>点击之后 会看到前后台联调必不可少的几个部分</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note034_2.png" alt></p>
<ol start="8">
<li><p>分别展开列表  </p>
<blockquote>
<p>点击view source</p>
</blockquote>
<blockquote>
<p>点击view source</p>
</blockquote>
<blockquote>
<p>点击view source</p>
</blockquote>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note034_3.png" alt></p>
<ol start="9">
<li>get请求的四部分</li>
</ol>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note034_4.png" alt></p>
<ol start="10">
<li>修改form里的 method=”post” 我知道你不会改的 所以看代码吧！</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;xxx&quot; method=&quot;post&quot; target=&quot;aa&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;password&quot; value=&quot;22&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt; </span><br><span class="line">&lt;iframe src=&quot;&quot; name=&quot;aa&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note034_5.png" alt></p>
</blockquote>
<h3 id="form发请求"><a href="#form发请求" class="headerlink" title="form发请求"></a>form发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;xxx&quot; method=&quot;get&quot; target=&quot;aa&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;password&quot; value=&quot;222&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt; </span><br><span class="line">&lt;iframe src=&quot;&quot; name=&quot;aa&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
<h3 id="a标签发请求"><a href="#a标签发请求" class="headerlink" title="a标签发请求"></a>a标签发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=&quot;link&quot; href=&quot;/xxx&quot;&gt;&lt;/a&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    link.click();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="img发请求"><a href="#img发请求" class="headerlink" title="img发请求"></a>img发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;/xxx&quot; alt=&quot;&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="link发请求"><a href="#link发请求" class="headerlink" title="link发请求"></a>link发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    var link = document.createElement(&apos;link&apos;);</span><br><span class="line">    link.rel = &apos;stylesheet&apos;;</span><br><span class="line">    link.href = &apos;/xxx&apos;;</span><br><span class="line">    document.head.appendChild(link);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="script发请求"><a href="#script发请求" class="headerlink" title="script发请求"></a>script发请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    var script = document.createElement(&apos;script&apos;);</span><br><span class="line">    script.src = &apos;/xxx&apos;;</span><br><span class="line">    document.head.appendChild(script);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>用 form 发请求，但是会刷新页面或新开页面</li>
<li>用 a 发 get 请求，但是也会刷新页面或新开页面</li>
<li>用 img 发 get 请求，但是只能以图片的形式展示</li>
<li>用 link 发 get 请求，但是只能以css/favicon的形式展示</li>
<li>用 script 发 get 请求，但是只能以脚本的形式运行</li>
</ul>
<h5 id="有没有什么方式可以实现"><a href="#有没有什么方式可以实现" class="headerlink" title="有没有什么方式可以实现"></a>有没有什么方式可以实现</h5><ol>
<li>get / post / put / delete 请求都行</li>
<li>想以什么形式展示就以什么形式展示</li>
</ol>
<h4 id="微软的突破"><a href="#微软的突破" class="headerlink" title="微软的突破"></a>微软的突破</h4><blockquote>
<p>IE 5 率先在 JS 中引入 ActiveX 对象（API），使得 JS 可以直接发起 HTTP 请求。<br>随后 Mozilla、 Safari、 Opera 也跟进（抄袭）了，取名 XMLHttpRequest，并被纳入 W3C 规范</p>
</blockquote>
<blockquote>
<p>IE6当时全球90%的市场份额于是做了愚蠢的决定：他以为自己的在浏览器已经天下无敌了没必要那么多人去维护了就留了两个人做日常维护,把其他人都开除了，然后chrome看准了这个时机异军突起，2年就占据了40%的市场份额，现在IE是人人喊打</p>
</blockquote>
<blockquote>
<h3 id="前端的起源就是因为IE发明了ajax"><a href="#前端的起源就是因为IE发明了ajax" class="headerlink" title="前端的起源就是因为IE发明了ajax"></a>前端的起源就是因为IE发明了ajax</h3></blockquote>
<h4 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h4><blockquote>
<p>Jesse James Garrett 讲如下技术取名叫做 AJAX：async JavaScript and XML</p>
</blockquote>
<ol>
<li>使用 XMLHttpRequest 发请求</li>
<li>服务器返回 XML 格式的字符串</li>
<li>JS 解析 XML，并更新局部页面</li>
</ol>
<h4 id="如何使用-XMLHttpRequest"><a href="#如何使用-XMLHttpRequest" class="headerlink" title="如何使用 XMLHttpRequest"></a>如何使用 XMLHttpRequest</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">myButton.addEventListener(&apos;click&apos;, (e)=&gt;&#123;</span><br><span class="line">  let request = new XMLHttpRequest()</span><br><span class="line">  request.open(&apos;get&apos;, &apos;/xxx&apos;) // 配置request</span><br><span class="line">  request.send()</span><br><span class="line">  request.onreadystatechange = ()=&gt;&#123;</span><br><span class="line">    if(request.readyState === 4)&#123;</span><br><span class="line">      console.log(&apos;请求响应都完毕了&apos;)</span><br><span class="line">      console.log(request.status)</span><br><span class="line">      if(request.status &gt;= 200 &amp;&amp; request.status &lt; 300)&#123;</span><br><span class="line">        console.log(&apos;说明请求成功&apos;)</span><br><span class="line">        console.log(typeof request.responseText) // &apos;string&apos;</span><br><span class="line">        console.log(request.responseText)</span><br><span class="line">        let string = request.responseText</span><br><span class="line">        // 把符合 JSON 语法的字符串</span><br><span class="line">        // 转换成 JS 对应的值</span><br><span class="line">        let object = window.JSON.parse(string)   </span><br><span class="line">        // JSON.parse 是浏览器提供的</span><br><span class="line">        console.log(typeof object)</span><br><span class="line">        console.log(object)</span><br><span class="line">        console.log(&apos;object.note&apos;)</span><br><span class="line">        console.log(object.note)</span><br><span class="line"></span><br><span class="line">      &#125;else if(request.status &gt;= 400)&#123;</span><br><span class="line">        console.log(&apos;说明请求失败&apos;) </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 后端代码</span><br><span class="line">if(path===&apos;/xxx&apos;)&#123;</span><br><span class="line">    response.statusCode = 200</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;, &apos;text/json;charset=utf-8&apos;)</span><br><span class="line">    response.write(`</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;note&quot;:&#123;</span><br><span class="line">        &quot;to&quot;: &quot;aaa&quot;,</span><br><span class="line">        &quot;from&quot;: &quot;hjx&quot;,</span><br><span class="line">        &quot;heading&quot;: &quot;打招呼&quot;,</span><br><span class="line">        &quot;content&quot;: &quot;hello&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    `)</span><br><span class="line">response.end()</span><br></pre></td></tr></table></figure>
<h3 id="注意readStaus有五种状态"><a href="#注意readStaus有五种状态" class="headerlink" title="注意readStaus有五种状态"></a>注意readStaus有五种状态</h3><ul>
<li>0    open()方法还未被调用.</li>
<li>1    open()方法已经被调用.</li>
<li>2    send()方法已经被调用, 响应头和响应状态已经返回.</li>
<li>3    响应体下载中; responseText中已经获取了部分数据.</li>
<li>4    整个请求过程已经完毕.</li>
</ul>
<blockquote>
<p>如何验证状态码经过了 01234 ？ 请按以下代码顺序书写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let request = new XMLHttpRequest();</span><br><span class="line">// open未调用</span><br><span class="line">console.log(request.readyState)</span><br><span class="line">request.onreadystatechange = function()&#123;</span><br><span class="line">    console.log(request.readyState)</span><br><span class="line">    if(request.readyState === 4)&#123;</span><br><span class="line">        if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">            console.log(request.responseText);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(request.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">request.open(&apos;get&apos;,&apos;/xxx&apos;);</span><br><span class="line">request.send();</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="考点-请使用原生JS实现AJAX"><a href="#考点-请使用原生JS实现AJAX" class="headerlink" title="考点:请使用原生JS实现AJAX"></a>考点:请使用原生JS实现AJAX</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let request = new XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">request.open(&apos;get&apos;,&apos;/xxx&apos;);</span><br><span class="line"></span><br><span class="line">request.send();</span><br><span class="line"></span><br><span class="line">request.onreadystatechange = function()&#123;</span><br><span class="line">    if(request.readyState === 4)&#123;</span><br><span class="line">        if(request.status &gt;= 200 &amp;&amp; request.status &lt;300)&#123;</span><br><span class="line">            console.log(request.responseText);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(request.status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JSON-是一门语言-抄袭的JS"><a href="#JSON-是一门语言-抄袭的JS" class="headerlink" title="JSON 是一门语言 (抄袭的JS)"></a>JSON 是一门语言 (抄袭的JS)</h3><blockquote>
<p>{name:’aa’}是对象 JS里这种方式叫做 对象字面量表达式</p>
</blockquote>
<blockquote>
<p>{“name”:”aa”} key必须是字符串 必须以 “ 开头 ， 以 “ 结尾</p>
</blockquote>
<h3 id="JS-VS-JSON"><a href="#JS-VS-JSON" class="headerlink" title="JS VS JSON"></a>JS VS JSON</h3><table>
<thead>
<tr>
<th>JS</th>
<th>JSON</th>
</tr>
</thead>
<tbody>
<tr>
<td>undefined</td>
<td>没有</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>[‘a’,’b’]</td>
<td>[“a”,”b”]</td>
</tr>
<tr>
<td>function(){}</td>
<td>没有</td>
</tr>
<tr>
<td>{name:’hjx’}</td>
<td>{“name”:”hjx”}</td>
</tr>
<tr>
<td>‘hjx’</td>
<td>“hjx”</td>
</tr>
<tr>
<td>var a = { }; a.self = a</td>
<td>搞不定没有变量</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. JSON没有抄袭 function和 undefined ，也没有抄袭symbol因为 symbol是最近出来的</span><br><span class="line">2. JSON 的字符串必须是 &quot;</span><br><span class="line">3. obj.__proto__   没有原型链</span><br></pre></td></tr></table></figure>
<h3 id="请看下面的后台返回"><a href="#请看下面的后台返回" class="headerlink" title="请看下面的后台返回"></a>请看下面的后台返回</h3><blockquote>
<h3 id="返回的是符合JSON对象类型语法的字符串-，-绝对不是JS的“对象”"><a href="#返回的是符合JSON对象类型语法的字符串-，-绝对不是JS的“对象”" class="headerlink" title="返回的是符合JSON对象类型语法的字符串 ， 绝对不是JS的“对象”"></a>返回的是符合JSON对象类型语法的字符串 ， 绝对不是JS的“对象”</h3></blockquote>
<blockquote>
<p>你才返回”对象” ,你全家才返回”对象”</p>
</blockquote>
<blockquote>
<p>后台是无法返回”对象” 给前端的 ，他只能返回字符串</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">response.write(`</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;note&quot;:&#123;</span><br><span class="line">        &quot;to&quot;: &quot;aaa&quot;,</span><br><span class="line">        &quot;from&quot;: &quot;hjx&quot;,</span><br><span class="line">        &quot;heading&quot;: &quot;打招呼&quot;,</span><br><span class="line">        &quot;content&quot;: &quot;hello&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h3><blockquote>
<h3 id="为什么form表单提交没有跨域问题，但ajax提交有跨域问题？"><a href="#为什么form表单提交没有跨域问题，但ajax提交有跨域问题？" class="headerlink" title="为什么form表单提交没有跨域问题，但ajax提交有跨域问题？"></a>为什么form表单提交没有跨域问题，但ajax提交有跨域问题？</h3></blockquote>
<blockquote>
</blockquote>
<ul>
<li>因为原页面用 form 提交到另一个域名之后，原页面的脚本无法获取新页面中的内容。所以浏览器认为这是安全的。</li>
<li>而 AJAX 是可以读取响应内容的，因此浏览器不能允许你这样做。如果你细心的话你会发现，其实请求已经发送出去了，   你只是拿不到响应而已。</li>
<li>所以浏览器这个策略的本质是，一个域名的JS，在未经允许的情况下，不得读取另一个域名的内容。但浏览器并不阻止你向另一个域名发送请求。</li>
</ul>
<h3 id="只有-协议-端口-域名-一模一样才允许发-AJAX-请求"><a href="#只有-协议-端口-域名-一模一样才允许发-AJAX-请求" class="headerlink" title="只有 协议+端口+域名 一模一样才允许发 AJAX 请求"></a>只有 协议+端口+域名 一模一样才允许发 AJAX 请求</h3><blockquote>
<p>一模一样！一模一样！一模一样！一模一样！一模一样！一模一样！一模一样！一模一样！一模一样！</p>
</blockquote>
<blockquote>
<p><a href="http://12306.cn" target="_blank" rel="noopener">http://12306.cn</a>  和 <a href="http://www.12306.cn" target="_blank" rel="noopener">http://www.12306.cn</a> 是不同域名</p>
</blockquote>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><blockquote>
<h3 id="http-baidu-com-可以向-http-www-baidu-com-发AJAX请求吗"><a href="#http-baidu-com-可以向-http-www-baidu-com-发AJAX请求吗" class="headerlink" title="http://baidu.com 可以向 http://www.baidu.com 发AJAX请求吗  ?"></a><a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a> 可以向 <a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a> 发AJAX请求吗  ?</h3></blockquote>
<blockquote>
<h3 id="http-www-baidu-com-可以向-http-baidu-com-发AJAX请求吗"><a href="#http-www-baidu-com-可以向-http-baidu-com-发AJAX请求吗" class="headerlink" title="http://www.baidu.com 可以向 http://baidu.com 发AJAX请求吗  ?"></a><a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a> 可以向 <a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a> 发AJAX请求吗  ?</h3></blockquote>
<h4 id="如果没有同源策略的限制"><a href="#如果没有同源策略的限制" class="headerlink" title="如果没有同源策略的限制"></a>如果没有同源策略的限制</h4><blockquote>
<p>任何一个网站都可以访问你支付宝的余额，QQ空间，你写的私密博客。</p>
</blockquote>
<blockquote>
<p>没有同源策略的浏览器就会让你的所有隐私泄露。</p>
</blockquote>
<h4 id="如果-A站的前端实在想访问B站的内容"><a href="#如果-A站的前端实在想访问B站的内容" class="headerlink" title="如果 A站的前端实在想访问B站的内容"></a>如果 A站的前端实在想访问B站的内容</h4><blockquote>
<p>可以 B站后台设置一个参数 Accept-Control-Allow-Origin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//我允许这个域名访问</span><br><span class="line">response.setHeader(&apos;Accept-Control-Allow-Origin&apos;, &apos;http://A.com:8001&apos;)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="浏览器必须保证"><a href="#浏览器必须保证" class="headerlink" title="浏览器必须保证"></a>浏览器必须保证</h4><ul>
<li>协议+端口+域名 一模一样才允许发AJAX请求</li>
<li>CORS 可以告诉浏览器 我俩是一家的别阻止他</li>
</ul>
<h3 id="CORS-跨域资源共享"><a href="#CORS-跨域资源共享" class="headerlink" title="CORS 跨域资源共享"></a>CORS 跨域资源共享</h3><blockquote>
<h3 id="Cross-Origin-Resource-Sharing"><a href="#Cross-Origin-Resource-Sharing" class="headerlink" title="Cross-Origin Resource Sharing"></a>Cross-Origin Resource Sharing</h3></blockquote>
<h2 id="谨记"><a href="#谨记" class="headerlink" title="谨记"></a>谨记</h2><ol>
<li>你才返回”对象”，你全家才返回 “对象”</li>
<li>JS是一门语言，JSON是另一门语言，JSON 这门语言抄袭了JS</li>
<li>AJAX就是用JS发请求</li>
<li>响应的第四部分是字符串，可以用JSON语法表示一个对象，也可以用JSON语法表示一个数组，还可以用XML语法，还可以用HTML语法，还可以用CSS语法，还可以用JS语法，还可以用你自创的语法。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/05/N034_AJAX是什么鬼/" data-id="ckl3ypv14007dsi91ln70k4mk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N033_JSONP是什么鬼" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/03/N033_JSONP是什么鬼/" class="article-date">
  <time datetime="2017-12-03T07:41:37.000Z" itemprop="datePublished">2017-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/03/N033_JSONP是什么鬼/">JSONP是什么鬼</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是jsonp"><a href="#什么是jsonp" class="headerlink" title="什么是jsonp"></a>什么是jsonp</h1><h2 id="从零开始构建"><a href="#从零开始构建" class="headerlink" title="从零开始构建"></a>从零开始构建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir jsonp_demo  //创建目录 jsonp_demo</span><br><span class="line">cd jsonp_demo     //切换目录到 json_demo</span><br><span class="line">touch server001.js</span><br><span class="line">touch index001.html</span><br></pre></td></tr></table></figure>
<h2 id="版本一"><a href="#版本一" class="headerlink" title="版本一"></a>版本一</h2><blockquote>
<h3 id="server001-js"><a href="#server001-js" class="headerlink" title="server001.js"></a>server001.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&apos;http&apos;)</span><br><span class="line">var fs = require(&apos;fs&apos;)</span><br><span class="line">var url = require(&apos;url&apos;)</span><br><span class="line">var port = process.argv[2]</span><br><span class="line"></span><br><span class="line">if(!port)&#123;</span><br><span class="line">  console.log(&apos;请指定端口号好不啦？\nnode server.js 8888 这样不会吗？&apos;)</span><br><span class="line">  process.exit(1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(request, response)&#123;</span><br><span class="line">  var parsedUrl = url.parse(request.url, true)</span><br><span class="line">  var pathWithQuery = request.url </span><br><span class="line">  var queryString = &apos;&apos;</span><br><span class="line">  if(pathWithQuery.indexOf(&apos;?&apos;) &gt;= 0)&#123; queryString = pathWithQuery.substring(pathWithQuery.indexOf(&apos;?&apos;)) &#125;</span><br><span class="line">  var path = parsedUrl.pathname</span><br><span class="line">  var query = parsedUrl.query</span><br><span class="line">  var method = request.method</span><br><span class="line"></span><br><span class="line">  /******** 从这里开始看，上面不要看 ************/</span><br><span class="line"></span><br><span class="line">  console.log(&apos;被请求后：含查询字符串的路径\n&apos; + pathWithQuery)</span><br><span class="line"></span><br><span class="line">  if(path==&apos;/&apos;)&#123;</span><br><span class="line">    var string = fs.readFileSync(&apos;./index001.html&apos;,&apos;utf8&apos;);</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;text/html;charset=utf-8&apos;);</span><br><span class="line">    response.write(string);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    response.statusCode = 404;</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /******** 代码结束，下面不要看 ************/</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(port)</span><br><span class="line">console.log(&apos;监听 &apos; + port + &apos; 成功\n请在浏览器输入 http://localhost:&apos; + port)</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>当前目录下 新建index.html main.js style.css (main.js/style.css内容为空暂时不需要)</p>
<h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;./style.css&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;100&lt;/span&gt; &lt;/h5&gt;</span><br><span class="line">    &lt;button id=&quot;btn&quot;&gt;付款1块钱&lt;/button&gt;</span><br><span class="line">    &lt;script src=&quot;./main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        btn.addEventListener(&apos;click&apos;,()=&gt;&#123;</span><br><span class="line">            let n = amount.innerText;</span><br><span class="line">            let number = parseInt(n,10);</span><br><span class="line">            let newNumber = number - 1;</span><br><span class="line">            amount.innerText = newNumber;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="运行-server001-js-所在目录-打开命令行运行"><a href="#运行-server001-js-所在目录-打开命令行运行" class="headerlink" title="运行 server001.js 所在目录  打开命令行运行"></a>运行 server001.js 所在目录  打开命令行运行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node server001.js 9999</span><br><span class="line">//你会看到</span><br><span class="line">监听 9999 成功</span><br><span class="line">请在浏览器输入 http://localhost:9999</span><br></pre></td></tr></table></figure>
<blockquote>
<p>打开浏览器输入 <a href="http://localhost:9999" target="_blank" rel="noopener">http://localhost:9999</a></p>
</blockquote>
<blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note033_0.png" alt="运行后"></p>
</blockquote>
<blockquote>
<p>点击按钮后你会看到  余额变动如下</p>
</blockquote>
<blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note033_1.png" alt="点击付款"></p>
</blockquote>
<h4 id="问题1-每次点击按钮都会把余额减1-但是浏览器只要刷新就会重新显示100"><a href="#问题1-每次点击按钮都会把余额减1-但是浏览器只要刷新就会重新显示100" class="headerlink" title="问题1 每次点击按钮都会把余额减1 但是浏览器只要刷新就会重新显示100"></a>问题1 每次点击按钮都会把余额减1 但是浏览器只要刷新就会重新显示100</h4><blockquote>
<p>如何长久的保存用户的数据呢？不可能你的余额永远是100吧  那岂不是有花不完的钱</p>
</blockquote>
<h4 id="长久的保存用户数据-保存到文件里"><a href="#长久的保存用户数据-保存到文件里" class="headerlink" title="长久的保存用户数据  保存到文件里"></a>长久的保存用户数据  保存到文件里</h4><blockquote>
<p>文件系统 将数据保存到服务器的文件里 这个文件专门为这个用户服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch db //创建 db 文件  </span><br><span class="line"></span><br><span class="line">vi db //打开之后写入100</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="版本二"><a href="#版本二" class="headerlink" title="版本二"></a>版本二</h2><h4 id="修改html里写死的100-换用一个‘匹配’字符替换-gt-“-amp-amp-amp-amount-amp-amp-amp-”"><a href="#修改html里写死的100-换用一个‘匹配’字符替换-gt-“-amp-amp-amp-amount-amp-amp-amp-”" class="headerlink" title="修改html里写死的100  换用一个‘匹配’字符替换 ==&gt; “&amp;&amp;&amp;amount&amp;&amp;&amp;”"></a>修改html里写死的100  换用一个‘匹配’字符替换 ==&gt; “&amp;&amp;&amp;amount&amp;&amp;&amp;”</h4><blockquote>
<p>index002.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//将这一行</span><br><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;100&lt;/span&gt; &lt;/h5&gt;</span><br><span class="line">//修改为</span><br><span class="line">//自己定义替换的匹配字符串 &quot;&amp;&amp;&amp;amount&amp;&amp;&amp;&quot; </span><br><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt; &amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt; &lt;/h5&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>server002.js 修改如下内容  从db读取 用户余额<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if(path==&apos;/&apos;)&#123;</span><br><span class="line">   var string = fs.readFileSync(&apos;./index002.html&apos;,&apos;utf8&apos;);</span><br><span class="line">   //读取db文件里用户余额</span><br><span class="line">   var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); //100</span><br><span class="line">   //替换 index002.html 里定义的 匹配字符 为 用户余额</span><br><span class="line">   string = string.replace(&apos;&amp;&amp;&amp;amount&amp;&amp;&amp;&apos;,amount);</span><br><span class="line">   response.setHeader(&apos;Content-Type&apos;,&apos;text/html;charset=utf-8&apos;);</span><br><span class="line">   response.write(string);</span><br><span class="line">   response.end();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>这样做了之后你会发现 一刷新 数据还是100 </p>
</blockquote>
<h4 id="解决长久保存"><a href="#解决长久保存" class="headerlink" title="解决长久保存"></a>解决长久保存</h4><blockquote>
<p>我们点击付款的时候  告诉服务器 请把数据库里的余额给我</p>
</blockquote>
<blockquote>
<p>所以我们点击付款的时候不能单独修改本地了 要去给服务器发 post请求</p>
</blockquote>
<blockquote>
<h3 id="为什么不是get-付款啊！这么重要的操作你敢用get"><a href="#为什么不是get-付款啊！这么重要的操作你敢用get" class="headerlink" title="为什么不是get 付款啊！这么重要的操作你敢用get?"></a>为什么不是get 付款啊！这么重要的操作你敢用get?</h3></blockquote>
<h2 id="版本三"><a href="#版本三" class="headerlink" title="版本三"></a>版本三</h2><h4 id="index003-html"><a href="#index003-html" class="headerlink" title="index003.html"></a>index003.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;form action=&quot;/pay&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;付款1块钱&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="server003-js"><a href="#server003-js" class="headerlink" title="server003.js"></a>server003.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if(path==&apos;/&apos;)&#123;</span><br><span class="line">  var string = fs.readFileSync(&apos;./index003.html&apos;,&apos;utf8&apos;);</span><br><span class="line">  var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); //100</span><br><span class="line">  string = string.replace(&apos;&amp;&amp;&amp;amount&amp;&amp;&amp;&apos;,amount);</span><br><span class="line">  response.setHeader(&apos;Content-Type&apos;,&apos;text/html;charset=utf-8&apos;);</span><br><span class="line">  response.write(string);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;else if(path==&apos;/pay&apos;&amp;&amp; method.toUpperCase() === &apos;POST&apos;)&#123;</span><br><span class="line">  //读取 db中用户余额</span><br><span class="line">  var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">  var newAmount = amount - 1;  //余额减1</span><br><span class="line">  fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额 </span><br><span class="line">  response.write(&apos;success&apos;);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  response.statusCode = 404;</span><br><span class="line">  response.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="再去开启你的服务器"><a href="#再去开启你的服务器" class="headerlink" title="再去开启你的服务器"></a>再去开启你的服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node server003.js 9999</span><br><span class="line">//在浏览器打开  http://localhost:9999</span><br></pre></td></tr></table></figure>
<p><a href="http://localhost:9999" target="_blank" rel="noopener">http://localhost:9999</a></p>
<ul>
<li>点击付款按钮</li>
<li>跳到 <a href="http://localhost:9999/pay" target="_blank" rel="noopener">http://localhost:9999/pay</a> 页面显示 success</li>
<li>点击浏览器返回   **注意：此时浏览器返回的是缓存页面  你要手动刷新一下</li>
<li>用户余额减少了</li>
</ul>
<blockquote>
<p>你去打开db文件 发现余额改变了</p>
</blockquote>
<h4 id="以上就是最最简单、最最原始的数据库的展示"><a href="#以上就是最最简单、最最原始的数据库的展示" class="headerlink" title="以上就是最最简单、最最原始的数据库的展示"></a>以上就是最最简单、最最原始的数据库的展示</h4><h4 id="再次修改一下server003-js里的代码"><a href="#再次修改一下server003-js里的代码" class="headerlink" title="再次修改一下server003.js里的代码"></a>再次修改一下server003.js里的代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;&amp;&amp; method.toUpperCase() === &apos;POST&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line">    if(Math.random()&gt;0.5)&#123;</span><br><span class="line">        fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额 </span><br><span class="line">        response.write(&apos;success&apos;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        response.write(&apos;fail&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="以上是：旧时代的前后端配合"><a href="#以上是：旧时代的前后端配合" class="headerlink" title="以上是：旧时代的前后端配合"></a>以上是：旧时代的前后端配合</h3><blockquote>
<p>操作数据库成功返回success 失败返回fail</p>
</blockquote>
<h3 id="在一个2018年的今天"><a href="#在一个2018年的今天" class="headerlink" title="在一个2018年的今天"></a>在一个2018年的今天</h3><blockquote>
<p>用户怎么可能忍受</p>
<ul>
<li>点击付款 </li>
<li>进入成功/失败页面</li>
<li>点击返回</li>
<li>点击刷新才看到你最新的数据</li>
</ul>
</blockquote>
<h3 id="form表单一旦提交不管成功还是失败一定会刷新当前页面"><a href="#form表单一旦提交不管成功还是失败一定会刷新当前页面" class="headerlink" title="form表单一旦提交不管成功还是失败一定会刷新当前页面"></a>form表单一旦提交不管成功还是失败一定会刷新当前页面</h3><h3 id="古老方式-优化一下用户体验"><a href="#古老方式-优化一下用户体验" class="headerlink" title="古老方式-优化一下用户体验"></a>古老方式-优化一下用户体验</h3><blockquote>
<p>用iframe承载这个form的提交 后的 success/fail响应  但是I现在已经没人用啦！</p>
</blockquote>
<h2 id="版本四"><a href="#版本四" class="headerlink" title="版本四"></a>版本四</h2><h4 id="index004-html"><a href="#index004-html" class="headerlink" title="index004.html"></a>index004.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">    &lt;form action=&quot;/pay&quot; method=&quot;post&quot; target=&quot;result&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;付款1块钱&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;iframe name=&quot;result&quot; src=&quot;about:blank&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h4 id="前端的高度洁癖-不用form向后台发送一个请求"><a href="#前端的高度洁癖-不用form向后台发送一个请求" class="headerlink" title="前端的高度洁癖 不用form向后台发送一个请求"></a>前端的高度洁癖 不用form向后台发送一个请求</h4><h2 id="版本五"><a href="#版本五" class="headerlink" title="版本五"></a>版本五</h2><h4 id="index005-html"><a href="#index005-html" class="headerlink" title="index005.html"></a>index005.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let img = document.createElement(&apos;img&apos;);</span><br><span class="line">        img.src = &apos;/pay&apos;;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>点击按钮的时候 会创建一个img标签 设置它的 src = ‘你的请求路径’ 就会触发请求</p>
</blockquote>
<h4 id="这样的缺陷就是-它无法post-它只能get"><a href="#这样的缺陷就是-它无法post-它只能get" class="headerlink" title="这样的缺陷就是 它无法post 它只能get"></a>这样的缺陷就是 它无法post 它只能get</h4><h4 id="问题来了？-我们如何知道它成功or失败呢？"><a href="#问题来了？-我们如何知道它成功or失败呢？" class="headerlink" title="问题来了？ 我们如何知道它成功or失败呢？"></a>问题来了？ 我们如何知道它成功or失败呢？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let img = document.createElement(&apos;img&apos;);</span><br><span class="line">        img.src = &apos;/pay&apos;;</span><br><span class="line">        //我们如何知道请求成功or失败呢？ </span><br><span class="line">        img.onload = function()&#123;</span><br><span class="line">            alert(&apos;打钱成功&apos;)</span><br><span class="line">            //我们帮用户刷新  但是会重绘整个页面</span><br><span class="line">            //window.location.reload();</span><br><span class="line">            //因为知道固定减1 所以我帮用户减1</span><br><span class="line">            amount.innerText = amount.innerText - 1;</span><br><span class="line">        &#125;</span><br><span class="line">        img.onerror = function()&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="server005-js"><a href="#server005-js" class="headerlink" title="server005.js"></a>server005.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line">    if(Math.random()&gt;0.5)&#123;</span><br><span class="line">        fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">        //设置响应头 </span><br><span class="line">        response.setHeader(&apos;Content-Type&apos;,&apos;image/png&apos;);</span><br><span class="line">        //设置状态码</span><br><span class="line">        response.statusCode = 200;</span><br><span class="line">        //返回响应的图片  不然 会走入img.onerror 事件里</span><br><span class="line">        response.write(fs.readFileSync(&apos;./dog.jpg&apos;));</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        response.statusCode = 400;</span><br><span class="line">        response.write(&apos;fail&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    response.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="这样我们就完成了-无刷新的发送请求-俗称-image发请求法"><a href="#这样我们就完成了-无刷新的发送请求-俗称-image发请求法" class="headerlink" title="这样我们就完成了 无刷新的发送请求  俗称 image发请求法"></a>这样我们就完成了 无刷新的发送请求  俗称 image发请求法</h4><h3 id="改良-script发请求法"><a href="#改良-script发请求法" class="headerlink" title="改良 script发请求法"></a>改良 script发请求法</h3><blockquote>
<h4 id="注意动态创建script-同时设置src-必须把script添加到body里才会生效"><a href="#注意动态创建script-同时设置src-必须把script添加到body里才会生效" class="headerlink" title="注意动态创建script 同时设置src 必须把script添加到body里才会生效"></a>注意动态创建script 同时设置src 必须把script添加到body里才会生效</h4></blockquote>
<h2 id="版本六"><a href="#版本六" class="headerlink" title="版本六"></a>版本六</h2><h4 id="server006-js"><a href="#server006-js" class="headerlink" title="server006.js"></a>server006.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/******** 从这里开始看，上面不要看 ************/</span><br><span class="line"></span><br><span class="line">console.log(&apos;被请求后：含查询字符串的路径\n&apos; + pathWithQuery)</span><br><span class="line"></span><br><span class="line">if(path==&apos;/&apos;)&#123;</span><br><span class="line">  var string = fs.readFileSync(&apos;./index006.html&apos;,&apos;utf8&apos;);</span><br><span class="line">  var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); //100</span><br><span class="line">  string = string.replace(&apos;&amp;&amp;&amp;amount&amp;&amp;&amp;&apos;,amount);</span><br><span class="line">  response.setHeader(&apos;Content-Type&apos;,&apos;text/html;charset=utf-8&apos;);</span><br><span class="line">  response.write(string);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">  //读取 db中用户余额</span><br><span class="line">  var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">  var newAmount = amount - 1;  //余额减1</span><br><span class="line">  if(Math.random()&gt;0.5)&#123;</span><br><span class="line">      fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">      //设置响应头 </span><br><span class="line">      response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">      //设置状态码</span><br><span class="line">      response.statusCode = 200;</span><br><span class="line">      //返回响应内容</span><br><span class="line">      response.write(&apos;&apos;);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">      response.statusCode = 400;</span><br><span class="line">      response.write(&apos;fail&apos;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  response.end();</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  response.statusCode = 404;</span><br><span class="line">  response.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/******** 代码结束，下面不要看 ************/</span><br></pre></td></tr></table></figure>
<h4 id="index006-html"><a href="#index006-html" class="headerlink" title="index006.html"></a>index006.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line">        script.src = &apos;/pay&apos;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        //我们如何知道请求成功or失败呢？ </span><br><span class="line">        script.onload = function()&#123;</span><br><span class="line">            alert(&apos;打钱成功&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">        script.onerror = function()&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样每次点击会生成一个script </p>
</blockquote>
<h4 id="我们知道-script里的代码是会执行的"><a href="#我们知道-script里的代码是会执行的" class="headerlink" title="我们知道 script里的代码是会执行的"></a>我们知道 script里的代码是会执行的</h4><blockquote>
<p>所以我们就不需要在 server006.js里写失败的情况 它会自动进入 script.onerror里</p>
</blockquote>
<h4 id="step1修改server006-js"><a href="#step1修改server006-js" class="headerlink" title="step1修改server006.js"></a>step1修改server006.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(&apos;alert(&quot;pay&quot;)&apos;);</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行发现如果成功了 就会 弹出pay  然后再弹出‘打钱成功’</p>
</blockquote>
<h4 id="不用监听script-onload了"><a href="#不用监听script-onload了" class="headerlink" title="不用监听script.onload了"></a>不用监听script.onload了</h4><blockquote>
<p>因为 成功自然会在server006.js 里 写入并执行 response.write(‘alert(“pay”)’);</p>
</blockquote>
<h2 id="版本七"><a href="#版本七" class="headerlink" title="版本七"></a>版本七</h2><h4 id="index007-html"><a href="#index007-html" class="headerlink" title="index007.html"></a>index007.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line">        script.src = &apos;/pay&apos;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        script.onerror = function()&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="server007-js"><a href="#server007-js" class="headerlink" title="server007.js"></a>server007.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(</span><br><span class="line">      `</span><br><span class="line">      amount.innerText = amount.innerText - 1;</span><br><span class="line">      `</span><br><span class="line">    );</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br></pre></td></tr></table></figure>
<h4 id="优化上面运行后每次点击按钮页面都会多一个script标签"><a href="#优化上面运行后每次点击按钮页面都会多一个script标签" class="headerlink" title="优化上面运行后每次点击按钮页面都会多一个script标签"></a>优化上面运行后每次点击按钮页面都会多一个script标签</h4><blockquote>
<p>成功或者失败后干掉script</p>
</blockquote>
<h2 id="版本八"><a href="#版本八" class="headerlink" title="版本八"></a>版本八</h2><h4 id="index008-html"><a href="#index008-html" class="headerlink" title="index008.html"></a>index008.html</h4><blockquote>
<p>注意:server里文件路径</p>
</blockquote>
<blockquote>
<p>所以我们还是得监听onload事件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line">        script.src = &apos;/pay&apos;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        script.onload = function(e)&#123;</span><br><span class="line">            alert(&apos;打钱成功&apos;)</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        script.onerror = function(e)&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="注意：不管成功还是失败script都会移除-但是script还在内存里只是从页面移除了"><a href="#注意：不管成功还是失败script都会移除-但是script还在内存里只是从页面移除了" class="headerlink" title="注意：不管成功还是失败script都会移除 但是script还在内存里只是从页面移除了"></a>注意：不管成功还是失败script都会移除 但是script还在内存里只是从页面移除了</h4></blockquote>
<h4 id="这个方案就叫-SRJ-Server-rendered-javascript-服务器返回的-javascript"><a href="#这个方案就叫-SRJ-Server-rendered-javascript-服务器返回的-javascript" class="headerlink" title="这个方案就叫 SRJ  (Server rendered javascript)服务器返回的 javascript"></a>这个方案就叫 SRJ  (Server rendered javascript)服务器返回的 javascript</h4><blockquote>
<p>无刷新局部更新页面内容的方案 在ajax之前</p>
</blockquote>
<h3 id="script是不受域名限制的-这跟跨域没关系"><a href="#script是不受域名限制的-这跟跨域没关系" class="headerlink" title="script是不受域名限制的 这跟跨域没关系"></a>script是不受域名限制的 这跟跨域没关系</h3><blockquote>
<p>aa.com:9999的前端 是可以访问  bb.com:8888的后台接口的 这就是SRJ</p>
</blockquote>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><h4 id="查看后端代码-发现–-后端要对前端代码非常了解"><a href="#查看后端代码-发现–-后端要对前端代码非常了解" class="headerlink" title="查看后端代码 发现– 后端要对前端代码非常了解"></a>查看后端代码 发现– 后端要对前端代码非常了解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(</span><br><span class="line">      `</span><br><span class="line">      amount.innerText = amount.innerText - 1;</span><br><span class="line">      `</span><br><span class="line">    );</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>bb.com:8888的后端居然要对 aa.com:9999的页面如此清楚</p>
</blockquote>
<h4 id="耦合"><a href="#耦合" class="headerlink" title="耦合"></a>耦合</h4><h4 id="解耦"><a href="#解耦" class="headerlink" title="解耦"></a>解耦</h4><h2 id="版本九"><a href="#版本九" class="headerlink" title="版本九"></a>版本九</h2><h4 id="index009-html"><a href="#index009-html" class="headerlink" title="index009.html"></a>index009.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //某域名下的前端  bb.com:9999的前端</span><br><span class="line">    window.xxx = function(result)&#123;</span><br><span class="line">        alert(`得到了结果是$&#123;result&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line">        script.src = &apos;/pay&apos;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        script.onload = function(e)&#123;</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        script.onerror = function(e)&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="server009-js"><a href="#server009-js" class="headerlink" title="server009.js"></a>server009.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(</span><br><span class="line">      `</span><br><span class="line">      xxx.call(undefined,&apos;success&apos;) //执行xxx方法并返回  字符串</span><br><span class="line">      `</span><br><span class="line">    );</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="这样的好处是什么"><a href="#这样的好处是什么" class="headerlink" title="这样的好处是什么"></a>这样的好处是什么</h3><ul>
<li>后端不需要知道任何细节，只调用xxx.call()返回结果</li>
<li>这样两个网站之间就可以无缝的沟通</li>
</ul>
<h4 id="xxx-call-是不是很丑？"><a href="#xxx-call-是不是很丑？" class="headerlink" title="xxx.call()是不是很丑？"></a>xxx.call()是不是很丑？</h4><ul>
<li>于是传递一个参数callback=xxx </li>
<li>callback =’你自己定义的方法名’</li>
</ul>
<h2 id="版本十"><a href="#版本十" class="headerlink" title="版本十"></a>版本十</h2><h4 id="index010-html"><a href="#index010-html" class="headerlink" title="index010.html"></a>index010.html</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //某域名下的前端  bb.com:9999的前端</span><br><span class="line">    window.yyy = function(result)&#123;</span><br><span class="line">        alert(`得到了结果是$&#123;result&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line">        //传递自己定义的方法名</span><br><span class="line">        script.src = &apos;/pay?callback=yyy&apos;;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        script.onload = function(e)&#123;</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        script.onerror = function(e)&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="server010-js"><a href="#server010-js" class="headerlink" title="server010.js"></a>server010.js</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(</span><br><span class="line">      `</span><br><span class="line">      $&#123;query.callback&#125;.call(undefined,&apos;success&apos;)</span><br><span class="line">      `</span><br><span class="line">    );</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="JSONP解决的问题是什么-两个网站之间如何交流"><a href="#JSONP解决的问题是什么-两个网站之间如何交流" class="headerlink" title="JSONP解决的问题是什么  两个网站之间如何交流"></a>JSONP解决的问题是什么  两个网站之间如何交流</h4><ul>
<li>因为script是不受域名限制的 ajax是受域名限制的</li>
<li>由于不受域名限制,我就告诉对方的网站 我要请求一个数据，</li>
<li>请你把数据给我 </li>
<li>你给我之后调用我的xxx </li>
<li>然后把参数给我 xxx.call(undefined,参数)</li>
</ul>
<h4 id="传递的参数不仅仅是字符串还可以是json"><a href="#传递的参数不仅仅是字符串还可以是json" class="headerlink" title="传递的参数不仅仅是字符串还可以是json"></a>传递的参数不仅仅是字符串还可以是json</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">response.write(</span><br><span class="line">     `</span><br><span class="line">     $&#123;query.callback&#125;.call(undefined,&#123;</span><br><span class="line">         &quot;success&quot;:true,</span><br><span class="line">         &quot;data&quot;:99</span><br><span class="line">     &#125;)</span><br><span class="line">     `</span><br><span class="line">   );</span><br></pre></td></tr></table></figure>
<blockquote>
<p>json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;:true,</span><br><span class="line">    &quot;data&quot;:99</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>json的左边是 左padding : ${query.callback}.call(undefined,</p>
</blockquote>
<blockquote>
<p>json的右边是 右padding : )</p>
</blockquote>
<blockquote>
<p>于是乎   JSON + padding = JSONP</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note033_2.png" alt="jsonp"></p>
<h2 id="版本十一"><a href="#版本十一" class="headerlink" title="版本十一"></a>版本十一</h2><h3 id="index011-html"><a href="#index011-html" class="headerlink" title="index011.html"></a>index011.html</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let script = document.createElement(&apos;script&apos;);</span><br><span class="line"></span><br><span class="line">        //生成无重复的方法名</span><br><span class="line">        let fnName = &apos;hjx&apos;+parseInt(Math.random()*100000,10);</span><br><span class="line">        window[fnName] = function(result)&#123;</span><br><span class="line">            //根据接收的json结果做处理</span><br><span class="line">            if(result === &apos;success&apos;)&#123;</span><br><span class="line">                amount.innerText = amount.innerText - 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //传递自己定义的方法名</span><br><span class="line">        script.src = &apos;/pay?callback=&apos; + fnName;</span><br><span class="line">        document.body.appendChild(script);</span><br><span class="line">        script.onload = function(e)&#123;</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">            //不管成功失败都要删除生成的fnName属性</span><br><span class="line">            delete window[fnName];</span><br><span class="line">        &#125;</span><br><span class="line">        script.onerror = function(e)&#123;</span><br><span class="line">            alert(&apos;打钱失败&apos;)</span><br><span class="line">            e.currentTarget.remove();</span><br><span class="line">            //不管成功失败都要删除生成的fnName属性</span><br><span class="line">            delete window[fnName];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="server011-js"><a href="#server011-js" class="headerlink" title="server011.js"></a>server011.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">var http = require(&apos;http&apos;)</span><br><span class="line">var fs = require(&apos;fs&apos;)</span><br><span class="line">var url = require(&apos;url&apos;)</span><br><span class="line">var port = process.argv[2]</span><br><span class="line"></span><br><span class="line">if(!port)&#123;</span><br><span class="line">  console.log(&apos;请指定端口号好不啦？\nnode server.js 8888 这样不会吗？&apos;)</span><br><span class="line">  process.exit(1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function(request, response)&#123;</span><br><span class="line">  var parsedUrl = url.parse(request.url, true)</span><br><span class="line">  var pathWithQuery = request.url </span><br><span class="line">  var queryString = &apos;&apos;</span><br><span class="line">  if(pathWithQuery.indexOf(&apos;?&apos;) &gt;= 0)&#123; queryString = pathWithQuery.substring(pathWithQuery.indexOf(&apos;?&apos;)) &#125;</span><br><span class="line">  var path = parsedUrl.pathname</span><br><span class="line">  var query = parsedUrl.query</span><br><span class="line">  var method = request.method</span><br><span class="line"></span><br><span class="line">  /******** 从这里开始看，上面不要看 ************/</span><br><span class="line"></span><br><span class="line">  console.log(&apos;被请求后：含查询字符串的路径\n&apos; + pathWithQuery)</span><br><span class="line"></span><br><span class="line">  if(path==&apos;/&apos;)&#123;</span><br><span class="line">    var string = fs.readFileSync(&apos;./index011.html&apos;,&apos;utf8&apos;);</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); //100</span><br><span class="line">    string = string.replace(&apos;&amp;&amp;&amp;amount&amp;&amp;&amp;&apos;,amount);</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;text/html;charset=utf-8&apos;);</span><br><span class="line">    response.write(string);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;else if(path==&apos;/style.css&apos;)&#123;</span><br><span class="line">    var string = fs.readFileSync(&apos;./style.css&apos;,&apos;utf8&apos;);</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;text/css&apos;);</span><br><span class="line">    response.write(string);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;else if(path==&apos;/main.js&apos;)&#123;</span><br><span class="line">    var string = fs.readFileSync(&apos;./main.js&apos;,&apos;utf8&apos;);</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;text/javascript&apos;);</span><br><span class="line">    response.write(string);</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;else if(path==&apos;/pay&apos;)&#123;</span><br><span class="line">    //读取 db中用户余额</span><br><span class="line">    var amount = fs.readFileSync(&apos;./db&apos;,&apos;utf8&apos;); </span><br><span class="line">    var newAmount = amount - 1;  //余额减1</span><br><span class="line"> </span><br><span class="line">    fs.writeFileSync(&apos;./db&apos;,newAmount);  //更新余额</span><br><span class="line">    //设置响应头 </span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;,&apos;application/javascript&apos;);</span><br><span class="line">    //设置状态码</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    //返回响应内容</span><br><span class="line">    response.write(</span><br><span class="line">      `</span><br><span class="line">      $&#123;query.callback&#125;.call(undefined,&apos;success&apos;)</span><br><span class="line">      `</span><br><span class="line">    );</span><br><span class="line">   </span><br><span class="line">    response.end();</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    response.statusCode = 404;</span><br><span class="line">    response.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /******** 代码结束，下面不要看 ************/</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(port)</span><br><span class="line">console.log(&apos;监听 &apos; + port + &apos; 成功\n请在浏览器输入 http://localhost:&apos; + port)</span><br></pre></td></tr></table></figure>
<h4 id="写了那么多-其实你可以使用jQuery-几句话就能搞定"><a href="#写了那么多-其实你可以使用jQuery-几句话就能搞定" class="headerlink" title="写了那么多  其实你可以使用jQuery 几句话就能搞定"></a>写了那么多  其实你可以使用jQuery 几句话就能搞定</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;h5&gt;您的账户余额是 &lt;span id=&quot;amount&quot;&gt;&amp;&amp;&amp;amount&amp;&amp;&amp;&lt;/span&gt;&lt;/h5&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;打钱&lt;/button&gt;</span><br><span class="line">&lt;script src=&quot;//code.jquery.com/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    btn.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:&quot;http://localhost:9999/pay&quot;,</span><br><span class="line">            dataType:&quot;jsonp&quot;,</span><br><span class="line">            success:function(res)&#123;</span><br><span class="line">                console.log(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)            </span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="注意：-ajax-只是把jsonp归纳到-jq里-而它不是ajax"><a href="#注意：-ajax-只是把jsonp归纳到-jq里-而它不是ajax" class="headerlink" title="注意： $.ajax()只是把jsonp归纳到 jq里  而它不是ajax"></a>注意： $.ajax()只是把jsonp归纳到 jq里  而它不是ajax</h4><h3 id="考点1-：请问JSONP为什么不支持POST请求"><a href="#考点1-：请问JSONP为什么不支持POST请求" class="headerlink" title="考点1 ：请问JSONP为什么不支持POST请求"></a>考点1 ：请问JSONP为什么不支持POST请求</h3><ul>
<li>因为JSONP是通过动态创建script实现的</li>
<li>我们动态创建script的时候只能用get 没有办法用post</li>
</ul>
<h3 id="考点2-：-什么是-JSONP？"><a href="#考点2-：-什么是-JSONP？" class="headerlink" title="考点2 ： 什么是 JSONP？"></a>考点2 ： 什么是 JSONP？</h3><ul>
<li>1请求方创建一个script标签src指向响应方，并传递callback =回调函数名</li>
<li>2响应方根据callback查询参数构造一个 xxx.call(undefined,传递的内容)</li>
<li>3浏览器接到响应，就会执行 xxx.call(undefined,传递的内容)</li>
<li>4请求方得到他想要的数据</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/03/N033_JSONP是什么鬼/" data-id="ckl3ypv120078si91loivqftx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N032_DOM事件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/01/N032_DOM事件/" class="article-date">
  <time datetime="2017-12-01T07:39:47.000Z" itemprop="datePublished">2017-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/01/N032_DOM事件/">DOM事件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="事件模型应用-点击显示浮层-点击其它地方关闭浮层"><a href="#事件模型应用-点击显示浮层-点击其它地方关闭浮层" class="headerlink" title="事件模型应用 点击显示浮层 点击其它地方关闭浮层"></a>事件模型应用 点击显示浮层 点击其它地方关闭浮层</h3><blockquote>
<p>问题1 点击按钮浮层不出现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;wrapper&quot; class=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;clickMe&quot;&gt;点我&lt;/button&gt;</span><br><span class="line">    &lt;div id=&quot;popover&quot; class=&quot;popover&quot;&gt;</span><br><span class="line">      浮层</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //点击显示浮层 </span><br><span class="line">    clickMe.addEventListener(&apos;click&apos;, function()&#123;</span><br><span class="line">        popover.style.display = &apos;block&apos;;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    document.addEventListener(&apos;click&apos;, function()&#123;</span><br><span class="line">        popover.style.display = &apos;none&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>点击按钮的时候浮层确实出现了 </p>
</blockquote>
<blockquote>
<p>但是addEventListener(‘事件’,fn,布尔值) 第三个参数不传代表false 代表冒泡</p>
</blockquote>
<blockquote>
<p>冒泡到document  </p>
</blockquote>
<blockquote>
<p>document 发现事件队列里有 fn于是执行   popover.style.display = ‘none’</p>
</blockquote>
<h3 id="如何解决-gt-event-stopPropagation"><a href="#如何解决-gt-event-stopPropagation" class="headerlink" title="如何解决 ==&gt; event.stopPropagation();"></a>如何解决 ==&gt; event.stopPropagation();</h3><blockquote>
<p>Prevents further propagation of the current event in the capturing and bubbling phases.</p>
</blockquote>
<blockquote>
<p>防止当前事件在捕获和冒泡阶段的进一步传播。</p>
</blockquote>
<blockquote>
<h5 id="早一点的前端肯定会认为还有一个方法阻止冒泡-event-cancelBubble-true-不好意思-该属性已废弃"><a href="#早一点的前端肯定会认为还有一个方法阻止冒泡-event-cancelBubble-true-不好意思-该属性已废弃" class="headerlink" title="早一点的前端肯定会认为还有一个方法阻止冒泡 event.cancelBubble = true ;不好意思 该属性已废弃"></a>早一点的前端肯定会认为还有一个方法阻止冒泡 event.cancelBubble = true ;不好意思 该属性已废弃</h5></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//点击显示浮层 </span><br><span class="line">clickMe.addEventListener(&apos;click&apos;, function(event)&#123;</span><br><span class="line">    popover.style.display = &apos;block&apos;;</span><br><span class="line">    event.stopPropagation(); //这样冒泡阶段就被禁止了 </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">document.addEventListener(&apos;click&apos;, function()&#123;</span><br><span class="line">    popover.style.display = &apos;none&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="问题2-虽然解决了阻止冒泡-但是当你点击浮层时-浮层也会消失"><a href="#问题2-虽然解决了阻止冒泡-但是当你点击浮层时-浮层也会消失" class="headerlink" title="问题2 虽然解决了阻止冒泡 但是当你点击浮层时  浮层也会消失"></a>问题2 虽然解决了阻止冒泡 但是当你点击浮层时  浮层也会消失</h3><blockquote>
<p>这样就不能在按钮上阻止冒泡 因为点击浮层也会冒泡到wrapper</p>
<ul>
<li>因为btn会冒泡到 wrapper </li>
<li>popover会冒泡到 wrapper</li>
<li>所以在它们的父节点做阻止冒泡</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;wrapper&quot; class=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;clickMe&quot;&gt;点我&lt;/button&gt;</span><br><span class="line">    &lt;div id=&quot;popover&quot; class=&quot;popover&quot;&gt;</span><br><span class="line">        浮层</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">clickMe.addEventListener(&apos;click&apos;, function(e)&#123;</span><br><span class="line">    popover.style.display = &apos;block&apos;;</span><br><span class="line">&#125;)</span><br><span class="line">wrapper.addEventListener(&apos;click&apos;,function(e)&#123;</span><br><span class="line">    //解决点击浮层触发的冒泡</span><br><span class="line">    e.stopPropagation()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">document.addEventListener(&apos;click&apos;, function()&#123;</span><br><span class="line">    popover.style.display = &apos;none&apos;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="问题3-现在点击按钮浮层出现-点击浮层浮层浮层不消失-但是有性能问题"><a href="#问题3-现在点击按钮浮层出现-点击浮层浮层浮层不消失-但是有性能问题" class="headerlink" title="问题3 现在点击按钮浮层出现  点击浮层浮层浮层不消失 但是有性能问题"></a>问题3 现在点击按钮浮层出现  点击浮层浮层浮层不消失 但是有性能问题</h3><ul>
<li>100个浮层就是100个事件队列  10000个呢？</li>
</ul>
<blockquote>
<p>现在我们先换jq来实现刚刚的效果</p>
</blockquote>
<blockquote>
<h3 id="jq提供了一个非常方便的方法-node-on-‘click’-false-第二个参数代表-阻止默认事件-和阻止传播"><a href="#jq提供了一个非常方便的方法-node-on-‘click’-false-第二个参数代表-阻止默认事件-和阻止传播" class="headerlink" title="jq提供了一个非常方便的方法  $(node).on(‘click’,false) 第二个参数代表 阻止默认事件 和阻止传播"></a>jq提供了一个非常方便的方法  $(node).on(‘click’,false) 第二个参数代表 阻止默认事件 和阻止传播</h3></blockquote>
<h3 id="又偶生出一个bug-就是-on-‘事件’-false-你在checkbox外的任何一层-阻止默认事件-这个checkbox就无法选中"><a href="#又偶生出一个bug-就是-on-‘事件’-false-你在checkbox外的任何一层-阻止默认事件-这个checkbox就无法选中" class="headerlink" title="又偶生出一个bug 就是.on(‘事件’,false) 你在checkbox外的任何一层 阻止默认事件 这个checkbox就无法选中"></a>又偶生出一个bug 就是.on(‘事件’,false) 你在checkbox外的任何一层 阻止默认事件 这个checkbox就无法选中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;wrapper&quot; class=&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;clickMe&quot;&gt;点我&lt;/button&gt;</span><br><span class="line">    &lt;div id=&quot;popover&quot; class=&quot;popover&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;checkbox&quot;&gt;浮层</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$(clickMe).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).show();</span><br><span class="line">&#125;);</span><br><span class="line">// 这样会再次出bug就是  如果浮层里有checkbox就无法选中 因为阻止了默认事件 </span><br><span class="line">$(wrapper).on(&apos;click&apos;,false)  </span><br><span class="line"></span><br><span class="line">$(document).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).hide();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所以我们还是单独阻止传播 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(clickMe).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).show();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(wrapper).on(&apos;click&apos;,function(e)&#123;</span><br><span class="line">    e.stopPropagation(); //阻止冒泡</span><br><span class="line">&#125;);  </span><br><span class="line"></span><br><span class="line">$(document).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).hide();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="解决问题3-性能问题"><a href="#解决问题3-性能问题" class="headerlink" title="解决问题3 性能问题"></a>解决问题3 性能问题</h3><ul>
<li>点击按钮的时候显示浮层 同时添加一个document监听</li>
<li>为什么监听不会触发 因为 wrapper哪里阻止了 冒泡<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(clickMe).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).show();</span><br><span class="line">    //只有显示的时候监听一次 但是不会触发  因为 wrapper上阻止了冒泡</span><br><span class="line">    //这样我只监听一次 click 同时马上干掉这个监听事件   </span><br><span class="line">    $(document).one(&apos;click&apos;,function()&#123;</span><br><span class="line">      console.log(&apos;doc&apos;)</span><br><span class="line">      $(popover).hide();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//所以只能这样写  单独阻止它的冒泡 不阻止默认事件</span><br><span class="line">$(wrapper).on(&apos;click&apos;,function(e)&#123;</span><br><span class="line">    e.stopPropagation(); //阻止冒泡</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="问题4-如果不在wrapper上不阻止冒泡-点击btn为什么浮层不显示"><a href="#问题4-如果不在wrapper上不阻止冒泡-点击btn为什么浮层不显示" class="headerlink" title="问题4 如果不在wrapper上不阻止冒泡 点击btn为什么浮层不显示"></a>问题4 如果不在wrapper上不阻止冒泡 点击btn为什么浮层不显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(clickMe).on(&apos;click&apos;,function()&#123;</span><br><span class="line">    $(popover).show();</span><br><span class="line">    //只有显示的时候监听一次 但是不会触发  因为 wrapper上阻止了冒泡</span><br><span class="line">    //这样我只监听一次 click 同时马上干掉这个监听事件   </span><br><span class="line">    $(document).one(&apos;click&apos;,function()&#123;</span><br><span class="line">      console.log(&apos;doc&apos;)</span><br><span class="line">      $(popover).hide();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>在你点击btn的时候它会做两件事</li>
<li>1 浮层显示出来</li>
<li>2 document的事件队列里 添加一个函数</li>
<li>3 事件开始冒泡</li>
<li>4 开始发现 document的事件队列里有一个函数</li>
<li>5 执行 document事件队列里的函数</li>
<li>6 浮层隐藏了</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/01/N032_DOM事件/" data-id="ckl3ypv100073si91by6hzt47" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N030_DOM事件初识" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/01/N030_DOM事件初识/" class="article-date">
  <time datetime="2017-12-01T01:00:47.000Z" itemprop="datePublished">2017-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/01/N030_DOM事件初识/">DOM事件初识</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="DOM事件"><a href="#DOM事件" class="headerlink" title="DOM事件"></a>DOM事件</h3><p>如果你想深挖请google搜索「dom spec」 <a href="https://www.w3.org/DOM/DOMTR" target="_blank" rel="noopener">dom spec</a></p>
<ul>
<li>Document Object Model (DOM) Level 1 只对基本的事件进行了汇总</li>
<li>Document Object Model (DOM) Level 2 增加了 Events 对事件的详细说明</li>
<li>Document Object Model (DOM) Level 3 并没有增加 Events 的相关修订</li>
<li>Document Object Model (DOM) Level 4 还在草案阶段</li>
</ul>
<blockquote>
<p>结论目前我们使用事件最新最广泛的标准是  dom level 2 (2000年11月3号)</p>
</blockquote>
<h4 id="dom-1-的一个经典问题"><a href="#dom-1-的一个经典问题" class="headerlink" title="dom 1 的一个经典问题"></a>dom 1 的一个经典问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    function print()&#123;console.log(&apos;Hi&apos;)&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;button id=&quot;x&quot; onclick=&quot;print&quot;&gt;A&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;y&quot; onclick=&quot;print()&quot;&gt;B&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;z&quot; onclick=&quot;print.call()&quot;&gt;C&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    x.onclick = print;</span><br><span class="line">    y.onclick = print();</span><br><span class="line">    z.onclick = print.call();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当把事件写在标签上的时候那个是正确调用 「B C」</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">写在标签上的事件</span><br><span class="line">onclick=&quot;要执行的代码&quot;</span><br><span class="line">一旦用户点击，浏览器就eval(&quot;要执行的代码&quot;)</span><br></pre></td></tr></table></figure>
<p>当把事件写在JS上的时候那个是正确调用 「x」</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">写在JS里的事件</span><br><span class="line">onclick=&quot;函数&quot;</span><br><span class="line">一旦用户点击，浏览器就 x.onclick.call(x,函数)</span><br></pre></td></tr></table></figure>
<h4 id="dom2-事件队列"><a href="#dom2-事件队列" class="headerlink" title="dom2 事件队列"></a>dom2 事件队列</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    console.log(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>你肯定问怎么比 onclick更麻烦了</p>
</blockquote>
<ul>
<li>onclick是唯一的</li>
<li>出现两次onclick就会发生覆盖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxx.onclick = function()&#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">&#125;</span><br><span class="line">// 第一个onclick被覆盖了  只会打印2</span><br><span class="line">xxx.onclick = function()&#123;</span><br><span class="line">    console.log(2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="事件队列的好处-eventListeners"><a href="#事件队列的好处-eventListeners" class="headerlink" title="事件队列的好处 eventListeners"></a>事件队列的好处 eventListeners</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxx.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">&#125;) </span><br><span class="line">xxx.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">    console.log(2)</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">当xxx被点击 打印 1 和 2</span><br></pre></td></tr></table></figure>
<h4 id="事件的移除"><a href="#事件的移除" class="headerlink" title="事件的移除"></a>事件的移除</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function f1()&#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">&#125;</span><br><span class="line">function f2()&#123;</span><br><span class="line">    console.log(2)</span><br><span class="line">&#125;</span><br><span class="line">xxx.addEventListener(&apos;click&apos;,f1)</span><br><span class="line">xxx.addEventListener(&apos;click&apos;,f2)</span><br><span class="line">//移除事件队列里的 f1</span><br><span class="line">xxx.removeEventListener(&apos;click&apos;,f1)</span><br><span class="line"></span><br><span class="line">点击xxx后 打印 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如何实现只监听one一次的效果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function f1()&#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">    //移除事件队列里的 f1</span><br><span class="line">    xxx.removeEventListener(&apos;click&apos;,f1)</span><br><span class="line">&#125;</span><br><span class="line">xxx.addEventListener(&apos;click&apos;,f1)</span><br></pre></td></tr></table></figure>
<h4 id="问题1-当我点击儿子的时候，我是否点击了-爸爸和爷爷-》yes"><a href="#问题1-当我点击儿子的时候，我是否点击了-爸爸和爷爷-》yes" class="headerlink" title="问题1  当我点击儿子的时候，我是否点击了 爸爸和爷爷 ==》yes"></a>问题1  当我点击儿子的时候，我是否点击了 爸爸和爷爷 ==》yes</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;grand1&quot;&gt;</span><br><span class="line">    爷爷</span><br><span class="line">    &lt;div id=&quot;parent1&quot;&gt;</span><br><span class="line">        爸爸</span><br><span class="line">        &lt;div id=&quot;child1&quot;&gt;</span><br><span class="line">            儿子</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h4 id="问题2-当我点击儿子的时候，三个函数是否调用-gt-yes"><a href="#问题2-当我点击儿子的时候，三个函数是否调用-gt-yes" class="headerlink" title="问题2 当我点击儿子的时候，三个函数是否调用 ==&gt; yes"></a>问题2 当我点击儿子的时候，三个函数是否调用 ==&gt; yes</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">grand1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;爷爷&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">parent1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;爸爸&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="问题3-三个函数的执行顺序-gt-1-2-3-or-3-2-1-答案是都可以"><a href="#问题3-三个函数的执行顺序-gt-1-2-3-or-3-2-1-答案是都可以" class="headerlink" title="问题3 三个函数的执行顺序 ==&gt; 1 2 3 or 3 2 1 答案是都可以"></a>问题3 三个函数的执行顺序 ==&gt; 1 2 3 or 3 2 1 答案是都可以</h4><blockquote>
<p>addEventListener(‘事件’,函数,可选参数) </p>
</blockquote>
<blockquote>
<p>第三个参数是 boolean值  不传代表false : 0 NaN undefined null false ‘’</p>
</blockquote>
<blockquote>
<p>false的话 顺序从内到外 儿子  爸爸  爷爷</p>
</blockquote>
<blockquote>
<p>true 的话 顺序从外到内 爷爷  爸爸  儿子</p>
</blockquote>
<blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/note032_0.png" alt="推荐"></p>
</blockquote>
<blockquote>
<p>爷爷设置true 其他设置false </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grand1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;爷爷&apos;)</span><br><span class="line">&#125;,true)</span><br><span class="line"></span><br><span class="line">parent1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;爸爸&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">// 爷爷  儿子  爸爸</span><br></pre></td></tr></table></figure>
<h4 id="考点-如果-儿子节点既有捕获又有冒泡执行顺序是什么"><a href="#考点-如果-儿子节点既有捕获又有冒泡执行顺序是什么" class="headerlink" title="考点 如果  儿子节点既有捕获又有冒泡执行顺序是什么"></a>考点 如果  儿子节点既有捕获又有冒泡执行顺序是什么</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子捕获&apos;)</span><br><span class="line">&#125;,true)</span><br><span class="line"></span><br><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子冒泡&apos;)</span><br><span class="line">&#125;,false)</span><br><span class="line"></span><br><span class="line">// 儿子捕获</span><br><span class="line">// 儿子冒泡</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子冒泡&apos;)</span><br><span class="line">&#125;,false)</span><br><span class="line"></span><br><span class="line">child1.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">  console.log(&apos;儿子捕获&apos;)</span><br><span class="line">&#125;,true)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 儿子冒泡</span><br><span class="line">// 儿子捕获</span><br></pre></td></tr></table></figure>
<blockquote>
<p>答案是 谁写在前面谁先触发</p>
</blockquote>
<p>如果触发在元素本身上是不区分捕获和冒泡的</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/01/N030_DOM事件初识/" data-id="ckl3ypv0z0070si91bh4ygzvg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-N029_02前端该遵守的原则" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/30/N029_02前端该遵守的原则/" class="article-date">
  <time datetime="2017-11-30T02:27:42.000Z" itemprop="datePublished">2017-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/30/N029_02前端该遵守的原则/">前端的自我修养</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="HTML-CSS-JS-内容、样式和行为分离原则"><a href="#HTML-CSS-JS-内容、样式和行为分离原则" class="headerlink" title="HTML/CSS/JS 内容、样式和行为分离原则"></a>HTML/CSS/JS 内容、样式和行为分离原则</h3><p>如果你去面试可能会被问道如下问题</p>
<blockquote>
<h4 id="请你说一下你对前端内容样式行为分离的原则"><a href="#请你说一下你对前端内容样式行为分离的原则" class="headerlink" title="请你说一下你对前端内容样式行为分离的原则?"></a>请你说一下你对前端内容样式行为分离的原则?</h4></blockquote>
<blockquote>
<p>如果你初出茅庐可能会这样回答 html负责内容css负责样式js负责行为</p>
</blockquote>
<p>但是这是大家都认可的真理，我为什么要解释原因呢！</p>
<blockquote>
<h4 id="正确做法！！！-你该这样用初中几何常用套路「反证法」"><a href="#正确做法！！！-你该这样用初中几何常用套路「反证法」" class="headerlink" title="正确做法！！！ 你该这样用初中几何常用套路「反证法」"></a>正确做法！！！ 你该这样用初中几何常用套路「反证法」</h4></blockquote>
<p>请看解题思路(如果你是程序员这就是「伪代码」)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">问：人类为什么吃饭</span><br><span class="line">答: 如果不吃饭人类就会死，所以人类需要吃饭</span><br></pre></td></tr></table></figure>
<p>你该这样回答</p>
<ol>
<li>如果html负责样式</li>
</ol>
<ul>
<li>会让html变得很复杂</li>
<li>很难区分这些标签的逻辑结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;body bgcolor=red&gt;</span><br><span class="line">    &lt;center&gt;</span><br><span class="line">        &lt;font color=red&gt;你好&lt;/font&gt;</span><br><span class="line">    &lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>用css表示内容</li>
</ol>
<ul>
<li>人类选不中</li>
<li>JS取不到  </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    div::after&#123;content:&apos;你好你好你好&apos;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;xxx&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        console.log(xxx.innerText) // 啥都没</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>用JS控制样式</li>
</ol>
<blockquote>
<p>你该避免使用jQuery的 show/hide方法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;xxx&quot;&gt;&lt;/div&gt;</span><br><span class="line">     &lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">       </span><br><span class="line">       $(&quot;#xxx&quot;).hide() // display:none; 隐藏没有任何问题</span><br><span class="line"></span><br><span class="line">       $(&quot;#xxx&quot;).show() // 但是 show就有问题了</span><br><span class="line">       /*</span><br><span class="line">       display:inline-block;</span><br><span class="line">       display:flex;</span><br><span class="line">       display:inline;</span><br><span class="line">       */</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>show()之后你很难定位 div隐藏之前是什么 可能是flex也可能是 block</p>
</blockquote>
<p>因为jQuery为了让你使用它的库，就特殊处理了</p>
<ul>
<li>在你hide的时候把display这个值存起来</li>
<li>当你show的时候把display这个值赋回去</li>
</ul>
<blockquote>
<h4 id="问题来了，如果div一开始display-none"><a href="#问题来了，如果div一开始display-none" class="headerlink" title="问题来了，如果div一开始display:none"></a>问题来了，如果div一开始display:none</h4></blockquote>
<p>show() 之后会是什么呢？ 经过测试竟然是block<br>凭啥?凭啥?凭啥?</p>
<h4 id="JS该这样使用"><a href="#JS该这样使用" class="headerlink" title="JS该这样使用"></a>JS该这样使用</h4><blockquote>
<p>通过class样式 来表示不同的状态去切换</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;xxx&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">$(&quot;#xxx&quot;).addClass(&apos;active&apos;)</span><br><span class="line">$(&quot;#xxx&quot;).removeClass(&apos;active&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="人在江湖"><a href="#人在江湖" class="headerlink" title="人在江湖"></a>人在江湖</h4><p>有的时候需要你迫不得已的用JS去操作样式，那就只能违反原则，但是你不该总是违反原则</p>
<blockquote>
<p>追溯到故事情节：天龙八部有一集阿紫被打伤乔峰各种救，去寻医，但是药店伙计告诉他没救了，此时突然一个地主家伙计来了说他家老爷不行了有没有办法，老掌柜的说快去拿“人参”，而此时纵是大侠气概的乔峰也「迫不得已」抢走了人参</p>
</blockquote>
<h3 id="基本的职业素养"><a href="#基本的职业素养" class="headerlink" title="基本的职业素养"></a>基本的职业素养</h3><h4 id="不要让「img」变形"><a href="#不要让「img」变形" class="headerlink" title="不要让「img」变形"></a>不要让「img」变形</h4><ul>
<li>你可以指定宽高,或者强行要求UI给你指定尺寸的图</li>
</ul>
<h4 id="关于「img」的坑"><a href="#关于「img」的坑" class="headerlink" title="关于「img」的坑"></a>关于「img」的坑</h4><p>因为「img」是一个可替换元素,所以当图片下载失败的时候就会显示alt里的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;xxx.jpg&quot;  alt=&quot;图片1&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>由于你没有指定宽高，假如是三个并排的img(不出意外是float或者flex-start)</p>
<p>由于第一张图加载速度慢，后面的img就不得不挤过来，直到图1 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">正常加载</span><br><span class="line">|--------| |--------||--------|</span><br><span class="line">|--------| |--------||--------|</span><br><span class="line">|   图1  | |   图2  ||   图3   |</span><br><span class="line">|--------| |--------||--------|</span><br><span class="line"></span><br><span class="line">图1还没加载过来 没指定宽高导致后面的img补位</span><br><span class="line">|图1||--------||--------|</span><br><span class="line">     |--------||--------|</span><br><span class="line">     |   图2  ||   图3   |</span><br><span class="line">     |--------||--------|</span><br><span class="line">图1回来了</span><br><span class="line">|--------| |--------||--------|</span><br><span class="line">|--------| |--------||--------|</span><br><span class="line">|   图1  | |   图2  ||   图3   |</span><br><span class="line">|--------| |--------||--------|</span><br></pre></td></tr></table></figure>
<p>就是因为你没有指定宽高所以在图片没回来的时候占据很小的空间，而当图1正常加载后 图2图3就必须给图1退出位置</p>
<blockquote>
<p>这样的结果就会导致「重排」</p>
</blockquote>
<blockquote>
<h4 id="重排是很耗性能的，页面性能优化的注意点就是"><a href="#重排是很耗性能的，页面性能优化的注意点就是" class="headerlink" title="重排是很耗性能的，页面性能优化的注意点就是"></a>重排是很耗性能的，页面性能优化的注意点就是</h4></blockquote>
<p>如果你已知图片的宽高你最好写在上面避免图片未加载的「让位」(腾地)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/11/30/N029_02前端该遵守的原则/" data-id="ckl3ypv0z006ysi91mfct75ay" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/48/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/47/">47</a><a class="page-number" href="/page/48/">48</a><span class="page-number current">49</span><a class="page-number" href="/page/50/">50</a><a class="page-number" href="/page/51/">51</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/50/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 13.91px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 14.35px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.3px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.48px;">M01</a> <a href="/tags/M02/" style="font-size: 15.22px;">M02</a> <a href="/tags/M03/" style="font-size: 15.65px;">M03</a> <a href="/tags/M04/" style="font-size: 16.09px;">M04</a> <a href="/tags/M06/" style="font-size: 18.26px;">M06</a> <a href="/tags/M07/" style="font-size: 17.83px;">M07</a> <a href="/tags/M08/" style="font-size: 16.96px;">M08</a> <a href="/tags/M09/" style="font-size: 11.74px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 12.17px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.7px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.52px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15.22px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.78px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.43px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.83px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.17px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.13px;">java</a> <a href="/tags/linux/" style="font-size: 10.87px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.3px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.61px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.61px;">mysql</a> <a href="/tags/node/" style="font-size: 10.43px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.39px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.04px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.57px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/20/HTTP06密码学到https流程/">HTTP06密码学到https流程</a>
          </li>
        
          <li>
            <a href="/2021/01/19/HTTP05缓存控制/">HTTP05缓存控制</a>
          </li>
        
          <li>
            <a href="/2021/01/18/HTTP04报文和http状态码/">HTTP04报文和http状态码</a>
          </li>
        
          <li>
            <a href="/2021/01/17/HTTP03http常用方法/">HTTP03http常用方法</a>
          </li>
        
          <li>
            <a href="/2021/01/16/HTTP02三次握手四度挥手/">HTTP02三次握手四度挥手</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>