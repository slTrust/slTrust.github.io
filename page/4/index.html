<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Node全解07-01docker-mysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/12/Node全解07-01docker-mysql/" class="article-date">
  <time datetime="2020-03-12T00:03:29.000Z" itemprop="datePublished">2020-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/12/Node全解07-01docker-mysql/">Node全解07_01docker_mysql</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="docker-启动-mysql"><a href="#docker-启动-mysql" class="headerlink" title="docker 启动 mysql"></a>docker 启动 mysql</h3><ul>
<li>docker 安装 不说了 自行解决</li>
<li>进入 Docker 上面的 mysql 主页</li>
<li>选择版本 如 5.7.27 或者 8.0.18</li>
<li>使用docker run 容器的名字</li>
<li>name 是容器的名字</li>
<li>MYSQL_ROOT_PASSWORD 是密码</li>
<li>tag是 版本号，我们选 5.7.27</li>
<li>再加一个端口映射 -p 3306:3306</li>
<li>最终命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -p 3306:3306 -d mysql:5.7.27</span><br><span class="line"></span><br><span class="line"># 查看容器</span><br><span class="line">docker ps -a</span><br><span class="line"># 删除容器</span><br><span class="line">docker rm -f id</span><br><span class="line"># 删除镜像</span><br><span class="line">docker rmi -f id</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong></p>
<ul>
<li>docker启动的容器默认不会持久化</li>
<li>容器删掉了，数据就没了</li>
<li>如果需要持久化，自行搜索 [docker mysql 数据目录]</li>
<li>目前我们不需要持久化</li>
</ul>
<h4 id="连接-docker-mysql"><a href="#连接-docker-mysql" class="headerlink" title="连接 docker mysql"></a>连接 docker mysql</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 镜像名称 bash</span><br><span class="line">这句话就是进入容器内部，容器内是一个 linux系统</span><br><span class="line">然后你就可以在这个系统里运行 mysql</span><br></pre></td></tr></table></figure>
<h4 id="mysql-命令"><a href="#mysql-命令" class="headerlink" title="mysql 命令"></a>mysql 命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p 回车 输入密码 123456</span><br><span class="line">命令 show databases; 可以查看所有的数据库</span><br><span class="line">如果你手抖就 ctrl + c 重新来</span><br><span class="line">命令 use xxx; 选择使用的数据库</span><br><span class="line">show tables; 查看对应库下的所有表</span><br><span class="line"></span><br><span class="line">select * from user; 查看表内容</span><br></pre></td></tr></table></figure>
<h3 id="什么是数据库"><a href="#什么是数据库" class="headerlink" title="什么是数据库"></a>什么是数据库</h3><p><strong>数据库Database</strong></p>
<ul>
<li>将大量数据保存起来，通过计算机加工而成的可以运行高效访问的数据集合称为数据库</li>
<li>根据保存格式不同，数据库一般分为<ul>
<li>关系型数据库 使用最广泛</li>
<li>面向对象数据库、xml数据库、键值对数据库、层次数据库</li>
</ul>
</li>
</ul>
<p><strong>数据库管理系统 DBMS</strong></p>
<ul>
<li>用来管理数据库的系统称之为数据库管理系统</li>
<li>如 MySQL 、PostgreSQL、SQL Server、DB2、Oracle</li>
</ul>
<h4 id="mysql-一个bug"><a href="#mysql-一个bug" class="headerlink" title="mysql 一个bug"></a>mysql 一个bug</h4><ul>
<li>mysql不要使用 utf-8 记住永远不要再 mysql里使用 utf-8 而是用 <strong>utf-8mb4</strong></li>
</ul>
<h3 id="Node-js-访问数据库"><a href="#Node-js-访问数据库" class="headerlink" title="Node.js 访问数据库"></a>Node.js 访问数据库</h3><ul>
<li><a href="https://github.com/mysqljs/mysql" target="_blank" rel="noopener">mysqljs</a> 里面是例子代码</li>
<li>新建目录 node-mysql</li>
<li>yarn init -y</li>
<li>抄文档 yarn add mysql</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var mysql = require(&apos;mysql&apos;);</span><br><span class="line">var connection = mysql.createConnection(&#123;</span><br><span class="line">    host: &apos;localhost&apos;,</span><br><span class="line">    user: &apos;root&apos;,</span><br><span class="line">    password: &apos;123456&apos;,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.connect();</span><br><span class="line">/*</span><br><span class="line">CREATE DATABASE IF NOT EXISTS fang </span><br><span class="line">    CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci</span><br><span class="line">*/</span><br><span class="line">// 创建库</span><br><span class="line">connection.query(&apos;CREATE DATABASE IF NOT EXISTS fang CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_520_ci;&apos;, function (error, results, fields) &#123;</span><br><span class="line">    if (error) throw error;</span><br><span class="line">    console.log(results);</span><br><span class="line">&#125;);</span><br><span class="line">connection.query(&apos;use fang;&apos;);</span><br><span class="line">// 创建表</span><br><span class="line">connection.query(`CREATE TABLE IF NOT EXISTS user(</span><br><span class="line">    name text,</span><br><span class="line">    age int</span><br><span class="line">)`, function (error, results, fields) &#123;</span><br><span class="line">    if (error) throw error;</span><br><span class="line">    console.log(results);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<h3 id="CRM学习法-搞定mysql"><a href="#CRM学习法-搞定mysql" class="headerlink" title="CRM学习法 搞定mysql"></a>CRM学习法 搞定mysql</h3><ul>
<li>了解如何连接 mysql</li>
<li>如何创建 数据库</li>
<li>如何创建表</li>
<li>对表 CRUD</li>
</ul>
<p><strong>如果你是新手千万不要写update 和 delete语句</strong></p>
<blockquote>
<h3 id="推荐你用这个解决sql语法"><a href="#推荐你用这个解决sql语法" class="headerlink" title="推荐你用这个解决sql语法"></a>推荐你用这个解决sql语法</h3></blockquote>
<ul>
<li>devdocs.io 开启 postgresql 文档</li>
<li>菜鸟教程</li>
</ul>
<h3 id="mysql-数据类型"><a href="#mysql-数据类型" class="headerlink" title="mysql 数据类型"></a>mysql 数据类型</h3><p><strong>五大类</strong></p>
<ul>
<li>数字<ul>
<li>太多了</li>
</ul>
</li>
<li>字符串<ul>
<li>char(100) 固定占用100字符，即使你存一个 字符串1</li>
<li>varchar(100) 变长存储 省空间</li>
<li>binary(1024)</li>
<li>varbinary(1024)</li>
<li>blob</li>
<li>text 存博客这种</li>
<li>enum(‘v1’,’v2’)</li>
<li>set(‘v1’,’v2’)</li>
<li>具体看文档</li>
</ul>
</li>
<li>时间和日期类型<ul>
<li>date 年月日</li>
<li>time 某事某分某秒</li>
<li>datetime 年月日 时分秒</li>
<li>timestamp 时间戳</li>
<li>year 只存年</li>
<li>关注一下 ISO 8601<ul>
<li>很多程序员处理不好日期数据，就是因为不了解它</li>
<li>如何把日期处理为 ISO 8601格式</li>
</ul>
</li>
</ul>
</li>
<li>JSON类型 5.7.8以上</li>
<li>其他特殊类型</li>
</ul>
<blockquote>
<p>参考文档</p>
</blockquote>
<ul>
<li>dev.mysql.com</li>
<li>菜鸟教程</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/12/Node全解07-01docker-mysql/" data-id="ckkmr2k1p00akfp91uq4f150h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解06-01翻译工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/11/Node全解06-01翻译工具/" class="article-date">
  <time datetime="2020-03-10T23:02:33.000Z" itemprop="datePublished">2020-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/11/Node全解06-01翻译工具/">Node全解06_01翻译工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>待更新</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/11/Node全解06-01翻译工具/" data-id="ckkmr2k1o00aifp91bmleyysi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解05静态服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/10/Node全解05静态服务器/" class="article-date">
  <time datetime="2020-03-10T03:01:23.000Z" itemprop="datePublished">2020-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/10/Node全解05静态服务器/">Node全解05静态服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HTTP模块"><a href="#HTTP模块" class="headerlink" title="HTTP模块"></a>HTTP模块</h1><blockquote>
<h4 id="一些有用的工具"><a href="#一些有用的工具" class="headerlink" title="一些有用的工具"></a>一些有用的工具</h4></blockquote>
<p><strong>node-dev</strong></p>
<ul>
<li>当文件更新时自动重启 node</li>
<li>避免每次改完代码都要重新运行的麻烦</li>
<li>不宜在生产环境使用</li>
</ul>
<p><strong>ts-node</strong></p>
<ul>
<li>让 node 支持直接运行 TS代码</li>
<li>不宜在生产环境使用</li>
</ul>
<p><strong>ts-node-dev</strong></p>
<ul>
<li>这个工具结合了上面两个工具</li>
<li>可以用 TS 开发 Node.js 程序，且会自动重启</li>
<li>不宜在生产环境使用，非常适合用来学习</li>
</ul>
<p>你可以这样安装 <code>yarn global add ts-node-dev</code></p>
<blockquote>
<h4 id="一些有用的工具2"><a href="#一些有用的工具2" class="headerlink" title="一些有用的工具2"></a>一些有用的工具2</h4></blockquote>
<p><strong>WebStorm自动格式化</strong></p>
<ul>
<li>ReformatCode 设置为 Ctrl + L 或者其他键位</li>
<li>可以快速帮你格式化 TS / JS 代码</li>
</ul>
<p><strong>WebStorm自动写代码</strong></p>
<ul>
<li>Complete Current Statement 设置为 Ctrl + Enter 或者其他键位</li>
<li>Show Context Actions 设置为 Alt + Enter 或者其他键位</li>
</ul>
<p><strong>VSCode配置</strong></p>
<ul>
<li>开启自动保存 autosave </li>
<li>format on save</li>
<li>format</li>
</ul>
<blockquote>
<h4 id="一些有用的工具3"><a href="#一些有用的工具3" class="headerlink" title="一些有用的工具3"></a>一些有用的工具3</h4></blockquote>
<p><strong>WebStorm Git配置</strong></p>
<ul>
<li>选择设置 =》 搜索 git =&gt; path选中你安装的git路径</li>
</ul>
<p><strong>VSCode配置</strong></p>
<ul>
<li>设置 搜索 settings 打开设置 json</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;git.enabled&quot;: true,</span><br><span class="line">    &quot;git.path&quot;: &quot;/usr/bin/git&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Curl命令</strong></p>
<ul>
<li>get: <code>curl -v url</code></li>
<li>post: <code>curl -v -d &quot;name=xxx&quot; url</code></li>
<li>设置请求头： <code>-H &#39;Content-Type:application/json&#39;</code></li>
<li>设置动词： <code>-X PUT</code></li>
<li>JSON请求： <code>curl -d &#39;{&quot;name&quot;:&quot;bob&quot;}&#39; -H &#39;Content-Type:pplication/json&#39; url</code></li>
</ul>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><ul>
<li>项目目录 node-server-demo</li>
<li>由于我们写 ts 别忘了安装 <code>yarn global add ts-node-dev</code></li>
<li>yarn init -y</li>
<li>yarn add –dev @types/node 安装 node 声明文件</li>
<li><p>新建 index.ts</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import * as http from &apos;http&apos;;</span><br><span class="line"></span><br><span class="line">const server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request, response) =&gt; &#123;</span><br><span class="line">    console.log(&apos;有人请求了&apos;)</span><br><span class="line">    response.end(&quot;hi&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务ts-node-dev index.ts</p>
</li>
<li>发请求<code>curl http://localhost:8888</code></li>
</ul>
<h3 id="server-是什么东西"><a href="#server-是什么东西" class="headerlink" title="server 是什么东西"></a>server 是什么东西</h3><p><strong>http.Server 类的实例</strong></p>
<ul>
<li>根据文档能知道 http.createServer 的返回值类型</li>
<li>根据文档知道 server 拥有几个事件和方法</li>
<li>其中目前能用上的 只有 request事件 和 listen()</li>
</ul>
<p><strong>继承自net.Server</strong></p>
<ul>
<li>根据文档知道继承关系</li>
<li>看到 net.Server 又有几个方法</li>
<li>其中也就 error事件 和 address() 能用上</li>
</ul>
<blockquote>
<h4 id="一些技巧"><a href="#一些技巧" class="headerlink" title="一些技巧"></a>一些技巧</h4></blockquote>
<ul>
<li>有的时候 <strong>点不出来东西</strong>，那是因为 类型声明文件不够匹配可能写的是 any</li>
<li>所以你可以通过 加类型声明 来达到 “点出来提示”</li>
<li>如果你用的是 vscode 请安装 auto import</li>
</ul>
<p>index.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import * as http from &apos;http&apos;;</span><br><span class="line">import &#123; IncomingMessage, ServerResponse &#125; from &apos;http&apos;;</span><br><span class="line"></span><br><span class="line">const server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request: IncomingMessage, response: ServerResponse) =&gt; &#123;</span><br><span class="line">    console.log(request.constructor);</span><br><span class="line">    console.log(response.constructor);</span><br><span class="line">    // 得知它是什么 然后声明它的类型 , 这样你在 request. 的时候才会有提示</span><br><span class="line">    console.log(request.httpVersion);</span><br><span class="line">    console.log(request.url);</span><br><span class="line">    response.end(&quot;hi&quot;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
<h3 id="如何获取请求体的内容"><a href="#如何获取请求体的内容" class="headerlink" title="如何获取请求体的内容"></a>如何获取请求体的内容</h3><ul>
<li><code>request.on(&#39;data&#39;, fn)</code></li>
<li><code>request.on(&#39;end&#39;, fn)</code></li>
<li><code>curl -v  -d &quot;name=aaa&quot; http://localhost:8888</code></li>
</ul>
<p><strong>有个问题：这个上传方式就算用户上传1G的东西都可以拿到，因为你是一小段一小段拿到然后拼起来，只要服务器内存够。就可以处理上传的内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import * as http from &apos;http&apos;;</span><br><span class="line">import &#123; IncomingMessage, ServerResponse &#125; from &apos;http&apos;;</span><br><span class="line"></span><br><span class="line">const server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request: IncomingMessage, response: ServerResponse) =&gt; &#123;</span><br><span class="line">    console.log(request.constructor);</span><br><span class="line">    console.log(response.constructor);</span><br><span class="line">    // 得知它是什么 然后声明它的类型 , 这样你在 request. 的时候才会有提示</span><br><span class="line">    console.log(&apos;request.httpVersion&apos;)</span><br><span class="line">    console.log(request.httpVersion);</span><br><span class="line">    console.log(&apos;request.url&apos;);</span><br><span class="line">    console.log(request.url);</span><br><span class="line">    console.log(&apos;request.headers&apos;);</span><br><span class="line">    console.log(request.headers);</span><br><span class="line">    console.log(&apos;request.method&apos;);</span><br><span class="line">    console.log(request.method);</span><br><span class="line"></span><br><span class="line">    // 获取请求体</span><br><span class="line">    const array = [];</span><br><span class="line">    request.on(&apos;data&apos;, (chunk) =&gt; &#123;</span><br><span class="line">        array.push(chunk)</span><br><span class="line">    &#125;)</span><br><span class="line">    request.on(&apos;end&apos;, () =&gt; &#123;</span><br><span class="line">        const body = Buffer.concat(array).toString();</span><br><span class="line">        console.log(body)</span><br><span class="line">        response.end(&quot;hi&quot;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
<h4 id="request-response-是啥"><a href="#request-response-是啥" class="headerlink" title="request,response 是啥"></a>request,response 是啥</h4><blockquote>
<p>找类</p>
</blockquote>
<ul>
<li>根据文档， request 是 http. IncomingMessage 的实例</li>
<li>根据文档， response 是 http. ServerResponse 的实例</li>
</ul>
<blockquote>
<p>Request</p>
</blockquote>
<ul>
<li>拥有 headers, method , url 等属性</li>
<li>从 stream.Readable 类继承了 data/end/error 事件</li>
<li>为什么不直接拿到请求的消息体呢？ 根TCP相关</li>
</ul>
<blockquote>
<p>Response</p>
</blockquote>
<ul>
<li>拥有 getHeader/setHeader/end/write 等方法</li>
<li><p>拥有 statusCode 属性，可读可写</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">response.statusCode = 404;</span><br><span class="line">// 设置响应头</span><br><span class="line">response.setHeader(&apos;x-frank&apos;, &apos;I am frank&apos;)</span><br><span class="line">response.write(&apos;1\n&apos;);</span><br><span class="line">response.write(&apos;2\n&apos;);</span><br><span class="line">response.write(&apos;3\n&apos;);</span><br><span class="line">response.write(&apos;4\n&apos;);</span><br><span class="line">response.end(); // 如果你设置了 404 就 end里不传任何东西</span><br></pre></td></tr></table></figure>
<ul>
<li>你也可以写回一个 image 但是要设置文件头标示它是一个 image</li>
</ul>
</li>
<li>继承了 Stream,目前用不上</li>
</ul>
<h3 id="项目1-根据url返回不同类型文件"><a href="#项目1-根据url返回不同类型文件" class="headerlink" title="项目1 根据url返回不同类型文件"></a>项目1 根据url返回不同类型文件</h3><ul>
<li><a href="http://localhost:8888/index.html" target="_blank" rel="noopener">http://localhost:8888/index.html</a></li>
<li><a href="http://localhost:8888/main.js" target="_blank" rel="noopener">http://localhost:8888/main.js</a></li>
<li><a href="http://localhost:8888/style.css" target="_blank" rel="noopener">http://localhost:8888/style.css</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import * as http from &apos;http&apos;;</span><br><span class="line">import &#123; IncomingMessage, ServerResponse &#125; from &apos;http&apos;;</span><br><span class="line">import * as fs from &apos;fs&apos;;</span><br><span class="line">import * as p from &apos;path&apos;;</span><br><span class="line"></span><br><span class="line">const server = http.createServer();</span><br><span class="line">const publicDir = p.relative(__dirname, &apos;public&apos;);</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request: IncomingMessage, response: ServerResponse) =&gt; &#123;</span><br><span class="line">    const &#123; method, url, headers &#125; = request;</span><br><span class="line">    switch (url) &#123;</span><br><span class="line">        case &apos;/index.html&apos;:</span><br><span class="line">            response.setHeader(&apos;Content-Type&apos;, &apos;text/html;charset=utf-8&apos;);</span><br><span class="line">            fs.readFile(p.resolve(publicDir, &apos;index.html&apos;), (error, data) =&gt; &#123;</span><br><span class="line">                if (error) throw error;</span><br><span class="line">                response.end(data.toString());</span><br><span class="line">            &#125;)</span><br><span class="line">            break;</span><br><span class="line">        case &apos;/style.css&apos;:</span><br><span class="line">            response.setHeader(&apos;Content-Type&apos;, &apos;text/css;charset=utf-8&apos;);</span><br><span class="line">            fs.readFile(p.resolve(publicDir, &apos;style.css&apos;), (error, data) =&gt; &#123;</span><br><span class="line">                if (error) throw error;</span><br><span class="line">                response.end(data.toString());</span><br><span class="line">            &#125;)</span><br><span class="line">            break;</span><br><span class="line">        case &apos;/main.js&apos;:</span><br><span class="line">            response.setHeader(&apos;Content-Type&apos;, &apos;text/javascript;charset=utf-8&apos;);</span><br><span class="line">            fs.readFile(p.resolve(publicDir, &apos;main.js&apos;), (error, data) =&gt; &#123;</span><br><span class="line">                if (error) throw error;</span><br><span class="line">                response.end(data.toString());</span><br><span class="line">            &#125;)</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
<h3 id="项目2-处理查询参数"><a href="#项目2-处理查询参数" class="headerlink" title="项目2 处理查询参数"></a>项目2 处理查询参数</h3><ul>
<li>使用 url模块 <code>url.path()</code></li>
<li><a href="http://localhost:8888/index.html?q=aa" target="_blank" rel="noopener">http://localhost:8888/index.html?q=aa</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import * as url from &apos;url&apos;;</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request: IncomingMessage, response: ServerResponse) =&gt; &#123;</span><br><span class="line">    const &#123; method, url: path, headers &#125; = request;</span><br><span class="line">    const &#123; pathname, search &#125; = url.parse(path);</span><br><span class="line">    switch (pathname) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="项目3-匹配任意文件"><a href="#项目3-匹配任意文件" class="headerlink" title="项目3 匹配任意文件"></a>项目3 匹配任意文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// 匹配任意文件</span><br><span class="line">import * as http from &apos;http&apos;;</span><br><span class="line">import &#123; IncomingMessage, ServerResponse &#125; from &apos;http&apos;;</span><br><span class="line">import * as fs from &apos;fs&apos;;</span><br><span class="line">import * as p from &apos;path&apos;;</span><br><span class="line">import * as url from &apos;url&apos;;</span><br><span class="line"></span><br><span class="line">const server = http.createServer();</span><br><span class="line">const publicDir = p.relative(__dirname, &apos;public&apos;);</span><br><span class="line"></span><br><span class="line">server.on(&apos;request&apos;, (request: IncomingMessage, response: ServerResponse) =&gt; &#123;</span><br><span class="line">    const &#123; method, url: path, headers &#125; = request;</span><br><span class="line">    const &#123; pathname, search &#125; = url.parse(path);</span><br><span class="line"></span><br><span class="line">    // /index.html ==&gt; index.html</span><br><span class="line">    let filename = pathname.substr(1);</span><br><span class="line">    if (filename === &apos;&apos;) &#123;</span><br><span class="line">        filename = &apos;index.html&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;, &apos;text/html;charset=utf-8&apos;);</span><br><span class="line">    fs.readFile(p.resolve(publicDir, filename), (error, data) =&gt; &#123;</span><br><span class="line">        if (error) &#123;</span><br><span class="line">            if (error.errno === -4058) &#123;</span><br><span class="line">                response.statusCode = 404;</span><br><span class="line">                response.end(&apos;你要的文件不存在啊！！！&apos;);</span><br><span class="line">            &#125; else if (error.errno === -4068) &#123;</span><br><span class="line">                // http://localhost:8888/xxx</span><br><span class="line">                response.statusCode = 403;</span><br><span class="line">                response.end(&apos;无权限查看目录内容&apos;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                response.statusCode = 500;</span><br><span class="line">                response.end(&apos;服务器繁忙，请稍后再试&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            response.end(data.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
<h3 id="项目4-处理非get请求-添加缓存文件时间"><a href="#项目4-处理非get请求-添加缓存文件时间" class="headerlink" title="项目4 处理非get请求 添加缓存文件时间"></a>项目4 处理非get请求 添加缓存文件时间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if (method !== &apos;GET&apos;) &#123;</span><br><span class="line">    response.statusCode = 200;</span><br><span class="line">    response.setHeader(&apos;Content-Type&apos;, &apos;text/html;charset=utf-8&apos;);</span><br><span class="line">    response.end(&quot;这是一个假的响应&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">response.setHeader(&apos;Cache-Control&apos;, `public,max-age=$&#123;cacheAge&#125;`);</span><br></pre></td></tr></table></figure>
<h3 id="免费用-WebStorm的途径"><a href="#免费用-WebStorm的途径" class="headerlink" title="免费用 WebStorm的途径"></a>免费用 WebStorm的途径</h3><p><strong>申请条件</strong></p>
<ul>
<li>开源项目的贡献者</li>
<li>你的项目是开源的 如MIT</li>
<li>你的项目是不盈利的</li>
<li>你的项目至少活跃3个月</li>
<li>你定期发布更新的版本</li>
<li>满足条件就 点击申请按钮</li>
</ul>
<p><strong>填写材料</strong></p>
<ul>
<li>邮箱地址一定不要错</li>
<li>No. of required licenses 填 1</li>
<li>项目描述用 google 翻译即可</li>
<li>正版 JetBrains 全家桶唾手可得，价值$649/年</li>
</ul>
<h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p><a href="https://github.com/slTrust/node-server-demo" target="_blank" rel="noopener">https://github.com/slTrust/node-server-demo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/10/Node全解05静态服务器/" data-id="ckkmr2k1n00affp91uhe5w730" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解04调试工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/09/Node全解04调试工具/" class="article-date">
  <time datetime="2020-03-09T06:00:19.000Z" itemprop="datePublished">2020-03-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/09/Node全解04调试工具/">Node全解04调试工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h1><h3 id="WebStorm"><a href="#WebStorm" class="headerlink" title="WebStorm"></a>WebStorm</h3><ul>
<li>打开一个项目目录</li>
<li>点击工具栏 Run</li>
<li>Edit Configurations</li>
<li>点击 “+”</li>
<li>然后配置你的测试配置<ul>
<li>Name 你这个配置的名称</li>
<li>Node interpreter node环境</li>
<li>Wroking directory: 工作目录</li>
<li>JavaScript file: 测试的文件 xxx.js</li>
<li>Application parameters: 输入的参数</li>
</ul>
</li>
<li>点击OK</li>
<li>再次点击 Run 子菜单里会多了一个 你刚刚的配置<ul>
<li>Run xxx 直接运行</li>
<li>debug xxx 设置断点运行</li>
</ul>
</li>
</ul>
<h3 id="VS-Code"><a href="#VS-Code" class="headerlink" title="VS Code"></a>VS Code</h3><ul>
<li>侧边栏点击 小虫子那个按钮</li>
<li>点击 启动程序 ， 如果没反应 点击它右边有个 控制台的按钮</li>
<li><p>会让你配置一个 json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    // Use IntelliSense to learn about possible attributes.</span><br><span class="line">    // Hover to view descriptions of existing attributes.</span><br><span class="line">    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span><br><span class="line">    &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;type&quot;: &quot;node&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            // 启动程序</span><br><span class="line">            &quot;name&quot;: &quot;Launch Program&quot;,</span><br><span class="line">            &quot;skipFiles&quot;: [</span><br><span class="line">                &quot;&lt;node_internals&gt;/**&quot;</span><br><span class="line">            ],</span><br><span class="line">            // 入口文件</span><br><span class="line">            &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/cli.js&quot;,</span><br><span class="line">            &quot;args&quot;: [&quot;add&quot;, &quot;task&quot;, &quot;100&quot;]</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次点击运行按钮</p>
</li>
</ul>
<h3 id="命令行-Chrome-断点"><a href="#命令行-Chrome-断点" class="headerlink" title="命令行 + Chrome 断点"></a>命令行 + Chrome 断点</h3><blockquote>
<p>第一种方式： 你可以在 js文件 添加 debugger 运行时就会停在当前行</p>
</blockquote>
<blockquote>
<p>第二种方式： 终端添加参数 <code>--inspect-brk</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 你原来是这样</span><br><span class="line">node cli.js add abc</span><br><span class="line"></span><br><span class="line">// 现在你这样,它就会停下来等你</span><br><span class="line">node --inspect-brk cli.js add abc</span><br></pre></td></tr></table></figure>
<ul>
<li>运行上述命令后，打开 Chrome 右键调试</li>
<li>你会看到弹出的工具栏 左上角 多了一个绿色 的 Node.js 图标 点击即可</li>
<li>注意！ 如果你直接添加的命令是 <code>--inspect</code> 它会直接执行 不停下来 ，所以要加 <code>-brk</code> 它就会等你连接</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/09/Node全解04调试工具/" data-id="ckkmr2k1m00adfp91w8q5rein" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解03-01jest" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/09/Node全解03-01jest/" class="article-date">
  <time datetime="2020-03-09T01:59:42.000Z" itemprop="datePublished">2020-03-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/09/Node全解03-01jest/">Node全解03_01jest</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="单元测试-JEST使用"><a href="#单元测试-JEST使用" class="headerlink" title="单元测试 JEST使用"></a>单元测试 JEST使用</h1><ul>
<li><a href="https://jestjs.io/" target="_blank" rel="noopener">jest</a></li>
</ul>
<p>代码使用我们上次写的<a href="https://github.com/slTrust/node-todo-1/tree/867474eb4f246258b847364f8a46bd6836ef7e4c" target="_blank" rel="noopener">Node命令行工具</a> </p>
<h3 id="如何测试"><a href="#如何测试" class="headerlink" title="如何测试"></a>如何测试</h3><blockquote>
<p>步骤</p>
</blockquote>
<ul>
<li>选择测试工具： jest</li>
<li>设计测试用例</li>
<li>写测试，运行测试，改代码</li>
<li>单元测试、功能测试、集成测试</li>
</ul>
<blockquote>
<p>重点</p>
</blockquote>
<ul>
<li>单元测试不应该和外界打交道(那是集成测试做的) 应该 mock<ul>
<li>不能操作硬盘</li>
<li>不能操作网络</li>
<li>不能操作任何东西，只能操作你自己</li>
</ul>
</li>
<li>单元测试的对象是函数</li>
<li>功能测试的对象是模块</li>
<li>集成测试的对象是系统</li>
<li>我们先搞定单元测试</li>
</ul>
<h3 id="直接-CRM学习法"><a href="#直接-CRM学习法" class="headerlink" title="直接 CRM学习法"></a>直接 CRM学习法</h3><ul>
<li><a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener">Jest官网 Docs</a></li>
<li><code>yarn add --dev jest</code></li>
<li><p>修改package.json</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;jest&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>__test__</code> 目录 并在它下面创建 <code>db.spec.js</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const db = require(&quot;../db.js&quot;)</span><br><span class="line">describe(&quot;db&quot;,()=&gt;&#123;</span><br><span class="line">    it(&quot;can read&quot;,()=&gt;&#123;</span><br><span class="line">        expect(db.read instanceof Function).toBe(true)</span><br><span class="line">    &#125;)  </span><br><span class="line"></span><br><span class="line">    it(&quot;can write&quot;,()=&gt;&#123;</span><br><span class="line">        expect(db.write instanceof Function).toBe(true)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行 npm run test</p>
</li>
</ul>
<h4 id="如何测试读文件呢？"><a href="#如何测试读文件呢？" class="headerlink" title="如何测试读文件呢？"></a>如何测试读文件呢？</h4><blockquote>
<h4 id="如果你想这样测试！！！-请放弃"><a href="#如果你想这样测试！！！-请放弃" class="headerlink" title="如果你想这样测试！！！ 请放弃"></a>如果你想这样测试！！！ 请放弃</h4></blockquote>
<ul>
<li>不该和外界打交道，万一你的文件已经存在了呢？这样就会有干扰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFileSync(&apos;/xxx.json&apos;,`[&#123;&quot;title&quot;:&quot;hi&quot;,&quot;done&quot;:true&#125;]`)</span><br><span class="line">db.read(&apos;/xxx.json&apos;)</span><br></pre></td></tr></table></figure>
<p><strong>请搜索 jest mock fs</strong> <a href="https://jestjs.io/docs/en/manual-mocks" target="_blank" rel="noopener">jest doc 的 Manual Mocks章节</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jest.mock(&apos;fs&apos;) // 意思是 jest 接管 fs模块</span><br></pre></td></tr></table></figure>
<h4 id="Mock-fs-模块"><a href="#Mock-fs-模块" class="headerlink" title="Mock fs 模块"></a>Mock fs 模块</h4><ul>
<li><p>新建 <code>__mocks__/fs.js</code> 代表 mock 一个假的 fs模块</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 声明是 fs的 jest 的假模块</span><br><span class="line">const fs = jest.genMockFromModule(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">fs.x = ()=&gt;&#123;</span><br><span class="line">    console.log(&apos;hi&apos;)</span><br><span class="line">    return &apos;xxx&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = fs;</span><br></pre></td></tr></table></figure>
</li>
<li><p>db.spec.js</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const db = require(&quot;../db.js&quot;)</span><br><span class="line">const fs = require(&apos;fs&apos;); </span><br><span class="line">jest.mock(&apos;fs&apos;); </span><br><span class="line"></span><br><span class="line">describe(&quot;db&quot;,()=&gt;&#123;</span><br><span class="line">    it(&quot;can read&quot;,()=&gt;&#123;</span><br><span class="line">        expect(fs.x()).toBe(&apos;xxx&apos;)</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行 npm run test 成功</p>
</li>
</ul>
<h3 id="完整版-mock-fs"><a href="#完整版-mock-fs" class="headerlink" title="完整版 mock fs"></a>完整版 mock fs</h3><p><code>__mocks__/fs.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">// 声明是 fs的 jest 的假模块</span><br><span class="line">const fs = jest.genMockFromModule(&apos;fs&apos;);</span><br><span class="line">const _fs = jest.requireActual(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">Object.assign(fs,_fs);</span><br><span class="line"></span><br><span class="line">let readMocks = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">fs.setReadFileMock = (path, error, data)=&gt;&#123;</span><br><span class="line">    readMocks[path] = [error,data];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 覆盖 fs的 readFile()</span><br><span class="line">fs.readFile = (path, options, callBack) =&gt; &#123;</span><br><span class="line">    // 如果你 fs.readFile(&apos;xxx&apos;,fn) 代表第二个参数是 callBack</span><br><span class="line">    if(callBack === undefined)&#123;</span><br><span class="line">        callBack = options</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(path in readMocks)&#123;</span><br><span class="line">        callBack(...readMocks[path])</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        _fs.readFile(path, options, callBack)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let writeMocks = &#123;&#125;</span><br><span class="line"></span><br><span class="line">fs.setWriteFileMock = (path, fn)=&gt;&#123;</span><br><span class="line">    writeMocks[path] = fn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fs.writeFile = (path,data,options, callBack) =&gt; &#123;</span><br><span class="line">    if(callBack === undefined)&#123;</span><br><span class="line">        callBack = options;</span><br><span class="line">    &#125;</span><br><span class="line">    if(path in writeMocks)&#123;</span><br><span class="line">        writeMocks[path](path, data, options, callBack)</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        _fs.writeFile(path, data, options, callBack)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fs.clearMocks = ()=&gt;&#123;</span><br><span class="line">    readMocks = &#123;&#125;;</span><br><span class="line">    writeMocks = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = fs;</span><br></pre></td></tr></table></figure>
<p><code>__tests__/db.spec.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const db = require(&quot;../db.js&quot;)</span><br><span class="line">const fs = require(&apos;fs&apos;); </span><br><span class="line">jest.mock(&apos;fs&apos;); </span><br><span class="line"></span><br><span class="line">describe(&quot;db&quot;,()=&gt;&#123;</span><br><span class="line">    afterEach(()=&gt;&#123;</span><br><span class="line">        // 每个it 执行之后</span><br><span class="line">        fs.clearMocks();</span><br><span class="line">    &#125;)</span><br><span class="line">    it(&quot;can read&quot;, async () =&gt;&#123;</span><br><span class="line">        const data = [&#123;title:&quot;hi&quot;,done:true&#125;]</span><br><span class="line">        fs.setReadFileMock(&apos;/xxx&apos;,null,JSON.stringify(data));</span><br><span class="line">        const list = await db.read(&apos;/xxx&apos;);</span><br><span class="line">        expect(list).toStrictEqual(data)</span><br><span class="line">    &#125;)  </span><br><span class="line"></span><br><span class="line">    it(&quot;can wriete&quot;, async () =&gt;&#123;</span><br><span class="line">        let fakeFile;</span><br><span class="line">        fs.setWriteFileMock(&apos;/yyy&apos;,(path, data, options, callBack)=&gt;&#123;</span><br><span class="line">            fakeFile = data;</span><br><span class="line">            callBack(null)</span><br><span class="line">        &#125;)</span><br><span class="line">        const list = [&#123;title:&quot;见欧阳娜娜&quot;,done:true&#125;, &#123;title:&quot;见迪丽热巴&quot;,done:true&#125;]</span><br><span class="line">        await db.write(list,&apos;/yyy&apos;);</span><br><span class="line">        expect(fakeFile).toBe(JSON.stringify(list) + &quot;\n&quot;);</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a>代码仓库</h3><ul>
<li><a href="https://github.com/slTrust/node-todo-1" target="_blank" rel="noopener">https://github.com/slTrust/node-todo-1</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/09/Node全解03-01jest/" data-id="ckkmr2k1l00aafp91jnzjabef" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解02-02node命令行程序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/08/Node全解02-02node命令行程序/" class="article-date">
  <time datetime="2020-03-08T15:58:45.000Z" itemprop="datePublished">2020-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/08/Node全解02-02node命令行程序/">Node全解02_02node命令行程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="继续完善代码"><a href="#继续完善代码" class="headerlink" title="继续完善代码"></a>继续完善代码</h3><blockquote>
<h3 id="001-如果用户输入-node-cli-js-就显示所有任务"><a href="#001-如果用户输入-node-cli-js-就显示所有任务" class="headerlink" title="001 如果用户输入 node cli.js 就显示所有任务"></a>001 如果用户输入 <code>node cli.js</code> 就显示所有任务</h3></blockquote>
<p>cli.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 用户实际输入的 命令参数</span><br><span class="line">// console.log(process.argv)</span><br><span class="line"></span><br><span class="line">if(process.argv.length === 2)&#123;</span><br><span class="line">  // 说明用户直接运行 node cli.js</span><br><span class="line">  api.showAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports.showAll = async (title) =&gt;&#123;</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    list.forEach((task, index)=&gt;&#123;</span><br><span class="line">        console.log(`$&#123;task.done ? &apos;[x]&apos; : &apos;[_]&apos;&#125;$&#123;index&#125; - $&#123;task.title&#125;`)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="002-在用户输入-node-cli-js-时候-假如有很多任务-如何通过上下按钮-切换呢？"><a href="#002-在用户输入-node-cli-js-时候-假如有很多任务-如何通过上下按钮-切换呢？" class="headerlink" title="002 在用户输入 node cli.js 时候 假如有很多任务 如何通过上下按钮 切换呢？"></a>002 在用户输入 <code>node cli.js</code> 时候 假如有很多任务 如何通过上下按钮 切换呢？</h3></blockquote>
<ul>
<li><a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener">inquirer.js</a></li>
<li><a href="https://github.com/SBoudrias/Inquirer.js/tree/master/packages/inquirer/examples" target="_blank" rel="noopener">example </a></li>
<li><a href="https://github.com/SBoudrias/Inquirer.js/blob/master/packages/inquirer/examples/list.js" target="_blank" rel="noopener">参考 example 提供的 list.js</a></li>
</ul>
<blockquote>
<h3 id="003-完成所有功能"><a href="#003-完成所有功能" class="headerlink" title="003 完成所有功能"></a>003 完成所有功能</h3></blockquote>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">const inquirer = require(&apos;inquirer&apos;);</span><br><span class="line">const db = require(&apos;./db.js&apos;);</span><br><span class="line"></span><br><span class="line">module.exports.add = async (title) =&gt;&#123;</span><br><span class="line">    // 读取之前的任务</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    // 往里面添加一个任务</span><br><span class="line">    list.push(&#123;title,done:false&#125;);</span><br><span class="line">    // 存储任务到文件</span><br><span class="line">    console.log(&apos;read~~~~&apos;)</span><br><span class="line">    console.log(list)</span><br><span class="line">    await db.write(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.clear = async (title) =&gt;&#123;</span><br><span class="line">    await db.write([]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.showAll = async (title) =&gt;&#123;</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    inquirer</span><br><span class="line">        .prompt([</span><br><span class="line">            &#123;</span><br><span class="line">                type: &apos;list&apos;,</span><br><span class="line">                name: &apos;index&apos;,</span><br><span class="line">                message: &apos;请选择你想操作的任务&apos;,</span><br><span class="line">                choices: [ </span><br><span class="line">                    &#123;name:&apos;退出&apos;,value:&apos;-1&apos;&#125;,</span><br><span class="line">                  </span><br><span class="line">                    ...list.map((task, index)=&gt;&#123;</span><br><span class="line">                    return &#123;name: `$&#123;task.done ? &apos;[x]&apos; : &apos;[_]&apos;&#125;$&#123;index&#125; - $&#123;task.title&#125;`, value: index.toString()&#125;</span><br><span class="line">                &#125;),</span><br><span class="line">                &#123;name:&apos;创建任务&apos;,value:&apos;-2&apos;&#125;</span><br><span class="line">            ]</span><br><span class="line">            &#125;,</span><br><span class="line">        ])</span><br><span class="line">        .then(answers =&gt; &#123;</span><br><span class="line">            const index = parseInt(answers.index);</span><br><span class="line">            if(index &gt;= 0)&#123;</span><br><span class="line">                inquirer</span><br><span class="line">                .prompt([</span><br><span class="line">                    &#123;</span><br><span class="line">                        type: &apos;list&apos;,</span><br><span class="line">                        name: &apos;action&apos;,</span><br><span class="line">                        message: &apos;请选择操作&apos;,</span><br><span class="line">                        choices: [ </span><br><span class="line">                            &#123;name:&apos;退出&apos;,value:&apos;quit&apos;&#125;,</span><br><span class="line">                            &#123;name:&apos;已完成&apos;,value:&apos;makeAsDone&apos;&#125;,</span><br><span class="line">                            &#123;name:&apos;未完成&apos;,value:&apos;maksAsUndone&apos;&#125;,</span><br><span class="line">                            &#123;name:&apos;改标题&apos;,value:&apos;updateTitle&apos;&#125;,</span><br><span class="line">                            &#123;name:&apos;删除&apos;,value:&apos;remove&apos;&#125;,</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                ])</span><br><span class="line">                .then(answers2 =&gt; &#123;</span><br><span class="line">                    switch(answers2.action)&#123;</span><br><span class="line">                        case &apos;makeAsDone&apos;:</span><br><span class="line">                            list[index].done = true;</span><br><span class="line">                            db.write(list);</span><br><span class="line">                            break;</span><br><span class="line">                        case &apos;maksAsUndone&apos;:</span><br><span class="line">                            list[index].done = false;</span><br><span class="line">                            db.write(list);</span><br><span class="line">                            break;</span><br><span class="line">                        case &apos;updateTitle&apos;:</span><br><span class="line">                            inquirer.prompt([</span><br><span class="line">                                &#123;type: &apos;input&apos;,</span><br><span class="line">                                name: &apos;title&apos;,</span><br><span class="line">                                message:&apos;新的标题&apos;,</span><br><span class="line">                                default: list[index].title</span><br><span class="line">                            &#125;]).then(answer =&gt; &#123;</span><br><span class="line">                                list[index].title = answer.title</span><br><span class="line">                                db.write(list)</span><br><span class="line">                              &#125;);</span><br><span class="line">                            break;</span><br><span class="line">                        case &apos;remove&apos;:</span><br><span class="line">                            list.splice(index,1);</span><br><span class="line">                            db.write(list);</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;else if( index === -2)&#123;</span><br><span class="line">                // 创建任务</span><br><span class="line">                inquirer.prompt([</span><br><span class="line">                    &#123;type: &apos;input&apos;,</span><br><span class="line">                    name: &apos;title&apos;,</span><br><span class="line">                    message:&apos;输入任务标题&apos;</span><br><span class="line">                &#125;]).then(answer =&gt; &#123;</span><br><span class="line">                    list.push(&#123;</span><br><span class="line">                        title: answer.title,</span><br><span class="line">                        done: false</span><br><span class="line">                    &#125;)</span><br><span class="line">                    db.write(list);</span><br><span class="line">                  &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="004-优化代码"><a href="#004-优化代码" class="headerlink" title="004 优化代码"></a>004 优化代码</h3></blockquote>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">const inquirer = require(&apos;inquirer&apos;);</span><br><span class="line">const db = require(&apos;./db.js&apos;);</span><br><span class="line"></span><br><span class="line">module.exports.add = async (title) =&gt;&#123;</span><br><span class="line">    // 读取之前的任务</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    // 往里面添加一个任务</span><br><span class="line">    list.push(&#123;title,done:false&#125;);</span><br><span class="line">    // 存储任务到文件</span><br><span class="line">    console.log(&apos;read~~~~&apos;)</span><br><span class="line">    console.log(list)</span><br><span class="line">    await db.write(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.clear = async () =&gt;&#123;</span><br><span class="line">    await db.write([]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function askForCreateTask(list)&#123;</span><br><span class="line">    inquirer.prompt([</span><br><span class="line">        &#123;type: &apos;input&apos;,</span><br><span class="line">        name: &apos;title&apos;,</span><br><span class="line">        message:&apos;输入任务标题&apos;</span><br><span class="line">    &#125;]).then(answer =&gt; &#123;</span><br><span class="line">        list.push(&#123;</span><br><span class="line">            title: answer.title,</span><br><span class="line">            done: false</span><br><span class="line">        &#125;)</span><br><span class="line">        db.write(list);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function makeAsDone(list,index)&#123;</span><br><span class="line">    list[index].done = true;</span><br><span class="line">    db.write(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function maksAsUndone(list,index)&#123;</span><br><span class="line">    list[index].done = false;</span><br><span class="line">    db.write(list);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function updateTitle(list,index)&#123;</span><br><span class="line">    inquirer.prompt([</span><br><span class="line">        &#123;type: &apos;input&apos;,</span><br><span class="line">        name: &apos;title&apos;,</span><br><span class="line">        message:&apos;新的标题&apos;,</span><br><span class="line">        default: list[index].title</span><br><span class="line">    &#125;]).then(answer =&gt; &#123;</span><br><span class="line">        list[index].title = answer.title</span><br><span class="line">        db.write(list)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function remove(list,index)&#123;</span><br><span class="line">    list.splice(index,1);</span><br><span class="line">    db.write(list);</span><br><span class="line">&#125;</span><br><span class="line">                </span><br><span class="line">function askForAction(list, index)&#123;</span><br><span class="line">    const actions = &#123;</span><br><span class="line">        makeAsDone,</span><br><span class="line">        maksAsUndone,</span><br><span class="line">        updateTitle,</span><br><span class="line">        remove</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    inquirer</span><br><span class="line">    .prompt([</span><br><span class="line">        &#123;</span><br><span class="line">            type: &apos;list&apos;,</span><br><span class="line">            name: &apos;action&apos;,</span><br><span class="line">            message: &apos;请选择操作&apos;,</span><br><span class="line">            choices: [ </span><br><span class="line">                &#123;name:&apos;退出&apos;,value:&apos;quit&apos;&#125;,</span><br><span class="line">                &#123;name:&apos;已完成&apos;,value:&apos;makeAsDone&apos;&#125;,</span><br><span class="line">                &#123;name:&apos;未完成&apos;,value:&apos;maksAsUndone&apos;&#125;,</span><br><span class="line">                &#123;name:&apos;改标题&apos;,value:&apos;updateTitle&apos;&#125;,</span><br><span class="line">                &#123;name:&apos;删除&apos;,value:&apos;remove&apos;&#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">    ])</span><br><span class="line">    .then(answers2 =&gt; &#123;</span><br><span class="line">        const action = actions[answers2.action];</span><br><span class="line">        console.log(action);</span><br><span class="line">        action &amp;&amp; action(list, index);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function printTasks(list)&#123;</span><br><span class="line">    inquirer</span><br><span class="line">    .prompt([</span><br><span class="line">        &#123;</span><br><span class="line">            type: &apos;list&apos;,</span><br><span class="line">            name: &apos;index&apos;,</span><br><span class="line">            message: &apos;请选择你想操作的任务&apos;,</span><br><span class="line">            choices: [ </span><br><span class="line">                &#123;name:&apos;退出&apos;,value:&apos;-1&apos;&#125;,</span><br><span class="line">              </span><br><span class="line">                ...list.map((task, index)=&gt;&#123;</span><br><span class="line">                return &#123;name: `$&#123;task.done ? &apos;[x]&apos; : &apos;[_]&apos;&#125;$&#123;index&#125; - $&#123;task.title&#125;`, value: index.toString()&#125;</span><br><span class="line">            &#125;),</span><br><span class="line">            &#123;name:&apos;创建任务&apos;,value:&apos;-2&apos;&#125;</span><br><span class="line">        ]</span><br><span class="line">        &#125;,</span><br><span class="line">    ])</span><br><span class="line">    .then(answers =&gt; &#123;</span><br><span class="line">        const index = parseInt(answers.index);</span><br><span class="line">        if(index &gt;= 0)&#123;</span><br><span class="line">            askForAction(list,index);</span><br><span class="line">        &#125;else if( index === -2)&#123;</span><br><span class="line">            // 创建任务</span><br><span class="line">            askForCreateTask(list);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports.showAll = async (title) =&gt;&#123;</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    printTasks(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>优化技巧，给一坨代码起个名字法</strong></p>
<blockquote>
<h3 id="005-发布代码"><a href="#005-发布代码" class="headerlink" title="005 发布代码"></a>005 发布代码</h3></blockquote>
<ul>
<li>修改 package.json</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;bin&quot;:&#123;</span><br><span class="line">    &quot;t&quot;: &quot;cli.js&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;files&quot;:[&quot;*.js&quot;]</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 node shebang 在 cli.js 第一行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你是 mac 添加文件可执行权限<ul>
<li><code>chmod +x cli.js</code></li>
</ul>
</li>
<li><p>nrm 安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nrm</span><br><span class="line"></span><br><span class="line">// 如果你是别的源 你就 nrm use npm</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布你的代码</p>
<ul>
<li>如果是 yarn 你就<code>yarn login 和 yarn publish</code></li>
<li>如果是npm 你就<code>npm adduser 和 npm puhlish</code></li>
<li>注意把淘宝源切换为原始源</li>
</ul>
</li>
</ul>
<h4 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a>代码仓库</h4><ul>
<li><a href="https://github.com/slTrust/node-todo-1/" target="_blank" rel="noopener">https://github.com/slTrust/node-todo-1/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/08/Node全解02-02node命令行程序/" data-id="ckkmr2k1l00a8fp91hssxvqha" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解02-01node命令行程序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/08/Node全解02-01node命令行程序/" class="article-date">
  <time datetime="2020-03-08T05:58:10.000Z" itemprop="datePublished">2020-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/08/Node全解02-01node命令行程序/">Node全解02_01node命令行程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="CRM学习-Node-js-之文件模块"><a href="#CRM学习-Node-js-之文件模块" class="headerlink" title="CRM学习 Node.js 之文件模块"></a>CRM学习 Node.js 之文件模块</h3><p>目标 <strong>完成一个命令行工具</strong></p>
<blockquote>
<p>001 新建目录 node-todo-1</p>
</blockquote>
<ul>
<li>打开这个目录终端 yarn init -y </li>
<li>修改package.json 的版本号为 0.0.1</li>
<li>新建 index.js 内容为<code>console.log(&#39;hi&#39;)</code></li>
</ul>
<blockquote>
<p>002 使用库 <a href="https://github.com/tj/commander.js" target="_blank" rel="noopener">commander.js</a></p>
</blockquote>
<ul>
<li>抄文档开始干</li>
<li><code>npm install commander</code> 或者你 <code>yarn add commander</code></li>
<li><p>安装后，继续抄</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line"></span><br><span class="line">program</span><br><span class="line">.option(&apos;-d, --debug&apos;, &apos;output extra debugging&apos;)</span><br><span class="line">.option(&apos;-s, --small&apos;, &apos;small pizza size&apos;)</span><br><span class="line">.option(&apos;-p, --pizza-type &lt;type&gt;&apos;, &apos;flavour of pizza&apos;);</span><br><span class="line"></span><br><span class="line">program.parse(process.argv);</span><br><span class="line"></span><br><span class="line">// 额外加一行</span><br><span class="line">console.log(&apos;hi&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>项目根目录运行 node index.js  只打印了 hi</p>
</li>
<li><p>此时你运行 <code>node index -h</code> 会显示如下内容</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage: index [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">-d, --debug              output extra debugging</span><br><span class="line">-s, --small              small pizza size</span><br><span class="line">-p, --pizza-type &lt;type&gt;  flavour of pizza</span><br><span class="line">-h, --help               output usage information</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 index.js</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 修改后然后运行  node index -h 就会显示你修改的内容</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line"></span><br><span class="line">program</span><br><span class="line">.option(&apos;-x, --xxx&apos;, &apos;what the x&apos;)</span><br><span class="line"></span><br><span class="line">program.parse(process.argv);</span><br></pre></td></tr></table></figure>
</li>
<li><p>继续抄文档， 实现一个子命令</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line"></span><br><span class="line">// 设置它的选项</span><br><span class="line">program</span><br><span class="line">.option(&apos;-x, --xxx&apos;, &apos;what the x&apos;)</span><br><span class="line"></span><br><span class="line">// 设置子命令</span><br><span class="line">program</span><br><span class="line">.command(&apos;add &lt;taskName&gt;&apos;)</span><br><span class="line">.description(&apos;add a task&apos;)</span><br><span class="line">.action((x,y) =&gt; &#123;</span><br><span class="line">    console.log(x)</span><br><span class="line">    console.log(y)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">program.parse(process.argv);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 运行 node index add  会提示缺少一个 taskName</span><br><span class="line"></span><br><span class="line">// 运行 node index add aa  打印 </span><br><span class="line">aa</span><br><span class="line">Command &#123;</span><br><span class="line">commands: [],</span><br><span class="line">options: [],</span><br><span class="line">_execs: Set &#123;&#125;,</span><br><span class="line">_allowUnknownOption: false,</span><br><span class="line">_args: [ &#123; required: true, name: &apos;taskName&apos;, variadic: false &#125; ],</span><br><span class="line">_name: &apos;add&apos;,</span><br><span class="line">_optionValues: &#123;&#125;,</span><br><span class="line">_storeOptionsAsProperties: true,</span><br><span class="line">_passCommandToAction: true,</span><br><span class="line">_actionResults: [],</span><br><span class="line">_helpFlags: &apos;-h, --help&apos;,</span><br><span class="line">_helpDescription: &apos;output usage information&apos;,</span><br><span class="line">_helpShortFlag: &apos;-h&apos;,</span><br><span class="line">_helpLongFlag: &apos;--help&apos;,</span><br><span class="line">_noHelp: false,</span><br><span class="line">_exitCallback: undefined,</span><br><span class="line">_executableFile: undefined,</span><br><span class="line">parent: Command &#123;</span><br><span class="line">    commands: [ [Circular] ],</span><br><span class="line">    options: [ [Option] ],</span><br><span class="line">    _execs: Set &#123;&#125;,</span><br><span class="line">    _allowUnknownOption: false,</span><br><span class="line">    _args: [],</span><br><span class="line">    _name: &apos;index&apos;,</span><br><span class="line">    _optionValues: &#123;&#125;,</span><br><span class="line">    _storeOptionsAsProperties: true,</span><br><span class="line">    _passCommandToAction: true,</span><br><span class="line">    _actionResults: [],</span><br><span class="line">    _helpFlags: &apos;-h, --help&apos;,</span><br><span class="line">    _helpDescription: &apos;output usage information&apos;,</span><br><span class="line">    _helpShortFlag: &apos;-h&apos;,</span><br><span class="line">    _helpLongFlag: &apos;--help&apos;,</span><br><span class="line">    Command: [Function: Command],</span><br><span class="line">    Option: [Function: Option],</span><br><span class="line">    CommanderError: [Function: CommanderError],</span><br><span class="line">    _events: [Object: null prototype] &#123;</span><br><span class="line">    &apos;option:xxx&apos;: [Function],</span><br><span class="line">    &apos;command:add&apos;: [Function: listener]</span><br><span class="line">    &#125;,</span><br><span class="line">    _eventsCount: 2,</span><br><span class="line">    rawArgs: [</span><br><span class="line">    &apos;/Users/hjx/.nvm/versions/node/v12.14.1/bin/node&apos;,</span><br><span class="line">    &apos;/Users/hjx/Desktop/node-todo-1/index.js&apos;,</span><br><span class="line">    &apos;add&apos;,</span><br><span class="line">    &apos;aa&apos;,</span><br><span class="line">    &apos;bb&apos;,</span><br><span class="line">    &apos;cc&apos;</span><br><span class="line">    ],</span><br><span class="line">    args: [ &apos;aa&apos;, &apos;bb&apos;, &apos;cc&apos; ]</span><br><span class="line">&#125;,</span><br><span class="line">_description: &apos;add a task&apos;,</span><br><span class="line">_argsDescription: undefined</span><br><span class="line">&#125;</span><br><span class="line">// 你就可以自己领会了</span><br></pre></td></tr></table></figure>
</li>
<li><p>index.js</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line"></span><br><span class="line">// 设置它的选项</span><br><span class="line">program</span><br><span class="line">.option(&apos;-x, --xxx&apos;, &apos;what the x&apos;)</span><br><span class="line"></span><br><span class="line">// 设置子命令</span><br><span class="line">program</span><br><span class="line">  .command(&apos;add &lt;taskName&gt;&apos;)</span><br><span class="line">  .description(&apos;add a task&apos;)</span><br><span class="line">  .action((firstArg,info) =&gt; &#123;</span><br><span class="line">      let args = info.parent.args;</span><br><span class="line">      console.log(args);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">program.parse(process.argv);</span><br><span class="line"></span><br><span class="line">// node index aa bb cc dd</span><br><span class="line">// 打印 aa bb cc dd</span><br></pre></td></tr></table></figure>
<blockquote>
<p>003 修改目录结构</p>
</blockquote>
<p>cli.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">const api = require(&apos;./index.js&apos;)</span><br><span class="line">// 设置它的选项</span><br><span class="line">program</span><br><span class="line">.option(&apos;-x, --xxx&apos;, &apos;what the x&apos;)</span><br><span class="line"></span><br><span class="line">// 设置子命令</span><br><span class="line">program</span><br><span class="line">  .command(&apos;add &lt;taskName&gt;&apos;)</span><br><span class="line">  .description(&apos;add a task&apos;)</span><br><span class="line">  .action((firstArg,info) =&gt; &#123;</span><br><span class="line">      let words = info.parent.args;</span><br><span class="line">      console.log(words);</span><br><span class="line">      api.add(words);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">program</span><br><span class="line">  .command(&apos;clear&apos;)</span><br><span class="line">  .description(&apos;clear all tasks&apos;)</span><br><span class="line">  .action(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;this is clear&apos;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">program.parse(process.argv);</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module.exports.add = (title)=&gt;&#123;</span><br><span class="line">    console.log(&apos;add &apos; + title);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行 <code>node cli add aa bb cc</code> 会显示相应的任务被添加</p>
<blockquote>
<p>004 持久化任务内容</p>
</blockquote>
<ul>
<li>但是没有数据库～</li>
<li>使用一个文件吧！ 存到用户home目录里 打算存在<code>~/</code></li>
<li>google 搜索 <code>nodejs get home directory</code></li>
<li>得到答案<code>const homedir = require(&#39;os&#39;).homedir()</code></li>
<li><p>获取用户设置的 home 目录 <code>const home = process.env.HOME</code></p>
</li>
<li><p>修改 index.js</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const homedir = require(&apos;os&apos;).homedir()</span><br><span class="line">const home = process.env.HOME || homedir;</span><br><span class="line">module.exports.add = (title)=&gt;&#123;</span><br><span class="line">    console.log(&apos;add &apos; + title);</span><br><span class="line">    // 读取之前的任务</span><br><span class="line">    fs.readFile(dbPath,&#123;&#125;);</span><br><span class="line">    // 往里面添加一个任务</span><br><span class="line">    // 存储任务到文件</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>005 如何拼目录 path</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 专门用来拼路径的 windows 是 \  mac 是 /</span><br><span class="line">const p = require(&apos;path&apos;);</span><br><span class="line">const dbPath = p.join(目录,目录&apos;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>006 利用<a href="https://devdocs.io/" target="_blank" rel="noopener">https://devdocs.io/</a>查fs模块使用</p>
</blockquote>
<ul>
<li>搜索 fs.readFile 查看api </li>
<li>看到 参数里 options 有个 flag 点进去</li>
<li>得到各种模式 <code>a / ax / a+ ...</code></li>
</ul>
<blockquote>
<p>007 实现创建任务功能</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">const homedir = require(&apos;os&apos;).homedir()</span><br><span class="line">const home = process.env.HOME || homedir;</span><br><span class="line">// 专门用来拼路径的 windows 是 \  mac 是 /</span><br><span class="line">const p = require(&apos;path&apos;);</span><br><span class="line">const dbPath = p.join(home,&apos;.todo&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">module.exports.add = (title)=&gt;&#123;</span><br><span class="line">    // 读取之前的任务</span><br><span class="line">    fs.readFile(dbPath,&#123;flag:&apos;a+&apos;&#125;,(error,data)=&gt;&#123;</span><br><span class="line">        if(error)&#123;</span><br><span class="line">            console.log(error)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            let list;</span><br><span class="line">            try&#123;</span><br><span class="line">                list = JSON.parse(data.toString())</span><br><span class="line">            &#125;catch(error2)&#123;</span><br><span class="line">                list = []</span><br><span class="line">            &#125;</span><br><span class="line">            const task = &#123;</span><br><span class="line">                title: title,</span><br><span class="line">                done: false</span><br><span class="line">            &#125;</span><br><span class="line">            list.push(task);</span><br><span class="line">            const string = JSON.stringify(list);</span><br><span class="line">            fs.writeFile(dbPath,string + &quot;\n&quot;,(error3)=&gt;&#123;</span><br><span class="line">                if(error3)&#123;</span><br><span class="line">                    console.log(error3)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            console.log(list)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 往里面添加一个任务</span><br><span class="line">    // 存储任务到文件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>007 优化代码 <strong>面向接口编程</strong></p>
</blockquote>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const db = require(&apos;./db.js&apos;);</span><br><span class="line"></span><br><span class="line">module.exports.add = async (title) =&gt;&#123;</span><br><span class="line">    // 读取之前的任务</span><br><span class="line">    const list = await db.read();</span><br><span class="line">    // 往里面添加一个任务</span><br><span class="line">    list.push(&#123;title,done:false&#125;);</span><br><span class="line">    // 存储任务到文件</span><br><span class="line">    await db.write(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>db.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">const homedir = require(&apos;os&apos;).homedir()</span><br><span class="line">const home = process.env.HOME || homedir;</span><br><span class="line">// 专门用来拼路径的 windows 是 \  mac 是 /</span><br><span class="line">const p = require(&apos;path&apos;);</span><br><span class="line">const dbPath = p.join(home,&apos;.todo&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">const db = &#123;</span><br><span class="line">    read(path = dbPath)&#123;</span><br><span class="line">        return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">            fs.readFile(path,&#123;flag:&apos;a+&apos;&#125;,(error,data)=&gt;&#123;</span><br><span class="line">                if(error)&#123; return reject(error); &#125;</span><br><span class="line">                let list;</span><br><span class="line">                try&#123;</span><br><span class="line">                    list = JSON.parse(data.toString())</span><br><span class="line">                &#125;catch(error2)&#123;</span><br><span class="line">                    list = []</span><br><span class="line">                &#125;</span><br><span class="line">                resolve(list);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)   </span><br><span class="line">    &#125;,</span><br><span class="line">    write(list, path = dbPath)&#123;</span><br><span class="line">        return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">            const string = JSON.stringify(list);</span><br><span class="line">            fs.writeFile(path,string + &quot;\n&quot;,(error)=&gt;&#123;</span><br><span class="line">                if(error)&#123; return reject(error); &#125;</span><br><span class="line">                resolve(); </span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = db;</span><br></pre></td></tr></table></figure>
<h3 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a>代码仓库</h3><ul>
<li><a href="https://github.com/slTrust/node-todo-1/tree/4e6810251dc4aa880d96c660d435b7487c7d7cb5" target="_blank" rel="noopener">https://github.com/slTrust/node-todo-1/tree/4e6810251dc4aa880d96c660d435b7487c7d7cb5</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/08/Node全解02-01node命令行程序/" data-id="ckkmr2k1k00a5fp918dazfj9t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解01-02如何学习Node" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/07/Node全解01-02如何学习Node/" class="article-date">
  <time datetime="2020-03-07T07:57:13.000Z" itemprop="datePublished">2020-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/07/Node全解01-02如何学习Node/">Node全解01_02如何学习Node</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="如何学习-Node-js"><a href="#如何学习-Node-js" class="headerlink" title="如何学习 Node.js"></a>如何学习 Node.js</h2><h3 id="先看提供的-Node-js-API"><a href="#先看提供的-Node-js-API" class="headerlink" title="先看提供的 Node.js API"></a>先看提供的 Node.js API</h3><blockquote>
<p>官方API文档</p>
</blockquote>
<ul>
<li>英文 <a href="http://nodejs.org/api" target="_blank" rel="noopener">http://nodejs.org/api</a></li>
<li>中文 <a href="http://nodejs.cn/api" target="_blank" rel="noopener">http://nodejs.cn/api</a></li>
</ul>
<blockquote>
<p>民间版本 <a href="https://devdocs.io/" target="_blank" rel="noopener">https://devdocs.io/</a></p>
</blockquote>
<p><strong>非常推荐</strong></p>
<ul>
<li>进入之后可以选择 Node.js 某个 LTS版本</li>
<li>搜索功能非常方便</li>
<li>可开启黑色主题</li>
<li>可离线观看</li>
</ul>
<h3 id="API-到底有哪些"><a href="#API-到底有哪些" class="headerlink" title="API 到底有哪些"></a>API 到底有哪些</h3><p><strong>加粗的是重点需要看的</strong></p>
<ul>
<li>Assertion 断言</li>
<li>Testing 测试</li>
<li>Async Hooks 异步钩子</li>
<li><strong>Buffer</strong> 一小段缓存</li>
<li><strong>Child Processes</strong> 子进程</li>
<li><strong>Cluster</strong> 集群</li>
<li>Console</li>
<li>Crypto 加密</li>
<li><strong>Debugger</strong> 调试</li>
<li>DNS 获取IP</li>
<li>Errors 错误</li>
<li><strong>Events</strong> 事件</li>
<li><strong>File System</strong> 文件系统</li>
<li><strong>Globals</strong> 全局变量</li>
<li><strong>HTTP</strong></li>
<li>HTTP/2</li>
<li>HTTPS</li>
<li>Inspector</li>
<li>i18n</li>
<li>Net</li>
<li>OS</li>
<li><strong>Path</strong> 路径</li>
<li>Performance Hooks</li>
<li><strong>Process</strong> 进程相关</li>
<li><strong>Query Strings</strong> url处理</li>
<li>Readline</li>
<li>REPL</li>
<li>Report</li>
<li><strong>Stream</strong> 流</li>
<li>String Decoder</li>
<li><strong>Times</strong> setTimeout 那类</li>
<li>TLS/SSL</li>
<li>Trace Events</li>
<li>TTY</li>
<li>UDP/Datagram</li>
<li><strong>URL</strong></li>
<li>Utilites</li>
<li>V8</li>
<li>VM</li>
<li><strong>Worker Threads</strong> node10之后的</li>
<li>Zlib</li>
</ul>
<h4 id="学习路线"><a href="#学习路线" class="headerlink" title="学习路线"></a>学习路线</h4><blockquote>
<p>基础 - Web - 框架</p>
</blockquote>
<ul>
<li>先学基础，以任务为导向学习</li>
<li>逐个学习 文件、HTTP、Stream 等模块</li>
<li>在学 Web,学习数据库、AJAX 相关知识</li>
<li>最后学框架，以项目为导向学习</li>
<li>以 Express 为切入点，制作完整的网站</li>
</ul>
<blockquote>
<p>三个约定</p>
</blockquote>
<ul>
<li>写博客，记笔记(可以参考 东京大学笔记法)</li>
<li>CRM学习法贯穿整个学习过程</li>
<li>学习调试工具和思路</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/07/Node全解01-02如何学习Node/" data-id="ckkmr2k1i00a3fp91wl0x8m3f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node全解01-01Node简介" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/07/Node全解01-01Node简介/" class="article-date">
  <time datetime="2020-03-07T02:56:44.000Z" itemprop="datePublished">2020-03-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/07/Node全解01-01Node简介/">Node全解01_01Node简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Node-js是什么"><a href="#Node-js是什么" class="headerlink" title="Node.js是什么"></a>Node.js是什么</h1><blockquote>
<p>是一个平台</p>
</blockquote>
<ul>
<li>将多种技术组合起来</li>
<li>让JS 也能调用系统接口，开发后端应用</li>
</ul>
<blockquote>
<p>Node.js用到那些技术</p>
</blockquote>
<ul>
<li>V8引擎</li>
<li>libuv</li>
<li>C/C++实现的 c-ares、http-parser、OpenSSL、zlib等库</li>
</ul>
<h3 id="Node-js的技术架构"><a href="#Node-js的技术架构" class="headerlink" title="Node.js的技术架构"></a>Node.js的技术架构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Node.js API (http模块 fs stream 等)</span><br><span class="line">-------------------------------------</span><br><span class="line">Node.js bindings |  c/c++插件</span><br><span class="line">让JS和 c/c++通讯  ｜  自定义其他能力</span><br><span class="line">------------------------------------------------------------------</span><br><span class="line">JS引擎 v8 | 跨平台的异步IO能力 libuv | DNS解析｜加密解密OpenSSL | 其他。。。</span><br></pre></td></tr></table></figure>
<p>随着Node.js的版本从 0.8升级到 12.11.1 架构也一直变化<br>如果你想看源代码，推进看 <a href="https://github.com/nodejs/node/tree/v0.10" target="_blank" rel="noopener">0.10版本</a><br>因为这一版使用了很长的时间，而且源代码比最新版少很多</p>
<blockquote>
<p>如果你想了解更多，可以看 <a href="https://github.com/yjhjstz/deep-into-node" target="_blank" rel="noopener">yjhjstz/deep-into-node</a></p>
</blockquote>
<h3 id="什么是-bindings"><a href="#什么是-bindings" class="headerlink" title="什么是 bindings"></a>什么是 bindings</h3><blockquote>
<p>背景</p>
</blockquote>
<ul>
<li>C/C++实现了一个 http_parser 库，很高效</li>
<li>你只会写JS,但是你想调用这个库</li>
<li>直接调用肯定不行，你需要一个中间的桥梁</li>
</ul>
<blockquote>
<p>bindings</p>
</blockquote>
<ul>
<li>Node.js 用C++ 对 http_parser 进行封装，使它符合某些要求，封装的的文件叫做 http_parser_bindings.cpp</li>
<li>用 Node.js提供的编译工具将其编译为 .node文件</li>
<li>JS代码可以直接 require 这个 .node文件</li>
<li>这样JS就可以 调用 C++库,中间的桥梁就是 bindings</li>
<li>由于 Node.js 提供了很多 binding， 所以叫做 bindings</li>
<li>这就是 bindings</li>
</ul>
<h4 id="JS-和-C-交互"><a href="#JS-和-C-交互" class="headerlink" title="JS 和 C++ 交互"></a>JS 和 C++ 交互</h4><ul>
<li>JS调用 C++ 代码<ul>
<li><a href="http://nodejs.cn/api/addons.html#addons_function_arguments" target="_blank" rel="noopener">官方例子</a></li>
</ul>
</li>
<li>C++调用 JS回调<ul>
<li><a href="http://nodejs.cn/api/addons.html#addons_callbacks" target="_blank" rel="noopener">官方例子</a></li>
</ul>
</li>
</ul>
<h3 id="先看下-0-10版的-Node-依赖了什么"><a href="#先看下-0-10版的-Node-依赖了什么" class="headerlink" title="先看下 0.10版的 Node 依赖了什么"></a>先看下 0.10版的 Node 依赖了什么</h3><ul>
<li><a href="https://github.com/nodejs/node/tree/v0.10/deps" target="_blank" rel="noopener">node0.10版 deps目录</a></li>
</ul>
<h3 id="libuv是什么"><a href="#libuv是什么" class="headerlink" title="libuv是什么"></a>libuv是什么</h3><blockquote>
<p>背景</p>
</blockquote>
<ul>
<li>FreeBSD 系统有个 kqueue</li>
<li>Linux 有个 epoll</li>
<li>Windows 有个 IOCP</li>
<li>Ryan 为了一个跨平台的异步IO库，开始写 libuv</li>
<li>libuv 会根据系统自动选择合适的方案</li>
</ul>
<blockquote>
<p>功能</p>
</blockquote>
<ul>
<li>可以用于TCP/UDP/DNS 文件等的异步操作</li>
</ul>
<h3 id="V8是什么"><a href="#V8是什么" class="headerlink" title="V8是什么"></a>V8是什么</h3><blockquote>
<p>功能</p>
</blockquote>
<ul>
<li>将JS源代码变成本地代码并执行</li>
<li>维护调用栈，确保JS函数的执行顺序</li>
<li>内存管理，为所有对象分配内存</li>
<li>垃圾回收，重复利用无用的内存</li>
<li>实现JS的标准库</li>
</ul>
<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li>V8不提供DOM API</li>
<li>V8执行 JS 是单线程的， V8本身是多线程的</li>
<li>可以开启两个线程分别执行JS</li>
<li>V8本身是包含多个线程的，如垃圾回收为单独线程</li>
<li>自带 eventloop 但 Node.js 基于 libuv 自己做了一个</li>
</ul>
<h3 id="Event-Loop-是什么"><a href="#Event-Loop-是什么" class="headerlink" title="Event Loop 是什么"></a>Event Loop 是什么</h3><blockquote>
<p>什么是 Event</p>
</blockquote>
<ul>
<li>setTimeout 的时间到了，就会产生一个事件</li>
<li>文件可以读取了，读取出错了</li>
<li>socket 有内容了，关闭了</li>
</ul>
<blockquote>
<p>什么是 Loop</p>
</blockquote>
<ul>
<li>loop 就是循环，比如 while(true) 循环</li>
<li>由于事件是分优先级的，所以处理起来也是分先后的<ul>
<li>setTimeout(f1,100)</li>
<li>fs.readFile(‘1.txt’,f2)</li>
<li>server.on(‘close’,f3)</li>
</ul>
</li>
<li>所以 Node.js 需要按顺序轮询每种事件</li>
<li>这种轮询往往都是循环的， 1=&gt;2=&gt;3=&gt;1=&gt;2=&gt;3</li>
</ul>
<blockquote>
<p>Event Loop</p>
</blockquote>
<ul>
<li>操作系统可以触发事件，JS可以处理事件</li>
<li>Event Loop 就是对事件处理顺序的管理</li>
</ul>
<h4 id="Event-loop"><a href="#Event-loop" class="headerlink" title="Event loop"></a>Event loop</h4><ul>
<li><a href="https://juejin.im/post/5ab7677f6fb9a028d56711d0" target="_blank" rel="noopener">翻译版官方文档</a></li>
<li>读官方文档是最好的方式</li>
</ul>
<blockquote>
<p>重点阶段 </p>
</blockquote>
<ul>
<li>times 检查计时器</li>
<li>poll 轮询，检查系统事件</li>
<li>check 检查 setImmediate 回调</li>
<li>其他阶段可暂时不考虑</li>
</ul>
<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li>大部分时间， Node.js 都停留在 poll 轮询阶段</li>
<li>大部分事件都在 poll 阶段被处理，如文件、网络请求</li>
</ul>
<p><strong>前面总结过Event loop 的知识点，可参考 Node-JS专精里的Eventloop章节</strong></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>用 libuv 进行异步I/O操作</li>
<li>用 eventloop 管理事件处理顺序</li>
<li>用 C/C++ 库高效处理 DNS/HTTP …</li>
<li>用 bindings 让 JS 和 C/C++ 沟通</li>
<li>用 V8 运行 JS</li>
<li>用 Node.js 标准库简化 JS 代码</li>
<li>这就是 Node.js</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/07/Node全解01-01Node简介/" data-id="ckkmr2k1h00a0fp91kf0yrasw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精13-02继承和组合" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/06/Node-JS专精13-02继承和组合/" class="article-date">
  <time datetime="2020-03-06T14:12:01.000Z" itemprop="datePublished">2020-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/06/Node-JS专精13-02继承和组合/">Node-JS专精13_02继承和组合</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="继承和组合"><a href="#继承和组合" class="headerlink" title="继承和组合"></a>继承和组合</h2><blockquote>
<p>现在给 Person 添加功能</p>
</blockquote>
<ul>
<li>person1.on(‘die’,fn)</li>
<li>person1.emit(‘die’,fn)</li>
<li>person1.off(‘die’,fn)</li>
<li>让 Person 实例具有发布订阅功能，怎么做</li>
</ul>
<blockquote>
<p>可以加代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Person&#123;</span><br><span class="line">    constructor()&#123;&#125;</span><br><span class="line">    sayHi()</span><br><span class="line">    cache = []</span><br><span class="line">    on()&#123;&#125;</span><br><span class="line">    off()&#123;&#125;</span><br><span class="line">    emit()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let p1 = new Person()</span><br><span class="line">// 这样 p1 即是 人类 又能发布订阅</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除了人还有另一个类，报社</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class 报社&#123;</span><br><span class="line">    constructor()&#123;&#125;</span><br><span class="line">    print()</span><br><span class="line">    cache = []</span><br><span class="line">    on()&#123;&#125;</span><br><span class="line">    off()&#123;&#125;</span><br><span class="line">    emit()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let 报社1 = new 报社()</span><br><span class="line">// 这样 报社1 即是 报社 又能发布订阅</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="消除重复"><a href="#消除重复" class="headerlink" title="消除重复"></a>消除重复</h3></blockquote>
<p><strong>Person 和报社有重复属性</strong></p>
<ul>
<li>把重复属性提取出来，单独写个类 EventEmitter</li>
<li>然后让 Person 和 报社 继承 EventEmitter</li>
</ul>
<blockquote>
<p>细节</p>
</blockquote>
<ul>
<li>constructor 要调用 super()</li>
<li>来保证 EventEmitter 实例被初始化</li>
</ul>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class EventEmitter&#123;</span><br><span class="line">    constructor()&#123;&#125;</span><br><span class="line">    cache = []</span><br><span class="line">    on()&#123;&#125;</span><br><span class="line">    off()&#123;&#125;</span><br><span class="line">    emit()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person extends EventEmitter &#123;</span><br><span class="line">    name</span><br><span class="line">    constructor()&#123; super() &#125;</span><br><span class="line">    sayHi()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class aa extends EventEmitter&#123;</span><br><span class="line">    name</span><br><span class="line">    constructor()&#123; super() &#125;</span><br><span class="line">    print()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="继承的问题"><a href="#继承的问题" class="headerlink" title="继承的问题"></a>继承的问题</h3><ul>
<li>如果我需要多个功能怎么办？</li>
</ul>
<blockquote>
<p>两个选择</p>
</blockquote>
<ul>
<li>让 EventEmitter 继承其他类 （非常不好，类就不单纯了）</li>
<li>让 Person 继承两个类(多继承，C++ 才支持 ，也不行) </li>
</ul>
<h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><p><strong>组合没有固定的写法</strong></p>
<blockquote>
<h4 id="让-Person-实现发布订阅"><a href="#让-Person-实现发布订阅" class="headerlink" title="让 Person 实现发布订阅"></a>让 Person 实现发布订阅</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Person&#123;</span><br><span class="line">    eventEmitter = new EventEmitter()</span><br><span class="line">    name</span><br><span class="line">    sayHi()&#123;&#125;</span><br><span class="line">    on(eventName,fn)&#123; </span><br><span class="line">        this.eventEmitter.on(eventName,fn)</span><br><span class="line">    &#125;</span><br><span class="line">    off(eventName,fn)&#123; </span><br><span class="line">        this.eventEmitter.off(eventName,fn)</span><br><span class="line">    &#125;</span><br><span class="line">    emit(eventName,data)&#123; </span><br><span class="line">        this.eventEmitter.emit(eventName,data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优化代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Person&#123;</span><br><span class="line">    eventEmitter = new EventEmitter()</span><br><span class="line">    name</span><br><span class="line">    sayHi()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let p1 = new Person(&apos;aa&apos;)</span><br><span class="line"></span><br><span class="line">mixin(p1,new EventEmitter())</span><br><span class="line"></span><br><span class="line">function mixin(to,from)&#123;</span><br><span class="line">    for(let key in from)&#123;</span><br><span class="line">        to[key] = from[key]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 注意这里是 简化版的 mixin， 实际会更复杂的</span><br></pre></td></tr></table></figure>
<p>这样你就可以有更多的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Person&#123;</span><br><span class="line">    eventEmitter = new EventEmitter()</span><br><span class="line">    name</span><br><span class="line">    sayHi()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">let p1 = new Person(&apos;aa&apos;)</span><br><span class="line">mixin(p1,new EventEmitter())</span><br><span class="line">mixin(p1,new Flyer())</span><br><span class="line">mixin(p1,new Killer())</span><br></pre></td></tr></table></figure>
<h4 id="有了组合之后，你可能不需要class了"><a href="#有了组合之后，你可能不需要class了" class="headerlink" title="有了组合之后，你可能不需要class了"></a>有了组合之后，你可能不需要class了</h4><ul>
<li>直接函数 + 闭包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 看到如下类</span><br><span class="line">class robot&#123;</span><br><span class="line">    run()</span><br><span class="line">&#125;</span><br><span class="line">class murderRobot extends robot&#123;</span><br><span class="line">    kill()</span><br><span class="line">&#125;</span><br><span class="line">class cleaningRobot extends robot&#123;</span><br><span class="line">    clean()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class animal&#123;</span><br><span class="line">    poop()</span><br><span class="line">&#125;</span><br><span class="line">class dog extends animal&#123;</span><br><span class="line">    wangwang()</span><br><span class="line">&#125;</span><br><span class="line">class cat extends animal&#123;</span><br><span class="line">    miaomiao()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需求 狗型杀人机器人 （变态的需求总是不期而遇）</p>
</blockquote>
<p><strong>继承很难做到，我们用组合</strong></p>
<blockquote>
<p>组合模式来看</p>
</blockquote>
<ul>
<li>dog = poop() + wangwang()</li>
<li>cat = poop() + miaomiao()</li>
<li>cleaningRobot = run() + clean()</li>
<li>murderRobot = run() + kill()</li>
<li>狗型杀人机器人 = run() + kill() + wangwang()</li>
</ul>
<blockquote>
<h4 id="不用-class写-dog"><a href="#不用-class写-dog" class="headerlink" title="不用 class写 dog"></a>不用 class写 dog</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const createWang = (state) =&gt;(&#123;</span><br><span class="line">    wangwang: ()=&gt;&#123;</span><br><span class="line">        console.log(`汪汪,我是$&#123;state.name&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const createRun = (state) =&gt;(&#123;</span><br><span class="line">    run: ()=&gt; state.position += 1</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const createKill = (state) =&gt;(&#123;</span><br><span class="line">    kill: ()=&gt; &#123;</span><br><span class="line">        console.log(`kill`)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const createDog = (name) =&gt;&#123;</span><br><span class="line">    const state = &#123;name,position:0&#125;</span><br><span class="line">    return Object.assign(</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        createWang(state),</span><br><span class="line">        createRun(state),</span><br><span class="line">        createKill(state)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const dog = createDog(&apos;小白&apos;)</span><br></pre></td></tr></table></figure>
<p><strong>这就是组合模式</strong></p>
<ul>
<li>缺点：写法太灵活，而且这是JS写法，如果是 Java 肯定不这样</li>
</ul>
<h4 id="结论和共识"><a href="#结论和共识" class="headerlink" title="结论和共识"></a>结论和共识</h4><ul>
<li>组合优于继承<ul>
<li>能实现 扁平化的重新分配</li>
<li>而继承 是一个垂直方向的，如果你的需求是两个垂直线交叉 很难做！</li>
</ul>
</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><blockquote>
<h4 id="什么情况用继承"><a href="#什么情况用继承" class="headerlink" title="什么情况用继承"></a>什么情况用继承</h4></blockquote>
<ul>
<li>开发者不会用组合</li>
<li>功能单一，没太多交叉的地方，一眼能看出继承关系</li>
<li>前端库比较喜欢用继承</li>
</ul>
<blockquote>
<p>举例</p>
</blockquote>
<ul>
<li>class App extends React.component{…}</li>
<li>React.Component 内置了方便的复用代码(钩子)</li>
</ul>
<blockquote>
<h4 id="什么情况用组合"><a href="#什么情况用组合" class="headerlink" title="什么情况用组合"></a>什么情况用组合</h4></blockquote>
<ul>
<li>功能组合非常灵活，无法一眼看出继承关系</li>
<li>插件模式</li>
<li>mixin 模式</li>
</ul>
<p><strong>举例</strong></p>
<ul>
<li>Vue.mixin()</li>
<li>Vue.use(plugin)</li>
<li>Vue 的 install 功能</li>
<li>React接受组件的组件</li>
<li>const vm = new Vue({…}) <ul>
<li>vm.$on / vm.$off / vm.$emit</li>
</ul>
</li>
<li>Vue 组合了 EventEmiter</li>
</ul>
<h4 id="什么情况用这些"><a href="#什么情况用这些" class="headerlink" title="什么情况用这些"></a>什么情况用这些</h4><ul>
<li>基础库用继承</li>
<li>业务开发使用组合</li>
<li>不一定是对的 灵活选择</li>
</ul>
<h3 id="组合的内存性能问题"><a href="#组合的内存性能问题" class="headerlink" title="组合的内存性能问题"></a>组合的内存性能问题</h3><ul>
<li>结论就是：实际上没多大区别</li>
</ul>
<p>之前的 狗型杀人机器人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const dog = createDog(&apos;小白&apos;)</span><br><span class="line">const d1 = createDog(&apos;a&apos;)</span><br><span class="line">const d2 = createDog(&apos;b&apos;)</span><br><span class="line"></span><br><span class="line">d1.run === d2.run  // false</span><br></pre></td></tr></table></figure>
<p>解决方案:通过一些技巧优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const f1 = ()=&gt;&#123;&#125;</span><br><span class="line">createF1 = (state)=&gt;(&#123;f1:f1&#125;)</span><br><span class="line">const f2 = ()=&gt;&#123;&#125;</span><br><span class="line">createF2 = (state)=&gt;(&#123;f2:f2&#125;)</span><br><span class="line"></span><br><span class="line">createDog = (name)=&gt;&#123;</span><br><span class="line">    const state = &#123;name&#125;</span><br><span class="line">    return Object.assign(&#123;&#125;,createF1(),createF2())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d1 = createDog(1)</span><br><span class="line">d2 = createDog(2)</span><br><span class="line"></span><br><span class="line">d1.f1 === d2.f1 // true</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在看继承：实际也不省空间</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">    sayA()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B extends A&#123;</span><br><span class="line">    name</span><br><span class="line">    constructor(name)&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    sayB()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 实际就是原型链</span><br><span class="line">// 但是 构建B的过程 要先构建 A 多了一层原型 所以也并不是非常的省内存</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/06/Node-JS专精13-02继承和组合/" data-id="ckkmr2k1c009nfp91q5zasqqr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 14.09px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 13.64px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.36px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.64px;">M01</a> <a href="/tags/M02/" style="font-size: 15px;">M02</a> <a href="/tags/M03/" style="font-size: 15.45px;">M03</a> <a href="/tags/M04/" style="font-size: 15.91px;">M04</a> <a href="/tags/M06/" style="font-size: 18.18px;">M06</a> <a href="/tags/M07/" style="font-size: 17.73px;">M07</a> <a href="/tags/M08/" style="font-size: 16.82px;">M08</a> <a href="/tags/M09/" style="font-size: 11.82px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 12.27px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.64px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.36px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.55px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.45px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.73px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.27px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.09px;">java</a> <a href="/tags/linux/" style="font-size: 10.91px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.36px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.73px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.73px;">mysql</a> <a href="/tags/node/" style="font-size: 10.45px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.27px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.18px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.55px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/20/HTTP06密码学到https流程/">HTTP06密码学到https流程</a>
          </li>
        
          <li>
            <a href="/2021/01/19/HTTP05缓存控制/">HTTP05缓存控制</a>
          </li>
        
          <li>
            <a href="/2021/01/18/HTTP04报文和http状态码/">HTTP04报文和http状态码</a>
          </li>
        
          <li>
            <a href="/2021/01/17/HTTP03http常用方法/">HTTP03http常用方法</a>
          </li>
        
          <li>
            <a href="/2021/01/16/HTTP02三次握手四度挥手/">HTTP02三次握手四度挥手</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>