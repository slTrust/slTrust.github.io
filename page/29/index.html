<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/29/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Py007-01-03内置urllib模块补充" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/Py007-01-03内置urllib模块补充/" class="article-date">
  <time datetime="2018-11-29T14:59:14.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/Py007-01-03内置urllib模块补充/">Py007-01-03内置urllib模块补充</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="urllib补充"><a href="#urllib补充" class="headerlink" title="urllib补充"></a>urllib补充</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 补充说明：</span><br><span class="line">urlopen函数原型：</span><br><span class="line">    urllib.request.urlopen(url, data=None, timeout=&lt;object object at 0x10af327d0&gt;, *, cafile=None, capath=None, cadefault=False, context=None)</span><br><span class="line"></span><br><span class="line">在上一节中我们只使用了该函数中的第一个参数url。在日常开发中，我们能用的只有url和data这两个参数。</span><br><span class="line"></span><br><span class="line">url参数：指定向哪个url发起请求</span><br><span class="line">data参数：可以将post请求中携带的参数封装成字典的形式传递给该参数</span><br><span class="line"></span><br><span class="line">urlopen函数返回的响应对象，相关函数调用介绍：</span><br><span class="line">response.headers()：获取响应头信息</span><br><span class="line">response.getcode()：获取响应状态码</span><br><span class="line">response.geturl()：获取请求的url</span><br><span class="line">response.read()：获取响应中的数据值（字节类型）</span><br></pre></td></tr></table></figure>
<h4 id="二进制数据的爬取"><a href="#二进制数据的爬取" class="headerlink" title="二进制数据的爬取"></a>二进制数据的爬取</h4><blockquote>
<p>爬取网络上的某张图片数据，且存储到磁盘</p>
</blockquote>
<ul>
<li>方法 1：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">#1.指定url</span><br><span class="line">url = &apos;https://pic.qiushibaike.com/system/pictures/12112/121121212/medium/ZOAND29U4NKNEWEF.jpg&apos;</span><br><span class="line">#2.发起请求:使用urlopen函数发起请求，该函数返回一个响应对象</span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line">#3.获取响应对象中的图片二进制类型的数据</span><br><span class="line">img_data = response.read()</span><br><span class="line">#4.持久化存储：将爬取的图片写入本地进行保存</span><br><span class="line">with open(&apos;./tupian.png&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(img_data)</span><br></pre></td></tr></table></figure>
<ul>
<li>方法 2：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;https://pic.qiushibaike.com/system/pictures/12112/121121212/medium/ZOAND29U4NKNEWEF.jpg&apos;</span><br><span class="line"># 函数原型：urllib.request.urlretrieve(url, filename=None)</span><br><span class="line"># 作用：对url发起请求，且将响应中的数据值写入磁盘进行存储</span><br><span class="line">urllib.request.urlretrieve(url=url,filename=&apos;./img.png&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="url的特性"><a href="#url的特性" class="headerlink" title="url的特性"></a>url的特性</h4><p>url必须为ASCII编码的数据值。所以我们在爬虫代码中编写url时，如果url中存在非ASCII编码的数据值，则必须对其进行ASCII编码后，该url方可被使用。</p>
<blockquote>
<p>案例：爬取使用搜狗根据指定词条搜索到的页面数据（例如爬取词条为‘周杰伦’的页面数据）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">url = &apos;https://www.sogou.com/web?query=周杰伦&apos;</span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line">data = response.read()</span><br><span class="line">with open(&apos;./周杰伦.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(data)</span><br><span class="line">print(&apos;写入文件完毕&apos;)</span><br></pre></td></tr></table></figure>
<p>【注意】上述代码中url存在非ascii编码的数据，则该url无效。如果对其发起请求，则会报如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeEncodeError: &apos;ascii&apos; codec can&apos;t encode characters in position 15-17: ordinal not in range</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所以必须对url中的非ascii的数据进行ascii的编码，则该url方可被发起请求：</p>
</blockquote>
<ul>
<li>方法 1：使用quote函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">url = &apos;https://www.sogou.com/web?query=%s&apos;</span><br><span class="line">#对url中的非ascii进行编码.quote函数可以对非ascii的数据值进行ascii的编码</span><br><span class="line">word = urllib.parse.quote(&apos;周杰伦&apos;)</span><br><span class="line">#将编码后的数据值拼接回url中</span><br><span class="line">url = format(url%word)</span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line">data = response.read()</span><br><span class="line">with open(&apos;./周杰伦.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(data)</span><br><span class="line">print(&apos;写入文件完毕&apos;)</span><br></pre></td></tr></table></figure>
<ul>
<li>方法2： 使用urlencode函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">url = &apos;https://www.sogou.com/web?&apos;</span><br><span class="line">#将get请求中url携带的参数封装至字典中</span><br><span class="line">param = &#123;</span><br><span class="line">    &apos;query&apos;:&apos;周杰伦&apos;</span><br><span class="line">&#125;</span><br><span class="line">#对url中的非ascii进行编码</span><br><span class="line">param = urllib.parse.urlencode(param)</span><br><span class="line">#将编码后的数据值拼接回url中</span><br><span class="line">url += param </span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line">data = response.read()</span><br><span class="line">with open(&apos;./周杰伦1.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(data)</span><br><span class="line">print(&apos;写入文件完毕&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="通过自定义请求对象，用于伪装爬虫程序请求的身份。"><a href="#通过自定义请求对象，用于伪装爬虫程序请求的身份。" class="headerlink" title="通过自定义请求对象，用于伪装爬虫程序请求的身份。"></a>通过自定义请求对象，用于伪装爬虫程序请求的身份。</h4><p>之前在讲解http常用请求头信息时，我们讲解过User-Agent参数，简称为UA，该参数的作用是用于表明本次请求载体的身份标识。如果我们通过浏览器发起的请求，则该请求的载体为当前浏览器，则UA参数的值表明的是当前浏览器的身份标识表示的一串数据。如果我们使用爬虫程序发起的一个请求，则该请求的载体为爬虫程序，那么该请求的UA为爬虫程序的身份标识表示的一串数据。有些网站会通过辨别请求的UA来判别该请求的载体是否为爬虫程序，如果为爬虫程序，则不会给该请求返回响应，那么我们的爬虫程序则也无法通过请求爬取到该网站中的数据值，这也是反爬虫的一种初级技术手段。那么为了防止该问题的出现，则我们可以给爬虫程序的UA进行伪装，伪装成某款浏览器的身份标识。</p>
<p>上述案例中，我们是通过request模块中的urlopen发起的请求，该请求对象为urllib中内置的默认请求对象，我们无法对其进行UA进行更改操作。urllib还为我们提供了一种自定义请求对象的方式，我们可以通过自定义请求对象的方式，给该请求对象中的UA进行伪装（更改）操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">url = &apos;https://www.sogou.com/web?&apos;</span><br><span class="line">#将get请求中url携带的参数封装至字典中</span><br><span class="line">param = &#123;</span><br><span class="line">    &apos;query&apos;:&apos;周杰伦&apos;</span><br><span class="line">&#125;</span><br><span class="line">#对url中的非ascii进行编码</span><br><span class="line">param = urllib.parse.urlencode(param)</span><br><span class="line">#将编码后的数据值拼接回url中</span><br><span class="line">url += param </span><br><span class="line"></span><br><span class="line">#封装自定义的请求头信息的字典：</span><br><span class="line">#将浏览器的UA数据获取，封装到一个字典中。该UA值可以通过抓包工具或者浏览器自带的开发者工具中获取某请求，从中获取UA的值</span><br><span class="line">#注意：在headers字典中可以封装任意的请求头信息</span><br><span class="line">headers=&#123;</span><br><span class="line">    &apos;User-Agent&apos; : &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36&apos;</span><br><span class="line">    &#125;</span><br><span class="line">#自定义请求对象，可以在该请求对象中添加自定义的请求头信息</span><br><span class="line">request = urllib.request.Request(url=url,headers=headers)</span><br><span class="line">#使用自定义请求对象发起请求</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">data = response.read()</span><br><span class="line">with open(&apos;./周杰伦.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(data)</span><br><span class="line">print(&apos;写入文件完毕&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="携带参数的post请求"><a href="#携带参数的post请求" class="headerlink" title="携带参数的post请求"></a>携带参数的post请求</h4><blockquote>
<p>案例：百度翻译发起post请求</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">#通过抓包工具抓取post请求的url</span><br><span class="line">post_url=&apos;https://fanyi.baidu.com/sug&apos;</span><br><span class="line">#封装post请求参数</span><br><span class="line">data=&#123;</span><br><span class="line">    &quot;kw&quot;:&quot;dog&quot;</span><br><span class="line">&#125;</span><br><span class="line">data=urllib.parse.urlencode(data)</span><br><span class="line">#自定义请求头信息字典</span><br><span class="line">headers=&#123;</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#自定义请求对象，然后将封装好的post请求参数赋值给Requst方法的data参数。</span><br><span class="line">#data参数：用来存储post请求的参数</span><br><span class="line">request=urllib.request.Request(post_url,data=data.encode(),headers=headers)</span><br><span class="line">#自定义的请求对象中的参数（data必须为bytes类型）</span><br><span class="line">response=urllib.request.urlopen(request)</span><br><span class="line">response.read()</span><br></pre></td></tr></table></figure>
<h3 id="urllib模块的高级操作"><a href="#urllib模块的高级操作" class="headerlink" title="urllib模块的高级操作"></a>urllib模块的高级操作</h3><blockquote>
<ol>
<li>代理</li>
</ol>
</blockquote>
<ul>
<li><p>什么是代理：代理就是第三方代替本体处理相关事务。例如：生活中的代理：代购，中介，微商……</p>
</li>
<li><p>爬虫中为什么需要使用代理？</p>
<blockquote>
<p>一些网站会有相应的反爬虫措施，例如很多网站会检测某一段时间某个IP的访问次数，如果访问频率太快以至于看起来不像正常访客，它可能就会会禁止这个IP的访问。所以我们需要设置一些代理IP，每隔一段时间换一个代理IP，就算IP被禁止，依然可以换个IP继续爬取。</p>
</blockquote>
</li>
<li><p>代理的分类：</p>
</li>
</ul>
<p>正向代理：代理客户端获取数据。正向代理是为了保护客户端防止被追究责任。</p>
<p>反向代理：代理服务器提供数据。反向代理是为了保护服务器或负责负载均衡。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">#1.创建处理器对象，在其内部封装代理ip和端口</span><br><span class="line">handler=urllib.request.ProxyHandler(proxies=&#123;&apos;http&apos;:&apos;95.172.58.224:52608&apos;&#125;)</span><br><span class="line">#2.创建opener对象，然后使用该对象发起一个请求</span><br><span class="line">opener=urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">url=&apos;http://www.baidu.com/s?ie=UTF-8&amp;wd=ip&apos;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&apos;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(url, headers=headers)</span><br><span class="line"></span><br><span class="line">#使用opener对象发起请求，该请求对应的ip即为我们设置的代理ip</span><br><span class="line">response = opener.open(request)</span><br><span class="line"></span><br><span class="line">with open(&apos;./daili.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(response.read())</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 2.cookie</p>
</blockquote>
<p>引言：有些时候，我们在使用爬虫程序去爬取一些用户相关信息的数据（爬取张三“人人网”个人主页数据）时，如果使用之前requests模块常规操作时，往往达不到我们想要的目的，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">#指定url</span><br><span class="line">url = &apos;http://www.renren.com/289676607/profile&apos;</span><br><span class="line">#自定义请求头信息</span><br><span class="line">headers=&#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">#自定义请求对象</span><br><span class="line">request = urllib.request.Request(url=url,headers=headers)</span><br><span class="line">#发起请求</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"></span><br><span class="line">with open(&apos;./renren.html&apos;,&apos;w&apos;) as fp:</span><br><span class="line">    fp.write(response.read().decode())</span><br></pre></td></tr></table></figure>
<p>【注意】上述代码中，我们爬取到的是登录首页面，而不是张三的个人主页也面。why？首先我们来回顾下cookie的相关概念及作用</p>
<pre><code>- cookie概念：当用户通过浏览器首次访问一个域名时，访问的web服务器会给客户端发送数据，以保持web服务器与客户端之间的状态保持，这些数据就是cookie。

- cookie作用：我们在浏览器中，经常涉及到数据的交换，比如你登录邮箱，登录一个页面。我们经常会在此时设置30天内记住我，或者自动登录选项。那么它们是怎么记录信息的呢，答案就是今天的主角cookie了，Cookie是由HTTP服务器设置的，保存在浏览器中，但HTTP协议是一种无状态协议，在数据交换完毕后，服务器端和客户端的链接就会关闭，每次交换数据都需要建立新的链接。就像我们去超市买东西，没有积分卡的情况下，我们买完东西之后，超市没有我们的任何消费信息，但我们办了积分卡之后，超市就有了我们的消费信息。cookie就像是积分卡，可以保存积分，商品就是我们的信息，超市的系统就像服务器后台，http协议就是交易的过程。 

- 经过cookie的相关介绍，其实你已经知道了为什么上述案例中爬取到的不是张三个人信息页，而是登录页面。那应该如何抓取到张三的个人信息页呢？
</code></pre><p>　　思路：</p>
<p>　　　　1.我们需要使用爬虫程序对人人网的登录时的请求进行一次抓取，获取请求中的cookie数据</p>
<p>　　　　2.在使用个人信息页的url进行请求时，该请求需要携带 1 中的cookie，只有携带了cookie后，服务器才可识别这次请求的用户信息，方可响应回指定的用户信息页数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cookiejar对象：</span><br><span class="line">    - 作用：自动保存请求中的cookie数据信息</span><br><span class="line">    - 注意：必须和handler和opener一起使用</span><br><span class="line">cookiejar使用流程：</span><br><span class="line">    - 创建一个cookiejar对象</span><br><span class="line">      import http.cookiejar</span><br><span class="line">      cj = http.cookiejar.CookieJar()</span><br><span class="line">    - 通过cookiejar创建一个handler</span><br><span class="line">      handler = urllib.request.HTTPCookieProcessor(cj)</span><br><span class="line">    - 根据handler创建一个opener</span><br><span class="line">      opener = urllib.request.build_opener(handler)</span><br><span class="line">    - 使用opener.open方法去发送请求，且将响应中的cookie存储到openner对象中，后续的请求如果使用openner发起，则请求中就会携带了cookie</span><br></pre></td></tr></table></figure>
<p>使用cookiejar实现爬取人人网个人主页页面数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#使用cookiejar实现人人网的登陆</span><br><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import http.cookiejar</span><br><span class="line">cj = http.cookiejar.CookieJar() #请求中的cookie会自动存储到cj对象中</span><br><span class="line">#创建处理器对象(携带cookiejar对象的)</span><br><span class="line">handler=urllib.request.HTTPCookieProcessor(cj)</span><br><span class="line">#创建opener对象 （携带cookiejar对象）</span><br><span class="line">opener=urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">#要让cookiejar获取请求中的cookie数据值</span><br><span class="line">url=&apos;http://www.renren.com/ajaxLogin/login?1=1&amp;uniqueTimestamp=201873958471&apos;</span><br><span class="line">#自定义一个请求对象，让该对象作为opener的open函数中的参数</span><br><span class="line">data=&#123;</span><br><span class="line">    &quot;email&quot;:&quot;www.zhangbowudi@qq.com&quot;,</span><br><span class="line">    &quot;icode&quot;:&quot;&quot;,</span><br><span class="line">    &quot;origURL&quot;:&quot;http://www.renren.com/home&quot;,</span><br><span class="line">    &quot;domain&quot;:&quot;renren.com&quot;,</span><br><span class="line">    &quot;key_id&quot;:&quot;1&quot;,</span><br><span class="line">    &quot;captcha_type&quot;:&quot;web_login&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;40dc65b82edd06d064b54a0fc6d202d8a58c4cb3d2942062f0f7dd128511fb9b&quot;,</span><br><span class="line">    &quot;rkey&quot;:&quot;41b44b0d062d3ca23119bc8b58983104&quot;,</span><br><span class="line">  </span><br><span class="line"> &apos;f&apos;:&quot;https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3DpPKf2680yRLbbZMVdntJpyPGwrSk2BtpKlEaAuKFTsW%26wd%3D%26eqid%3Deee20f380002988c000000025b7cbb80&quot;</span><br><span class="line">&#125;</span><br><span class="line">data=urllib.parse.urlencode(data).encode()</span><br><span class="line">request=urllib.request.Request(url,data=data)</span><br><span class="line">opener.open(request)</span><br><span class="line"></span><br><span class="line">#获取当前用户的二级子页面</span><br><span class="line">s_url=&apos;http://www.renren.com/289676607/profile&apos;</span><br><span class="line">#该次请求中就携带了cookie</span><br><span class="line">resonse=opener.open(s_url)</span><br><span class="line"></span><br><span class="line">with open(&apos;./renren.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(resonse.read())</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/Py007-01-03内置urllib模块补充/" data-id="ckkmr2k4p00i5fp91t0is8klt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M07/">M07</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py007-01-02内置urllib模块" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/Py007-01-02内置urllib模块/" class="article-date">
  <time datetime="2018-11-29T14:58:37.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/Py007-01-02内置urllib模块/">Py007-01-02内置urllib模块</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>urllib模块非爬虫的重点，核心为后面的request以及各种框架</p>
</blockquote>
<h3 id="内置urllib"><a href="#内置urllib" class="headerlink" title="内置urllib"></a>内置urllib</h3><p>概念：urllib是Python自带的一个用于爬虫的库，其主要作用就是可以通过代码模拟浏览器发送请求。其常被用到的子模块在Python3中的为urllib.request和urllib.parse，在Python2中是urllib和urllib2。</p>
<ul>
<li>作用：可以使用代码模拟浏览器发起请求。request  parse</li>
</ul>
<blockquote>
<p>使用流程：</p>
</blockquote>
<ol>
<li>指定url</li>
<li>发请求</li>
<li>获取页面数据</li>
<li>持久化存储</li>
</ol>
<h4 id="需求1爬取搜狗首页的页面数据"><a href="#需求1爬取搜狗首页的页面数据" class="headerlink" title="需求1爬取搜狗首页的页面数据"></a>需求1爬取搜狗首页的页面数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line"></span><br><span class="line">#1.指定url</span><br><span class="line">url = &apos;https://www.sogou.com/&apos;</span><br><span class="line"></span><br><span class="line">#2.发起请求:urlopen可以根据指定的url发起请求，切返回一个响应对象</span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line"></span><br><span class="line">#3.获取页面数据:read函数返回的就是响应对象中存储的页面数据(byte)</span><br><span class="line">page_text = response.read()</span><br><span class="line"></span><br><span class="line">#4.持久化存储</span><br><span class="line">with open(&apos;./sougou.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    # fp.write(page_text)</span><br><span class="line">    # print(page_text) # 字节码</span><br><span class="line">    print(page_text.decode()) # 转化为字符串</span><br><span class="line">    fp.write(page_text.decode())#使用decode将page_text转成字符串类型</span><br><span class="line">    print(&apos;写入数据成功&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="需求2搜狗搜关键字"><a href="#需求2搜狗搜关键字" class="headerlink" title="需求2搜狗搜关键字"></a>需求2搜狗搜关键字</h4><blockquote>
<p>注意：</p>
</blockquote>
<ul>
<li>urllib模块的get参数如果有中文要自行转义，否则报错UnicodeEncodeError</li>
<li>使用urllib.parse.quote(“中文参数”) 转义中文</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 需求：爬取指定词条所对应的页面数据</span><br><span class="line"></span><br><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">#指定url</span><br><span class="line">url = &apos;https://www.sogou.com/web?query=&apos;</span><br><span class="line">#url特性：url不可以存在非ASCII编码的字符数据</span><br><span class="line">word = urllib.parse.quote(&quot;人民币&quot;)</span><br><span class="line">url += word #有效的url</span><br><span class="line"></span><br><span class="line">#发请求</span><br><span class="line">response = urllib.request.urlopen(url=url)</span><br><span class="line"></span><br><span class="line">#获取页面数据</span><br><span class="line">page_text = response.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with open(&apos;renminbi.html&apos;,&apos;wb&apos;) as fp:</span><br><span class="line">    fp.write(page_text)</span><br><span class="line">    </span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">如果</span><br><span class="line">word=&apos;人民币&apos;</span><br><span class="line">不经过转义则直接报错</span><br><span class="line">UnicodeEncodeError: &apos;ascii&apos; codec can&apos;t encode characters in position 15-17: ordinal not in range(128)</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<p>是不是很麻烦如果多个参数就要多次处理？</p>
<h4 id="使用UA来伪装"><a href="#使用UA来伪装" class="headerlink" title="使用UA来伪装"></a>使用UA来伪装</h4><ul>
<li>反爬机制：网站检查请求的UA，如果发现UA是爬虫程序，则拒绝提供网站数据。</li>
<li>User-Agent(UA)：请求载体的身份标识.</li>
<li>反反爬机制：伪装爬虫程序请求的UA</li>
</ul>
<blockquote>
<p>爬去百度首页</p>
</blockquote>
<ul>
<li>如果不用UA伪装，爬去的页面是不对的(百度已经做了反爬处理)</li>
<li>获取UA打开浏览器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.开发者工具</span><br><span class="line">2.检查</span><br><span class="line">3.Network</span><br><span class="line">4.访问百度</span><br><span class="line">5.找到Request Headers的请求信息里的User-Agent字符串</span><br><span class="line">形如</span><br><span class="line">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line"></span><br><span class="line">url = &apos;https://www.baidu.com/&apos;</span><br><span class="line"></span><br><span class="line">#UA伪装</span><br><span class="line">#1.自定制一个请求对象</span><br><span class="line">headers = &#123;</span><br><span class="line">    #存储任意的请求头信息</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.67 Safari/537.36&apos;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">#该请求对象的UA进行了成功的伪装</span><br><span class="line">request = urllib.request.Request(url=url,headers=headers)</span><br><span class="line"></span><br><span class="line">#2.针对自定制的请求对象发起请求</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"></span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure>
<h4 id="使用urllib发起post请求"><a href="#使用urllib发起post请求" class="headerlink" title="使用urllib发起post请求"></a>使用urllib发起post请求</h4><blockquote>
<p>需求：爬取百度翻译的翻译结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">#1.指定url</span><br><span class="line">url = &apos;https://fanyi.baidu.com/sug&apos;</span><br><span class="line"></span><br><span class="line">#post请求携带的参数进行处理  流程：</span><br><span class="line">#1.将post请求参数封装到字典</span><br><span class="line">data = &#123;</span><br><span class="line">    &apos;kw&apos;:&apos;西瓜&apos;</span><br><span class="line">&#125;</span><br><span class="line">#2.使用parse模块中的urlencode(返回值类型为str)进行编码处理</span><br><span class="line">data = urllib.parse.urlencode(data)</span><br><span class="line">#3.将步骤2的编码结果转换成byte类型</span><br><span class="line">data = data.encode()</span><br><span class="line"></span><br><span class="line">#2.发起post请求:urlopen函数的data参数表示的就是经过处理之后的post请求携带的参数</span><br><span class="line">response = urllib.request.urlopen(url=url,data=data)</span><br><span class="line"></span><br><span class="line">response.read()</span><br><span class="line">res = response.read()</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/Py007-01-02内置urllib模块/" data-id="ckkmr2k4o00i2fp912euz9u1r" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M07/">M07</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py007-01-01爬虫初识" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/29/Py007-01-01爬虫初识/" class="article-date">
  <time datetime="2018-11-29T14:57:17.000Z" itemprop="datePublished">2018-11-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/29/Py007-01-01爬虫初识/">Py007-01-01爬虫初识</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="python网络爬虫的简单介绍"><a href="#python网络爬虫的简单介绍" class="headerlink" title="python网络爬虫的简单介绍"></a>python网络爬虫的简单介绍</h3><blockquote>
<p>什么是爬虫</p>
</blockquote>
<p>爬虫就是通过编写程序模拟浏览器上网，然后让其去互联网上抓取数据的过程。</p>
<blockquote>
<p>哪些语言可以实现爬虫</p>
</blockquote>
<ol>
<li><p>php：可以实现爬虫。php被号称是全世界最优美的语言（当然是其自己号称的，就是王婆卖瓜的意思），但是php在实现爬虫中支持多线程和多进程方面做的不好。</p>
</li>
<li><p>java：可以实现爬虫。java可以非常好的处理和实现爬虫，是唯一可以与python并驾齐驱且是python的头号劲敌。但是java实现爬虫代码较为臃肿，重构成本较大。</p>
</li>
<li><p>c、c++：可以实现爬虫。但是使用这种方式实现爬虫纯粹是是某些人（大佬们）能力的体现，却不是明智和合理的选择。</p>
</li>
<li><p>python：可以实现爬虫。python实现和处理爬虫语法简单，代码优美，支持的模块繁多，学习成本低，具有非常强大的框架（scrapy等）且一句难以言表的好！没有但是！</p>
</li>
</ol>
<h4 id="爬虫的分类"><a href="#爬虫的分类" class="headerlink" title="爬虫的分类"></a>爬虫的分类</h4><blockquote>
<h4 id="1-通用爬虫：通用爬虫是搜索引擎（Baidu、Google、Yahoo等）“抓取系统”的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。-简单来讲就是尽可能的；把互联网上的所有的网页下载下来，放到本地服务器里形成备分，在对这些网页做相关处理-提取关键字、去掉广告-，最后提供一个用户检索接口。"><a href="#1-通用爬虫：通用爬虫是搜索引擎（Baidu、Google、Yahoo等）“抓取系统”的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。-简单来讲就是尽可能的；把互联网上的所有的网页下载下来，放到本地服务器里形成备分，在对这些网页做相关处理-提取关键字、去掉广告-，最后提供一个用户检索接口。" class="headerlink" title="1. 通用爬虫：通用爬虫是搜索引擎（Baidu、Google、Yahoo等）“抓取系统”的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。  简单来讲就是尽可能的；把互联网上的所有的网页下载下来，放到本地服务器里形成备分，在对这些网页做相关处理(提取关键字、去掉广告)，最后提供一个用户检索接口。"></a>1. 通用爬虫：通用爬虫是搜索引擎（Baidu、Google、Yahoo等）“抓取系统”的重要组成部分。主要目的是将互联网上的网页下载到本地，形成一个互联网内容的镜像备份。  简单来讲就是尽可能的；把互联网上的所有的网页下载下来，放到本地服务器里形成备分，在对这些网页做相关处理(提取关键字、去掉广告)，最后提供一个用户检索接口。</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">搜索引擎如何抓取互联网上的网站数据？</span><br><span class="line">门户网站主动向搜索引擎公司提供其网站的url</span><br><span class="line">搜索引擎公司与DNS服务商合作，获取网站的url</span><br><span class="line">门户网站主动挂靠在一些知名网站的友情链接中</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-聚焦爬虫：聚焦爬虫是根据指定的需求抓取网络上指定的数据。例如：获取豆瓣上电影的名称和影评，而不是获取整张页面中所有的数据值。"><a href="#2-聚焦爬虫：聚焦爬虫是根据指定的需求抓取网络上指定的数据。例如：获取豆瓣上电影的名称和影评，而不是获取整张页面中所有的数据值。" class="headerlink" title="2.聚焦爬虫：聚焦爬虫是根据指定的需求抓取网络上指定的数据。例如：获取豆瓣上电影的名称和影评，而不是获取整张页面中所有的数据值。"></a>2.聚焦爬虫：聚焦爬虫是根据指定的需求抓取网络上指定的数据。例如：获取豆瓣上电影的名称和影评，而不是获取整张页面中所有的数据值。</h4></blockquote>
<h4 id="robots-txt协议"><a href="#robots-txt协议" class="headerlink" title="robots.txt协议"></a>robots.txt协议</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果自己的门户网站中的指定页面中的数据不想让爬虫程序爬取到的话，那么则可以通过编写一个robots.txt的协议文件来约束爬虫程序的数据爬取。robots协议的编写格式可以观察淘宝网的robots（访问www.taobao.com/robots.txt即可）。但是需要注意的是，该协议只是相当于口头的协议，并没有使用相关技术进行强制管制，所以该协议是防君子不防小人。但是我们在学习爬虫阶段编写的爬虫程序可以先忽略robots协议。</span><br></pre></td></tr></table></figure>
<h4 id="反爬虫"><a href="#反爬虫" class="headerlink" title="反爬虫"></a>反爬虫</h4><ul>
<li>门户网站通过相应的策略和技术手段，防止爬虫程序进行网站数据的爬取。</li>
</ul>
<h4 id="反反爬虫"><a href="#反反爬虫" class="headerlink" title="反反爬虫"></a>反反爬虫</h4><ul>
<li>爬虫程序通过相应的策略和技术手段，破解门户网站的反爬虫手段，从而爬取到相应的数据。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/29/Py007-01-01爬虫初识/" data-id="ckkmr2k4o00i1fp91stit27yx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M07/">M07</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-01-05选择排序和插入排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/27/Py008-01-05选择排序和插入排序/" class="article-date">
  <time datetime="2018-11-27T13:21:51.000Z" itemprop="datePublished">2018-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/27/Py008-01-05选择排序和插入排序/">Py008-01-05选择排序和插入排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="选择排序-体育老师一指禅法"><a href="#选择排序-体育老师一指禅法" class="headerlink" title="选择排序(体育老师一指禅法)"></a>选择排序(体育老师一指禅法)</h3><p>思路：</p>
<p>在一个列表里每次把最小的值取出来。</p>
<blockquote>
<p>简易版本(不建议用)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">li = [3,2,4,6,5,1,8,7,9]</span><br><span class="line"></span><br><span class="line">def select_sort1(li):</span><br><span class="line">    list_new = []</span><br><span class="line">    for i in range(len(li)):</span><br><span class="line">        min_val = min(li)</span><br><span class="line">        list_new.append(min_val)</span><br><span class="line">        li.remove(min_val)</span><br><span class="line"></span><br><span class="line">    return list_new</span><br><span class="line"></span><br><span class="line">res = select_sort1(li)</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">我们知道  冒泡排序是交换彼此直接的位置，属于原地排序</span><br><span class="line"></span><br><span class="line">而这个版本的选择排序  </span><br><span class="line">每次都对原始数据进行删除  假如是长度10000的集合  如果满足条件的值在中间5000的位置  那么后边的要依次  索引-1</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>优化版</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def select_sort2(li):</span><br><span class="line">    for i in range(len(li)-1): # i是第几趟</span><br><span class="line">        min_loc = i</span><br><span class="line">        for j in range(i+1,len(li)):</span><br><span class="line">            if li[j]&lt;li[min_loc]:</span><br><span class="line">                min_loc = j</span><br><span class="line">        li[i],li[min_loc] = li[min_loc],li[i]</span><br><span class="line">        print(li)</span><br><span class="line"></span><br><span class="line">res2 = select_sort2(li)</span><br><span class="line">print(res2)</span><br></pre></td></tr></table></figure>
<ul>
<li>一趟排序记录最小的数，放到第一个</li>
<li>再一趟排序记录 列表无序区最小的数，放到第二个位置</li>
<li>。。。。</li>
<li>关键点：有序区 和 无序区，无序区最小值的位置</li>
</ul>
<blockquote>
<h4 id="时间复杂度：O-n-n"><a href="#时间复杂度：O-n-n" class="headerlink" title="时间复杂度：O(n*n)"></a>时间复杂度：O(n*n)</h4></blockquote>
<h3 id="插入排序-起扑克牌法"><a href="#插入排序-起扑克牌法" class="headerlink" title="插入排序(起扑克牌法)"></a>插入排序(起扑克牌法)</h3><p>你玩过扑克吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">你是如何摸牌的？</span><br><span class="line">比如 arr = [5,1,3,2,4]</span><br><span class="line"></span><br><span class="line">()内为你摸到的牌</span><br><span class="line"></span><br><span class="line">第一次摸到5 </span><br><span class="line">(5) [1,3,2,4]</span><br><span class="line">第二次摸到1   1与5比=&gt;小 交换位置</span><br><span class="line">(1,5) [3,2,4]</span><br><span class="line">第三次摸到3   3与5比=&gt;小 交换位置   3与1比=&gt;大 不交换</span><br><span class="line">(1,3,5) [2,4]</span><br><span class="line">第四次摸到2   2与5比=&gt;小 交换位置   2与3比=&gt;小 交换位置   2与1比=&gt;大 不交换</span><br><span class="line">(1,2,3,5) [4]</span><br><span class="line">第五次摸到4  4与5比=&gt;小 交换位置   4与3比=&gt;大  不交换</span><br></pre></td></tr></table></figure>
<p>插入排序代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def insert_sort(li):</span><br><span class="line">    for i in range(1,len(li)): # 表示摸到的牌的下标</span><br><span class="line">        tmp = li[i]</span><br><span class="line">        j = i-1 # 手里牌的下标</span><br><span class="line">        while j&gt;=0 and li[j]&gt;tmp:</span><br><span class="line">            li[j+1] = li[j]</span><br><span class="line">            j -= 1</span><br><span class="line">        li[j+1] = tmp</span><br><span class="line">        print(li)</span><br><span class="line"></span><br><span class="line">li = [3,2,4,6,5,1,8,7,9]</span><br><span class="line"></span><br><span class="line">insert_sort(li)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="时间复杂度：-O-n-n"><a href="#时间复杂度：-O-n-n" class="headerlink" title="时间复杂度： O(n*n)"></a>时间复杂度： O(n*n)</h4></blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/27/Py008-01-05选择排序和插入排序/" data-id="ckkmr2k5c00jqfp919xgox03e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-01-04排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/26/Py008-01-04排序/" class="article-date">
  <time datetime="2018-11-26T14:44:28.000Z" itemprop="datePublished">2018-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/26/Py008-01-04排序/">Py008-01-04排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><ul>
<li>排序：将一组‘无序’的记录序列调整为‘有序’的记录列表</li>
<li><p>列表排序<br>  输入：列表<br>  输出：有序列表</p>
</li>
<li><p>生序和降序</p>
</li>
<li>内置排序函数：sort()</li>
</ul>
<h4 id="常见排序"><a href="#常见排序" class="headerlink" title="常见排序"></a>常见排序</h4><blockquote>
<p>low B 三人组</p>
</blockquote>
<ul>
<li>冒泡排序</li>
<li>选择排序</li>
<li>插入排序</li>
</ul>
<blockquote>
<p>NB 三人组</p>
</blockquote>
<ul>
<li>快速排序</li>
<li>堆排序</li>
<li>归并排序</li>
</ul>
<blockquote>
<p>其他排序</p>
</blockquote>
<ul>
<li>希尔</li>
<li>计数</li>
<li>基数</li>
</ul>
<h4 id="冒泡排序-Bubble-sort-体育委员两两比较法"><a href="#冒泡排序-Bubble-sort-体育委员两两比较法" class="headerlink" title="冒泡排序 (Bubble sort) 体育委员两两比较法"></a>冒泡排序 (Bubble sort) 体育委员两两比较法</h4><ul>
<li>列表每两个相邻的数，如果后面的比前面的大，则交换这两个数</li>
<li>一趟排序完成后，则无序区减少一个数，有序区增加一个数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">初始列表</span><br><span class="line">5 2 3 1 4</span><br><span class="line"></span><br><span class="line">第一趟 </span><br><span class="line">    5 2 3 1 4</span><br><span class="line">    第一次</span><br><span class="line">    2 5 3 1 4</span><br><span class="line">    第二次</span><br><span class="line">    2 3 5 1 4</span><br><span class="line">    第三次</span><br><span class="line">    2 3 1 5 4</span><br><span class="line">    第四次</span><br><span class="line">    2 3 1 4 5  此时最大的数5已经站定了</span><br><span class="line"></span><br><span class="line">第二趟</span><br><span class="line">    2 3 1 4</span><br><span class="line">    第一次</span><br><span class="line">    2 3 1 4 </span><br><span class="line">    第二次</span><br><span class="line">    2 1 3 4</span><br><span class="line">    第三次</span><br><span class="line">    2 1 3 4  此时最大的数4已经站定了</span><br><span class="line"></span><br><span class="line">第三趟</span><br><span class="line">    2 1 3</span><br><span class="line">    第一次</span><br><span class="line">    1 2 3</span><br><span class="line">    第二次</span><br><span class="line">    1 2 3    此时最大的数3已经站定了</span><br><span class="line"></span><br><span class="line">第四趟</span><br><span class="line">    1 2</span><br><span class="line">    第一次</span><br><span class="line">    1 2      此时最大的数2已经站定了</span><br><span class="line"></span><br><span class="line">最后 1 2 3 4 5</span><br></pre></td></tr></table></figure>
<p>冒泡排序代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def bubble_sort(li):</span><br><span class="line">    for i in range(len(li)-1): # 第几趟</span><br><span class="line">        for j in range(len(li) - i - 1):</span><br><span class="line">            if li[j] &gt; li[j+1]:# 大就交换</span><br><span class="line">                li[j],li[j+1] = li[j+1],li[j]</span><br><span class="line">        print(li)</span><br><span class="line"></span><br><span class="line">li = [3,2,4,6,5,1,8,7,9]</span><br><span class="line"></span><br><span class="line">bubble_sort(li)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">结果如下</span><br><span class="line">[2, 3, 4, 5, 1, 6, 7, 8, 9]</span><br><span class="line">[2, 3, 4, 1, 5, 6, 7, 8, 9]</span><br><span class="line">[2, 3, 1, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[2, 1, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>时间复杂度：O(n*n)</p>
</blockquote>
<blockquote>
<h4 id="冒泡排序的优化"><a href="#冒泡排序的优化" class="headerlink" title="冒泡排序的优化"></a>冒泡排序的优化</h4></blockquote>
<p>如果一趟列表中没有发生交换则代表已经排好序了  则后面无需进行那么多次的比较了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">def bubble_sort2(li):</span><br><span class="line">    for i in range(len(li)-1): # 第几趟</span><br><span class="line">        exchange = False</span><br><span class="line">        for j in range(len(li) - i - 1):</span><br><span class="line">            if li[j] &gt; li[j+1]:# 大就交换</span><br><span class="line">                li[j],li[j+1] = li[j+1],li[j]</span><br><span class="line">                exchange = True</span><br><span class="line">        print(li)</span><br><span class="line">        if not exchange:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">li = [3,2,4,6,5,1,8,7,9]</span><br><span class="line"></span><br><span class="line">bubble_sort2(li)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">[2, 3, 4, 5, 1, 6, 7, 8, 9]</span><br><span class="line">[2, 3, 4, 1, 5, 6, 7, 8, 9]</span><br><span class="line">[2, 3, 1, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[2, 1, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/26/Py008-01-04排序/" data-id="ckkmr2k5c00jofp916a2b4mtv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-01-03查找算法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/26/Py008-01-03查找算法/" class="article-date">
  <time datetime="2018-11-26T13:58:42.000Z" itemprop="datePublished">2018-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/26/Py008-01-03查找算法/">Py008-01-03查找算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><p>在一些数据里，通过一定的方法找出与给定关键字相同的数据的元素的过程</p>
<blockquote>
<h3 id="列表查找-线性表查找-：从列表中查找指定元素"><a href="#列表查找-线性表查找-：从列表中查找指定元素" class="headerlink" title="列表查找(线性表查找)：从列表中查找指定元素"></a>列表查找(线性表查找)：从列表中查找指定元素</h3></blockquote>
<ul>
<li>输入：列表/待查找元素</li>
<li>输出：元素下标（未找到元素时一般返回None或-1）</li>
</ul>
<blockquote>
<h3 id="内置列表查找函数：index"><a href="#内置列表查找函数：index" class="headerlink" title="内置列表查找函数：index()"></a>内置列表查找函数：index()</h3></blockquote>
<h3 id="顺序查找-linear-search"><a href="#顺序查找-linear-search" class="headerlink" title="顺序查找(linear search)"></a>顺序查找(linear search)</h3><p>也叫线性查找，从列表第一个元素开始，顺序进行搜索，直到找到元素或搜索到列表最后一个元素为止</p>
<blockquote>
<p>时间复杂度：O(n)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def linear_search(data_set,value):</span><br><span class="line">    for i,v in enumerate(data_set):</span><br><span class="line">        if v == value:</span><br><span class="line">            return i</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">index = linear_search([1,2,3,5,4],4) # 4</span><br></pre></td></tr></table></figure>
<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><p>折半查找，从有序列表的初始候选区arr[0:n]开始，通过对待查找的值与候选区中间的值的比较，可以使候选区减少一半</p>
<blockquote>
<p>猜物品价格 0-1000 假设物品840元</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一次 500  低了  + (1000-500)/2 = +250</span><br><span class="line">第二次 750  低了  + (1000-750)/2 = +125</span><br><span class="line">第三次 875  高了  - (875-750)/2 = -62.5</span><br><span class="line">第四次 813  低了  + (875-813)/2 = +31</span><br><span class="line">第五次 844  高了 - (844-813)/2 = -11.5</span><br><span class="line">第六次 833  低了 + (844-833)/2 = +5.5</span><br><span class="line">第七次 838  低了 + (844-838)/2 = +3</span><br><span class="line">第七次 841  高了 - (841-838)/2 = -1.5</span><br><span class="line">第八次 840  对了</span><br></pre></td></tr></table></figure>
<p>二分查找算法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def binary_search(li,val):</span><br><span class="line">    left = 0</span><br><span class="line">    right = len(li) - 1</span><br><span class="line">    while left &lt;= right: # 候选区有值</span><br><span class="line">        # 中间值</span><br><span class="line">        mid = (left + right) // 2</span><br><span class="line">        if li[mid] == val:</span><br><span class="line">            return mid</span><br><span class="line">        elif li[mid] &gt; val: # 待查找的值在mid左侧</span><br><span class="line">            right = mid - 1</span><br><span class="line">        else: # li[mid] &lt; val # 待查找的值在mid右侧</span><br><span class="line">            left = mid + 1</span><br><span class="line">    else:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">a = binary_search([1,2,3,4,5,6,7,8,9],3) # 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>时间复杂度： O(log n)</p>
</blockquote>
<p>二分查找比线性查找速度快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内置函数index() 就是线性查找，因为二分查找的要求就是有序列表</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/26/Py008-01-03查找算法/" data-id="ckkmr2k5b00jmfp91b75do79o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-01-02递归和汉诺塔" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/26/Py008-01-02递归和汉诺塔/" class="article-date">
  <time datetime="2018-11-26T13:15:59.000Z" itemprop="datePublished">2018-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/26/Py008-01-02递归和汉诺塔/">Py008-01-02递归和汉诺塔</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><p>特点</p>
<ul>
<li>调用自身</li>
<li>结束条件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def fn1(x):</span><br><span class="line">    print(x)</span><br><span class="line">    fn1(x-1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def fn2(x):</span><br><span class="line">    if x&gt;0:</span><br><span class="line">        print(x)</span><br><span class="line">        fn2(x+1)</span><br><span class="line"></span><br><span class="line"># 合法递归   fn3(3)  ==&gt;3 2 1</span><br><span class="line">def fn3(x):</span><br><span class="line">    if x&gt;0:</span><br><span class="line">        print(x)</span><br><span class="line">        fn3(x-1)</span><br><span class="line"></span><br><span class="line"># 合法递归   fn4(3)  ==&gt;1 2 3</span><br><span class="line">def fn4(x):</span><br><span class="line">    if x&gt;0:</span><br><span class="line">        fn4(x-1)</span><br><span class="line">        print(x)</span><br></pre></td></tr></table></figure>
<h4 id="汉诺塔问题"><a href="#汉诺塔问题" class="headerlink" title="汉诺塔问题"></a>汉诺塔问题</h4><ul>
<li>三个柱子 A B C</li>
<li>A上有3个盘子   大盘子在最下  小盘子在最上</li>
<li>只能在 三个柱子上移动</li>
<li>实现  把A上的盘子移动到C</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n=2时</span><br><span class="line">1. 把小圆盘从A移动到B</span><br><span class="line">2. 把小圆盘从A移动到C</span><br><span class="line">3. 把小圆盘从B移动到C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=n时</span><br><span class="line">1. 把n-1个盘子从A经过C移动到B</span><br><span class="line">2. 把第n个圆盘从A移动到C</span><br><span class="line">3. 把n-1个圆盘从B经过A移动到C</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;&apos;</span><br><span class="line">a:从那个盘子</span><br><span class="line">b:经过那个盘子</span><br><span class="line">c:到那个盘子</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def hanoi(n,a,b,c):</span><br><span class="line">    if n&gt;0:</span><br><span class="line">        hanoi(n-1,a,c,b)</span><br><span class="line">        print(&apos;moving from %s to %s&apos;%(a,c))</span><br><span class="line">        hanoi(n-1,b,a,c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hanoi(3,&apos;A&apos;,&apos;B&apos;,&apos;C&apos;)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">moving from A to C</span><br><span class="line">moving from A to B</span><br><span class="line">moving from C to B</span><br><span class="line">moving from A to C</span><br><span class="line">moving from B to A</span><br><span class="line">moving from B to C</span><br><span class="line">moving from A to C</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<p>汉诺塔移动次数的递推式：h(x)=2h(x-1)+1<br>h(64)=18446744073709551615</p>
<p>假设每秒搬一个盘子，则需要5800亿年！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/26/Py008-01-02递归和汉诺塔/" data-id="ckkmr2k5900jkfp91wibdslbh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-01-01算法基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/26/Py008-01-01算法基础/" class="article-date">
  <time datetime="2018-11-26T12:41:00.000Z" itemprop="datePublished">2018-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/26/Py008-01-01算法基础/">Py008-01-01算法基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="算法入门"><a href="#算法入门" class="headerlink" title="算法入门"></a>算法入门</h3><ul>
<li>什么是算法 Algorithm</li>
</ul>
<blockquote>
<p>一个计算过程，解决问题的方法</p>
</blockquote>
<p>Niklaus Wirth:程序=数据结构+算法</p>
<h4 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><p>生活中一些事情，估计时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">眨眼     一瞬间</span><br><span class="line"></span><br><span class="line">口算 29+68   几秒钟</span><br><span class="line"></span><br><span class="line">烧一壶水    几分钟</span><br><span class="line"></span><br><span class="line">睡一觉    几小时</span><br><span class="line"></span><br><span class="line">完成一个项目   几天/几周/几个月</span><br><span class="line"></span><br><span class="line">飞船从地球到太阳系   几年</span><br></pre></td></tr></table></figure>
<p>如下代码那个运行最短？</p>
<blockquote>
<p>用来评估算法运行效率的一个式子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#时间复杂度   O(1)</span><br><span class="line">print(&apos;hi&apos;)   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#时间复杂度   O(n)</span><br><span class="line">for i in range(n):</span><br><span class="line">    print(&apos;hi&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#时间复杂度   O(n*n)</span><br><span class="line">for i in range(n):</span><br><span class="line">    for j in range(n):</span><br><span class="line">        print(&apos;hi&apos;)</span><br><span class="line"></span><br><span class="line">#时间复杂度   O(n*n*n)</span><br><span class="line">for i in range(n):</span><br><span class="line">    for j in range(n):</span><br><span class="line">        for k in range(n):</span><br><span class="line">            print(&apos;hi&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>继续看</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#时间复杂度   不是O(3)  而是 O(1)</span><br><span class="line">print(&apos;hi&apos;)</span><br><span class="line">print(&apos;hi&apos;)</span><br><span class="line">print(&apos;hi&apos;)</span><br><span class="line"># why?</span><br><span class="line"># 比如生活角度的烧水  没人回答你   3个3分钟 而是回答  几分钟  </span><br><span class="line"></span><br><span class="line">#时间复杂度   不是O(n*n+n)  而是O(n*n)</span><br><span class="line">for i in range(n):</span><br><span class="line">    print(&apos;hi&apos;)</span><br><span class="line">    for j in range(n):</span><br><span class="line">        print(&apos;hi&apos;)</span><br><span class="line"></span><br><span class="line"># why?</span><br><span class="line"># 比如生活角度的睡觉  没人回答你   7个小时零20分 而是回答  几小时</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再看</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">while n &gt; 1:</span><br><span class="line">    print(n)</span><br><span class="line">    n = n // 2</span><br><span class="line"></span><br><span class="line">n=64输出</span><br><span class="line">64</span><br><span class="line">32</span><br><span class="line">16</span><br><span class="line">8</span><br><span class="line">4</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">每次少一半 （对数形式）</span><br><span class="line">2*2*2*2*2*2 = 64</span><br><span class="line">log64 = 6</span><br><span class="line">时间复杂度为 O(log n)</span><br></pre></td></tr></table></figure>
<h4 id="时间复杂度小结"><a href="#时间复杂度小结" class="headerlink" title="时间复杂度小结"></a>时间复杂度小结</h4><ul>
<li>用来估计算法运行时间的式子</li>
<li>时间复杂度高的算法比复杂度低的算法慢</li>
<li><p>常见时间复杂度(按效率排序)<br>  O(1)&lt;O(log n)&lt;O(n)&lt;O(n log n)&lt;O(n<em>n)&lt;O(n</em>n log n)&lt;O(n<em>n</em>n)</p>
</li>
<li><p>复杂的时间复杂度<br>  O(n!) O(2的n次方) O(n的n次方) …</p>
</li>
</ul>
<blockquote>
<p>如何简单快速判断算法复杂度</p>
</blockquote>
<p>常见情况</p>
<ul>
<li>确定问题规模的n</li>
<li>循环减半过程 –&gt; log n</li>
<li>k层关于n的循环 –&gt; n的k次方</li>
</ul>
<p>复杂情况：根据算法执行过程判断</p>
<h4 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h4><ul>
<li>评估算法内存占用大小的式子</li>
<li>空间复杂度的表达方式和时间复杂度完全一样<br>  算法使用了几个变量O(1)<br>  算法使用了长度为n的一维列表 O(n)<br>  算法使用了长度为m行n列的一维列表 O(m*n)</li>
<li>空间换时间</li>
</ul>
<p>由于现在内存和硬件水平的提升所以空间已经不是那么重要了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/26/Py008-01-01算法基础/" data-id="ckkmr2k5800jifp91r5asfen6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py006-02-07中间件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/15/Py006-02-07中间件/" class="article-date">
  <time datetime="2018-11-14T16:20:32.000Z" itemprop="datePublished">2018-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/15/Py006-02-07中间件/">Py006-02-07中间件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="中间件-django里非常非常重要的一个内容"><a href="#中间件-django里非常非常重要的一个内容" class="headerlink" title="中间件(django里非常非常重要的一个内容)"></a>中间件(django里非常非常重要的一个内容)</h3><p>中间件顾名思义，是介于request与response处理之间的一道处理过程，相对比较轻量级，并且在全局上改变django的输入与输出。因为改变的是全局，所以需要谨慎实用，用不好会影响到性能。</p>
<blockquote>
<p>Django默认的7个Middleware(中间件)：</p>
</blockquote>
<p>settings.py里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    &apos;django.middleware.security.SecurityMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.messages.middleware.MessageMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.clickjacking.XFrameOptionsMiddleware&apos;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 通过导入模块查看中间件源码</span><br><span class="line">from django.middleware.security import SecurityMiddleware</span><br><span class="line"></span><br><span class="line"># 点进去发现基本都有这两个方法</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def process_request(self,request):...</span><br><span class="line"></span><br><span class="line">def process_response(self,request,response):...</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<p>一次请求的完成过程</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py006_02_0701.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">django接受请求时  中间件时  依次执行  process_request</span><br><span class="line"></span><br><span class="line">django响应时  中间件时  逆向依次执行  process_response</span><br></pre></td></tr></table></figure>
<h4 id="自定义中间件"><a href="#自定义中间件" class="headerlink" title="自定义中间件"></a>自定义中间件</h4><p>中间件中一共有四个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">process_request</span><br><span class="line">process_view</span><br><span class="line">process_exception</span><br><span class="line">process_response</span><br></pre></td></tr></table></figure>
<p>我们也可以自己定义一个中间件，我们可以自己写一个类，但是必须继承MiddlewareMixin<br>需要导入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.utils.deprecation import MiddlewareMixin</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="step001-第一步创建一个项目建立一个应用app01"><a href="#step001-第一步创建一个项目建立一个应用app01" class="headerlink" title="step001 第一步创建一个项目建立一个应用app01"></a>step001 第一步创建一个项目建立一个应用app01</h4></blockquote>
<p>在app01目录下建立自己的中间件</p>
<p>my_middlewares.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 自定义中间件 必须继承MiddlewareMixin</span><br><span class="line"># 自定义中间件 必须继承MiddlewareMixin</span><br><span class="line"># 自定义中间件 必须继承MiddlewareMixin</span><br><span class="line"></span><br><span class="line">from django.utils.deprecation import MiddlewareMixin</span><br><span class="line"></span><br><span class="line">class MyMiddleWare1(MiddlewareMixin):</span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 001 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self,request,response):</span><br><span class="line">        print(&apos;my middleware 001 response&apos;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 002 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&apos;my middleware 002 response&apos;)</span><br><span class="line">        return response</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="step002-第二步settings-py里引入自定义的中间件"><a href="#step002-第二步settings-py里引入自定义的中间件" class="headerlink" title="step002 第二步settings.py里引入自定义的中间件"></a>step002 第二步settings.py里引入自定义的中间件</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    &apos;django.middleware.security.SecurityMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.messages.middleware.MessageMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.clickjacking.XFrameOptionsMiddleware&apos;,</span><br><span class="line">    &apos;app01.my_middleware1.MyMiddleWare1&apos;,</span><br><span class="line">    &apos;app01.my_middleware1.MyMiddleWare2&apos;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:8000/index/" target="_blank" rel="noopener">http://localhost:8000/index/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 打印如下信息</span><br><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">index.html</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="为什么process-request没返回值"><a href="#为什么process-request没返回值" class="headerlink" title="为什么process_request没返回值"></a>为什么process_request没返回值</h4></blockquote>
<p>return一下试试</p>
<p>给 MyMiddleWare1的process_request()添加一个返回值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render,HttpResponse</span><br><span class="line"></span><br><span class="line">class MyMiddleWare1(MiddlewareMixin):</span><br><span class="line"></span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 001 request&apos;)</span><br><span class="line">        return HttpResponse(&apos;被禁止的请求&apos;)</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:8000/index/" target="_blank" rel="noopener">http://localhost:8000/index/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 控制台打印</span><br><span class="line">my middleware 001 request</span><br><span class="line">my middleware 001 response</span><br><span class="line"></span><br><span class="line"># 页面显示</span><br><span class="line">被禁止的请求</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py006_02_0702.png" alt></p>
<p>第一个中间件由于return一个HttpResponse(‘xxx’)</p>
<p>导致不会再去下一个中间件而提前返回给客户端</p>
<blockquote>
<h4 id="process-view"><a href="#process-view" class="headerlink" title="process_view"></a>process_view</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process_view(self, request, callback, callback_args, callback_kwargs)</span><br></pre></td></tr></table></figure>
<p>中间件修改如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class MyMiddleWare1(MiddlewareMixin):</span><br><span class="line"></span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 001 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self,request,response):</span><br><span class="line">        print(&apos;my middleware 001 response&apos;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line">        print(&quot;Md1view view&quot;)</span><br><span class="line"></span><br><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line"></span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 002 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&apos;my middleware 002 response&apos;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line">        print(&quot;Md1view2 view&quot;)</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://localhost:8000/index/" target="_blank" rel="noopener">http://localhost:8000/index/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">index.html</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py006_02_0703.png" alt></p>
<p>当最后一个中间的process_request到达路由关系映射之后，返回到中间件1的process_view，然后依次往下，到达views函数，最后通过process_response依次返回到达用户。</p>
<p>process_view可以用来调用视图函数：</p>
<blockquote>
<h4 id="在第二个中间件里做如下处理"><a href="#在第二个中间件里做如下处理" class="headerlink" title="在第二个中间件里做如下处理"></a>在第二个中间件里做如下处理</h4></blockquote>
<ul>
<li>直接返回结果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line">    ...</span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line"></span><br><span class="line">        print(&quot;Md1view2 view&quot;)</span><br><span class="line">        # 直接返回响应体内容</span><br><span class="line">        return HttpResponse(&apos;view2  response&apos;)</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"># 就不会进入路由views.index的视图函数了</span><br><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>提前获取路由里 index函数的响应</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line">        print(&quot;Md1view2 view&quot;)</span><br><span class="line">        # 拿到视图函数的结果提前响应</span><br><span class="line">        res = callback(request, *callback_args, **callback_kwargs)</span><br><span class="line">        return res</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">index.html</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br></pre></td></tr></table></figure>
<p>注意：process_view如果有返回值，会越过其他的process_view以及视图函数，但是所有的process_response都还会执行。</p>
<blockquote>
<h4 id="process-exception"><a href="#process-exception" class="headerlink" title="process_exception"></a>process_exception</h4></blockquote>
<p>正常是不会执行process_exception里的内容，只有报错的时候才会执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process_exception(self, request, exception)</span><br></pre></td></tr></table></figure>
<p>添加process_exception函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">class MyMiddleWare1(MiddlewareMixin):</span><br><span class="line"></span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 001 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self,request,response):</span><br><span class="line">        print(&apos;my middleware 001 response&apos;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line">        print(&quot;Md1view view&quot;)</span><br><span class="line"></span><br><span class="line">    def process_exception(self,request,exception):</span><br><span class="line">        print(&quot;md1 process_exception...&quot;)</span><br><span class="line"></span><br><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line"></span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        print(&apos;my middleware 002 request&apos;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&apos;my middleware 002 response&apos;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">    def process_view(self, request, callback, callback_args, callback_kwargs):</span><br><span class="line">        print(&quot;Md1view2 view&quot;)</span><br><span class="line"></span><br><span class="line">    def process_exception(self,request,exception):</span><br><span class="line">        print(&quot;md2 process_exception...&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">访问 http://localhost:8000/index/</span><br><span class="line"></span><br><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">index.html</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<p>由于没有错误所以不会执行process_exception的内容</p>
<blockquote>
<p>修改views.py 添加一个未初始化的变量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def index(request):</span><br><span class="line">    print(&apos;index.html&apos;)</span><br><span class="line">    aaa</span><br><span class="line">    return render(request,&apos;index.html&apos;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">index.html</span><br><span class="line">md2 process_exception...</span><br><span class="line">md1 process_exception...</span><br><span class="line">....错误信息</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br></pre></td></tr></table></figure>
<blockquote>
<p>系统返回的错误信息难看了，想自己返回一个</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># return响应信息</span><br><span class="line">class MyMiddleWare2(MiddlewareMixin):</span><br><span class="line">    ...</span><br><span class="line">    def process_exception(self,request,exception):</span><br><span class="line">        print(&quot;md2 process_exception...&quot;)</span><br><span class="line">        return HttpResponse(&apos;error&apos;)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">my middleware 001 request</span><br><span class="line">my middleware 002 request</span><br><span class="line">Md1view view</span><br><span class="line">Md1view2 view</span><br><span class="line">index.html</span><br><span class="line">md2 process_exception...</span><br><span class="line">my middleware 002 response</span><br><span class="line">my middleware 001 response</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<p>流程如下</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py006_02_0704.png" alt></p>
<h3 id="三、应用案例"><a href="#三、应用案例" class="headerlink" title="三、应用案例"></a>三、应用案例</h3><ol>
<li>做IP访问频率限制</li>
</ol>
<p>某些IP访问服务器的频率过高，进行拦截，比如限制每分钟不能超过20次。</p>
<ol start="2">
<li>URL访问过滤</li>
</ol>
<p>如果用户访问的是login视图（放过）<br>如果访问其他视图，需要检测是不是有session认证，已经有了放行，没有返回login，这样就省得在多个视图函数上写装饰器了！</p>
<blockquote>
<p>中间件是个双刃剑</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果80个视图函数70个不需要校验</span><br><span class="line">如果用中间件处理  反而影响了效率</span><br></pre></td></tr></table></figure>
<p>作为延伸扩展内容，有余力的同学可以尝试着读一下以下两个自带的中间件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</span><br><span class="line">&apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/15/Py006-02-07中间件/" data-id="ckkmr2k4m00hyfp91bib2jyrl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M06/">M06</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py006-02-06用户认证组件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/14/Py006-02-06用户认证组件/" class="article-date">
  <time datetime="2018-11-14T13:56:03.000Z" itemprop="datePublished">2018-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/14/Py006-02-06用户认证组件/">Py006-02-06用户认证组件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="用户认证组件"><a href="#用户认证组件" class="headerlink" title="用户认证组件"></a>用户认证组件</h3><p>之前是用django的session设置键值对</p>
<p>但是存在个问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">假如你有两个账号  </span><br><span class="line">你用a账号在chrome登陆了  xx站   </span><br><span class="line">此时session里生成了  session&#123;&apos;00001&apos;:&#123;user:&apos;a&apos;&#125;&#125;</span><br><span class="line"></span><br><span class="line">此时你在用b账号在chrome里登陆  xx站</span><br><span class="line">此时session里不会进行重新生成</span><br><span class="line">而是更新  session&#123;&apos;00001&apos;:&#123;user:&apos;b&apos;&#125;&#125;</span><br><span class="line">这样相当于覆盖</span><br><span class="line"></span><br><span class="line">假设  每个账号权限不一样   </span><br><span class="line">a是超级管理员</span><br><span class="line">b是普通用户</span><br><span class="line">此时b登陆时可能数据里还存留a的一些权限数据  这样就容易数据混淆</span><br></pre></td></tr></table></figure>
<p>我们的目标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a登陆生成  a的信息</span><br><span class="line">b登陆生成  b的信息</span><br><span class="line">相互独立</span><br></pre></td></tr></table></figure>
<h4 id="auth模块"><a href="#auth模块" class="headerlink" title="auth模块"></a>auth模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 需要导入这个模块才可以使用</span><br><span class="line">from django.contrib import auth</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="django-contrib-auth中提供了许多方法，这里主要介绍其中的三个："><a href="#django-contrib-auth中提供了许多方法，这里主要介绍其中的三个：" class="headerlink" title="django.contrib.auth中提供了许多方法，这里主要介绍其中的三个："></a>django.contrib.auth中提供了许多方法，这里主要介绍其中的三个：</h4></blockquote>
<ul>
<li>1.1 、authenticate()</li>
</ul>
<p>提供了用户认证，即验证用户名以及密码是否正确,一般需要username password两个关键字参数<br>如果认证信息有效，会返回一个 User 对象。authenticate()会在User 对象上设置一个属性标识那种认证后端认证了该用户，且该信息在后面的登录过程中是需要的。当我们试图登陆一个从数据库中直接取出来不经过authenticate()的User对象会报错的！！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = authenticate(username=&apos;someone&apos;,password=&apos;somepassword&apos;)</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2 、login(HttpRequest, user)　　</li>
</ul>
<p>该函数接受一个HttpRequest对象，以及一个认证了的User对象<br>此函数使用django的session框架给某个已认证的用户附加上session id等信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth import authenticate, login</span><br><span class="line"></span><br><span class="line">def my_view(request):</span><br><span class="line">  username = request.POST[&apos;username&apos;]</span><br><span class="line">  password = request.POST[&apos;password&apos;]</span><br><span class="line">  user = authenticate(username=username, password=password)</span><br><span class="line">  if user is not None:</span><br><span class="line">    login(request, user)</span><br><span class="line">    # Redirect to a success page.</span><br><span class="line">    ...</span><br><span class="line">  else:</span><br><span class="line">    # Return an &apos;invalid login&apos; error message.</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<ul>
<li>1.3 、logout(request) 注销用户</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth import logout</span><br><span class="line"></span><br><span class="line">def logout_view(request):</span><br><span class="line">  logout(request)</span><br><span class="line">  # Redirect to a success page.</span><br></pre></td></tr></table></figure>
<p>该函数接受一个HttpRequest对象，无返回值。当调用该函数时，当前请求的session信息会全部清除。该用户即使没有登录，使用该函数也不会报错。</p>
<blockquote>
<h4 id="使用auth模块的大前提"><a href="#使用auth模块的大前提" class="headerlink" title="使用auth模块的大前提"></a>使用auth模块的大前提</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">用户认证组件：</span><br><span class="line">    功能：用session记录登陆状态</span><br><span class="line">    前提：用户表：django自带的auth_user表</span><br><span class="line">    </span><br><span class="line">    创建超级用户：python3 manage.py createsuperuser</span><br><span class="line"></span><br><span class="line">    创建普通用户:python3 manage.py createuser</span><br><span class="line"></span><br><span class="line">        # 根据 is_supperuser区分  1代表超级用户</span><br><span class="line"></span><br><span class="line">    api</span><br><span class="line"></span><br><span class="line"># 之前使用django里的session 使用的是django_session表</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="step001新建项目不创建表直接进行数据库迁移"><a href="#step001新建项目不创建表直接进行数据库迁移" class="headerlink" title="step001新建项目不创建表直接进行数据库迁移"></a>step001新建项目不创建表直接进行数据库迁移</h4></blockquote>
<p>用户表不用自己写了使用 django自带的auth_user表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py makemigrations</span><br><span class="line">python3 manage.py migrate</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="step002创建用户"><a href="#step002创建用户" class="headerlink" title="step002创建用户"></a>step002创建用户</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py createsuperuser</span><br><span class="line"># 输入用户名</span><br><span class="line">hjx</span><br><span class="line"># 输入邮箱</span><br><span class="line">直接回车</span><br><span class="line"># 输入密码</span><br><span class="line">111</span><br><span class="line"># 再次输入密码</span><br><span class="line">111</span><br><span class="line"></span><br><span class="line"># 此时去看表里生成了一条数据</span><br><span class="line">但是这个密码 已经被加密了 不是你输入的111</span><br><span class="line"></span><br><span class="line">我们创建两个账号</span><br><span class="line">|username    |password</span><br><span class="line">-----------------------</span><br><span class="line">|hjx         |111</span><br><span class="line">|aaa          |222</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="step003-初始代码"><a href="#step003-初始代码" class="headerlink" title="step003 初始代码"></a>step003 初始代码</h4></blockquote>
<p>urls.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from app01 import views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    path(&apos;login/&apos;,views.login),</span><br><span class="line">    path(&apos;index/&apos;, views.index),</span><br><span class="line">    path(&apos;logout/&apos;, views.logout)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>login.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    用户名 &lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;</span><br><span class="line">    密码 &lt;input type=&quot;text&quot; name=&quot;pwd&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>views.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"># step001 导入模块</span><br><span class="line">from django.contrib import auth</span><br><span class="line"></span><br><span class="line">def login(request):</span><br><span class="line"></span><br><span class="line">    if request.method==&apos;POST&apos;:</span><br><span class="line">        user = request.POST.get(&apos;user&apos;)</span><br><span class="line">        pwd = request.POST.get(&apos;pwd&apos;)</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line">        step002  调用 </span><br><span class="line">        user = auth.authenticate(username=用户名,password=密码)</span><br><span class="line">        有一个返回值 如果存在就是这个用户对象 反之None</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">        cur_user = auth.authenticate(username=user,password=pwd)</span><br><span class="line"></span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line">        # 注意虽然用户orm是这个类构造的  但是存在表的时候  密码是加密的  所以无法匹配</span><br><span class="line">        from django.contrib.auth.models import User</span><br><span class="line">        User.objects.filter(username=user,password=pwd)</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">        if cur_user:</span><br><span class="line">            auth.login(request,cur_user) # request.user 当前登陆对象</span><br><span class="line">            # 此时访问任意请求的时候  都可以访问到这个用户对象</span><br><span class="line">            return redirect(&apos;/index/&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return render(request,&apos;login.html&apos;)</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    # 用户对象</span><br><span class="line">    print(&apos;request.user&apos;,request.user)</span><br><span class="line">    # 用户id</span><br><span class="line">    print(&apos;request.user&apos;, request.user.id)</span><br><span class="line">    # 是否是匿名的</span><br><span class="line">    print(&apos;request.user&apos;, request.user.is_anonymous)</span><br><span class="line"></span><br><span class="line">    if request.user.is_anonymous:</span><br><span class="line">        return redirect(&apos;/login/&apos;)</span><br><span class="line">    </span><br><span class="line">    username = request.user.username</span><br><span class="line">    return render(request,&apos;index.html&apos;,&#123;&quot;username&quot;:username&#125;)</span><br><span class="line"></span><br><span class="line">def logout(request):</span><br><span class="line">    # 注销   实质就是request.session.flush()</span><br><span class="line">    auth.logout(request)</span><br><span class="line"></span><br><span class="line">    return redirect(&apos;/login/&apos;)</span><br></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;hi &#123;&#123; username &#125;&#125;&lt;/h3&gt;</span><br><span class="line">&#123;#也可以在模版里直接使用#&#125;</span><br><span class="line">&lt;h4&gt;hi &#123;&#123; request.user.username &#125;&#125;&lt;/h4&gt;</span><br><span class="line"></span><br><span class="line">&lt;a href=&quot;/logout/&quot;&gt;注销&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h3 id="User对象"><a href="#User对象" class="headerlink" title="User对象"></a>User对象</h3><p>User 对象属性：username， password（必填项）password用哈希算法保存到数据库</p>
<blockquote>
<h4 id="2-1-、user对象的-is-authenticated"><a href="#2-1-、user对象的-is-authenticated" class="headerlink" title="2.1 、user对象的 is_authenticated()"></a>2.1 、user对象的 is_authenticated()</h4></blockquote>
<p>如果是真正的 User 对象，返回值恒为 True 。 用于检查用户是否已经通过了认证。</p>
<p>通过认证并不意味着用户拥有任何权限，甚至也不检查该用户是否处于激活状态，这只是表明用户成功的通过了认证。 这个方法很重要, 在后台用request.user.is_authenticated()判断用户是否已经登录，如果true则可以向前台展示request.user.name</p>
<blockquote>
<p>要求：</p>
</blockquote>
<ol>
<li><p>用户登陆后才能访问某些页面，</p>
</li>
<li><p>如果用户没有登录就访问该页面的话直接跳到登录页面</p>
</li>
<li><p>用户在跳转的登陆界面中完成登陆后，自动访问跳转到之前访问的地址</p>
</li>
</ol>
<ul>
<li>方法1:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def my_view(request):</span><br><span class="line">  if not request.user.is_authenticated():</span><br><span class="line">    return redirect(&apos;%s?next=%s&apos; % (settings.LOGIN_URL, request.path))</span><br></pre></td></tr></table></figure>
<ul>
<li>方法2:</li>
</ul>
<h5 id="django已经为我们设计好了一个用于此种情况的装饰器：login-requierd"><a href="#django已经为我们设计好了一个用于此种情况的装饰器：login-requierd" class="headerlink" title="django已经为我们设计好了一个用于此种情况的装饰器：login_requierd()"></a>django已经为我们设计好了一个用于此种情况的装饰器：login_requierd()</h5><h5 id="注意：未登陆要跳转的默认页码要在settings-py进行设置"><a href="#注意：未登陆要跳转的默认页码要在settings-py进行设置" class="headerlink" title="注意：未登陆要跳转的默认页码要在settings.py进行设置"></a>注意：未登陆要跳转的默认页码要在settings.py进行设置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 这个值本身是没有的</span><br><span class="line">LOGIN_URL = &apos;/login/&apos;</span><br><span class="line"></span><br><span class="line"># 默认会跳</span><br><span class="line">accounts/login/?next=/index/</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth.decorators import login_required</span><br><span class="line">      </span><br><span class="line">@login_required</span><br><span class="line">def other(request):</span><br><span class="line">    # 不用在做验证登陆的重定向了</span><br><span class="line">    # ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def login(request):</span><br><span class="line"></span><br><span class="line">    if user:</span><br><span class="line">        auth.login(request,user)</span><br><span class="line">    # 从失效页面返回到login时  url会变成  login/?next=/other/</span><br><span class="line">    next_url = request.GET.get(&apos;next&apos;,&apos;/index/&apos;)</span><br><span class="line">    return redirect(next_url)</span><br></pre></td></tr></table></figure>
<p>若用户没有登录，则会跳转到django默认的 登录URL ‘/accounts/login/ ‘ (这个值可以在settings文件中通过LOGIN_URL进行修改)。并传递  当前访问url的绝对路径 (登陆成功后，会重定向到该路径)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 之前判断是否登陆是</span><br><span class="line">def index(request):</span><br><span class="line">    # 通过is_anonymous判断</span><br><span class="line">    if request.user.is_anonymous:</span><br><span class="line">        return redirect(&apos;/login/&apos;)</span><br><span class="line"></span><br><span class="line">    username = request.user.username</span><br><span class="line">    return render(request,&apos;index.html&apos;,&#123;&quot;username&quot;:username&#125;)</span><br><span class="line"></span><br><span class="line"># 通过 is_authenticated是否登陆</span><br><span class="line">if not request.user.is_authenticated:</span><br><span class="line">    return redirect(&apos;/login/&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-2-、创建用户"><a href="#2-2-、创建用户" class="headerlink" title="2.2 、创建用户"></a>2.2 、创建用户</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.auth.models import User</span><br><span class="line">user = User.objects.create_user(username=&apos;&apos;,password=&apos;&apos;)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"># 注意不要直接用这个方式</span><br><span class="line"># 注意不要直接用这个方式</span><br><span class="line"># 注意不要直接用这个方式</span><br><span class="line">user = User.objects.create(username=&apos;&apos;,password=&apos;&apos;)</span><br><span class="line">因为auth_user里的password是加密处理后的</span><br><span class="line">这种方式创建没有经过加密</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注册用户的需求</p>
</blockquote>
<p>views.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def reg(request):</span><br><span class="line">    if request.method==&apos;POST&apos;:</span><br><span class="line">        user = request.POST.get(&apos;user&apos;)</span><br><span class="line">        pwd = request.POST.get(&apos;pwd&apos;)</span><br><span class="line"></span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line">        # 千万别用</span><br><span class="line">        User.objects.create(username=user,password=pwd)</span><br><span class="line">        # 因为密码是 加密的</span><br><span class="line">        &apos;&apos;&apos;</span><br><span class="line">        from django.contrib.auth.models import User</span><br><span class="line">        user = User.objects.create_user(username=user, password=pwd)</span><br><span class="line"></span><br><span class="line">        return redirect(&apos;/login/&apos;)</span><br><span class="line"></span><br><span class="line">    return render(request,&apos;reg.html&apos;)</span><br></pre></td></tr></table></figure>
<p>reg.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;注册&lt;/h3&gt;</span><br><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    用户名 &lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;</span><br><span class="line">    密码 &lt;input type=&quot;text&quot; name=&quot;pwd&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-3-、check-password-passwd"><a href="#2-3-、check-password-passwd" class="headerlink" title="2.3 、check_password(passwd)"></a>2.3 、check_password(passwd)</h4></blockquote>
<p>用户需要修改密码的时候 首先要让他输入原来的密码 ，如果给定的字符串通过了密码检查，返回 True</p>
<blockquote>
<h4 id="2-4-、修改密码"><a href="#2-4-、修改密码" class="headerlink" title="2.4 、修改密码"></a>2.4 、修改密码</h4></blockquote>
<p>使用 set_password() 来修改密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user = User.objects.get(username=&apos;&apos;)</span><br><span class="line">user.set_password(password=&apos;&apos;)</span><br><span class="line">user.save</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-5-、简单示例"><a href="#2-5-、简单示例" class="headerlink" title="2.5 、简单示例"></a>2.5 、简单示例</h4></blockquote>
<ul>
<li>注册：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def sign_up(request):</span><br><span class="line"></span><br><span class="line">    state = None</span><br><span class="line">    if request.method == &apos;POST&apos;:</span><br><span class="line"></span><br><span class="line">        password = request.POST.get(&apos;password&apos;, &apos;&apos;)</span><br><span class="line">        repeat_password = request.POST.get(&apos;repeat_password&apos;, &apos;&apos;)</span><br><span class="line">        email=request.POST.get(&apos;email&apos;, &apos;&apos;)</span><br><span class="line">        username = request.POST.get(&apos;username&apos;, &apos;&apos;)</span><br><span class="line">        if User.objects.filter(username=username):</span><br><span class="line">                state = &apos;user_exist&apos;</span><br><span class="line">        else:</span><br><span class="line">                new_user = User.objects.create_user(username=username, password=password,email=email)</span><br><span class="line">                new_user.save()</span><br><span class="line"></span><br><span class="line">                return redirect(&apos;/book/&apos;)</span><br><span class="line">    content = &#123;</span><br><span class="line">        &apos;state&apos;: state,</span><br><span class="line">        &apos;user&apos;: None,</span><br><span class="line">    &#125;</span><br><span class="line">    return render(request, &apos;sign_up.html&apos;, content)</span><br></pre></td></tr></table></figure>
<ul>
<li>修改密码：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@login_required</span><br><span class="line">def set_password(request):</span><br><span class="line">    user = request.user</span><br><span class="line">    state = None</span><br><span class="line">    if request.method == &apos;POST&apos;:</span><br><span class="line">        old_password = request.POST.get(&apos;old_password&apos;, &apos;&apos;)</span><br><span class="line">        new_password = request.POST.get(&apos;new_password&apos;, &apos;&apos;)</span><br><span class="line">        repeat_password = request.POST.get(&apos;repeat_password&apos;, &apos;&apos;)</span><br><span class="line">        if user.check_password(old_password):</span><br><span class="line">            if not new_password:</span><br><span class="line">                state = &apos;empty&apos;</span><br><span class="line">            elif new_password != repeat_password:</span><br><span class="line">                state = &apos;repeat_error&apos;</span><br><span class="line">            else:</span><br><span class="line">                user.set_password(new_password)</span><br><span class="line">                user.save()</span><br><span class="line">                return redirect(&quot;/log_in/&quot;)</span><br><span class="line">        else:</span><br><span class="line">            state = &apos;password_error&apos;</span><br><span class="line">    content = &#123;</span><br><span class="line">        &apos;user&apos;: user,</span><br><span class="line">        &apos;state&apos;: state,</span><br><span class="line">    &#125;</span><br><span class="line">    return render(request, &apos;set_password.html&apos;, content)</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>api常用的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import auth</span><br><span class="line">    1. if验证成功返回user对象，否则返回None</span><br><span class="line">        user=auth.authenticate(username=&apos;&apos;,password=&apos;&apos;)</span><br><span class="line"></span><br><span class="line">    2. auth.login(request,user) # request.user # 当前登陆对象</span><br><span class="line"></span><br><span class="line">    3. auth.logout(request)</span><br><span class="line"></span><br><span class="line">from django.contrib.auth.models import User # User(orm模型) = auth_user表</span><br><span class="line"></span><br><span class="line">    4. request.user.is_authenticated()</span><br><span class="line"></span><br><span class="line">    5. user = User.objects.create_user(username=&apos;&apos;,password=&apos;&apos;)</span><br></pre></td></tr></table></figure>
<ul>
<li>补充</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">匿名用户</span><br><span class="line">    class models.AnonymousUser</span><br><span class="line"></span><br><span class="line">    django.contrib.auth.models.AnonymousUser 类实现了django.contrib.auth.models.User 接口，但具有下面几个不同点：</span><br><span class="line"></span><br><span class="line">    id 永远为None。</span><br><span class="line">    username 永远为空字符串。</span><br><span class="line">    get_username() 永远返回空字符串。</span><br><span class="line">    is_staff 和 is_superuser 永远为False。</span><br><span class="line">    is_active 永远为 False。</span><br><span class="line">    groups 和 user_permissions 永远为空。</span><br><span class="line">    is_anonymous() 返回True 而不是False。</span><br><span class="line">    is_authenticated() 返回False 而不是True。</span><br><span class="line">    set_password()、check_password()、save() 和delete() 引发 NotImplementedError。</span><br><span class="line">    New in Django 1.8:</span><br><span class="line">    新增 AnonymousUser.get_username() 以更好地模拟 django.contrib.auth.models.User。</span><br></pre></td></tr></table></figure>
<ul>
<li>总结</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果没登录</span><br><span class="line">request.user = 匿名用户对象</span><br><span class="line"></span><br><span class="line">如果登录了</span><br><span class="line"></span><br><span class="line">request.user = 登录对象</span><br><span class="line"></span><br><span class="line">request.user 是一个全局变量</span><br><span class="line">可以在任何视图和模版里使用</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/14/Py006-02-06用户认证组件/" data-id="ckkmr2k4m00hxfp912pm9mh6f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M06/">M06</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/28/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><span class="page-number current">29</span><a class="page-number" href="/page/30/">30</a><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/30/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 14.09px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 13.64px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.36px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.64px;">M01</a> <a href="/tags/M02/" style="font-size: 15px;">M02</a> <a href="/tags/M03/" style="font-size: 15.45px;">M03</a> <a href="/tags/M04/" style="font-size: 15.91px;">M04</a> <a href="/tags/M06/" style="font-size: 18.18px;">M06</a> <a href="/tags/M07/" style="font-size: 17.73px;">M07</a> <a href="/tags/M08/" style="font-size: 16.82px;">M08</a> <a href="/tags/M09/" style="font-size: 11.82px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 12.27px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.64px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.36px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.55px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.45px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.73px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.27px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.09px;">java</a> <a href="/tags/linux/" style="font-size: 10.91px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.36px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.73px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.73px;">mysql</a> <a href="/tags/node/" style="font-size: 10.45px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.27px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.18px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.55px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/20/HTTP06密码学到https流程/">HTTP06密码学到https流程</a>
          </li>
        
          <li>
            <a href="/2021/01/19/HTTP05缓存控制/">HTTP05缓存控制</a>
          </li>
        
          <li>
            <a href="/2021/01/18/HTTP04报文和http状态码/">HTTP04报文和http状态码</a>
          </li>
        
          <li>
            <a href="/2021/01/17/HTTP03http常用方法/">HTTP03http常用方法</a>
          </li>
        
          <li>
            <a href="/2021/01/16/HTTP02三次握手四度挥手/">HTTP02三次握手四度挥手</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>