
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Almost</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stevin">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/10/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">

    
    <link rel="alternative" href="/atom.xml" title="Almost" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Almost" title="Almost"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Almost">Almost</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/04/ZB-022-02-异常的类型体系/" title="ZB-022-02-异常的类型体系" itemprop="url">ZB-022-02-异常的类型体系</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-09-04T15:51:20.000Z" itemprop="datePublished"> Published 2019-09-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="throw-throws"><a href="#throw-throws" class="headerlink" title="throw/throws"></a>throw/throws</h3><blockquote>
<h4 id="throw-丢出异常"><a href="#throw-丢出异常" class="headerlink" title="throw 丢出异常"></a><code>throw</code> 丢出异常</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void a()&#123;</span><br><span class="line">        b();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c()&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所有人都不处理这个异常会怎么样</p>
</blockquote>
<ul>
<li>答案是： 终止这个线程，如果都没人抓这个异常，异常就会把当前的线程杀掉，这是默认的处理方式</li>
</ul>
<blockquote>
<h4 id="throws-用于声明方法将来可能会丢出什么样的东西"><a href="#throws-用于声明方法将来可能会丢出什么样的东西" class="headerlink" title="throws 用于声明方法将来可能会丢出什么样的东西"></a><code>throws</code> 用于声明方法将来可能会丢出什么样的东西</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static void b() throws  Exception&#123;</span><br><span class="line">    if(true)&#123;</span><br><span class="line">        throw new Exception();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>如果一个方法抛出了异常，那么调用它的地方都要 主动抛出异常 或者 <code>try/catch</code></strong></p>
<blockquote>
<h4 id="throw-throws区别"><a href="#throw-throws区别" class="headerlink" title="throw/throws区别"></a>throw/throws区别</h4></blockquote>
<ul>
<li>throw 是一个语句，可以声明自己要抛出的异常，不管这个异常怎样被处理，只管往外抛</li>
<li>throws 只是声明当前方法 <strong>有可能</strong> 会抛出 <code>XXException</code>,代价就是调用该方法的地方都要 <code>throws XXException</code> 或者 <code>try/catch</code></li>
</ul>
<h4 id="让你诧异的地方"><a href="#让你诧异的地方" class="headerlink" title="让你诧异的地方"></a>让你诧异的地方</h4><blockquote>
<p><code>throws RuntimeException</code> 时候 a 不报错</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static void a()&#123;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void b() throws RuntimeException&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>throws Exception</code> 时候 a 竟然报错了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static void a()&#123;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void b() throws Exception&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Java的异常体系"><a href="#Java的异常体系" class="headerlink" title="Java的异常体系"></a>Java的异常体系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Throwable </span><br><span class="line">所有 错误 和 异常的父类 ，任何的 throwable 都可以被丢出来</span><br><span class="line">它是有毒的</span><br><span class="line">    -|Exception  (checked exception) 受检异常，有毒</span><br><span class="line">        -|RuntionException 运行时异常 无毒</span><br><span class="line">            _|NullPointerException</span><br><span class="line"></span><br><span class="line">    -|Error 错误 无毒</span><br></pre></td></tr></table></figure>
<h4 id="什么是-有毒-什么是-无毒"><a href="#什么是-有毒-什么是-无毒" class="headerlink" title="什么是 有毒 什么是 无毒"></a>什么是 有毒 什么是 无毒</h4><blockquote>
<p>”有毒“学名叫做 <strong>受检异常</strong></p>
</blockquote>
<ul>
<li>抛出了<code>Throwable</code> 或者 <code>Throwable 的子类</code> 都是有毒的，就是你必须处理它 要么你也 <code>throws</code> 要么 <code>try/catch</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static void a()&#123;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void b() throws Throwable&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>“无毒” 学名叫做 <strong>不受检异常</strong></p>
</blockquote>
<ul>
<li>不用去处理，你可以随便抛<ul>
<li>RuntimeException</li>
<li>NullPointerException</li>
<li>Error</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static void a()&#123;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void b() throws RuntimeException&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="java异常体系的最初的设计想法"><a href="#java异常体系的最初的设计想法" class="headerlink" title="java异常体系的最初的设计想法"></a>java异常体系的最初的设计想法</h4></blockquote>
<p>1994年 ，假如显示的抛出异常，这样别人就必须处理，是不是能让软件更加安全呢？ </p>
<ul>
<li>当时的想法：是的</li>
<li>后来发现：实在太麻烦了，于是大家纷纷讨厌了这种设计思路。</li>
</ul>
<blockquote>
<h4 id="Exception-代表我预期，可能会发生的情况的一种状态"><a href="#Exception-代表我预期，可能会发生的情况的一种状态" class="headerlink" title="Exception 代表我预期，可能会发生的情况的一种状态"></a>Exception 代表我预期，可能会发生的情况的一种状态</h4></blockquote>
<ul>
<li>预期之内的， 如文件找不到，断网了</li>
<li>所以当时的思路是，任何调用<code>throws Exception 的方法</code>的人都该对预期之内的情况进行处理 ，这就是最初设计的目的</li>
</ul>
<blockquote>
<h4 id="RuntimeException-代表什么呢？"><a href="#RuntimeException-代表什么呢？" class="headerlink" title="RuntimeException 代表什么呢？"></a>RuntimeException 代表什么呢？</h4></blockquote>
<ul>
<li>意料之外的异常，因此不需要声明，所以你可以随便丢</li>
<li>发生了就是一个bug</li>
</ul>
<blockquote>
<h4 id="Error-是什么"><a href="#Error-是什么" class="headerlink" title="Error 是什么"></a>Error 是什么</h4></blockquote>
<ul>
<li>异常是可以恢复的，而 Error 是不可以恢复的异常</li>
<li>意思就是 “错误”</li>
<li>大多数情况 代表 <strong>不正常</strong> 的情况</li>
</ul>
<h3 id="你可以丢出不同的异常-因为它们都是-Exception-的子类"><a href="#你可以丢出不同的异常-因为它们都是-Exception-的子类" class="headerlink" title="你可以丢出不同的异常,因为它们都是 Exception 的子类"></a>你可以丢出不同的异常,因为它们都是 Exception 的子类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private static void b()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(&quot;文件没找到&quot;);</span><br><span class="line">    &#125; catch (EOFException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        System.out.println(&quot;文件末尾&quot;);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private static void c () throws Exception &#123;</span><br><span class="line">    if(fileNotFound())&#123;</span><br><span class="line">        throw new FileNotFoundException();</span><br><span class="line">    &#125;else if(readFileEnd())&#123;</span><br><span class="line">        throw new EOFException();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        throw new IOException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果一个方法抛出多个异常，你应该按照 <strong>从小到大</strong> 的顺序捕获异常</p>
</blockquote>
<ul>
<li>为什么？ 因为 Exception 是其他异常的父类，优先被匹配了，这样就不会走进其他 catch 里了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    c();</span><br><span class="line">&#125; catch (NullPointerException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    System.out.println(&quot;文件没找到&quot;);</span><br><span class="line">&#125; catch (RuntimeException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    System.out.println(&quot;文件末尾&quot;);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; catch (Throwable t)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>比如一个方法抛出了多个异常，其中有两个处理都是 打印日志，你可以 <strong>折叠</strong> 它</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">private static void b()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125; catch (NullPointerException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (Throwable t)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 折叠它 对处理方式一样的异常 来合并 catch 块</span><br><span class="line"></span><br><span class="line">private static void b()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125; catch (NullPointerException | IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (Throwable t)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="异常的栈轨迹-Stacktrace"><a href="#异常的栈轨迹-Stacktrace" class="headerlink" title="异常的栈轨迹  Stacktrace"></a>异常的栈轨迹  Stacktrace</h3><ul>
<li><strong>排查问题最重要的信息，没有之一</strong></li>
<li><strong>排查问题最重要的信息，没有之一</strong></li>
<li><strong>排查问题最重要的信息，没有之一</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.io.demo;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void a()&#123;</span><br><span class="line">        b();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c ()  &#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void d ()  &#123;</span><br><span class="line">        if(true)&#123;</span><br><span class="line">            throw new RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>栈轨迹如下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.RuntimeException</span><br><span class="line">	at com.io.demo.Main.d(Main.java:23)</span><br><span class="line">	at com.io.demo.Main.c(Main.java:18)</span><br><span class="line">	at com.io.demo.Main.b(Main.java:14)</span><br><span class="line">	at com.io.demo.Main.a(Main.java:10)</span><br><span class="line">	at com.io.demo.Main.main(Main.java:6)</span><br><span class="line"></span><br><span class="line">沿着栈轨迹 我们知道方法的执行过程，从哪里报错了</span><br><span class="line">这是排查错误最重要的信息</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="为异常添加额外信息，以便排查"><a href="#为异常添加额外信息，以便排查" class="headerlink" title="为异常添加额外信息，以便排查"></a>为异常添加额外信息，以便排查</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.io.demo;</span><br><span class="line"></span><br><span class="line">import java.sql.SQLException;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void a()&#123;</span><br><span class="line">        processUserData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class UserAlreadyExistException extends RuntimeException&#123;</span><br><span class="line">        public UserAlreadyExistException(String msg, Throwable cause) &#123;</span><br><span class="line">            super(msg,cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void processUserData ()  &#123;</span><br><span class="line">        Integer userId = 1;</span><br><span class="line">        try &#123;</span><br><span class="line">            insertIntoDatabase();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            // 额外包一层 用于方便排查信息</span><br><span class="line">            throw new UserAlreadyExistException(&quot;插入id值为：&quot; + userId + &quot;的数据发生了异常&quot;,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void insertIntoDatabase () throws SQLException &#123;</span><br><span class="line">        throw new SQLException(&quot;重复的键值&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 栈轨迹如下</span><br><span class="line"></span><br><span class="line">Exception in thread &quot;main&quot; com.io.demo.Main$UserAlreadyExistException: 插入id值为：1的数据发生了异常</span><br><span class="line">	at com.io.demo.Main.processUserData(Main.java:27)</span><br><span class="line">	at com.io.demo.Main.a(Main.java:12)</span><br><span class="line">	at com.io.demo.Main.main(Main.java:8)</span><br><span class="line">Caused by: java.sql.SQLException: 重复的键值</span><br><span class="line">	at com.io.demo.Main.insertIntoDatabase(Main.java:32)</span><br><span class="line">	at com.io.demo.Main.processUserData(Main.java:24)</span><br><span class="line">	... 2 more</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="异常链-Caused-by"><a href="#异常链-Caused-by" class="headerlink" title="异常链 Caused by"></a>异常链 Caused by</h4></blockquote>
<h4 id="异常抛出的原则"><a href="#异常抛出的原则" class="headerlink" title="异常抛出的原则"></a>异常抛出的原则</h4><ul>
<li><p>能⽤if/else处理的，不要使⽤异常</p>
<ul>
<li><a href="https://github.com/hcsp/http-login-and-use-cookie/pull/7" target="_blank" rel="noopener">https://github.com/hcsp/http-login-and-use-cookie/pull/7</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">a()&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        return xxx.length();</span><br><span class="line">    &#125;catch(NullPointerException e)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a()&#123;</span><br><span class="line">    if(xxx != null)&#123;</span><br><span class="line">        return xxx.length();</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public int getNameLength() &#123;</span><br><span class="line">// Fix the NullPointerException thrown in this method</span><br><span class="line">// 在本方法中，修复抛出的空指针异常（NullPointerException）</span><br><span class="line">  -        return name.length();</span><br><span class="line">  +        try &#123;</span><br><span class="line">  +            return name.length();</span><br><span class="line">  +        &#125;catch(NullPointerException e) &#123;</span><br><span class="line">如果可以使用“正常”的流程完成，尽量不要使用try/catch。</span><br><span class="line">原因有二： </span><br><span class="line">1. 无法保证catch到的异常一定是你想要抓住的。你可以错误的catch到了更深处的异常。比如说，这里你怎么保证catch到的一定是name为null抛出来的，而不是name.length()方法里面抛出来的？（当然这个例子可能有点极端） </span><br><span class="line">2. 相比正常的if判断，异常的创建是非常，非常昂贵的操作</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>尽早抛出异常</p>
<ul>
<li>当你碰到一个异常时？</li>
<li>首先问自己 能处理这个异常吗？</li>
<li>如果不能处理就立刻抛出来</li>
</ul>
</li>
<li>异常要准确、带有详细信息<ul>
<li>一个写错的异常，比没有异常更可怕，你可以定义很多异常</li>
<li>如 <code>IOException</code> 是很宽泛的异常，你该抛出更具体的如 <code>FileNotFoundException / EOFException</code>等更准确的异常</li>
<li>尽可能带有更多的信息，如上面我们自己定义的<code>UserAlreadyExistException</code></li>
</ul>
</li>
<li>抛出异常也⽐悄悄地执⾏错误的逻辑强的多<ul>
<li>抓住了异常，就直接处理不要继续往下走流程<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">a()&#123;</span><br><span class="line">    String result = &quot;&quot;;</span><br><span class="line">    try &#123;</span><br><span class="line">        result = xxx;</span><br><span class="line">    &#125; catch (IOException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        // 这样要么抛出异常 要么return</span><br><span class="line">    &#125;</span><br><span class="line">    // 上面抓到了异常，此时就不该继续返回 result</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        result = xxx;</span><br><span class="line">    &#125; catch (IOException e)&#123;</span><br><span class="line">        // e.printStackTrace();</span><br><span class="line">        不打印栈轨迹，你抓住了，但是你把异常吃掉了，很难排查问题</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="异常的处理原则"><a href="#异常的处理原则" class="headerlink" title="异常的处理原则"></a>异常的处理原则</h4><ul>
<li>本⽅法是否有责任处理这个异常？<ul>
<li>不要处理不归⾃⼰管的异常</li>
</ul>
</li>
<li>本⽅法是否有能⼒处理这个异常？<ul>
<li>如果⾃⼰⽆法处理，就抛出</li>
</ul>
</li>
<li>如⾮万分必要，不要忽略异常  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    result = xxx;</span><br><span class="line">&#125; catch (IOException e)&#123;&#125;</span><br><span class="line">这里就是把异常吃了，如果出错，没人发现的了这个异常</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="了解和使⽤JDK内置的异常"><a href="#了解和使⽤JDK内置的异常" class="headerlink" title="了解和使⽤JDK内置的异常"></a>了解和使⽤JDK内置的异常</h4><ul>
<li>NullPointerException</li>
<li>ClassNotFoundException/NoClassDefFoundError</li>
<li>IllegalStateException</li>
<li>IllegalArgumentException</li>
<li>IllegalAccessException</li>
<li>ClassCastException </li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/oak/">oak</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/04/ZB-022-01异常入门和控制流/" title="ZB-022-01异常入门和控制流" itemprop="url">ZB-022-01异常入门和控制流</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-09-04T14:04:04.000Z" itemprop="datePublished"> Published 2019-09-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><ul>
<li>在 return 语句之外，为方法提供另外一种出口</li>
<li>IOException 通常代表“预期之内的异常”</li>
</ul>
<h4 id="有毒的-IOException"><a href="#有毒的-IOException" class="headerlink" title="有毒的 IOException"></a>有毒的 IOException</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    private static void readFile(File file) throws IOException &#123;</span><br><span class="line">        InputStream inputStream = new FileInputStream(file);</span><br><span class="line">        while(true)&#123;</span><br><span class="line">            int b = inputStream.read();</span><br><span class="line">            if(b == -1)&#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print((char) b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void 同事A() throws IOException &#123;</span><br><span class="line">        readFile(new File(&quot;my-file&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void 同事B() throws IOException &#123;</span><br><span class="line">        readFile(null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于一个方法<code>readFile</code>丢出了一个异常，就使得所有使用该方法的人全部被传染了，被迫都要加上这个 <code>throws IOException</code></p>
<p>这个烦人的东西 <strong>源头是什么</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 这里面声明了 throws </span><br><span class="line">public FileInputStream(File file) throws FileNotFoundException &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结论就是：<strong>任何声明了 throws XXXException 的方法</strong>，再被调用的时候都必须显示的声明 <code>throws XXX XXXException</code> 或者 <code>trg/catch</code></p>
<blockquote>
<h4 id="万能的解决方案"><a href="#万能的解决方案" class="headerlink" title="万能的解决方案"></a>万能的解决方案</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static void 同事B()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        readFile(null);</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exception-是干嘛的？"><a href="#Exception-是干嘛的？" class="headerlink" title="Exception 是干嘛的？"></a>Exception 是干嘛的？</h4><p>对应任何一个函数都有入口和出口</p>
<p>但是 <strong>异常 给程序提供了另一种出口</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public FileInputStream(File file) throws FileNotFoundException &#123;</span><br><span class="line">    String name = (file != null ? file.getPath() : null);</span><br><span class="line">    SecurityManager security = System.getSecurityManager();</span><br><span class="line">    if (security != null) &#123;</span><br><span class="line">        security.checkRead(name);</span><br><span class="line">    &#125;</span><br><span class="line">    if (name == null) &#123;</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    &#125;</span><br><span class="line">    if (file.isInvalid()) &#123;</span><br><span class="line">        throw new FileNotFoundException(&quot;Invalid file path&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fd = new FileDescriptor();</span><br><span class="line">    fd.attach(this);</span><br><span class="line">    path = name;</span><br><span class="line">    open(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这里给程序提供了另一种出口</span><br><span class="line">if (name == null) &#123;</span><br><span class="line">    throw new NullPointerException();</span><br><span class="line">&#125;</span><br><span class="line">if (file.isInvalid()) &#123;</span><br><span class="line">    throw new FileNotFoundException(&quot;Invalid file path&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>举个例子</p>
</blockquote>
<ul>
<li>假设文件不存在你去调用 <code>readFile</code> 就会丢出一个<code>RuntimeException</code>异常</li>
<li>它会击穿方法栈里所有的东西，一直向上抛，抛到有人处理它为止</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private static void readFile(File file) throws IOException &#123;</span><br><span class="line">    if(file == null)&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">    InputStream inputStream = new FileInputStream(file);</span><br><span class="line">    while(true)&#123;</span><br><span class="line">        int b = inputStream.read();</span><br><span class="line">        if(b == -1)&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print((char) b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>异常：异常击穿栈帧过程</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void a()&#123;</span><br><span class="line">        b();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c()&#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void d()&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">调用 main =&gt; a =&gt; b ==&gt; c ==&gt; d</span><br><span class="line">此时 d 抛出一个异常，导致异常击穿当前方法，使得当前方法退出</span><br><span class="line">击穿 c ==&gt; 击穿 b ==&gt; 击穿 a ==&gt; 抛给 main</span><br><span class="line">击穿所有栈帧，直接结束掉</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="java的异常体系"><a href="#java的异常体系" class="headerlink" title="java的异常体系"></a>java的异常体系</h4><blockquote>
<p>处理异常</p>
</blockquote>
<ul>
<li>在 <code>a方法处 try/catch</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        a();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void a()&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            b();</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c()&#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void d()&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">调用 main =&gt; a =&gt; b ==&gt; c ==&gt; d</span><br><span class="line">此时 d 抛出一个异常，导致异常击穿当前方法，使得当前方法退出</span><br><span class="line">异常丢到 c，c没有处理异常被击穿</span><br><span class="line"> ==&gt; </span><br><span class="line">异常丢到 b，b没有处理异常被击穿</span><br><span class="line"> ==&gt;</span><br><span class="line">异常丢到 a，a 里面有 try/catch 尝试捕获异常，</span><br><span class="line">    抓到后变成了 e ==&gt; e.printStackTrace();</span><br><span class="line"></span><br><span class="line">这就是 java的异常处理</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h4 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h4><p><strong>无论程序正常/异常都执行的操作</strong></p>
<ul>
<li>释放 数据库连接</li>
<li>关闭 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(a());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int a()&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            b();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;finally&#123;</span><br><span class="line">            System.out.println(222);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c()&#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void d()&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">java.lang.RuntimeException</span><br><span class="line">	at com.io.demo.Main.d(Main.java:35)</span><br><span class="line">	at com.io.demo.Main.c(Main.java:31)</span><br><span class="line">	at com.io.demo.Main.b(Main.java:27)</span><br><span class="line">	at com.io.demo.Main.a(Main.java:16)</span><br><span class="line">	at com.io.demo.Main.main(Main.java:11)</span><br><span class="line">222</span><br><span class="line">1</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// 捕获异常</span><br><span class="line">// 无论a结果如何 执行 finally里的语句</span><br><span class="line">// 返回 1</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="不要在-finally里写-return"><a href="#不要在-finally里写-return" class="headerlink" title="不要在 finally里写 return"></a>不要在 finally里写 return</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">//        a();</span><br><span class="line">        System.out.println(a());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int a()&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            b();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;finally&#123;</span><br><span class="line">            System.out.println(222);</span><br><span class="line">            return 3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void b()&#123;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void c()&#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void d()&#123;</span><br><span class="line">        throw new RuntimeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">执行结果</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">java.lang.RuntimeException</span><br><span class="line">	at com.io.demo.Main.d(Main.java:36)</span><br><span class="line">	at com.io.demo.Main.c(Main.java:32)</span><br><span class="line">	at com.io.demo.Main.b(Main.java:28)</span><br><span class="line">	at com.io.demo.Main.a(Main.java:16)</span><br><span class="line">	at com.io.demo.Main.main(Main.java:11)</span><br><span class="line">222</span><br><span class="line">3</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<ul>
<li>finally 里的 return 会打破原来的流程，取代 catch里的 return </li>
<li><strong>finally 里 应该只执行资源的清理工作</strong></li>
<li>finally 不是必要的，其实 catch 也不是必要的  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 可以没有 catch</span><br><span class="line">private static int a()&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        b();</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;finally&#123;</span><br><span class="line">        System.out.println(222);</span><br><span class="line">        return 3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 不能只有 try  ，报错</span><br><span class="line">private static int a()&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        b();</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="如果你catch里什么都不做，别人想杀了你"><a href="#如果你catch里什么都不做，别人想杀了你" class="headerlink" title="如果你catch里什么都不做，别人想杀了你"></a>如果你catch里什么都不做，别人想杀了你</h4></blockquote>
<ul>
<li>一般来说，必须在 catch 里做处理</li>
<li>不做处理，可能项目上线一周发现问题都很难排查，因为没有任何错误信息，这个错误信息被你吃了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private static void a()&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        b();</span><br><span class="line">    &#125;catch (Exception e)&#123;</span><br><span class="line">        // 异常被你吃掉了～</span><br><span class="line">        // 异常被你吃掉了～</span><br><span class="line">        // 异常被你吃掉了～</span><br><span class="line">    &#125;finally&#123;</span><br><span class="line">        System.out.println(222);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>你应该在 catch里这样</strong></p>
<ul>
<li>处理异常</li>
<li>在日志里打印异常</li>
<li>返回对应的异常处理</li>
</ul>
<h4 id="file-leak-detector"><a href="#file-leak-detector" class="headerlink" title="file-leak-detector"></a>file-leak-detector</h4><p>它是用于针对那些粗心的开发人员在自己的程序里忘了写 <code>close</code>导致各种各样的闹鬼问题，用于检测这种情况。</p>
<ul>
<li><a href="https://file-leak-detector.kohsuke.org" target="_blank" rel="noopener">https://file-leak-detector.kohsuke.org</a></li>
<li>kohsuke 就是 jenkins 的作者</li>
</ul>
<h4 id="try-with-resources-JDK7"><a href="#try-with-resources-JDK7" class="headerlink" title="try with resources (JDK7+)"></a>try with resources (JDK7+)</h4><blockquote>
<p>语法糖</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 以前你要在 finally里 关闭资源</span><br><span class="line">private static void XXX(Connection conn) throws SQLException &#123;</span><br><span class="line">    PreparedStatement preparedStatement = null;</span><br><span class="line">    try&#123;</span><br><span class="line">        preparedStatement = conn.prepareStatement(&quot;sql&quot;);</span><br><span class="line">        preparedStatement.executeQuery();</span><br><span class="line">    &#125;finally &#123;</span><br><span class="line">        preparedStatement.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>try with resources改写后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private static void XXX(Connection conn) throws SQLException &#123;</span><br><span class="line">    try (PreparedStatement preparedStatement = conn.prepareStatement(&quot;sql&quot;)) &#123;</span><br><span class="line">        preparedStatement.executeQuery();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你在 try 的括号里 声明了一个语句</span><br><span class="line">1. 你可以不加 finally ,java 会自动给你加 finally</span><br><span class="line">2. 在 try离开的时候 把括号内的资源清理掉</span><br></pre></td></tr></table></figure>
<p><strong>问题来了，什么样的东西可以自动被清理掉呢？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// PreparedStatement 点进去看看</span><br><span class="line">public interface PreparedStatement extends Statement &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">// Statement 点进去看看</span><br><span class="line">public interface Statement extends Wrapper, AutoCloseable &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 应该就是它了   </span><br><span class="line">/**</span><br><span class="line"> * An object that may hold resources (such as file or socket handles)</span><br><span class="line"> * until it is closed. The &#123;@link #close()&#125; method of an &#123;@code AutoCloseable&#125;</span><br><span class="line"> * object is called automatically when exiting a &#123;@code</span><br><span class="line"> * try&#125;-with-resources block for which the object has been declared in</span><br><span class="line"> * the resource specification header. This construction ensures prompt</span><br><span class="line"> * release, avoiding resource exhaustion exceptions and errors that</span><br><span class="line"> * may otherwise occur.</span><br><span class="line"> */</span><br><span class="line">public interface AutoCloseable &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 任何实现 AutoCloseable 的对象在离开 try() 语句块的时候，都将调用 close();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个注意点</p>
</blockquote>
<p><code>try with resource</code> 的限制，只能在同一方法里使用。如果你的业务要求你 <strong>在某处打开文件，另一个地方关闭文件，它就做不到</strong> </p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/oak/">oak</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/03/ZB-021-02-NIO/" title="ZB-021-02-NIO" itemprop="url">ZB-021-02-NIO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-09-03T14:25:29.000Z" itemprop="datePublished"> Published 2019-09-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="NIO-（Java-7-）"><a href="#NIO-（Java-7-）" class="headerlink" title="NIO （Java 7+）"></a>NIO （Java 7+）</h3><ul>
<li>New IO 新的IO</li>
<li>Non-blocking IO ⾮阻塞IO</li>
<li>NIO的Path - 就是旧版本的File<ul>
<li>它们之间可以转换</li>
<li>Path.toFile()</li>
<li>File.toPath()</li>
</ul>
</li>
</ul>
<h4 id="关于NIO你仅仅需要了解-Files"><a href="#关于NIO你仅仅需要了解-Files" class="headerlink" title="关于NIO你仅仅需要了解 Files"></a>关于NIO你仅仅需要了解 <code>Files</code></h4><p>比较有用的几个api</p>
<ul>
<li>Files.walkFileTree</li>
<li>Files.readAllLines 不依赖第三方库的时候使用</li>
</ul>
<h4 id="NIO到底干什么的"><a href="#NIO到底干什么的" class="headerlink" title="NIO到底干什么的"></a>NIO到底干什么的</h4><blockquote>
<p><strong>经典的<code>IO</code>模型是基于流的</strong></p>
</blockquote>
<ul>
<li>就是你访问磁盘/网络的时候都是以<strong>流</strong>的形式</li>
</ul>
<p>它的优点是： 非常的直观，方便抽象 读 read / 写 write </p>
<p>它的缺点是： 慢，因为它是 流 就像一个水流，一个字节一个字节按顺序的读或写，严重限制了它的性能。</p>
<blockquote>
<p><strong>NIO模型是基于块的</strong></p>
</blockquote>
<p>好处是： 块和块之间没有顺序的，可以同时的写，比基于流的要快</p>
<p>还有一个原因就是 上篇文章里说的 <a href="http://www.sohu.com/a/222322011_487482" target="_blank" rel="noopener">CPU说：这个世界太慢了</a> 所导致的 CPU和硬盘之间的矛盾</p>
<h4 id="由于IO慢逼迫我们这样做"><a href="#由于IO慢逼迫我们这样做" class="headerlink" title="由于IO慢逼迫我们这样做"></a>由于IO慢逼迫我们这样做</h4><blockquote>
<p>1.缓冲</p>
</blockquote>
<ul>
<li>buffer</li>
<li>cache</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cpu往硬盘写一个文件</span><br><span class="line">你有两个选择</span><br><span class="line"></span><br><span class="line">1. 一个一个字节的写 </span><br><span class="line">    这就导致了 </span><br><span class="line">        写一个字节 等一个磁盘写入时间 </span><br><span class="line">        再写一个字节 在等一个磁盘写入时间</span><br><span class="line">        循环往复 </span><br><span class="line">2. 攒一堆一块写， 比如缓冲区里是 1MB 攒够了一次写入磁盘</span><br></pre></td></tr></table></figure>
<blockquote>
<p>2.并发(多线程)</p>
</blockquote>
<h3 id="IO太慢了，怎么办？"><a href="#IO太慢了，怎么办？" class="headerlink" title="IO太慢了，怎么办？"></a>IO太慢了，怎么办？</h3><ul>
<li>BufferedReader/Writer</li>
<li>BufferedReader - ⼀次性读取好多东⻄到缓冲区⾥</li>
<li>BufferedWriter - ⼀次性写好多东⻄到缓冲区⾥</li>
<li>在内存中创建好，⼀次写⼊</li>
</ul>
<blockquote>
<p>换⾏符的故事</p>
</blockquote>
<ul>
<li>windows 换行是 <code>\r\n</code></li>
<li>linux 换行是 <code>\n</code></li>
</ul>
<p><strong>导致文件从不同系统复制过来后显示会有问题</strong></p>
<blockquote>
<p>这个缓冲区到底是什么</p>
</blockquote>
<ul>
<li>实际就是<code>char cb[]</code>，它是在内存里的</li>
</ul>
<h3 id="其实……不需要重复发明轮⼦"><a href="#其实……不需要重复发明轮⼦" class="headerlink" title="其实……不需要重复发明轮⼦"></a>其实……不需要重复发明轮⼦</h3><ul>
<li>需要任何IO的功能，尽管搜索，肯定有⼈把轮⼦造好了。<ul>
<li>FileUtils</li>
<li>IOUtils</li>
</ul>
</li>
</ul>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><ul>
<li><a href="https://github.com/hcsp/read-write-files" target="_blank" rel="noopener">https://github.com/hcsp/read-write-files</a></li>
<li><a href="https://github.com/hcsp/save-pull-requests-to-csv" target="_blank" rel="noopener">https://github.com/hcsp/save-pull-requests-to-csv</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/oak/">oak</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/03/ZB-021-01-File与IO/" title="ZB-021-01-File与IO" itemprop="url">ZB-021-01-File与IO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-09-03T12:05:47.000Z" itemprop="datePublished"> Published 2019-09-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="计算机常识"><a href="#计算机常识" class="headerlink" title="计算机常识"></a>计算机常识</h3><p>现在典型的计算机里分三级</p>
<ul>
<li>CPU<ul>
<li>计算机的<strong>大脑</strong>，负责一切运算</li>
</ul>
</li>
<li>内存 memory<ul>
<li>存数据，断电丢失</li>
</ul>
</li>
<li>硬盘 <strong>存数据，容量大，断电不丢失</strong><ol>
<li>HDD 以前的硬盘</li>
<li>SSD 现在的硬盘</li>
</ol>
</li>
</ul>
<blockquote>
<h4 id="假设你有台-3GHz的电脑"><a href="#假设你有台-3GHz的电脑" class="headerlink" title="假设你有台 3GHz的电脑"></a>假设你有台 3GHz的电脑</h4></blockquote>
<ul>
<li>3*10亿</li>
<li>每秒运行 30亿条指令 如<code>i = i + 1</code></li>
<li>一个指令大概 <code>0.3ns</code> 这是非常快的</li>
</ul>
<h3 id="CPU说：这个世界太慢了"><a href="#CPU说：这个世界太慢了" class="headerlink" title="CPU说：这个世界太慢了"></a><a href="http://www.sohu.com/a/222322011_487482" target="_blank" rel="noopener">CPU说：这个世界太慢了</a></h3><blockquote>
<p>来源：cizixs（51CTO博客作者）</p>
</blockquote>
<blockquote>
<p>链接：<a href="http://blog.51cto.com/13188467/2065321" target="_blank" rel="noopener">http://blog.51cto.com/13188467/2065321</a></p>
</blockquote>
<p>经常听到有人说磁盘很慢、网络很卡，这都是站在人类的感知维度去表述的，比如拷贝一个文件到硬盘需要几分钟到几十分钟，够我去吃个饭啦；而从网络下载一部电影，有时候需要几个小时，我都可以睡一觉了。</p>
<p>最为我们熟知的关于计算机不同组件速度差异的图表，是下面这种金字塔形式：越往上速度越快，容量越小，而价格越高。这张图只是给了我们一个直观地感觉，并没有对各个速度和性能做出量化的说明和解释。而实际上，不同层级之间的差异要比这张图大的多。<strong>这篇文章就让你站在 CPU 的角度看这个世界，说说到底它们有多慢。</strong></p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_024_01.png" alt></p>
<p>希望你看到看完这篇文章能明白两件事情：</p>
<ul>
<li>磁盘和网络真的很慢</li>
<li>性能优化是个复杂的系统性的活</li>
</ul>
<p>注：所有的数据都是来自这个地址。所有的数据会因为机器配置不同，或者硬件的更新而有出入，但是不影响我们直觉的感受。如果对这些数据比较感兴趣，这个网址给出了不同年份一些指标的数值。</p>
<h4 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h4><p>先来看看 CPU 的速度，就拿我的电脑来说，<strong>主频是 2.6G，也就是说每秒可以执行 2.6*10^9 个指令每个指令只需要 0.38ns</strong>（现在很多个人计算机的主频要比这个高，配置比较高的能达到 3.0G+）。我们把这个时间当做基本单位 1s，因为 1s 大概是人类能感知的最小时间单位。</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_024_02.png" alt></p>
<p><strong>一级缓存读取时间为 0.5ns，换算成人类时间大约是 1.3s</strong>，大约一次或者两次心跳的时间。这里能看出缓存的重要性，因为它的速度可以赶上 CPU，程序本身的 locality 特性加上指令层级上的优化，cache 访问的命中率很高，这最终能极大提高效率。</p>
<p><strong>分支预测错误需要耗时 5ns，换算成人类时间大约是 13s</strong>，这个就有点久了，所以你会看到很多文章分析如何优化代码来降低分支预测的几率，比如这个得分非常高的 stackoverflow 问题。</p>
<p><strong>二级缓存时间就比较久了，大约在 7ns，换算成人类时间大约是 18.2s</strong>，可以看到的是如果一级缓存没有命中，然后去二级缓存读取数据，时间差了一个数量级。</p>
<p><strong>小知识：为什么需要多层的 CPU 缓存呢？</strong>这篇文章通过一个通俗易懂的例子给出了讲解。</p>
<p>我们继续，<strong>互斥锁的加锁和解锁时间需要 25ns，换算成人类时间大约是 65s</strong>，首次达到了一分钟。并发编程中，我们经常听说锁是一个很耗时的东西，因为在微波炉里加热一个东西需要一分钟的话，你要在那傻傻地等蛮久了。</p>
<p>然后就到了内存，<strong>每次内存寻址需要 100ns，换算成人类时间是 260s</strong>，也就是4分多钟，如果读一些不需要太多思考的文章，这么久能读完2-3千字（这个快阅读的时代，很少人在手机上能静心多这么字了）。看起来还不算坏，不多要从内存中读取一段数据需要的时间会更多。到了内存之后，时间就变了一个量级，CPU 和内存之间的速度瓶颈被称为冯诺依曼瓶颈。</p>
<p><strong>一次 CPU 上下文切换（系统调用）需要大约 1500ns，也就是 1.5us（这个数字参考了这篇文章，采用的是单核 CPU 线程平均时间），换算成人类时间大约是 65分钟</strong>，嗯，也就是一个小时。我们也知道上下文切换是很耗时的行为，毕竟每次浪费一个小时，也很让人有罪恶感的。上下文切换更恐怖的事情在于，这段时间里 CPU 没有做任何有用的计算，只是切换了两个不同进程的寄存器和内存状态；而且这个过程还破坏了缓存，让后续的计算更加耗时。</p>
<p><strong>在 1Gbps 的网络上传输 2K 的数据需要 20us，换算成人类时间是 14.4小时</strong>，这么久都能把《星球大战》六部曲看完了（甚至还加上吃饭撒尿的时间）！可以看到网络上非常少数据传输对于 CPU 来说，已经很漫长。而且这里的时间还是理论最大值，实际过程还要更慢一些。</p>
<p><strong>SSD 随机读取耗时为 150us，换算成人类时间大约是 4.5天</strong>。换句话说，SSD 读点数据，CPU 都能休假，报团参加周边游了。虽然我们知道 SSD 要比机械硬盘快很多，但是这个速度对于 CPU 来说也是像乌龟一样。I/O 设备 从硬盘开始速度开始变得漫长，这个时候我们就想起内存的好处了。尽量减少 IO 设备的读写，把最常用的数据放到内存中作为缓存是所有程序的通识。像 memcached 和 redis 这样的高速缓存系统近几年的异军突起，就是解决了这里的问题。</p>
<p><strong>从内存中读取 1MB 的连续数据，耗时大约为 250us，换算成人类时间是 7.5天</strong>，这次假期升级到国庆七天国外游了。</p>
<p><strong>同一个数据中心网络上跑一个来回需要 0.5ms，换算成人类时间大约是 15天</strong>，也就是半个月的时间。如果你的程序有段代码需要和数据中心的其他服务器交互，在这段时间里 CPU 都已经狂做了半个月的运算。减少不同服务组件的网络请求，是性能优化的一大课题。</p>
<p><strong>从 SSD 读取 1MB 的顺序数据，大约需要 1ms，换算成人类时间是 1个月</strong>。也就是说 SSD 读一个普通的文件，如果要等你做完，CPU 一个月时间就荒废了。尽管如此，SSD 已经很快啦，不信你看下面机械磁盘的表现。</p>
<p><strong>磁盘寻址时间为 10ms，换算成人类时间是 10个月</strong>，刚好够人类创造一个新的生命了。如果 CPU 需要让磁盘泡杯咖啡，在它眼里，磁盘去生了个孩子，回来告诉它你让我泡的咖啡好了。机械硬盘使用 RPM(Revolutions Per Minute/每分钟转速) 来评估磁盘的性能：RPM 越大，平均寻址时间更短，磁盘性能越好。寻址只是把磁头移动到正确的磁道上，然后才能读取指定扇区的内容。换句话说，寻址虽然很浪费时间，但其实它并没有办任何的正事（读取磁盘内容）。</p>
<p><strong>从磁盘读取 1MB 连续数据需要 20ms，换算成人类时间是 20个月</strong>。IO 设备是计算机系统的瓶颈，希望读到这里你能更深切地理解这句话！如果还不理解，不妨想想你在网上买的东西，快递送了将近两年，你的心情是怎么样的。</p>
<p>而<strong>从世界上不同城市网络上走一个来回，平均需要 150ms（参考世界各地 ping 报文的时间），换算成人类时间是 12.5年</strong>。不难理解，所有的程序和架构都会尽量避免不同城市甚至是跨国家的网络访问，CDN 就是这个问题的一个解决方案：让用户和最接近自己的服务器交互，从而减少网络上报文的传输时间。</p>
<p><strong>虚拟机重启一次大约要 4s 时间，换算成人类的时间是 3百多年</strong>。对于此，我想到了乔布斯要死命优化 Mac 系统开机启动时间的故事。如果机器能少重启而且每次启动能快一点，不仅能救人命，也能救 CPU 的命。</p>
<p><strong>物理服务器重启一次需要 5min，换算成人类时间是 2万5千年</strong>，快赶上人类的文明史了。5 分钟人类都要等一会了，更别提 CPU 了，所以没事不要乱重启服务器啊，分分钟终结一个文明的节奏。</p>
<h3 id="文件的本质"><a href="#文件的本质" class="headerlink" title="文件的本质"></a>文件的本质</h3><blockquote>
<h4 id="一切文件的本质"><a href="#一切文件的本质" class="headerlink" title="一切文件的本质"></a>一切文件的本质</h4></blockquote>
<ul>
<li>一段字节流<ul>
<li>文本文件(txt/代码/HTML等)</li>
<li>二进制文件</li>
</ul>
</li>
<li>由每个程序负责解释文件的字节流<ul>
<li>看到<code>.txt</code>就文本编辑器</li>
<li>看到<code>.png</code>就显示为图片</li>
<li>看到<code>.mp4</code>就播放</li>
<li>文本编辑器打开二进制文件乱码，而<code>JVM/IDEA</code> 认识</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么文件不用十进制而用十六进制</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">十进制 112 </span><br><span class="line"></span><br><span class="line">十六进制 70</span><br><span class="line"></span><br><span class="line">如果是16进制 秘诀就是 8421</span><br><span class="line">   7|0</span><br><span class="line">----------</span><br><span class="line">8421|8421 </span><br><span class="line">0111|0000 换算成二进制</span><br><span class="line"></span><br><span class="line">这个 8421就是 BCD编码</span><br><span class="line"></span><br><span class="line">而十进制 112 换算二进制就没这么快了</span><br><span class="line"></span><br><span class="line">所以这就是为什么用16进制来展示，并通过把中间部分拆开两半换算的原因</span><br></pre></td></tr></table></figure>
<h3 id="输入输出IO流详解"><a href="#输入输出IO流详解" class="headerlink" title="输入输出IO流详解"></a>输入输出IO流详解</h3><ul>
<li>InputStream</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package java.io;</span><br><span class="line"></span><br><span class="line">public abstract class InputStream implements Closeable &#123;</span><br><span class="line">    ...</span><br><span class="line">    // 最重要的方法 read</span><br><span class="line">    public abstract int read() throws IOException;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>OutputStream</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package java.io;</span><br><span class="line"></span><br><span class="line">public abstract class InputStream implements Closeable, Flushable&#123;</span><br><span class="line">    ...</span><br><span class="line">    // 最重要的方法 write</span><br><span class="line">    public abstract void write(int b) throws IOException;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="如果你对操作系统不是十分熟悉，请使用绝对路径"><a href="#如果你对操作系统不是十分熟悉，请使用绝对路径" class="headerlink" title="如果你对操作系统不是十分熟悉，请使用绝对路径"></a>如果你对操作系统不是十分熟悉，请使用绝对路径</h4></blockquote>
<ul>
<li>从文件读取字节流</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException &#123;</span><br><span class="line">    InputStream inputStream = new FileInputStream(&quot;绝对路径的文件&quot;);</span><br><span class="line">    while(true)&#123;</span><br><span class="line">        int b = inputStream.read();</span><br><span class="line">        if(b == -1)&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print((char) b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    OutputStream outputStream = new FileOutputStream(&quot;绝对路径的文件&quot;);</span><br><span class="line">    outputStream.write(&apos;p&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>从网络读取字节流</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HttpClient client = HttpClients.createDefault();</span><br><span class="line">HttpGet get = new HttpGet(&quot;https://www.baidu.com&quot;);</span><br><span class="line">HttpResponse response = client.execute(get);</span><br><span class="line"></span><br><span class="line">System.out.println(response.getStatusLine());</span><br><span class="line">System.out.println((char) response.getEntity().getContent().read());</span><br></pre></td></tr></table></figure>
<ul>
<li>从其他各种地方读取内容</li>
</ul>
<p>在java中 fork子进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ProcessBuilder pb = new ProcessBuilder(&quot;ls&quot;);</span><br><span class="line">Process process = pb.start();</span><br><span class="line">System.out.println((char)process.getInputStream().read());</span><br></pre></td></tr></table></figure>
<h3 id="java中的File"><a href="#java中的File" class="headerlink" title="java中的File"></a>java中的File</h3><ul>
<li><strong>不要误会！不要误会！不要误会！</strong><ul>
<li>File并不代表⼀个“⽂件”，它只代表⼀个 <strong>路径</strong></li>
<li>抽象的“⽂件”路径：⽂件或者⽂件夹</li>
</ul>
</li>
<li><p>File的常⻅⽅法</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 不要背这些api 最重要的是找到如何使用这些</span><br><span class="line">File file = new File(&quot;路径&quot;);</span><br><span class="line">file.isDirectory();</span><br><span class="line">file.exists();</span><br><span class="line">file.isFile();</span><br><span class="line">file.getAbsolutePath();</span><br><span class="line">file.listFiles(); // List&lt;File&gt;</span><br><span class="line">file.list();// 文件名</span><br><span class="line">file.isAbsolute(); //是不是绝对路径</span><br><span class="line">file.getName(); //获取文件名</span><br><span class="line">file.getParentFile();</span><br><span class="line">file.getCanonicalPath(); //获取经典路径  如 &quot;./././.././&quot; =&gt; /某个目录</span><br></pre></td></tr></table></figure>
</li>
<li><p>绝对路径与相对路径</p>
<ul>
<li>绝对路径在 windows上 <code>c:/ 或 d:/开头的</code> ，在linux上 以<code>/</code>开头的</li>
<li>相对路径<code>&quot;.&quot;</code> 当前路径</li>
</ul>
</li>
<li>读/写⽂件</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/oak/">oak</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/09/02/ZB-020-http/" title="ZB-020-http" itemprop="url">ZB-020-http</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-09-02T14:11:38.000Z" itemprop="datePublished"> Published 2019-09-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><ul>
<li><a href="https://www.runoob.com/http/http-methods.html" target="_blank" rel="noopener">http请求方法</a></li>
<li><a href="https://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">http状态码</a></li>
</ul>
<blockquote>
<h4 id="HTTP彩蛋"><a href="#HTTP彩蛋" class="headerlink" title="HTTP彩蛋"></a>HTTP彩蛋</h4></blockquote>
<ul>
<li><a href="https://http.cat" target="_blank" rel="noopener">https://http.cat</a> 图解状态码</li>
</ul>
<blockquote>
<p>451什么意思</p>
</blockquote>
<ul>
<li>来源于一本小说《华式451度》 </li>
</ul>
<p><strong>代表由于法律原因被禁止的请求</strong></p>
<blockquote>
<p>另一个彩蛋 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/418" target="_blank" rel="noopener">http staus 咖啡壶</a></p>
</blockquote>
<ul>
<li>没有任何卵用</li>
</ul>
<h4 id="参考知识"><a href="#参考知识" class="headerlink" title="参考知识"></a>参考知识</h4><ul>
<li><a href="https://sltrust.github.io/2017/10/12/N006_HTTP入门/" target="_blank" rel="noopener">https://sltrust.github.io/2017/10/12/N006_HTTP入门/</a></li>
<li><a href="https://sltrust.github.io/2019/06/06/Java-019-HTTP/" target="_blank" rel="noopener">https://sltrust.github.io/2019/06/06/Java-019-HTTP/</a></li>
<li><a href="https://sltrust.github.io/2019/06/15/Java-030-cookie和session/" target="_blank" rel="noopener">https://sltrust.github.io/2019/06/15/Java-030-cookie和session/</a></li>
</ul>
<h4 id="HTTP实战"><a href="#HTTP实战" class="headerlink" title="HTTP实战"></a>HTTP实战</h4><ul>
<li><a href="https://github.com/hcsp/http-login-and-use-cookie/pull/2" target="_blank" rel="noopener">https://github.com/hcsp/http-login-and-use-cookie/pull/2</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/oak/">oak</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/08/24/ReactWheels11-03form组件/" title="ReactWheels11-03form组件" itemprop="url">ReactWheels11-03form组件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-08-24T12:47:55.000Z" itemprop="datePublished"> Published 2019-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="proposal-optional-chaining-提案"><a href="#proposal-optional-chaining-提案" class="headerlink" title="proposal optional chaining 提案"></a>proposal optional chaining 提案</h3><ul>
<li><a href="https://github.com/tc39/proposal-optional-chaining" target="_blank" rel="noopener">https://github.com/tc39/proposal-optional-chaining</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;c:[0,2]&#125;</span><br><span class="line"></span><br><span class="line">a.c &amp;&amp; a.c.join(&apos;,&apos;)</span><br><span class="line"></span><br><span class="line">// 如果有这个提案就可以这样</span><br><span class="line">a?.c.join(&apos;,&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="异步的表单验证"><a href="#异步的表单验证" class="headerlink" title="异步的表单验证"></a>异步的表单验证</h3><p>如用户名是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const rules = [</span><br><span class="line">           &#123;key: &apos;username&apos;,validator: &#123;</span><br><span class="line">                   name:&apos;unique&apos;,</span><br><span class="line">                   validate(username:string)&#123;</span><br><span class="line">                       axios.get(&apos;/check_name&apos;,&#123;params:&#123;username&#125;&#125;)</span><br><span class="line">                           .then(()=&gt;&#123;</span><br><span class="line">                               </span><br><span class="line">                           &#125;,()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">                           &#125;)</span><br><span class="line">                       // 但是结果是异步的  </span><br><span class="line">                       // 此时只能用 Promise</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       ]</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const usernames = [&apos;frank&apos;,&apos;jack&apos;,&apos;tom&apos;];</span><br><span class="line">const checkUserName = (username: string,success:()=&gt;void,fail:()=&gt;void) =&gt;&#123;</span><br><span class="line">    setTimeout(()=&gt;&#123;</span><br><span class="line">        if(usernames.indexOf(username)&gt;0)&#123;</span><br><span class="line">            success()</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            fail();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;key: &apos;username&apos;,validator: &#123;</span><br><span class="line">        name:&apos;unique&apos;,</span><br><span class="line">        validate(username:string)&#123;</span><br><span class="line">            return new Promise((resolve,reject)=&gt;&#123;</span><br><span class="line">                checkUserName(username, resolve, reject);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cosnt x = ()=&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Promise.all(promistList).then(x,x);</span><br><span class="line">// 等价于</span><br><span class="line">Promise.all(promistList).finally(x);</span><br></pre></td></tr></table></figure>
<h4 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h4><ul>
<li>支持子字段编辑(子表单)</li>
<li>支持更多的 type 如 图片上传 / 自定义 type</li>
<li>支持手机端</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/08/24/ReactWheels11-02form组件/" title="ReactWheels11-02form组件" itemprop="url">ReactWheels11-02form组件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-08-24T11:25:53.000Z" itemprop="datePublished"> Published 2019-08-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Input组件"><a href="#Input组件" class="headerlink" title="Input组件"></a>Input组件</h3><blockquote>
<h4 id="input-tsx"><a href="#input-tsx" class="headerlink" title="input.tsx"></a>input.tsx</h4></blockquote>
<ul>
<li>Props 继承 InputHTMLAttributes</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123;InputHTMLAttributes&#125; from &quot;react&quot;;</span><br><span class="line">import classes from &quot;../helpers/classes&quot;;</span><br><span class="line">import &apos;./input.scss&apos;;</span><br><span class="line"></span><br><span class="line">interface Props extends InputHTMLAttributes&lt;HTMLInputElement&gt;&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Input: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className , ...rest&#125; = props</span><br><span class="line">    return (</span><br><span class="line">        &lt;input className=&#123;classes(&apos;fui-input&apos;, className)&#125; type=&quot;text&quot; &#123;...rest&#125;/&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Input;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="input-scss"><a href="#input-scss" class="headerlink" title="input.scss"></a>input.scss</h4></blockquote>
<ul>
<li>实现 类似 ant-design 的 border过渡效果</li>
<li>不要上来就写 <code>width/height</code> 绝对有bug</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../helper&quot;;</span><br><span class="line">.fui-input&#123;</span><br><span class="line">  border:1px solid #ddd;</span><br><span class="line">  line-height: 22px;</span><br><span class="line">  padding:4px 8px;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  box-shadow: 0 0 0 2px fade_out($main-color,1);</span><br><span class="line">  transition: box-shadow 1s;</span><br><span class="line">  &amp;:focus&#123;</span><br><span class="line">    outline: none;</span><br><span class="line">    border-color: $main-color;</span><br><span class="line">    box-shadow: 0 0 0 2px fade_out($main-color,0.5);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何让form表单不写样式就对齐呢？"><a href="#如何让form表单不写样式就对齐呢？" class="headerlink" title="如何让form表单不写样式就对齐呢？"></a>如何让form表单不写样式就对齐呢？</h3><p><strong>table布局</strong><br><strong>table布局</strong><br><strong>table布局</strong></p>
<p>它虽然渲染速度慢，但是它会自动计算宽度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;aaa&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;用户名xxxxxxxxx&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;aaa&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">// table 会把整个列宽都算一遍 </span><br><span class="line">// 找到最大宽度的 td 以它的宽度去渲染td 对应 column</span><br><span class="line">// 所以才会慢</span><br></pre></td></tr></table></figure>
<h4 id="只有中国人才需要的字段对齐"><a href="#只有中国人才需要的字段对齐" class="headerlink" title="只有中国人才需要的字段对齐"></a>只有中国人才需要的字段对齐</h4><blockquote>
<p>实现任意长度的两端字对齐</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">用  户  名</span><br><span class="line">密      码</span><br><span class="line"></span><br><span class="line">// 这个只有中国人才会这样</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://segmentfault.com/a/1190000011336392" target="_blank" rel="noopener">css 两端对齐 after</a></li>
</ul>
<h4 id="table-的td"><a href="#table-的td" class="headerlink" title="table 的td"></a>table 的td</h4><ul>
<li>不接受 margin</li>
<li>接受 padding</li>
</ul>
<h4 id="button"><a href="#button" class="headerlink" title="button"></a>button</h4><p>button.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123;ButtonHTMLAttributes&#125; from &quot;react&quot;;</span><br><span class="line">import classes from &quot;../helpers/classes&quot;;</span><br><span class="line">import &apos;./button.scss&apos;;</span><br><span class="line"></span><br><span class="line">interface Props extends ButtonHTMLAttributes&lt;HTMLButtonElement&gt;&#123;</span><br><span class="line">    level?: &apos;important&apos; | &apos;danger&apos; | &apos;normal&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Button: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className ,children,level, ...rest&#125; = props</span><br><span class="line">    return (</span><br><span class="line">        &lt;button</span><br><span class="line">            className=&#123;classes(&apos;fui-button&apos;,`fui-button-$&#123;level&#125;`,className)&#125;</span><br><span class="line">            &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Button.defaultProps = &#123;</span><br><span class="line">    level: &apos;normal&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Button;</span><br></pre></td></tr></table></figure>
<p>button.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../helper&quot;;</span><br><span class="line"></span><br><span class="line">.fui-button&#123;</span><br><span class="line">  padding:4px 16px;</span><br><span class="line">  line-height: 22px;</span><br><span class="line">  transition: all 250ms;</span><br><span class="line">  cursor:pointer;</span><br><span class="line">  &amp;:focus&#123;</span><br><span class="line">    outline: none;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;-normal&#123;</span><br><span class="line">    color: #333;</span><br><span class="line">    border:1px solid lighten(#333,50%);</span><br><span class="line">    background: white;</span><br><span class="line">    &amp;:hover , &amp;:focus&#123;</span><br><span class="line">      border-color: $main-color;</span><br><span class="line">      color:$main-color;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;-important&#123;</span><br><span class="line">    color: white;</span><br><span class="line">    border:1px solid $main-color;</span><br><span class="line">    background: $main-color;</span><br><span class="line">    &amp;:hover , &amp;:focus&#123;</span><br><span class="line">      background: lighten($main-color,10%);</span><br><span class="line">      border-color: lighten($main-color,10%);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ReactWheels/">ReactWheels</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/08/20/ReactWheels11-01form组件/" title="ReactWheels11-01form组件" itemprop="url">ReactWheels11-01form组件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-08-20T13:43:11.000Z" itemprop="datePublished"> Published 2019-08-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Form-组件"><a href="#Form-组件" class="headerlink" title="Form 组件"></a>Form 组件</h3><h4 id="form基本思路"><a href="#form基本思路" class="headerlink" title="form基本思路"></a>form基本思路</h4><p>form.example.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import Form from &quot;./form&quot;;</span><br><span class="line">import &#123;useState, Fragment&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [formData] = useState(&#123;</span><br><span class="line">        username:&apos;&apos;,</span><br><span class="line">        password:&apos;&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">    const [fields] = useState([</span><br><span class="line">        &#123;name:&apos;username&apos;,label:&apos;用户名&apos;,input:&#123;type:&apos;text&apos;&#125;&#125;,</span><br><span class="line">        &#123;name:&apos;password&apos;,label:&apos;密码&apos;,input:&#123;type:&apos;password&apos;&#125;&#125;,</span><br><span class="line">    ])</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Form value=&#123;formData&#125; fields=&#123;fields&#125;</span><br><span class="line">                buttons=&#123;</span><br><span class="line">                    &lt;Fragment&gt;</span><br><span class="line">                        &lt;button&gt;提交&lt;/button&gt;</span><br><span class="line">                        &lt;button&gt;返回&lt;/button&gt;</span><br><span class="line">                    &lt;/Fragment&gt;</span><br><span class="line">                &#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default FormExample;</span><br></pre></td></tr></table></figure>
<p>form.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123;ReactFragment&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">interface Props &#123;</span><br><span class="line">    value: &#123; [K: string]: any &#125;;</span><br><span class="line">    fields: Array&lt;&#123;name:string,label:string,input:&#123;type:string&#125;&#125;&gt;;</span><br><span class="line">    buttons: ReactFragment;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Form:React.FunctionComponent&lt;Props&gt; = (props)=&gt;&#123;</span><br><span class="line">    // key 是为了消除警告</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123;props.fields.map( f =&gt;</span><br><span class="line">                &lt;div key=&#123;f.name&#125;&gt;</span><br><span class="line">                    &#123;f.label&#125;</span><br><span class="line">                    &lt;input type=&#123;f.input.type&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            )&#125;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;props.buttons&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Form;</span><br></pre></td></tr></table></figure>
<h4 id="受控组件和非受控组件"><a href="#受控组件和非受控组件" class="headerlink" title="受控组件和非受控组件"></a>受控组件和非受控组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [name,setName] = useState(&apos;hjx&apos;)</span><br><span class="line">    return (</span><br><span class="line">        &lt;input value=&#123;name&#125; /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>页面显示一个 input 然后 value 为 “hjx”</p>
</blockquote>
<ul>
<li>但是无法编辑</li>
<li>而且有警告</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">checkPropTypes.js:20 Warning: Failed prop type: You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.</span><br><span class="line">    in input (created by FormExample)</span><br><span class="line">    in FormExample (created by Context.Consumer)</span><br><span class="line">    in Route</span><br><span class="line">    in div (created by Content)</span><br><span class="line">    in Content</span><br><span class="line">    in div (created by Layout)</span><br><span class="line">    in Layout</span><br><span class="line">    in div (created by Layout)</span><br><span class="line">    in Layout</span><br><span class="line">    in Router (created by HashRouter)</span><br><span class="line">    in HashRouter</span><br></pre></td></tr></table></figure>
<p><strong>想改怎么办？</strong></p>
<ul>
<li>添加 onChange 事件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [name,setName] = useState(&apos;hjx&apos;)</span><br><span class="line">    return (</span><br><span class="line">        &lt;input value=&#123;name&#125; onChange=&#123;(e)=&gt; setName(e.target.value)&#125; /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="困惑"><a href="#困惑" class="headerlink" title="困惑"></a>困惑</h4><blockquote>
<p>为什么以前什么都不加就可以写，而现在在React要这样写</p>
</blockquote>
<p><strong>关系到React的设计哲学</strong></p>
<ul>
<li><code>UI = f(state)</code> 只要 状态 state 没变 UI就不该变  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn(1) //返回 2</span><br><span class="line">fn(1) //返回 2</span><br><span class="line">// 再次调用时，应该还是返回2 ，这样才符合函数式</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="其他方式"><a href="#其他方式" class="headerlink" title="其他方式"></a>其他方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [name,setName] = useState(&apos;hjx&apos;)</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;input value=&#123;name&#125; onChange=&#123;(e)=&gt; setName(e.target.value)&#125; /&gt;</span><br><span class="line">            &lt;input defaultValue=&#123;name&#125; type=&quot;text&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">第一个可以修改 但要添加 onChange</span><br><span class="line"></span><br><span class="line">第二个也可以修改 但是拿不到 value的值此时你只能使用 Ref</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [name,setName] = useState(&apos;hjx&apos;)</span><br><span class="line">    // 泛型告诉 refInput.current 就是 input元素</span><br><span class="line">    const refInput = useRef&lt;HTMLInputElement&gt;(null);</span><br><span class="line">    const x = ()=&gt;&#123;</span><br><span class="line">        // refInput.current 就是 input</span><br><span class="line">        // 断言有值</span><br><span class="line">        console.log(refInput.current!.value)</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;input value=&#123;name&#125; onChange=&#123;(e)=&gt; setName(e.target.value)&#125; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;input defaultValue=&#123;name&#125; ref=&#123;refInput&#125; type=&quot;text&quot; onBlur=&#123;x&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第一种叫做受控组件(React推荐使用)</li>
<li>第二种叫做 非受控组件(它只是比较方便，如只是显示一个值)</li>
</ul>
<h4 id="onChange输出最新的值"><a href="#onChange输出最新的值" class="headerlink" title="onChange输出最新的值"></a>onChange输出最新的值</h4><p>form.example.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import Form, &#123;FormValue&#125; from &quot;./form&quot;;</span><br><span class="line">import &#123;useState, Fragment&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [formData,setFormData] = useState&lt;FormValue&gt;(&#123;</span><br><span class="line">        username:&apos;aaa&apos;,</span><br><span class="line">        password:&apos;111&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">    const [fields] = useState([</span><br><span class="line">        &#123;name:&apos;username&apos;,label:&apos;用户名&apos;,input:&#123;type:&apos;text&apos;&#125;&#125;,</span><br><span class="line">        &#123;name:&apos;password&apos;,label:&apos;密码&apos;,input:&#123;type:&apos;password&apos;&#125;&#125;,</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    const onSubmit = (e:React.FormEvent&lt;HTMLFormElement&gt;)=&gt;&#123;</span><br><span class="line">        console.log(formData)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Form</span><br><span class="line">                value=&#123;formData&#125; fields=&#123;fields&#125;</span><br><span class="line">                buttons=&#123;</span><br><span class="line">                    &lt;Fragment&gt;</span><br><span class="line">                        &lt;button&gt;提交&lt;/button&gt;</span><br><span class="line">                        &lt;button&gt;返回&lt;/button&gt;</span><br><span class="line">                    &lt;/Fragment&gt;</span><br><span class="line">                &#125;</span><br><span class="line">                onChange=&#123;(newValue) =&gt; setFormData(newValue)&#125;</span><br><span class="line">                onSubmit=&#123;onSubmit&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default FormExample;</span><br></pre></td></tr></table></figure>
<p>form.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import &#123;ReactFragment&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">// FormValue 就是把整个 value传递回去 有性能问题 但是你有10000条数据的表单吗？ 最多提交20条</span><br><span class="line">export interface FormValue&#123;</span><br><span class="line">    [K: string]: any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Props &#123;</span><br><span class="line">    value: FormValue;</span><br><span class="line">    fields: Array&lt;&#123;name:string,label:string,input:&#123;type:string&#125;&#125;&gt;;</span><br><span class="line">    buttons: ReactFragment;</span><br><span class="line">    onSubmit: React.FormEventHandler&lt;HTMLFormElement&gt;;</span><br><span class="line">    onChange: (value: FormValue)=&gt; void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Form:React.FunctionComponent&lt;Props&gt; = (props)=&gt;&#123;</span><br><span class="line">    const formData = props.value;</span><br><span class="line">    const onSubmit: React.FormEventHandler&lt;HTMLFormElement&gt; = (e)=&gt;&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        props.onSubmit(e);</span><br><span class="line">    &#125;</span><br><span class="line">    const onInputChange = (name:string,value:string)=&gt;&#123;</span><br><span class="line">        const newFormValue = &#123;...formData, [name]:value&#125;;</span><br><span class="line">        props.onChange(newFormValue)</span><br><span class="line">        console.log(name,value)</span><br><span class="line">    &#125;</span><br><span class="line">    // key 是为了消除警告</span><br><span class="line">    return (</span><br><span class="line">        &lt;form onSubmit=&#123;onSubmit&#125;&gt;</span><br><span class="line">            &#123;props.fields.map( f =&gt;</span><br><span class="line">                &lt;div key=&#123;f.name&#125;&gt;</span><br><span class="line">                    &#123;f.label&#125;</span><br><span class="line">                    &lt;input type=&#123;f.input.type&#125; value=&#123;formData[f.name]&#125;</span><br><span class="line">                        onChange=&#123;(e) =&gt; onInputChange(f.name, e.target.value)&#125;</span><br><span class="line">                        //还可以用bind onChange=&#123;onInputChange.bind(null,f.name)&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            )&#125;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;props.buttons&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Form;</span><br></pre></td></tr></table></figure>
<h3 id="表单验证思路"><a href="#表单验证思路" class="headerlink" title="表单验证思路"></a>表单验证思路</h3><p>Validator.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import &#123;FormValue&#125; from &quot;./form&quot;;</span><br><span class="line"></span><br><span class="line">interface FormRule &#123;</span><br><span class="line">    key: string;</span><br><span class="line">    required?: boolean;</span><br><span class="line">    minLength?: number;</span><br><span class="line">    maxLength?: number;</span><br><span class="line">    pattern?: RegExp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type FormRules = Array&lt;FormRule&gt;</span><br><span class="line"></span><br><span class="line">interface FormErrors &#123;</span><br><span class="line">    [K: string]: string[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isEmpty(value: any)&#123;</span><br><span class="line">    if(value === undefined || value === null || value === &apos;&apos;)&#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Validator = (formValue: FormValue, rules: FormRules): FormErrors =&gt;&#123;</span><br><span class="line">    let errors: any = &#123;&#125;;</span><br><span class="line">    const addError = (key: string, message: string) =&gt; &#123;</span><br><span class="line">        if(errors[key] === undefined)&#123;</span><br><span class="line">            errors[key] = [];</span><br><span class="line">        &#125;</span><br><span class="line">        errors[key].push(message);</span><br><span class="line">    &#125;</span><br><span class="line">    rules.map(rule =&gt; &#123;</span><br><span class="line">        console.log(rule);</span><br><span class="line">        const value = formValue[rule.key];</span><br><span class="line">        if (rule.required &amp;&amp; isEmpty(value)) &#123;</span><br><span class="line">            addError(rule.key, &apos;必填&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (rule.minLength &amp;&amp; !isEmpty(value) &amp;&amp; value.length &lt; rule.minLength) &#123;</span><br><span class="line">            addError(rule.key, &apos;太短&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (rule.maxLength &amp;&amp; !isEmpty(value) &amp;&amp; value.length &gt; rule.maxLength) &#123;</span><br><span class="line">            addError(rule.key, &apos;太长&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        if( rule.pattern )&#123;</span><br><span class="line">            if(!(rule.pattern.test(value)))&#123;</span><br><span class="line">                addError(rule.key,&apos;格式不正确&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return errors;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Validator;</span><br></pre></td></tr></table></figure>
<p>form.example.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &quot;react&quot;;</span><br><span class="line">import Form, &#123;FormValue&#125; from &quot;./form&quot;;</span><br><span class="line">import &#123;useState, Fragment&#125; from &quot;react&quot;;</span><br><span class="line">import Validator from &quot;./validator&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const FormExample:React.FunctionComponent = ()=&gt;&#123;</span><br><span class="line">    const [formData,setFormData] = useState&lt;FormValue&gt;(&#123;</span><br><span class="line">        username:&apos;aaa&apos;,</span><br><span class="line">        password:&apos;111&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">    const [fields] = useState([</span><br><span class="line">        &#123;name:&apos;username&apos;,label:&apos;用户名&apos;,input:&#123;type:&apos;text&apos;&#125;&#125;,</span><br><span class="line">        &#123;name:&apos;password&apos;,label:&apos;密码&apos;,input:&#123;type:&apos;password&apos;&#125;&#125;,</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    const onSubmit = (e:React.FormEvent&lt;HTMLFormElement&gt;)=&gt;&#123;</span><br><span class="line">        console.log(formData)</span><br><span class="line">        const rules = [</span><br><span class="line">            &#123;key: &apos;username&apos;,required: true &#125;,</span><br><span class="line">            &#123;key: &apos;username&apos;,minLength: 3 , maxLength:16 &#125;,</span><br><span class="line">            &#123;key: &apos;username&apos;,pattern: /^[A-Za-z0-9]+$/&#125;,</span><br><span class="line">        ]</span><br><span class="line">        const errors = Validator(formData,rules);</span><br><span class="line">        console.log(errors)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Form</span><br><span class="line">                value=&#123;formData&#125; fields=&#123;fields&#125;</span><br><span class="line">                buttons=&#123;</span><br><span class="line">                    &lt;Fragment&gt;</span><br><span class="line">                        &lt;button&gt;提交&lt;/button&gt;</span><br><span class="line">                        &lt;button&gt;返回&lt;/button&gt;</span><br><span class="line">                    &lt;/Fragment&gt;</span><br><span class="line">                &#125;</span><br><span class="line">                onChange=&#123;(newValue) =&gt; setFormData(newValue)&#125;</span><br><span class="line">                onSubmit=&#123;onSubmit&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default FormExample;</span><br></pre></td></tr></table></figure>
<h4 id="UNIX-编程艺术"><a href="#UNIX-编程艺术" class="headerlink" title="UNIX 编程艺术"></a>UNIX 编程艺术</h4><ul>
<li>有些代码，没有明显的BUG</li>
<li>另外一些代码，明显没有BUG (我们应该写这种)</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ReactWheels/">ReactWheels</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/08/15/ReactWheels10-制作官网/" title="ReactWheels10-制作官网" itemprop="url">ReactWheels10-制作官网</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-08-15T14:59:30.000Z" itemprop="datePublished"> Published 2019-08-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="制作LOGON"><a href="#制作LOGON" class="headerlink" title="制作LOGON"></a>制作LOGON</h3><ul>
<li><a href="https://hatchful.shopify.com" target="_blank" rel="noopener">logo maker</a></li>
</ul>
<h3 id="引入-logo"><a href="#引入-logo" class="headerlink" title="引入 logo"></a>引入 logo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D file-loader@3.0.1</span><br><span class="line"></span><br><span class="line">webpack 文件添加配置</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    test: /\.(png|jpe?g|gif)$/i,</span><br><span class="line">    use: [</span><br><span class="line">        &#123;</span><br><span class="line">            loader: &apos;file-loader&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>example.tsx 里 引入图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const logo = require(&apos;./logo.png&apos;);</span><br><span class="line"></span><br><span class="line">&lt;img src=&#123;logo&#125; alt=&quot;&quot;/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="如何展示源代码？"><a href="#如何展示源代码？" class="headerlink" title="如何展示源代码？"></a>如何展示源代码？</h3><ul>
<li><code>!!raw-loader</code> 代表开启加载</li>
<li><code>!!raw-loader!路径</code> 代表加载的文件 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add raw-loader@2.0.0</span><br><span class="line"></span><br><span class="line">然后在 example.tsx里</span><br><span class="line">const x = require(&apos;!!raw-loader!./lib/icon/icon.example.tsx&apos;);</span><br><span class="line">console.log(x.default)</span><br></pre></td></tr></table></figure>
<p>demo.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">interface Props &#123;</span><br><span class="line">    code:string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Demo:React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">            &lt;pre&gt;</span><br><span class="line">                &#123;props.code&#125;</span><br><span class="line">            &lt;/pre&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Demo;</span><br></pre></td></tr></table></figure>
<p>icon.demo.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import IconExample from &quot;./icon.example&quot;;</span><br><span class="line">import Demo from &quot;../../demo&quot;;</span><br><span class="line"></span><br><span class="line">const IconDemo = () =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;Demo code=&#123;require(&apos;!!raw-loader!./icon.example.tsx&apos;).default&#125;&gt;</span><br><span class="line">            &lt;IconExample/&gt;</span><br><span class="line">        &lt;/Demo&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">export default IconDemo;</span><br></pre></td></tr></table></figure>
<ul>
<li>不要企图传递组件路径让 demo.tsx 里去动态加载,因为不支持，试过了  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const code = require(`!!raw-loader!$&#123;prop.path&#125;`).default</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="源代码高亮"><a href="#源代码高亮" class="headerlink" title="源代码高亮"></a>源代码高亮</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add prism-react-renderer@0.1.6 -D</span><br></pre></td></tr></table></figure>
<p>demo.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import Highlight, &#123;defaultProps&#125; from &quot;prism-react-renderer&quot;;</span><br><span class="line">import &#123;useState&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">interface Props &#123;</span><br><span class="line">    code:string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">const Demo:React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">            &lt;pre&gt;</span><br><span class="line">                &#123;props.code&#125;</span><br><span class="line">            &lt;/pre&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">const Demo:React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const [codeVisible,setCodeVisible] = useState(false);</span><br><span class="line">    const code = (</span><br><span class="line">        &lt;Highlight &#123;...defaultProps&#125; code=&#123;props.code&#125; language=&quot;jsx&quot;&gt;</span><br><span class="line">            &#123;(&#123;className, style, tokens, getLineProps, getTokenProps&#125;) =&gt; (</span><br><span class="line">                &lt;pre className=&#123;className&#125; style=&#123;style&#125;&gt;</span><br><span class="line">                      &#123;tokens.map((line, i) =&gt; (</span><br><span class="line">                          &lt;div &#123;...getLineProps(&#123;line, key: i&#125;)&#125;&gt;</span><br><span class="line">                              &#123;line.map((token, key) =&gt; (</span><br><span class="line">                                  &lt;span &#123;...getTokenProps(&#123;token, key&#125;)&#125; /&gt;</span><br><span class="line">                              ))&#125;</span><br><span class="line">                          &lt;/div&gt;</span><br><span class="line">                      ))&#125;</span><br><span class="line">                    &lt;/pre&gt;</span><br><span class="line">            )&#125;</span><br><span class="line">        &lt;/Highlight&gt;</span><br><span class="line">    );</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;example&quot;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;setCodeVisible(!codeVisible)&#125;&gt;查看代码&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;codeVisible &amp;&amp; code&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Demo;</span><br></pre></td></tr></table></figure>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>修改 webpack.config.example.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const base = require(&apos;./webpack.config&apos;)</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;)</span><br><span class="line"></span><br><span class="line">module.exports = Object.assign(&#123;&#125;,base,&#123;</span><br><span class="line">    mode:&apos;production&apos;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &apos;doc&apos;),</span><br><span class="line">    &#125;,</span><br><span class="line">    entry:&#123;</span><br><span class="line">        example:&apos;./example.tsx&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins:[</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template:&apos;example.html&apos;,</span><br><span class="line">            filename: &quot;index.html&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>新建分支 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git branch gh-pages</span><br><span class="line">git checkout gh-pages</span><br><span class="line"># 提交到远程</span><br><span class="line">git push orgin gh-pages:gh-pages</span><br><span class="line"># 删除所有文件</span><br><span class="line">rm -rf *</span><br><span class="line"># 提交</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;remove all files&quot;</span><br><span class="line"></span><br><span class="line"># 回到master</span><br></pre></td></tr></table></figure>
<p>doc.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/env bash</span><br><span class="line"></span><br><span class="line">yarn doc</span><br><span class="line">git checkout gh-pages</span><br><span class="line">mv -f doc/* ./</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;update&quot;</span><br><span class="line">git push</span><br><span class="line">git checkout -</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ReactWheels/">ReactWheels</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/08/14/ReactWheels09-layout组件/" title="ReactWheels09-layout组件" itemprop="url">ReactWheels09-layout组件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-08-14T12:15:46.000Z" itemprop="datePublished"> Published 2019-08-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="参考-ant-design的-Layout组件"><a href="#参考-ant-design的-Layout组件" class="headerlink" title="参考 ant-design的 Layout组件"></a>参考 ant-design的 Layout组件</h3><ul>
<li><a href="https://ant.design/components/layout-cn/" target="_blank" rel="noopener">Layout</a></li>
</ul>
<h3 id="如何给-Layout-传递-style呢？"><a href="#如何给-Layout-传递-style呢？" class="headerlink" title="如何给 Layout 传递 style呢？"></a>如何给 <code>Layout</code> 传递 style呢？</h3><ul>
<li>CSSProperties</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;Layout style=&#123;&#123;height:500&#125;&#125;&gt;&lt;/Layout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import React, &#123; CSSProperties &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">interface Props &#123;</span><br><span class="line">    style: CSSProperties;</span><br><span class="line">&#125;</span><br><span class="line">const Layout: React.FunctionComponent = (props) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc()&#125;&gt;</span><br><span class="line">            ...</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>继承 <code>React.HTMLAttributes</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">        ...</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决className-覆盖问题"><a href="#解决className-覆盖问题" class="headerlink" title="解决className 覆盖问题"></a>解决className 覆盖问题</h4><p>如果直接组件上<code>...props</code> 导致我们组件的className 被覆盖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    // rest 代表剩余的属性值，这样就不会把我们自己的 className 覆盖了</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;[sc(),className].join(&apos; &apos;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="基本实现"><a href="#基本实现" class="headerlink" title="基本实现"></a>基本实现</h4><p>layout.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;scopedClassMaker&#125; from &apos;../classes&apos;;</span><br><span class="line">import &apos;./layout.scss&apos;</span><br><span class="line"></span><br><span class="line">const sc = scopedClassMaker(&apos;fui-layout&apos;)</span><br><span class="line"></span><br><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc(&apos;&apos;,&#123;extra:className&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Layout;</span><br></pre></td></tr></table></figure>
<p><code>Temp.tsx</code> 内容替换为 <code>[header|footer|content|aside]</code> 就是对应的组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;scopedClassMaker&#125; from &apos;../classes&apos;;</span><br><span class="line"></span><br><span class="line">const sc = scopedClassMaker(&apos;fui-layout&apos;)</span><br><span class="line"></span><br><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Temp: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc(&apos;temp&apos;,&#123;extra:className&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Temp;</span><br></pre></td></tr></table></figure>
<p>layout.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../helper&quot;;</span><br><span class="line">.fui-layout&#123;</span><br><span class="line">    border:1px solid red;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    &amp;-content&#123;</span><br><span class="line">        flex-grow:1;</span><br><span class="line">        border:1px solid green;</span><br><span class="line">    &#125;</span><br><span class="line">    // layout 里的 layout</span><br><span class="line">    &amp; &amp;&#123;</span><br><span class="line">        flex-grow: 1;</span><br><span class="line">        border:1px solid blue;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="遇到问题-就是-菜单单独在左侧，右侧上中下结构，我们的布局出新问题了"><a href="#遇到问题-就是-菜单单独在左侧，右侧上中下结构，我们的布局出新问题了" class="headerlink" title="遇到问题 就是 菜单单独在左侧，右侧上中下结构，我们的布局出新问题了"></a>遇到问题 就是 菜单单独在左侧，右侧上中下结构，我们的布局出新问题了</h4><ul>
<li>尝试获取 layout 的 children 来改className 的方式。</li>
<li>限制用户传递的 children 必须是<strong>元素</strong> 而不是字符串</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">    // 限制我们的组件的 children 不能是一个字符串，必须是一个元素</span><br><span class="line">    children: ReactElement | Array&lt;ReactElement&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line">    // 报错 因为它不一定是数组</span><br><span class="line">    // if(props.children.length)&#123;&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    // 只能通过断言 来绕过检查  </span><br><span class="line">    // 但是这样就导致 容易写出垃圾代码 ，只是让你写的时候思考 该不该这样写</span><br><span class="line">    if((props.children as Array&lt;ReactElement&gt;).length)&#123;</span><br><span class="line">        // 此时还需要继续断言</span><br><span class="line">        (props.children as Array&lt;ReactElement&gt;).map(node =&gt; &#123;</span><br><span class="line">            console.log(node);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc(&apos;&apos;,&#123;extra:className&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Layout;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过判断 Layout 里是否有 Aside 来添加 hasAside</p>
</blockquote>
<p>layout.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; ReactElement &#125; from &apos;react&apos;;</span><br><span class="line">import &#123;scopedClassMaker&#125; from &apos;../classes&apos;;</span><br><span class="line">import &apos;./layout.scss&apos;;</span><br><span class="line">import Aside from &apos;./aside&apos;;</span><br><span class="line"></span><br><span class="line">const sc = scopedClassMaker(&apos;fui-layout&apos;)</span><br><span class="line"></span><br><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">    // 限制我们的组件的 children 不能是一个字符串，必须是一个元素</span><br><span class="line">    children: ReactElement | Array&lt;ReactElement&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line">    // 报错 因为它不一定是数组</span><br><span class="line">    // if(props.children.length)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    // 只能通过断言 来绕过检查  </span><br><span class="line">    // 但是这样就导致 容易写出垃圾代码 ，只是让你写的时候思考 该不该这样写</span><br><span class="line">    let hasAside = false;</span><br><span class="line">    if((props.children as Array&lt;ReactElement&gt;).length)&#123;</span><br><span class="line">        (props.children as Array&lt;ReactElement&gt;).map(node =&gt; &#123;</span><br><span class="line">            console.log(node);</span><br><span class="line">            // 一旦发现有 aside 就附加一个类 hasAside</span><br><span class="line">            if(node.type === Aside)&#123;</span><br><span class="line">                hasAside = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc(&apos;&apos;,&#123;extra:[className, hasAside &amp;&amp; &apos;hasAside&apos;].join(&apos; &apos;)&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Layout;</span><br></pre></td></tr></table></figure>
<p>layout.scss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../helper&quot;;</span><br><span class="line">.fui-layout&#123;</span><br><span class="line">    border:1px solid red;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    /* 如果Layout 含有Aside 则它为row 同时它里面的 Layout 还是 column*/</span><br><span class="line">    &amp;.hasAside&#123;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">        .fui-layout&#123;</span><br><span class="line">            flex-direction: column;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &amp;-content&#123;</span><br><span class="line">        flex-grow:1;</span><br><span class="line">        border:1px solid green;</span><br><span class="line">    &#125;</span><br><span class="line">    // layout 里的 layout</span><br><span class="line">    &amp; &amp;&#123;</span><br><span class="line">        flex-grow: 1;</span><br><span class="line">        border:1px solid blue;</span><br><span class="line">        flex-direction: row;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消除代码里的-let-因为它违反函数式"><a href="#消除代码里的-let-因为它违反函数式" class="headerlink" title="消除代码里的 let 因为它违反函数式"></a>消除代码里的 let 因为它违反<strong>函数式</strong></h4><ul>
<li>我们用一个boolean值 存这个 hasAside</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if((props.children as Array&lt;ReactElement&gt;).length)&#123;</span><br><span class="line">        const hasAside =(props.children as Array&lt;ReactElement&gt;)</span><br><span class="line">            .reduce((result,node) =&gt; result || node.type === Aside,false);</span><br><span class="line">   &#125;</span><br><span class="line">return (</span><br><span class="line">    &lt;div className=&#123;sc(&apos;&apos;,&#123;extra:[className, hasAside &amp;&amp; &apos;hasAside&apos;].join(&apos; &apos;)&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">        &#123;props.children&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 此时的问题是 hasAside 无法在 return 里用</span><br></pre></td></tr></table></figure>
<p>改写完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">interface Props extends React.HTMLAttributes&lt;HTMLElement&gt;&#123;</span><br><span class="line">    // 限制我们的组件的 children 不能是一个字符串，必须是一个元素</span><br><span class="line">    children: ReactElement | Array&lt;ReactElement&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Layout: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">    const &#123;className, ...rest&#125; = props;</span><br><span class="line"></span><br><span class="line">    const children = props.children as Array&lt;ReactElement&gt;</span><br><span class="line">    const hasAside = children.length &amp;&amp; </span><br><span class="line">        children.reduce((result,node) =&gt; result || node.type === Aside,false);</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&#123;sc(&apos;&apos;,&#123;extra:[className, hasAside &amp;&amp; &apos;hasAside&apos;].join(&apos; &apos;)&#125;)&#125; &#123;...rest&#125;&gt;</span><br><span class="line">            &#123;props.children&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Layout;</span><br></pre></td></tr></table></figure>
<h4 id="Object-entries"><a href="#Object-entries" class="headerlink" title="Object.entries()"></a><code>Object.entries()</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Object.entries(&#123;a:1,c:2,b:3&#125;)</span><br><span class="line">返回</span><br><span class="line">[</span><br><span class="line">    [&quot;a&quot;,1],</span><br><span class="line">    [&quot;c&quot;:2],</span><br><span class="line">    [&quot;b&quot;:3]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="重构-scopedClassMaker"><a href="#重构-scopedClassMaker" class="headerlink" title="重构 scopedClassMaker"></a>重构 scopedClassMaker</h4><ul>
<li>classes.tsx</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">function classes(...names: (string | undefined)[]) &#123;</span><br><span class="line">    return names.filter(Boolean).join(&apos; &apos;);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">export default classes;</span><br><span class="line"></span><br><span class="line">interface Options &#123;</span><br><span class="line">    extra: string | undefined</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">&#123;</span><br><span class="line">    hasAside:true,</span><br><span class="line">    clearfix:false,</span><br><span class="line">    mt20:true</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line">interface ClassToggles &#123;</span><br><span class="line">    [K: string]: boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function scopedClassMaker(prefix: string)&#123;</span><br><span class="line">    return function (name?: string | ClassToggles,options?: Options)&#123;</span><br><span class="line">        let name2;</span><br><span class="line">        let result;</span><br><span class="line"></span><br><span class="line">        if( typeof name === &apos;string&apos; || name === undefined)&#123;</span><br><span class="line">            name2 = name;</span><br><span class="line">            result = [prefix,name2].filter(Boolean).join(&apos;-&apos;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            // [&apos;hasAside&apos;,&apos;x&apos;]</span><br><span class="line">            name2 = Object.entries(name).filter(kv =&gt; kv[1]).map(kv =&gt; kv[0]);</span><br><span class="line">            result = name2.map( n =&gt;&#123;</span><br><span class="line">                return [prefix,n].filter(Boolean).join(&apos;-&apos;)</span><br><span class="line">            &#125;).join(&apos; &apos;)</span><br><span class="line">            // [&apos;fui-layout-hasAside&apos;, &apos;fui-layout-x&apos;]</span><br><span class="line">        &#125;</span><br><span class="line">        if(options &amp;&amp; options.extra)&#123;</span><br><span class="line">            return  [ result, options &amp;&amp; options.extra].filter(Boolean).join(&apos; &apos;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export &#123;scopedClassMaker&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="再次重构它——函数式"><a href="#再次重构它——函数式" class="headerlink" title="再次重构它——函数式"></a>再次重构它——函数式</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">interface ClassToggles &#123;</span><br><span class="line">    [K: string]: boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function scopedClassMaker(prefix: string)&#123;</span><br><span class="line"></span><br><span class="line">    return function (name: string | ClassToggles , options?: Options)&#123;</span><br><span class="line">        const namesObject = (typeof name === &apos;string&apos; || name === undefined) ?</span><br><span class="line">            &#123;[name]:name&#125; :</span><br><span class="line">            name;</span><br><span class="line">        const scoped = Object</span><br><span class="line">            .entries(namesObject)</span><br><span class="line">            .filter(kv =&gt; kv[1] !==false)</span><br><span class="line">            .map(kv =&gt; kv[0])</span><br><span class="line">            .map(name =&gt; [prefix, name]</span><br><span class="line">                .filter(Boolean)</span><br><span class="line">                .join(&apos;-&apos;)</span><br><span class="line">            ).join(&apos; &apos;);</span><br><span class="line">        if(options &amp;&amp; options.extra)&#123;</span><br><span class="line">            return  [ scoped, options &amp;&amp; options.extra].filter(Boolean).join(&apos; &apos;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return scoped;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="将函数式进行到底"><a href="#将函数式进行到底" class="headerlink" title="将函数式进行到底"></a>将函数式进行到底</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const scopedClassMaker = (prefix: string) =&gt;</span><br><span class="line">     (name: string | ClassToggles , options?: Options) =&gt;</span><br><span class="line">    Object</span><br><span class="line">    .entries(name instanceof Object ? name : &#123;[name]:name&#125;)</span><br><span class="line">    .filter(kv =&gt; kv[1] !==false)</span><br><span class="line">    .map(kv =&gt; kv[0])</span><br><span class="line">    .map(name =&gt; [prefix, name]</span><br><span class="line">        .filter(Boolean)</span><br><span class="line">        .join(&apos;-&apos;))</span><br><span class="line">    .concat( options &amp;&amp; options.extra || [])</span><br><span class="line">    .join(&apos; &apos;);</span><br></pre></td></tr></table></figure>
<h4 id="测试-scopedClassMaker"><a href="#测试-scopedClassMaker" class="headerlink" title="测试 scopedClassMaker"></a>测试 scopedClassMaker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe(&apos;scopedClassMaker&apos;, () =&gt; &#123;</span><br><span class="line">  it(&apos;接收字符串 或 对象&apos;, () =&gt; &#123;</span><br><span class="line">    const sc = scopedClassMaker(&apos;fui-layout&apos;)</span><br><span class="line">    expect(sc(&apos;&apos;)).toEqual(&apos;fui-layout&apos;)</span><br><span class="line">    expect(sc(&apos;x&apos;)).toEqual(&apos;fui-layout-x&apos;)</span><br><span class="line">    expect(sc(&#123;y:true,z:false&#125;)).toEqual(&apos;fui-layout-y&apos;)</span><br><span class="line">    expect(sc(&#123;y:true,z:true&#125;)).toEqual(&apos;fui-layout-y fui-layout-z&apos;)</span><br><span class="line">    expect(sc(&#123;y:true,z:true&#125;,&#123;extra:&apos;red&apos;&#125;)).toEqual(&apos;fui-layout-y fui-layout-z red&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码连接</p>
</blockquote>
<p><a href="https://github.com/slTrust/react-gulu-test-4" target="_blank" rel="noopener">react-gulu-test-4</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/ReactWheels/">ReactWheels</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/9/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/50/">50</a><a class="extend next" rel="next" href="/page/11/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/oak/" title="oak">oak<sup>71</sup></a></li>
			
		
			
				<li><a href="/tags/前端知识点/" title="前端知识点">前端知识点<sup>43</sup></a></li>
			
		
			
				<li><a href="/tags/java/" title="java">java<sup>37</sup></a></li>
			
		
			
				<li><a href="/tags/Node后端/" title="Node后端">Node后端<sup>34</sup></a></li>
			
		
			
				<li><a href="/tags/M06/" title="M06">M06<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/fullstack/" title="fullstack">fullstack<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/M07/" title="M07">M07<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/M08/" title="M08">M08<sup>25</sup></a></li>
			
		
			
				<li><a href="/tags/M04/" title="M04">M04<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/M03/" title="M03">M03<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/M02/" title="M02">M02<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/React入门/" title="React入门">React入门<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/ReactWheels/" title="ReactWheels">ReactWheels<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/TS入门/" title="TS入门">TS入门<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/CSS/" title="CSS">CSS<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/M01/" title="M01">M01<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/vue/" title="vue">vue<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/ES6速学/" title="ES6速学">ES6速学<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>7</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="Stevin">Stevin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
