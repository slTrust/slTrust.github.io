<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Node-JS专精08手写bind01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/26/Node-JS专精08手写bind01/" class="article-date">
  <time datetime="2019-12-26T14:39:38.000Z" itemprop="datePublished">2019-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/26/Node-JS专精08手写bind01/">Node-JS专精08手写bind01</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="手写bind"><a href="#手写bind" class="headerlink" title="手写bind"></a>手写bind</h1><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener">MDN bind</a></li>
</ul>
<h3 id="确定API"><a href="#确定API" class="headerlink" title="确定API"></a>确定API</h3><ul>
<li>bind 位于 Function.prototype 上</li>
<li>需要做 polyfill</li>
</ul>
<blockquote>
<p>什么是<strong>polyfill</strong>？</p>
</blockquote>
<ul>
<li><a href="https://juejin.im/post/5a579bc7f265da3e38496ba1" target="_blank" rel="noopener">polyfill为何物</a></li>
<li>聚填充(生活中)<ul>
<li>抹平</li>
<li>补全</li>
<li>你的桌子一个腿短，于是底下垫了一个纸片</li>
<li>你的墙面不够平整，有坑，于是用白浆填平它</li>
</ul>
</li>
<li>对于前端<ul>
<li>你的JS代码运行在坑人的IE6下</li>
<li>我们知道方法一般挂在<code>Function.prototype</code>上 也就是<code>Function.prototype.bind</code>而在 IE6没有，此时你就需要 <strong>polyfill</strong> </li>
</ul>
</li>
</ul>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul>
<li><code>fn.bind(asThis)</code></li>
<li><code>fn.bind(asThis, param1, param2)</code></li>
<li><code>fn.bind(asThis)()</code></li>
<li><code>fn.bind(asThis, param1, param2)()</code></li>
<li><code>fn.bind(asThis)(param1)</code></li>
<li><code>fn.bind(asThis, param1, param2)(p3, p4)</code></li>
</ul>
<blockquote>
<p>bind API例子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">function aa()&#123;</span><br><span class="line">    console.log(this);</span><br><span class="line">    console.log(arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// fn.bind(asThis)</span><br><span class="line">// fn.bind(asThis)()</span><br><span class="line">var newFn = aa.bind(&#123;a:1&#125;)</span><br><span class="line">newFn()</span><br><span class="line">/*</span><br><span class="line">&#123;a:1&#125;</span><br><span class="line">arguments[]</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// fn.bind(asThis, param1, param2)</span><br><span class="line">// fn.bind(asThis, param1, param2)()</span><br><span class="line">var newFn2 = aa.bind(&#123;a:1&#125;,1,2)</span><br><span class="line">newFn2()</span><br><span class="line">/*</span><br><span class="line">&#123;a:1&#125;</span><br><span class="line">arguments[1,2]</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// fn.bind(asThis)(param1)</span><br><span class="line">var newFn3 = aa.bind(&#123;a:1&#125;)</span><br><span class="line">newFn3(1)</span><br><span class="line">/*</span><br><span class="line">&#123;a:1&#125;</span><br><span class="line">arguments[1]</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// fn.bind(asThis,p1,p2)(p3,p4)</span><br><span class="line">var newFn4 = aa.bind(&#123;a:1&#125;,1,2)</span><br><span class="line">newFn4(3,4)</span><br><span class="line">/*</span><br><span class="line">&#123;a:1&#125;</span><br><span class="line">arguments[1,2,3,4]</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="001bind-asThis-实现"><a href="#001bind-asThis-实现" class="headerlink" title="001bind(asThis) 实现"></a>001<code>bind(asThis)</code> 实现</h3></blockquote>
<ul>
<li>新建项目目录 <code>bind_demo</code></li>
<li>新建 <code>bind_demo/src/index.js</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function bind(asThis)&#123;</span><br><span class="line">    const fn = this</span><br><span class="line">    return function()&#123;</span><br><span class="line">        return fn.call(asThis)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = bind;</span><br><span class="line"></span><br><span class="line">if(!Function.prototype.bind)&#123;</span><br><span class="line">    Function.prototype.bind = bind;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>新建 <code>bind_demo/test/index.js</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const bind = require(&apos;../src/index&apos;);</span><br><span class="line">Function.prototype.bind2 = bind;</span><br><span class="line"></span><br><span class="line">console.assert(Function.prototype.bind2 !== undefined);</span><br><span class="line"></span><br><span class="line">const fn1 = function()&#123;</span><br><span class="line">    return this;</span><br><span class="line">&#125; </span><br><span class="line">const newFn = fn1.bind2(&#123;name:&apos;hjx&apos;&#125;);</span><br><span class="line">console.assert(newFn().name === &apos;hjx&apos;);</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="002bind-asThis-p1-p2-实现"><a href="#002bind-asThis-p1-p2-实现" class="headerlink" title="002bind(asThis,p1,p2) 实现"></a>002<code>bind(asThis,p1,p2)</code> 实现</h3></blockquote>
<ul>
<li>通过扩展运算符</li>
</ul>
<p><code>src/index.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function bind(asThis, ...args)&#123;</span><br><span class="line">    const fn = this</span><br><span class="line">    return function()&#123;</span><br><span class="line">        return fn.call(asThis, ...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = bind;</span><br><span class="line"></span><br><span class="line">if(!Function.prototype.bind)&#123;</span><br><span class="line">    Function.prototype.bind = bind;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>test/index.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const bind = require(&apos;../src/index&apos;);</span><br><span class="line">Function.prototype.bind2 = bind;</span><br><span class="line"></span><br><span class="line">console.assert(Function.prototype.bind2 !== undefined);</span><br><span class="line"></span><br><span class="line">const fn1 = function()&#123;</span><br><span class="line">    return this;</span><br><span class="line">&#125; </span><br><span class="line">const newFn = fn1.bind2(&#123;name:&apos;hjx&apos;&#125;);</span><br><span class="line">console.assert(newFn().name === &apos;hjx&apos;);</span><br><span class="line"></span><br><span class="line">const fn2 = function(p1,p2)&#123;</span><br><span class="line">    return [this,p1,p2]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const newFn2 = fn2.bind2(&#123;name:&apos;hjx&apos;&#125;, 123, 456);</span><br><span class="line">console.assert(newFn2()[0].name === &apos;hjx&apos;);</span><br><span class="line">console.assert(newFn2()[1] === 123 , &quot;p1&quot;);</span><br><span class="line">console.assert(newFn2()[2] === 456 , &quot;p2&quot;);</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="003bind-asThis-p1-p2-实现"><a href="#003bind-asThis-p1-p2-实现" class="headerlink" title="003bind(asThis,p1)(p2) 实现"></a>003<code>bind(asThis,p1)(p2)</code> 实现</h3></blockquote>
<ul>
<li>step1通过<code>newFn = fn.bind({name:&#39;hjx&#39;},1)</code> 绑定this 传递参数</li>
<li>step2<code>newFn(2)</code> 在此传递参数调用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function bind(asThis, ...args)&#123;</span><br><span class="line">    const fn = this</span><br><span class="line">    return function(...args2)&#123;</span><br><span class="line">        return fn.call(asThis, ...args, ...args2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">module.exports = bind;</span><br><span class="line"></span><br><span class="line">if(!Function.prototype.bind)&#123;</span><br><span class="line">    Function.prototype.bind = bind;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>test/index.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const bind = require(&apos;../src/index&apos;);</span><br><span class="line">Function.prototype.bind2 = bind;</span><br><span class="line"></span><br><span class="line">console.assert(Function.prototype.bind2 !== undefined);</span><br><span class="line"></span><br><span class="line">const fn1 = function()&#123;</span><br><span class="line">    return this;</span><br><span class="line">&#125; </span><br><span class="line">const newFn = fn1.bind2(&#123;name:&apos;hjx&apos;&#125;);</span><br><span class="line">console.assert(newFn().name === &apos;hjx&apos;);</span><br><span class="line"></span><br><span class="line">const fn2 = function(p1,p2)&#123;</span><br><span class="line">    return [this,p1,p2]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const newFn2 = fn2.bind2(&#123;name:&apos;hjx&apos;&#125;,123,456);</span><br><span class="line">console.assert(newFn2()[0].name === &apos;hjx&apos;);</span><br><span class="line">console.assert(newFn2()[1] === 123 , &quot;p1&quot;);</span><br><span class="line">console.assert(newFn2()[2] === 456 , &quot;p2&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const anotherFn2 = fn2.bind2(&#123;name:&apos;hjx&apos;&#125;,123);</span><br><span class="line">console.assert(anotherFn2(456)[0].name === &apos;hjx&apos;);</span><br><span class="line">console.assert(anotherFn2(456)[1] === 123);</span><br><span class="line">console.assert(anotherFn2(456)[2] === 456);</span><br></pre></td></tr></table></figure>
<h3 id="MDN-bind的Polyfill实现"><a href="#MDN-bind的Polyfill实现" class="headerlink" title="MDN bind的Polyfill实现"></a>MDN bind的Polyfill实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">if (!Function.prototype.bind) (function()&#123;</span><br><span class="line">  var slice = Array.prototype.slice;</span><br><span class="line">  Function.prototype.bind = function() &#123;</span><br><span class="line">    var thatFunc = this, thatArg = arguments[0];</span><br><span class="line">    var args = slice.call(arguments, 1);</span><br><span class="line">    if (typeof thatFunc !== &apos;function&apos;) &#123;</span><br><span class="line">      // closest thing possible to the ECMAScript 5</span><br><span class="line">      // internal IsCallable function</span><br><span class="line">      throw new TypeError(&apos;Function.prototype.bind - &apos; +</span><br><span class="line">             &apos;what is trying to be bound is not callable&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    return function()&#123;</span><br><span class="line">      var funcArgs = args.concat(slice.call(arguments))</span><br><span class="line">      return thatFunc.apply(thatArg, funcArgs);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>改写我们的 bind </p>
</blockquote>
<ul>
<li>为什么MDN 不用扩展运算符，因为它不能用和 bind 同时期的API</li>
</ul>
<p><code>src/index.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var slice = Array.prototype.slice;</span><br><span class="line">function bind(asThis)&#123;</span><br><span class="line">    var args = slice.call(arguments,1);</span><br><span class="line">    const fn = this</span><br><span class="line">    if(typeof fn !== &apos;function&apos;)&#123;</span><br><span class="line">        throw new Error(&quot;bind 必须调用在函数身上&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        var args2 = slice.call(arguments,0);</span><br><span class="line">        return fn.apply(asThis, args.concat(args2))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ES5和ES6版-bind"><a href="#ES5和ES6版-bind" class="headerlink" title="ES5和ES6版 bind"></a>ES5和ES6版 bind</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var slice = Array.prototype.slice;</span><br><span class="line">// ES5版</span><br><span class="line">function bind(asThis)&#123;</span><br><span class="line">    var args = slice.call(arguments,1);</span><br><span class="line">    const fn = this</span><br><span class="line">    if(typeof fn !== &apos;function&apos;)&#123;</span><br><span class="line">        throw new Error(&quot;bind 必须调用在函数身上&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        var args2 = slice.call(arguments,0);</span><br><span class="line">        return fn.apply(asThis, args.concat(args2))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ES6版</span><br><span class="line">function _bind(asThis, ...args)&#123;</span><br><span class="line">    const fn = this</span><br><span class="line">    return function(...args2)&#123;</span><br><span class="line">        return fn.call(asThis, ...args, ...args2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/slTrust/source-bind" target="_blank" rel="noopener">代码分支:01手写bind基本实现</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/26/Node-JS专精08手写bind01/" data-id="cklhjp211008wulfy48432w9o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精07手写深拷贝" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/26/Node-JS专精07手写深拷贝/" class="article-date">
  <time datetime="2019-12-26T14:38:50.000Z" itemprop="datePublished">2019-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/26/Node-JS专精07手写深拷贝/">Node-JS专精07手写深拷贝</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="手写深拷贝"><a href="#手写深拷贝" class="headerlink" title="手写深拷贝"></a>手写深拷贝</h2><h3 id="如何答题？"><a href="#如何答题？" class="headerlink" title="如何答题？"></a>如何答题？</h3><blockquote>
<p>步骤</p>
</blockquote>
<ul>
<li>询问数据类型</li>
<li>询问数据规模</li>
<li>询问性能要求</li>
<li>询问运行环境</li>
<li>询问其他要求</li>
<li>开始写</li>
</ul>
<h4 id="JSON数据格式有哪些"><a href="#JSON数据格式有哪些" class="headerlink" title="JSON数据格式有哪些"></a>JSON数据格式有哪些</h4><ul>
<li><a href="https://sltrust.github.io/2017/12/05/N034_AJAX%E6%98%AF%E4%BB%80%E4%B9%88%E9%AC%BC/#JSON-%E6%98%AF%E4%B8%80%E9%97%A8%E8%AF%AD%E8%A8%80-%E6%8A%84%E8%A2%AD%E7%9A%84JS" target="_blank" rel="noopener">参考</a></li>
</ul>
<h4 id="JSON序列化和反序列化"><a href="#JSON序列化和反序列化" class="headerlink" title="JSON序列化和反序列化"></a>JSON序列化和反序列化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">  name:&apos;abc&apos;,</span><br><span class="line">  age:18,</span><br><span class="line">  birthDate:new Date(2018,1,1), // 会变成日期字符串</span><br><span class="line">  exp:/hi/ , // 会被忽略</span><br><span class="line">  body:&#123;</span><br><span class="line">    leg:4,</span><br><span class="line">    head:&apos;one&apos;,</span><br><span class="line">    eye:[&apos;left&apos;,&apos;right&apos;],</span><br><span class="line">    color:&apos;red&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  s:Symbol(&quot;a&quot;), // 会被忽略</span><br><span class="line">  gender:undefined, // 会被忽略</span><br><span class="line">  sayHi:function()&#123;console.log(&apos;hello&apos;)&#125; // 会被忽略</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 序列化</span><br><span class="line">var obj_str = JSON.stringify(obj)</span><br><span class="line"></span><br><span class="line">// 反序列化</span><br><span class="line">var obj2 = JSON.parse(obj_str)</span><br><span class="line">console.log(obj2)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="JSON序列化反序列化的缺点是什么"><a href="#JSON序列化反序列化的缺点是什么" class="headerlink" title="JSON序列化反序列化的缺点是什么"></a>JSON序列化反序列化的缺点是什么</h4></blockquote>
<ul>
<li>不支持函数(会被忽略)</li>
<li>不支持 <code>undefined</code> 只支持<code>null</code></li>
<li><p>不支持引用(循环引用)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var a = &#123;name:&apos;abc&apos;,age:18&#125;</span><br><span class="line">a.self = a;</span><br><span class="line">JSON.stringify(a)</span><br><span class="line"></span><br><span class="line">报错</span><br><span class="line">Converting circular structure to JSON</span><br><span class="line">    --&gt; starting at object with constructor &apos;Object&apos;</span><br><span class="line">    --- property &apos;self&apos; closes the circle</span><br><span class="line">    at JSON.stringify (&lt;anonymous&gt;)</span><br><span class="line">    at &lt;anonymous&gt;:3:6</span><br></pre></td></tr></table></figure>
</li>
<li><p>不支持 Date ,<code>JSON.stringify</code> 之后会是 Date的字符串形式</p>
</li>
<li>不支持正则表达式</li>
<li>不支持 Symbol</li>
</ul>
<h3 id="递归深拷贝"><a href="#递归深拷贝" class="headerlink" title="递归深拷贝"></a>递归深拷贝</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/26/Node-JS专精07手写深拷贝/" data-id="cklhjp20z008pulfysd26krt0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精05高阶函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/25/Node-JS专精05高阶函数/" class="article-date">
  <time datetime="2019-12-25T06:36:14.000Z" itemprop="datePublished">2019-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/25/Node-JS专精05高阶函数/">Node-JS专精05高阶函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>把函数作为参数或者返回值的函数</p>
<blockquote>
<h4 id="JS内置高阶函数"><a href="#JS内置高阶函数" class="headerlink" title="JS内置高阶函数"></a>JS内置高阶函数</h4></blockquote>
<ul>
<li><code>Function.prototype.bind</code></li>
<li><code>Function.prototype.apply</code></li>
<li><code>Function.prototype.call</code></li>
<li><code>Array.prototype.sort</code></li>
<li><code>Array.prototype.map</code></li>
<li><code>Array.prototype.filter</code></li>
<li><code>Array.prototype.reduce</code></li>
</ul>
<blockquote>
<p>bind</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">var bind = Function.prototype.bind</span><br><span class="line"></span><br><span class="line">const fn = function()&#123;</span><br><span class="line">    console.log(this)</span><br><span class="line">    console.log(arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var f1 = fn.bind(&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line"></span><br><span class="line">fn()</span><br><span class="line">// window</span><br><span class="line">// Arguments[]</span><br><span class="line"></span><br><span class="line">f1()</span><br><span class="line">// &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// Arguments伪数组[1,2,3]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 首先我们认同这句话</span><br><span class="line">// obj.method(a,b,c,d)  </span><br><span class="line">// 等价于 </span><br><span class="line">// obj.method.call(obj,a,b,c,d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 代入值</span><br><span class="line">// 设 obj = f1</span><br><span class="line">// 设 method = bind</span><br><span class="line"></span><br><span class="line">// 得到</span><br><span class="line">// f1.bind(a,b,c,d)</span><br><span class="line">// 等价于</span><br><span class="line">// f1.bind.call(f1,a,b,c,d)</span><br><span class="line"></span><br><span class="line">// 继续代入</span><br><span class="line">// 设 a = &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// 设 b,c,d = 1,2,3</span><br><span class="line">// f1.bind(&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line">// 等价于</span><br><span class="line">// f1.bind.call(f1,&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line"></span><br><span class="line">// f1.bind = Function.prototype.bind</span><br><span class="line">// var bind = Function.prototype.bind</span><br><span class="line">// 所以 f1.bind 就是 bind</span><br><span class="line"></span><br><span class="line">// 继续代入 f1.bind.call(f1,&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line">bind.call(f1,&#123;name:&apos;hjx&apos;&#125;,1,2,3) 这个式子就是结论</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 得到结论</span><br><span class="line">bind.call 接受 一个函数fn,this,其他参数</span><br><span class="line">返回一个新的函数，会调用 fn,并传入 this,和其他参数</span><br></pre></td></tr></table></figure>
<blockquote>
<p>apply</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">var apply = Function.prototype.apply</span><br><span class="line"></span><br><span class="line">const f1 = function()&#123;</span><br><span class="line">    console.log(this)</span><br><span class="line">    console.log(arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1.apply(&#123;name:&apos;hjx&apos;&#125;,[1,2,3]) // 直接调用</span><br><span class="line">// &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// Arguments伪数组[1,2,3]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 首先我们认同这句话</span><br><span class="line">// obj.method(a,b,c,d)  </span><br><span class="line">// 等价于 </span><br><span class="line">// obj.method.call(obj,a,b,c,d)</span><br><span class="line"></span><br><span class="line">// 设 obj =  f1</span><br><span class="line">// 设 method = apply</span><br><span class="line"></span><br><span class="line">// 代入</span><br><span class="line">// f1.apply(&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line">// 等价于</span><br><span class="line">// f1.apply.call(f1,&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line"></span><br><span class="line">// 继续代入</span><br><span class="line">// 设 a = &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// 设 b,c,d = 1,2,3</span><br><span class="line">// f1.apply(&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line">// 等价于</span><br><span class="line">// f1.apply.call(f1,&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line"></span><br><span class="line">// f1.apply = Function.prototype.apply</span><br><span class="line">// f1.apply = apply</span><br><span class="line"></span><br><span class="line">// 注意这里是直接调用，不会像 bind一样重新返回函数</span><br><span class="line">apply.call(f1,&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var call = Function.prototype.call</span><br><span class="line"></span><br><span class="line">const f1 = function()&#123;</span><br><span class="line">    console.log(this)</span><br><span class="line">    console.log(arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f1.call(&#123;name:&apos;hjx&apos;&#125;,1,2,3) // 直接调用</span><br><span class="line">// &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// Arguments伪数组[1,2,3]</span><br><span class="line"></span><br><span class="line">// 设 obj =  f1</span><br><span class="line">// 设 method = call</span><br><span class="line"></span><br><span class="line">// 代入</span><br><span class="line">// f1.call(&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line">// 等价于</span><br><span class="line">// f1.call.call(f1,&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br><span class="line"></span><br><span class="line">// 继续代入</span><br><span class="line">// 设 a = &#123;name:&apos;hjx&apos;&#125;</span><br><span class="line">// 设 b,c,d = 1,2,3</span><br><span class="line">// f1.call(&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line">// 等价于</span><br><span class="line">// f1.call.call(f1,&#123;name:&apos;hjx&apos;&#125;,[1,2,3])</span><br><span class="line"></span><br><span class="line">// f1.call = Function.prototype.call</span><br><span class="line">// f1.call = call</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// call的含义 也是直接调用 f1</span><br><span class="line">call.call(f1,&#123;name:&apos;hjx&apos;&#125;,1,2,3)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sort</p>
</blockquote>
<p>map ,filter , reduce同理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var array = [1,5,2,3,4]</span><br><span class="line">var sort = Array.property.sort</span><br><span class="line"></span><br><span class="line">array.sort((a,b)=&gt; b - a)</span><br><span class="line">array.sort.call(array,(a,b=&gt; b - a))</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4></blockquote>
<p>理解JS的 <code>call</code> 用法才能真正掌握JS</p>
<blockquote>
<p><a href="https://twitter.com/amejiarosario" target="_blank" rel="noopener">adrian Mejia twitter</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Reduce illustrated with Emojis:</span><br><span class="line"></span><br><span class="line">map([🌽, 🐮, 🥚,🐓, 🥔], cook)</span><br><span class="line">//=&gt; [🍿, 🍔, 🍳,🍗, 🍟]</span><br><span class="line"></span><br><span class="line">filter([🍿, 🍔, 🍳,🍗, 🍟], isVegetarian)</span><br><span class="line">//=&gt;  [🍿, 🍳, 🍟]</span><br><span class="line"></span><br><span class="line">reduce([🍿, 🍔, 🍳,🍗, 🍟], digest)</span><br><span class="line">//=&gt; 💩</span><br></pre></td></tr></table></figure>
<h4 id="函数的组合-用的比较少的"><a href="#函数的组合-用的比较少的" class="headerlink" title="函数的组合(用的比较少的)"></a>函数的组合(用的比较少的)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function doubleSay (str) &#123;</span><br><span class="line">    return str + &quot;, &quot; + str;</span><br><span class="line">&#125;</span><br><span class="line">function capitalize (str) &#123;</span><br><span class="line">    return str[0].toUpperCase() + str.substring(1);</span><br><span class="line">&#125;</span><br><span class="line">function exclaim (str) &#123;</span><br><span class="line">    return str + &apos;!&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let result = exclaim(capitalize(doubleSay(&quot;hello&quot;)));</span><br><span class="line">result //=&gt; &quot;Hello, hello!&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用Pipe操作</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let result = &quot;hello&quot;</span><br><span class="line">    |&gt; doubleSay</span><br><span class="line">    |&gt; capitalize</span><br><span class="line">    |&gt; exclaim;</span><br><span class="line"></span><br><span class="line">result //=&gt; &quot;Hello, hello!&quot;</span><br></pre></td></tr></table></figure>
<p>在不久的将来，这个语法就能用了。<br>如果你现在就想用，可以使用Ramda.js</p>
<ul>
<li><a href="https://codesandbox.io/s/quirky-black-frtjl" target="_blank" rel="noopener">https://codesandbox.io/s/quirky-black-frtjl</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 组合方法，除了第一个函数，后面的函数必须接受一个参数</span><br><span class="line">const say = R.compose(doubleSay, capitalize, exclaim);</span><br><span class="line">let result = say(&quot;hello&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="React高阶组件"><a href="#React高阶组件" class="headerlink" title="React高阶组件"></a>React高阶组件</h4><ul>
<li>示例代码</li>
<li><a href="https://codesandbox.io/s/quizzical-rgb-2nel7" target="_blank" rel="noopener">https://codesandbox.io/s/quizzical-rgb-2nel7</a></li>
</ul>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>children是个函数</li>
<li>children返回React个数</li>
<li>把需要暴露的API传给 children</li>
<li>其实就是个回调</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>搞清函数所有特点</li>
<li>理解递归</li>
<li>理解迭代</li>
<li>理解记忆化 memorize</li>
<li>理解柯里化 curry</li>
<li>组合函数</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/25/Node-JS专精05高阶函数/" data-id="cklhjp20x008kulfyskzimw4u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精06手写EventHub" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/Node-JS专精06手写EventHub/" class="article-date">
  <time datetime="2019-12-24T09:37:29.000Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/Node-JS专精06手写EventHub/">Node-JS专精06手写EventHub</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="EventHub"><a href="#EventHub" class="headerlink" title="EventHub"></a>EventHub</h3><ul>
<li><a href="https://github.com/slTrust/generate_hexoBlog/blob/master/source/_posts/React%E5%85%A5%E9%97%A8004%E4%B9%8BReact%E9%80%9A%E4%BF%A1eventHub.md" target="_blank" rel="noopener">参考之前总结的EventHub</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//订阅的事件</span><br><span class="line">var eventMap = &#123;</span><br><span class="line">    // 蒙牛:[&apos;张三&apos;,&apos;李四&apos;,&apos;王五&apos;],</span><br><span class="line">    // 光明:[&apos;熊大&apos;,&apos;光头强&apos;]</span><br><span class="line">&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 订阅——事件</span><br><span class="line">eventHub.on(&apos;我要用钱&apos;,function fn1(data)&#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 发布——事件</span><br><span class="line">eventHub.trigger(&apos;我要用钱&apos;,100)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>确定API</p>
</blockquote>
<ul>
<li>on</li>
<li>off</li>
<li>emit</li>
<li>如果可能还有 once</li>
</ul>
<blockquote>
<h4 id="环境配置先确保你有ts-node环境"><a href="#环境配置先确保你有ts-node环境" class="headerlink" title="环境配置先确保你有ts-node环境"></a>环境配置先确保你有ts-node环境</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn global add ts-node@8.3.0</span><br><span class="line">ts-node -v </span><br><span class="line"># 如果是 8.3.0 代表我们环境一致了</span><br></pre></td></tr></table></figure>
<p>新建 index.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const a = 1;</span><br><span class="line">console.log(a);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>你就可以运行 ts代码了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ts-node index.ts</span><br></pre></td></tr></table></figure>
<h4 id="TS版-EventHub"><a href="#TS版-EventHub" class="headerlink" title="TS版 EventHub"></a>TS版 EventHub</h4><blockquote>
<p>001-JS版</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class EventHub &#123;</span><br><span class="line">    cache = &#123;&#125;;</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(this.cache[eventName]=== undefined)&#123;</span><br><span class="line">            this.cache[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        const array = this.cache[eventName];</span><br><span class="line">        array.push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">    emit(eventName)&#123;</span><br><span class="line">        let array = this.cache[eventName];</span><br><span class="line">        if(array === undefined)&#123;</span><br><span class="line">            array = [];</span><br><span class="line">        &#125;</span><br><span class="line">        array.forEach(fn =&gt; fn());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>002-JS优化版,支持传递data</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class EventHub &#123;</span><br><span class="line">    cache = &#123;&#125;;</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        this.cache[eventName] = this.cache[eventName] || [];</span><br><span class="line">        this.cache[eventName].push(fn);</span><br><span class="line">    &#125;</span><br><span class="line">    emit(eventName,data?)&#123;</span><br><span class="line">        (this.cache[eventName] || []).forEach(fn =&gt; fn(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const eventHub  = new EventHub();</span><br><span class="line">// eventHub 是个对象</span><br><span class="line">console.assert(eventHub instanceof Object === true,&quot;eventHub 是个对象&quot;);</span><br><span class="line"></span><br><span class="line">// emit(&apos;xxx&apos;) 能被触发</span><br><span class="line">let called = false;</span><br><span class="line">eventHub.on(&apos;xxx&apos;,()=&gt;&#123;</span><br><span class="line">    called = true;</span><br><span class="line">    console.log(&quot;called:&quot; + called);</span><br><span class="line">&#125;)</span><br><span class="line">eventHub.emit(&apos;xxx&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 可以传递 abc</span><br><span class="line">eventHub.on(&apos;xxx2&apos;,(y)=&gt;&#123;</span><br><span class="line">    console.assert(y === &apos;abc&apos; === true,&quot;传递emit(&apos;xxx2&apos;,&apos;abc&apos;)&quot;)</span><br><span class="line">&#125;)</span><br><span class="line">eventHub.emit(&apos;xxx2&apos;,&apos;abc&apos;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>003-JS-可以off</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class EventHub &#123;</span><br><span class="line">    private cache = &#123;&#125;;</span><br><span class="line">    on(eventName, fn)&#123;</span><br><span class="line">        this.cache[eventName] = this.cache[eventName] || [];</span><br><span class="line">        this.cache[eventName].push(fn);</span><br><span class="line">    &#125;</span><br><span class="line">    emit(eventName, data?)&#123;</span><br><span class="line">        (this.cache[eventName] || []).forEach(fn =&gt; fn(data));</span><br><span class="line">    &#125;</span><br><span class="line">    off(eventName, fn) &#123;</span><br><span class="line">        let index = indexOf(this.cache[eventName], fn);</span><br><span class="line">        if (index === -1) return;</span><br><span class="line">        this.cache[eventName].splice(index, 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default EventHub;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 帮助函数 indexOf</span><br><span class="line"> * @param array</span><br><span class="line"> * @param item</span><br><span class="line"> */</span><br><span class="line">function indexOf(array, item) &#123;</span><br><span class="line">    if (array === undefined) return -1;</span><br><span class="line">  </span><br><span class="line">    let index = -1;</span><br><span class="line">    for (let i = 0; i &lt; array.length; i++) &#123;</span><br><span class="line">        if (array[i] === item) &#123;</span><br><span class="line">            index = i;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    const eventHub  = new EventHub();</span><br><span class="line">    let called = false;</span><br><span class="line">    const fn1 = (y)=&gt;&#123;</span><br><span class="line">        called = true;</span><br><span class="line">    &#125;;</span><br><span class="line">    eventHub.on(&apos;xxx&apos;,fn1)</span><br><span class="line">    eventHub.off(&apos;xxx&apos;,fn1);</span><br><span class="line">    eventHub.emit(&apos;xxx&apos;,&apos;aaa&apos;);</span><br><span class="line">    setTimeout(()=&gt;&#123;</span><br><span class="line">        console.log(called);</span><br><span class="line">    &#125;,1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>004-JS-完善测试代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import EventHub from &quot;../src/index&quot;;</span><br><span class="line"></span><br><span class="line">const test1 =  message =&gt; &#123;</span><br><span class="line">    const eventHub = new EventHub();</span><br><span class="line">    console.assert(eventHub instanceof Object === true,&quot;eventHub 是个对象&quot;);</span><br><span class="line">    console.log(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const test2 = message =&gt; &#123;</span><br><span class="line">    const eventHub = new EventHub();</span><br><span class="line">    let called = false;</span><br><span class="line">    eventHub.on(&apos;xxx&apos;,(y)=&gt;&#123;</span><br><span class="line">        called = true;</span><br><span class="line"></span><br><span class="line">        console.assert(y === &apos;abc&apos; === true,&quot;传递emit(&apos;xxx&apos;,&apos;abc&apos;)&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    eventHub.emit(&apos;xxx&apos;,&apos;abc&apos;);</span><br><span class="line">    console.assert(called);</span><br><span class="line">    console.log(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const test3 = message =&gt; &#123;</span><br><span class="line">    const eventHub  = new EventHub();</span><br><span class="line">    let called = false;</span><br><span class="line">    const fn1 = (y)=&gt;&#123;</span><br><span class="line">        called = true;</span><br><span class="line">    &#125;;</span><br><span class="line">    eventHub.on(&apos;yyy&apos;,fn1)</span><br><span class="line">    eventHub.off(&apos;yyy&apos;,fn1);</span><br><span class="line">    eventHub.emit(&apos;yyy&apos;);</span><br><span class="line">    console.assert(called === false);</span><br><span class="line">    console.log(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test1(&quot;EventHub 可以创建对象&quot;);</span><br><span class="line">test2(&quot;.on 了之后 .emit，会触发 .on 的函数&quot;);</span><br><span class="line">test3(&quot;.off 有用&quot;);</span><br></pre></td></tr></table></figure>
<h4 id="一些疑问"><a href="#一些疑问" class="headerlink" title="一些疑问"></a>一些疑问</h4><ul>
<li><code>emit(&#39;xxx&#39;,data)</code> 能不能传递两个数据？<ul>
<li>面试容易问，你这个只能传一个参数，我想要两个怎么办？</li>
<li>传一个数组不就好了</li>
<li>这个没有规范的。面试技巧就是<strong>留一个坑给Ta踩</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const eventHub = new EventHub();</span><br><span class="line">let called = false;</span><br><span class="line">eventHub.on(&quot;xxx&quot;, y =&gt; &#123;</span><br><span class="line">    called = true;</span><br><span class="line">    console.assert(y[0] === &quot;今天林志玲结婚了&quot;);</span><br><span class="line">    console.assert(y[1] === &quot;言承旭无话可说&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">eventHub.emit(&quot;xxx&quot;, [&quot;今天林志玲结婚了&quot;, &quot;言承旭无话可说&quot;]);</span><br><span class="line">console.assert(called);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a>代码仓库</h3><ul>
<li><a href="https://github.com/slTrust/source-eventhub" target="_blank" rel="noopener">https://github.com/slTrust/source-eventhub</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/Node-JS专精06手写EventHub/" data-id="cklhjp20y008mulfygmtwsyvp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精04柯里化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/Node-JS专精04柯里化/" class="article-date">
  <time datetime="2019-12-24T04:34:43.000Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/Node-JS专精04柯里化/">Node-JS专精04柯里化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="柯里化-Currying"><a href="#柯里化-Currying" class="headerlink" title="柯里化 Currying"></a>柯里化 Currying</h3><p>让所有函数只接受一个参数</p>
<blockquote>
<p>单一参数的意义？</p>
</blockquote>
<p>基于单一参数，已经衍生出非常多的理论知识，如<code>λ</code>演算</p>
<blockquote>
<p>那么如何支持两个参数？</p>
</blockquote>
<p>用对象接受？</p>
<p>并不是，而是用闭包</p>
<p>还记得吗：对象是穷人的闭包</p>
<blockquote>
<p>单参数函数接受两个参数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 这是用对象形式</span><br><span class="line">const add = (&#123;a,b&#125;)=&gt; a + b</span><br><span class="line">add(&#123;a:1,b:2&#125;)</span><br><span class="line"></span><br><span class="line">// add接受一个数字，返回一个函数</span><br><span class="line">const add = a =&gt; b =&gt; a + b</span><br><span class="line">add(1)(2) </span><br><span class="line">/*</span><br><span class="line">// 等价形式</span><br><span class="line">const add = function(a)&#123;</span><br><span class="line">    return function(b)&#123;</span><br><span class="line">        return a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">感觉有点不方便是不是</span><br><span class="line"></span><br><span class="line">没错，如果你没接受函数式的一整套理论，你就没必要使用柯里化。</span><br></pre></td></tr></table></figure>
<h4 id="柯里化一个函数"><a href="#柯里化一个函数" class="headerlink" title="柯里化一个函数"></a>柯里化一个函数</h4><p>把多个参数函数，变成单参数函数</p>
<blockquote>
<h4 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h4></blockquote>
<p>如何把三参数函数 add(1,2,3) 变成 <code>curriedAdd(1)(2)(3)</code>形式？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const curriedArr =</span><br><span class="line">    a =&gt;</span><br><span class="line">        b =&gt;</span><br><span class="line">            c =&gt;</span><br><span class="line">                add(a,b,c)</span><br><span class="line">// 完毕</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="面试题升级"><a href="#面试题升级" class="headerlink" title="面试题升级"></a>面试题升级</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">假设</span><br><span class="line">addTwo 接受2个参数</span><br><span class="line">addThree 接受3个参数</span><br><span class="line">addFore 接受4个参数</span><br><span class="line">请写出一个 currify函数，使他分别接受 2 3 4 次参数，比如</span><br><span class="line">currify(addTwo)(1)(2) // 3</span><br><span class="line">currify(addThree)(1)(2)(3) // 6</span><br><span class="line">currify(addFore)(1)(2)(3)(4) // 10</span><br><span class="line">也就是说，currify 能将任意接受固定个参数的函数，变成单一参数的函数</span><br></pre></td></tr></table></figure>
<p>答案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">addTwo = (a,b)=&gt;a+b</span><br><span class="line">currify = (fn,params = [])=&gt;&#123;</span><br><span class="line">    return (arg)=&gt;&#123;</span><br><span class="line">        params.push(arg)</span><br><span class="line">        if(params.length === fn.length)&#123;</span><br><span class="line">            return fn(...params)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return currify(fn,params)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">newAddTwo = currify(addTwo)</span><br><span class="line">newAddTwo(1)(2) // 打印 3</span><br></pre></td></tr></table></figure>
<p>代码是有问题的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 如果这样就报错 </span><br><span class="line">console.log(newAddTwo(1))</span><br><span class="line">console.log(newAddTwo(1)(2))</span><br><span class="line"></span><br><span class="line">原因是 params 是外面传递进来，会不会导致感染？</span><br></pre></td></tr></table></figure>
<blockquote>
<p>改进</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">addTwo = (a,b)=&gt;a+b</span><br><span class="line">currify = (fn,params = [])=&gt;&#123;</span><br><span class="line">    return (arg)=&gt;&#123;</span><br><span class="line">        const newParams = params.concat(arg)</span><br><span class="line">        if(newParams.length === fn.length)&#123;</span><br><span class="line">            return fn(...newParams)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return currify(fn,newParams)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">newAddTwo = currify(addTwo)</span><br><span class="line">newAddTwo(1)(2) // 打印 3  </span><br><span class="line">console.log(newAddTwo(1)) // 打印是一个函数</span><br><span class="line">console.log(newAddTwo(1)(2)) // 打印3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次优化</p>
</blockquote>
<ul>
<li>它支持一次绑定两个参数<ul>
<li><code>newAddThree(1)(2)(3) 可以这样 newAddThree(1)(2,3)</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">currify = (fn, params = [])=&gt;</span><br><span class="line">    (...args) =&gt;</span><br><span class="line">        params.length + args.length === fn.length</span><br><span class="line">                ? fn(...params, ...args)</span><br><span class="line">                : currify(fn, [...params, ...args])</span><br><span class="line"></span><br><span class="line">addTwo = (a, b)=&gt;a + b</span><br><span class="line">addThree = (a, b, c)=&gt;a + b + c</span><br><span class="line">newAddTwo = currify(addTwo)</span><br><span class="line">newAddThree = currify(addThree)</span><br><span class="line">newAddTwo(1)(2)</span><br><span class="line">newAddThree(1)(2)(3)</span><br><span class="line">newAddThree(1)(2,3)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/Node-JS专精04柯里化/" data-id="cklhjp20w008hulfy7dy74wop" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精03递归记忆化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/23/Node-JS专精03递归记忆化/" class="article-date">
  <time datetime="2019-12-23T14:33:31.000Z" itemprop="datePublished">2019-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/23/Node-JS专精03递归记忆化/">Node-JS专精03递归记忆化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><h4 id="阶乘"><a href="#阶乘" class="headerlink" title="阶乘"></a>阶乘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const j = (n) =&gt; </span><br><span class="line">                n === 1 ? 1 </span><br><span class="line">                        : n * j(n - 1)</span><br><span class="line"></span><br><span class="line">j(4)</span><br><span class="line">= 4 * j(3)</span><br><span class="line">= 4 * ( 3 * j(2))</span><br><span class="line">= 4 * ( 3 * 2 * j(1))</span><br><span class="line">= 4 * ( 3 * 2 * 1)</span><br><span class="line">= 4 * ( 3 * 2 )</span><br><span class="line">= 4 * 6</span><br><span class="line">= 24</span><br></pre></td></tr></table></figure>
<h4 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const fib = (n) =&gt;</span><br><span class="line">            n === 0 ? 0 :</span><br><span class="line">            n === 1 ? 1 :</span><br><span class="line">            fib(n - 1) + fib(n - 2)</span><br></pre></td></tr></table></figure>
<h4 id="递归的过程"><a href="#递归的过程" class="headerlink" title="递归的过程"></a>递归的过程</h4><ul>
<li>压栈 <ul>
<li>弹匣压入子弹</li>
</ul>
</li>
<li>出栈  <ul>
<li>从弹匣(栈顶)拿出子弹</li>
</ul>
</li>
</ul>
<blockquote>
<p>而上面的几个例子利用的就是方法栈</p>
</blockquote>
<p>调用栈用来记忆“回到那”</p>
<ul>
<li>如果记忆过多，就会爆栈</li>
</ul>
<h4 id="如果降低压栈次数"><a href="#如果降低压栈次数" class="headerlink" title="如果降低压栈次数"></a>如果降低压栈次数</h4><ul>
<li>尾递归优化 (使用迭代代替递归)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">f = (n) =&gt; f_inner(2,n,1,0)</span><br><span class="line"></span><br><span class="line">f_inner = (start, end, prev1, prev2) =&gt; </span><br><span class="line">    start === end ? prev1 + prev2</span><br><span class="line">        : f_inner(start + 1, end , prev1 + prev2, prev1)</span><br><span class="line">// 这就是尾递归</span><br><span class="line"></span><br><span class="line">// 还可以写成循环</span><br><span class="line">f = (n) =&gt;&#123;</span><br><span class="line">    let array = [0,1]</span><br><span class="line">    for(let i=0;i&lt; n - 2;i++)&#123;</span><br><span class="line">        array[i+2] = array[i+1] + array[i]</span><br><span class="line">    &#125;</span><br><span class="line">    return array[array.length - 1]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>记忆化函数</li>
</ul>
<h3 id="记忆化"><a href="#记忆化" class="headerlink" title="记忆化"></a>记忆化</h3><p><strong>可以大量减少重复计算</strong></p>
<blockquote>
<p>Lodash 实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">_.memoize = function(func, hasher) &#123;</span><br><span class="line">    var memoize = function(key) &#123;</span><br><span class="line">      var cache = memoize.cache;</span><br><span class="line">      var address = &apos;&apos; + (hasher ? hasher.apply(this, arguments) : key)</span><br><span class="line">      if (!has(cache, address))</span><br><span class="line">          cache[address] = func.apply(this, arguments)</span><br><span class="line">          return cache[address];</span><br><span class="line">    &#125;;</span><br><span class="line">    memoize.cache = &#123;&#125;;</span><br><span class="line">    return memoize;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="React记忆化"><a href="#React记忆化" class="headerlink" title="React记忆化"></a>React记忆化</h4><ul>
<li><a href="https://codesandbox.io/s/gallant-poitras-nvv63" target="_blank" rel="noopener">https://codesandbox.io/s/gallant-poitras-nvv63</a></li>
<li><a href="https://codesandbox.io/s/thirsty-edison-3fns7" target="_blank" rel="noopener">https://codesandbox.io/s/thirsty-edison-3fns7</a></li>
</ul>
<blockquote>
<p>React.memo 减少计算</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  const [n, setN] = React.useState(0);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onClick&#125;&gt;update &#123;n&#125;&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">      &lt;Child2 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child() &#123;</span><br><span class="line">  console.log(&quot;child 执行了&quot;);</span><br><span class="line">  return &lt;div&gt;Child&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child_2() &#123;</span><br><span class="line">  console.log(&quot;child2 执行了&quot;);</span><br><span class="line">  return &lt;div&gt;Child2&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Child2 = React.memo(Child_2);</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<p>解析</p>
<ul>
<li>如果你用函数式组件，那么每次setN 都会导致执行 <code>Child()</code> 里的打印<ul>
<li>如果 <code>Child()</code> 里有定义变量，那么也会重新执行，非常浪费</li>
</ul>
</li>
<li>优化就是使用 <code>React.memo减少计算</code> 记忆化组件(把结果缓存起来)</li>
</ul>
<blockquote>
<h4 id="一个新的问题每次-onclick都会重新创建"><a href="#一个新的问题每次-onclick都会重新创建" class="headerlink" title="一个新的问题每次 onclick都会重新创建"></a>一个新的问题每次 onclick都会重新创建</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const onClickChild = React.useCallback(() =&gt; &#123;</span><br><span class="line">    console.log(m);</span><br><span class="line">&#125;, [m]); </span><br><span class="line">// 第一个参数是 执行的函数</span><br><span class="line">// 第二个参数是 它依赖于什么 如果 m 变了 则它重新执行</span><br><span class="line"></span><br><span class="line">只要 m 不变 onClickChild 就不会重新执行</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/beautiful-sanderson-92ve6" target="_blank" rel="noopener">https://codesandbox.io/s/beautiful-sanderson-92ve6</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/23/Node-JS专精03递归记忆化/" data-id="cklhjp20w008fulfyyazihnr3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精01函数与闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/Node-JS专精01函数与闭包/" class="article-date">
  <time datetime="2019-12-19T15:05:45.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/Node-JS专精01函数与闭包/">Node-JS专精01函数与闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="函数是什么？"><a href="#函数是什么？" class="headerlink" title="函数是什么？"></a>函数是什么？</h3><ul>
<li>最开始程序员写的大部分是汇编，后来有了 C / C++ 那时候没有函数，只有<strong>子程序</strong><ul>
<li>比如有四行代码完成特定的功能</li>
<li>给这四行代码起了一个名字 叫做函数</li>
<li>但是那个时候不叫 <strong>函数</strong>而叫 <strong>子程序</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>子程序</p>
</blockquote>
<ul>
<li>一个或多个语句组成</li>
<li>完成特定功能</li>
<li>功能相对独立</li>
</ul>
<blockquote>
<p>子程序又分三种</p>
</blockquote>
<ul>
<li>函数(有返回值) function</li>
<li>过程(无返回值) procedure</li>
<li>方法 (类或对象中) method </li>
</ul>
<blockquote>
<h4 id="JS-里只有函数和方法"><a href="#JS-里只有函数和方法" class="headerlink" title="JS 里只有函数和方法"></a>JS 里只有函数和方法</h4></blockquote>
<p>因为JS的所有函数都有返回值，你不写return 但是返回值是 undefined</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 函数</span><br><span class="line">function fn()&#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">const a = fn() // undefined</span><br><span class="line"></span><br><span class="line">// 方法</span><br><span class="line">var obe = &#123;</span><br><span class="line">    fn:fn //方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="数学领域里的函数"><a href="#数学领域里的函数" class="headerlink" title="数学领域里的函数"></a>数学领域里的函数</h4><ul>
<li>数学中的函数<ul>
<li>两个集合之间的对应关系 如<code>y = f(x)</code> 比如方程式 <code>y = a*x + b</code><ul>
<li>X 叫做 定义域 Y 叫做 值域</li>
</ul>
</li>
<li>定义域里的每个元素都对应一项 值域中的元素</li>
</ul>
</li>
<li><code>f()</code>在数学领域是不合法的，因为没有输入</li>
<li>函数式编程<ul>
<li>如果你的函数符合数学函数的定义，就是 <strong>函数式</strong>的</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如 f(x) = 3 * x +2</span><br><span class="line">y = f(x)</span><br><span class="line"></span><br><span class="line">x = 1 时 y = 5</span><br><span class="line">x = 2 时 y = 8</span><br></pre></td></tr></table></figure>
<h4 id="但是-JS的函数不是数学函数"><a href="#但是-JS的函数不是数学函数" class="headerlink" title="但是 JS的函数不是数学函数"></a>但是 JS的函数不是数学函数</h4><p>最大的区别就是，你给我一个值我可能给你返回不同的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a = 0</span><br><span class="line">function add()&#123;</span><br><span class="line">	a += 1</span><br><span class="line">	return a</span><br><span class="line">&#125;</span><br><span class="line">add() // 1</span><br><span class="line">add() // 2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们平时用的是哪个函数?</p>
</blockquote>
<p>是编程里的子程序，还是数学里的函数？</p>
<ul>
<li>答案是 子程序</li>
</ul>
<h3 id="函数的返回值由什么确定？"><a href="#函数的返回值由什么确定？" class="headerlink" title="函数的返回值由什么确定？"></a>函数的返回值由什么确定？</h3><h4 id="影响因素"><a href="#影响因素" class="headerlink" title="影响因素"></a>影响因素</h4><ul>
<li>调用时输入的参数 params</li>
<li>定义时的环境 env</li>
</ul>
<blockquote>
<h4 id="这个例子说明-a-是定义时的-a-，而不是执行时的-a"><a href="#这个例子说明-a-是定义时的-a-，而不是执行时的-a" class="headerlink" title="这个例子说明 a 是定义时的 a ，而不是执行时的 a"></a>这个例子说明 a 是定义时的 a ，而不是执行时的 a</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let x = &apos;x&apos;</span><br><span class="line">let a = &apos;1&apos;</span><br><span class="line">function f1(x)&#123;</span><br><span class="line">    return x + a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    let a = &apos;2&apos;</span><br><span class="line">    f1(&apos;x&apos;) // 值是多少？</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 答案是 &apos;x1&apos;</span><br></pre></td></tr></table></figure>
<p><strong>为什么不是 ‘x2’?</strong></p>
<ul>
<li>x 很好理解是 参数 所以 <code>f1(&#39;x&#39;)</code> 时<code>x = &#39;x&#39;</code> </li>
<li>a 在这里不是参数 ，它是环境，它由 f1 所处的环境确定的<ul>
<li>如果你是参数 则在调用时 确定</li>
<li>如果你是环境 则在 定义时确定</li>
</ul>
</li>
</ul>
<p>再看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let x = &apos;x&apos;</span><br><span class="line">let a = &apos;1&apos;</span><br><span class="line">function f1(x)&#123;</span><br><span class="line">    return x + a</span><br><span class="line">&#125;</span><br><span class="line">a = &apos;3&apos;</span><br><span class="line">&#123;</span><br><span class="line">    let a = &apos;2&apos;</span><br><span class="line">    f1(&apos;x&apos;) // 值是多少？</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 答案是  &apos;x3&apos;</span><br></pre></td></tr></table></figure>
<p>再看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let x = &apos;x&apos;</span><br><span class="line">let a = &apos;1&apos;</span><br><span class="line">function f1(x)&#123;</span><br><span class="line">    return x + a</span><br><span class="line">&#125;</span><br><span class="line">a = &apos;3&apos;</span><br><span class="line">&#123;</span><br><span class="line">    let a = &apos;2&apos;</span><br><span class="line">    f1(&apos;x&apos;) // 值是多少？</span><br><span class="line">&#125;</span><br><span class="line">a = &apos;4&apos;</span><br><span class="line"></span><br><span class="line">// 答案是  &apos;x3&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="另一个例子"><a href="#另一个例子" class="headerlink" title="另一个例子"></a>另一个例子</h5></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let x = &apos;x&apos;</span><br><span class="line">let a = &apos;1&apos;</span><br><span class="line">function f1(c)&#123;</span><br><span class="line">    c()</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    let a = &apos;2&apos;</span><br><span class="line">    function f2()&#123;</span><br><span class="line">        console.log(x + a)</span><br><span class="line">    &#125;</span><br><span class="line">    f1(f2) // 打印什么？</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 打印  &apos;x2&apos; </span><br><span class="line">// 因为 x 和 a 都不是参数，所以只能看定义的地方，从内向外依次找</span><br><span class="line">// 这个例子说明 a 是定义时的a ,而不是执行的 a</span><br></pre></td></tr></table></figure>
<p><strong>这个就是闭包，函数里面可以访问外面的变量</strong></p>
<p><strong>但并不是一定的，Ruby就不允许</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ruby 代码</span><br><span class="line">def f1</span><br><span class="line">    a = 1 # 局部变量</span><br><span class="line">    def f2</span><br><span class="line">        print a # 打印 a</span><br><span class="line">    end</span><br><span class="line">    f2()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line"># 报错： NameError(undefined local variable or method &apos;a&apos; for main: Object)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你就要在 ruby里访问局部变量，需要使用 lambda</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def f1</span><br><span class="line">    a = 1 # 局部变量</span><br><span class="line">    f2 = lambda &#123;print a&#125;  # 使用 lambda</span><br><span class="line">    f2.call()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">f1()</span><br><span class="line"># 成功 打印 1</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4></blockquote>
<p>函数里面可以访问外面的变量，那么<code>这个函数 + 这些变量 = 闭包</code></p>
<h4 id="闭包-时间"><a href="#闭包-时间" class="headerlink" title="闭包 + 时间"></a>闭包 + 时间</h4><h5 id="常见的考题"><a href="#常见的考题" class="headerlink" title="常见的考题"></a>常见的考题</h5><blockquote>
<h4 id="请问打印什么？"><a href="#请问打印什么？" class="headerlink" title="请问打印什么？"></a>请问打印什么？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">for(var i=0;i&lt;6;i++)&#123;</span><br><span class="line">    setTimeout(</span><br><span class="line">        ()=&gt;console.log(i) //</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 打印 6个 6</span><br><span class="line">// 因为六个函数共用了一个 i</span><br><span class="line">// 这其实就是闭包</span><br><span class="line"></span><br><span class="line">// setTimeout 是在 for循环之后执行的，所以循环已经结束了 那时 i = 6</span><br><span class="line"></span><br><span class="line">// 如果你不理解它，那就回想一个成语 “刻舟求剑”</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="如何打印成-0-1-2-3-4-5呢？"><a href="#如何打印成-0-1-2-3-4-5呢？" class="headerlink" title="如何打印成 0 1 2 3 4 5呢？"></a>如何打印成 <code>0 1 2 3 4 5</code>呢？</h4></blockquote>
<ul>
<li>改用 <code>let</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for(let i=0;i&lt;6;i++)&#123;</span><br><span class="line">    setTimeout(</span><br><span class="line">        ()=&gt;console.log(i) </span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 打印 0 1 2 3 4 5</span><br><span class="line"></span><br><span class="line">// let 的魔法：每次循环会把这个值复制一份， 然后把 这个值 分给这个闭包用</span><br></pre></td></tr></table></figure>
<ul>
<li>立即执行函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">// 立即执行函数</span><br><span class="line">(function(i)&#123;</span><br><span class="line">    console.log(i)</span><br><span class="line">&#125;)(x)</span><br><span class="line"></span><br><span class="line">// 立即执行函数</span><br><span class="line">!function(j)&#123;</span><br><span class="line">    console.log(j)</span><br><span class="line">&#125;(i)</span><br><span class="line">*/</span><br><span class="line">for(var i=0;i&lt;6;i++)&#123;</span><br><span class="line">    (function(x)&#123;</span><br><span class="line">        setTimeout(</span><br><span class="line">            ()=&gt;console.log(x) </span><br><span class="line">        )   </span><br><span class="line">    &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为什么？</p>
</blockquote>
<ul>
<li>用 var 声明的时候 用的都是 一个 i，每个闭包用的同一个 i</li>
<li>用了 let 后，每个闭包分配一个新的 i </li>
</ul>
<h5 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h5><blockquote>
<p>闭包的特点</p>
</blockquote>
<ul>
<li>能让一个函数维持住一个变量</li>
<li>但不能维持这个变量的值</li>
<li>尤其是变量的值会变化的时候</li>
</ul>
<blockquote>
<p>对象是穷人的闭包</p>
</blockquote>
<ul>
<li>对象也可以来维持一个变量</li>
<li>如果一门语言不支持闭包，你可以用对象代理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">    i:0,</span><br><span class="line">    fn()&#123;</span><br><span class="line">        console.log(this.i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const handle = function()&#123;</span><br><span class="line">    var i = 0;</span><br><span class="line">    return function()&#123;</span><br><span class="line">        console.log(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>闭包是穷人的对象</p>
</blockquote>
<ul>
<li>如果一门语言不支持对象，你可以用闭包代理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// person 有 name age 属性</span><br><span class="line"></span><br><span class="line">function createPerson(age,name)&#123;</span><br><span class="line">    return function(key)&#123;</span><br><span class="line">        if(key === &apos;name&apos;) return name;</span><br><span class="line">        if(key === &apos;age&apos;) return age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var person = createPerson(18,&apos;hjx&apos;);</span><br><span class="line">person(&apos;name&apos;) // &apos;hjx&apos;</span><br><span class="line">person(&apos;age&apos;) // 18</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/Node-JS专精01函数与闭包/" data-id="cklhjp20u008aulfyvkvvno1e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Node-JS专精02this变态面试题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/Node-JS专精02this变态面试题/" class="article-date">
  <time datetime="2019-12-19T15:05:45.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/Node-JS专精02this变态面试题/">Node-JS专精02this变态面试题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="回顾基础知识，JS如何声明函数"><a href="#回顾基础知识，JS如何声明函数" class="headerlink" title="回顾基础知识，JS如何声明函数"></a>回顾基础知识，JS如何声明函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const f1 = new Function(&apos;x&apos;,&apos;y&apos;,&apos;return x + y&apos;)</span><br><span class="line"></span><br><span class="line">function f2(x,y)&#123;return x + y&#125;</span><br><span class="line"></span><br><span class="line">const f3 = function(x,y)&#123;return x + y&#125;</span><br><span class="line"></span><br><span class="line">const f4 = (x, y)=&gt; x + y</span><br></pre></td></tr></table></figure>
<p>其中，<code>f1,f2,f3</code> 是ES6之前的语法，<strong>支持 <code>this,arguments,new</code></strong><br>而 <code>f4</code> 是 ES6语法，<strong>不支持 <code>this,arguments,new</code></strong></p>
<blockquote>
<p>你可以去 浏览器控制台里试试</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const f2 = ()=&gt;console.log(this)</span><br><span class="line">f2() // window</span><br><span class="line"></span><br><span class="line">f2.call(&#123;name:&apos;hjx&apos;&#125;)  // 还是 window</span><br></pre></td></tr></table></figure>
<h4 id="箭头函数不支持this"><a href="#箭头函数不支持this" class="headerlink" title="箭头函数不支持this"></a>箭头函数不支持this</h4><blockquote>
<p>箭头函数如何处理 a ,就如何处理 this</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const a = 233</span><br><span class="line">const f2 = ()=&gt;console.log(a)</span><br><span class="line">f2() //</span><br><span class="line"></span><br><span class="line">console.log(this) </span><br><span class="line">const f2 = ()=&gt;console.log(this)</span><br></pre></td></tr></table></figure>
<p>箭头函数把 this 当作外部的变量，仅此而已，但是非箭头函数的 this 有很多<strong>特殊处理</strong></p>
<p>箭头函数不支持this 指的就是<strong>尖头函数对 this 和其他变量一视同仁，不会特殊对待</strong></p>
<h4 id="非箭头函数的this"><a href="#非箭头函数的this" class="headerlink" title="非箭头函数的this"></a>非箭头函数的this</h4><blockquote>
<p>网传死记方法</p>
</blockquote>
<ul>
<li>this是上下文</li>
<li>全局环境执行时候,this是全局对象</li>
<li>调用对象方法时，this是该对象</li>
<li>函数里调用函数时，this是全局对象</li>
<li>箭头函数的this，不看调用，看定义(静态作用域)</li>
<li>还有人说箭头函数里的 this 指向外面的this</li>
<li>用new调用函数时，this是新增对象</li>
<li>可以用<code>call/apply/bind</code>指定this</li>
</ul>
<blockquote>
<p>记忆力好可以这样记</p>
</blockquote>
<ul>
<li>我记不住</li>
</ul>
<h4 id="那么this是参数还是环境？"><a href="#那么this是参数还是环境？" class="headerlink" title="那么this是参数还是环境？"></a>那么this是参数还是环境？</h4><ul>
<li>答案：this是参数，只有箭头函数 this是环境</li>
</ul>
<h4 id="如何确定this"><a href="#如何确定this" class="headerlink" title="如何确定this"></a>如何确定this</h4><blockquote>
<p>显式this</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn.call(asThis,1,2)</span><br><span class="line">fn.bind(asThis,1,2)()</span><br><span class="line">obj.method.call(obj,&apos;hi&apos;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>隐式this</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn(1,2)</span><br><span class="line">// fn.call(undefined,1,2)</span><br><span class="line"></span><br><span class="line">obj.method(&apos;hi&apos;)</span><br><span class="line">// obj.method.call(obj,&apos;hi&apos;)</span><br><span class="line"></span><br><span class="line">array[0](&apos;hi&apos;)</span><br><span class="line">// array[0].call(array,&apos;hi&apos;)</span><br></pre></td></tr></table></figure>
<p><strong>为什么你很难确定this,因为你总是让js帮你选this</strong></p>
<p><strong>所以你应该自己指定this</strong></p>
<h4 id="测试一下"><a href="#测试一下" class="headerlink" title="测试一下"></a>测试一下</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">button.onclick = function(e)&#123;</span><br><span class="line">    console.log(this)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// this 是参数， 答 button 是错的</span><br></pre></td></tr></table></figure>
<p>答案是：<strong>不知道,要看怎么调用</strong></p>
<p>因为你没看到call,没指定this,所以没法确定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">button.onclick = function(e)&#123;</span><br><span class="line">    console.log(this)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 当你手点的时候 是 button</span><br><span class="line"></span><br><span class="line">// 如果js调用呢?</span><br><span class="line">button.click()</span><br><span class="line"></span><br><span class="line">// 而如果这样，就不是button</span><br><span class="line">var fn = button.onclick</span><br><span class="line">fn() // 打印的是 window</span><br><span class="line">fn.call(&#123;name:&apos;hjx&apos;&#125;) // &#123;name:&apos;hjx&apos;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>标准答案</p>
</blockquote>
<p>这个this的值无法确定，我们要看this是如何调用的，如果是用户点击按钮的时候浏览器调用的，那么浏览器一定会把button作为this传递进来，<br>如果是通过其他方式调用的，那么就要看它是如何调用的如以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var fn = button.onclick</span><br><span class="line">fn()</span><br></pre></td></tr></table></figure>
<p>由于fn没指定this所以相当于 fn.call(undefined) 那么浏览器就会把这个this变成全局对象 window</p>
<blockquote>
<p>再来一个题</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const vm = new Vue(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        msg:&apos;hi&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        sayHi()&#123;</span><br><span class="line">            console.log(this.msg) // this是什么</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">答案依然是 不知道</span><br><span class="line">如果你是在 vue正常情况下调用 这个this 就是 vm</span><br><span class="line">但如果你是把 vm.sayHi放在其他地方调用就要看你调用的时候怎么传递参数</span><br><span class="line">根据传参的形式不同，我才能确定this是什么</span><br><span class="line">所以this是一个参数，只有在调用的时候唯一的确定</span><br></pre></td></tr></table></figure>
<h4 id="真实面试题"><a href="#真实面试题" class="headerlink" title="真实面试题"></a>真实面试题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let length = 10</span><br><span class="line">function fn()&#123; console.log(this.length) &#125;</span><br><span class="line"></span><br><span class="line">let obj = &#123;</span><br><span class="line">    length:5,</span><br><span class="line">    method(fn)&#123;</span><br><span class="line">        fn()</span><br><span class="line">        arguments[0]()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.method(fn,1) // 输出什么，有陷阱</span><br></pre></td></tr></table></figure>
<p>你可以拷贝代码到浏览器里试一下</p>
<blockquote>
<p>分析以下，先把 <code>fn()</code>改写</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let length = 10</span><br><span class="line">function fn()&#123; console.log(this.length) &#125;</span><br><span class="line"></span><br><span class="line">let obj = &#123;</span><br><span class="line">    length:5,</span><br><span class="line">    method(fn)&#123;</span><br><span class="line">        // fn()</span><br><span class="line">        fn.call(undefined) // 所以此时 this 实际是 window</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj.method(fn,1) </span><br><span class="line">//所以打印的是 window.length</span><br><span class="line">// 然而 let length 是不是 window 的 length?</span><br><span class="line">// 答案是 没关系</span><br><span class="line">// window.length 是什么？</span><br><span class="line"></span><br><span class="line">window.length 默认指的是 当前页面有多少个窗口或者说多少个 iframe</span><br><span class="line">// 你说这题是不是非常坑</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再来分析<code>arguments[0]()</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 改写 arguments[0]()</span><br><span class="line">// 实际就变成了这样 arguments.0.call(arguments)</span><br><span class="line">let length = 10</span><br><span class="line">function fn()&#123; console.log(this.length) &#125;</span><br><span class="line"></span><br><span class="line">let obj = &#123;</span><br><span class="line">    length:5,</span><br><span class="line">    method(fn)&#123;</span><br><span class="line">        fn()</span><br><span class="line">        arguments[0]()</span><br><span class="line">        // arguments.0.call(arguments)</span><br><span class="line">        // 所以此时 this是 arguments</span><br><span class="line">        // arguments.length 是什么？</span><br><span class="line">        // 是形参的长度还是，实参的长度</span><br><span class="line">        // 答案是 arguments.length 是 实参的长度</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.method(fn,1)</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>首先碰到这些this问题，一定要改写，你不改写就是坑自己</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn(1,2)</span><br><span class="line">// fn.call(undefined,1,2)</span><br><span class="line"></span><br><span class="line">obj.method(&apos;hi&apos;)</span><br><span class="line">// obj.method.call(obj,&apos;hi&apos;)</span><br><span class="line"></span><br><span class="line">array[0](&apos;hi&apos;)</span><br><span class="line">// array[0].call(array,&apos;hi&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>this 是 call 的第一个参数</p>
</li>
<li>new 重新设计了 this/箭头函数不接受 this <ul>
<li><a href="https://zhuanlan.zhihu.com/p/23987456" target="_blank" rel="noopener">参考链接</a></li>
</ul>
</li>
<li>函数的返回值由参数和环境确定</li>
<li>this是参数，arguments也是参数</li>
<li>全局变量和自由变量是环境</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/Node-JS专精02this变态面试题/" data-id="cklhjp20v008culfytklc9ci1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node后端/">Node后端</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-044-01自动化测试" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/ZB-044-01自动化测试/" class="article-date">
  <time datetime="2019-12-13T04:03:27.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/ZB-044-01自动化测试/">ZB-044-01自动化测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="自动化测试"><a href="#自动化测试" class="headerlink" title="自动化测试"></a>自动化测试</h1><h3 id="为什么需要⾃动化测试"><a href="#为什么需要⾃动化测试" class="headerlink" title="为什么需要⾃动化测试"></a>为什么需要⾃动化测试</h3><ul>
<li>你在接⼿⼀份前⼈留下来的代码的时候，你更喜欢：<ul>
<li>⼀份具有完善的⾃动化测试的代码，改完了跑⼀下⾃动化测试</li>
<li>⼀份没有测试覆盖的代码，改完了听天由命</li>
</ul>
</li>
</ul>
<h3 id="什么是⾃动化测试"><a href="#什么是⾃动化测试" class="headerlink" title="什么是⾃动化测试"></a>什么是⾃动化测试</h3><ul>
<li>⼀段程序代码<ul>
<li>不提供具体的程序功能，只保证主要程序功能符合预期<ul>
<li>代码界的炊事班？</li>
</ul>
</li>
<li>编写需要（很⾼的）成本<ul>
<li>短时期看不到收益(项目就运行几个月)</li>
<li>长远看来收益很大(项目运行几年)<ul>
<li><a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener">https://github.com/alibaba/fastjson</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>由机器负责的代码质量检查</li>
<li>我们来看看著名的开源项⽬中的⾃动化测试</li>
</ul>
<h3 id="为什么需要⾃动化测试-1"><a href="#为什么需要⾃动化测试-1" class="headerlink" title="为什么需要⾃动化测试"></a>为什么需要⾃动化测试</h3><ul>
<li>代码写完了</li>
<li>怎么保证它是对的</li>
<li>怎么保证它会永远对下去</li>
<li>⻓久来看，没有测试的代码质量是⽆法保证的</li>
</ul>
<p><strong>测试的意义就是保证代码质量</strong></p>
<h3 id="测试种类有哪些？"><a href="#测试种类有哪些？" class="headerlink" title="测试种类有哪些？"></a>测试种类有哪些？</h3><blockquote>
<p>常见的测试</p>
</blockquote>
<ul>
<li>⼿⼯测试：最low的测试⽅式<ul>
<li>人肉点点点</li>
</ul>
</li>
<li>单元测试：快速检查⼀个类的功能<ul>
<li>只测这一个类的功能</li>
</ul>
</li>
<li>集成测试：检查整个系统的功能<ul>
<li>把手工的所有过程以代码的方式运行</li>
</ul>
</li>
<li>回归测试：检查新的代码有没有破坏旧的功能<ul>
<li>修一个bug把原来的bug触发了</li>
</ul>
</li>
<li>冒烟测试：快速检查代码有没有⼤问题</li>
<li>User Accepted Test：⽤户/甲⽅是否接受<ul>
<li>验收</li>
</ul>
</li>
<li>⿊盒测试：将整个系统看成⼀个⿊盒进⾏测试<ul>
<li>不关心内部细节</li>
</ul>
</li>
<li>⽩盒测试：根据系统的内部细节设计专⽤的测试</li>
<li>压⼒测试：对系统施加⼀定的压⼒，确保系统的稳定性<ul>
<li>能扛住多少个用户，一个，10个，10000个？</li>
</ul>
</li>
</ul>
<h3 id="丰富的自动化测试的仓库"><a href="#丰富的自动化测试的仓库" class="headerlink" title="丰富的自动化测试的仓库"></a>丰富的自动化测试的仓库</h3><ul>
<li><a href="https://github.com/hcsp" target="_blank" rel="noopener">https://github.com/hcsp</a></li>
</ul>
<h3 id="Java中的测试形态"><a href="#Java中的测试形态" class="headerlink" title="Java中的测试形态"></a>Java中的测试形态</h3><ul>
<li>TestNG</li>
<li>JUnit(现在最流行的测试框架)<ul>
<li>JUnit 4</li>
<li>JUnit 5</li>
</ul>
</li>
</ul>
<blockquote>
<p>maven约定</p>
</blockquote>
<ul>
<li>src/main 生产代码</li>
<li>src/test 测试代码</li>
</ul>
<h4 id="IDEA里写一个测试demo"><a href="#IDEA里写一个测试demo" class="headerlink" title="IDEA里写一个测试demo"></a>IDEA里写一个测试demo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.test.demo;</span><br><span class="line"></span><br><span class="line">public class Add_Junit4 &#123;</span><br><span class="line">    public static int add(int a, int b, int c)&#123;</span><br><span class="line">        return a + b + c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 按住快捷键 idea 默认的 (如果你没修改) 可以自动生成测试类</span><br><span class="line">command + shift + t</span><br><span class="line">此时你可以选择 测试框架的种类</span><br><span class="line">这里只推荐</span><br><span class="line">junit4 和 junit5</span><br><span class="line"></span><br><span class="line">我们先用 junit4</span><br></pre></td></tr></table></figure>
<blockquote>
<p>junit4</p>
</blockquote>
<ul>
<li>此时你可以添加 scope 了，因为这些代码仅在测试阶段使用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.test.demo;</span><br><span class="line"></span><br><span class="line">import org.junit.Assert;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">// junit4 测试方式</span><br><span class="line">public class Add_Junit4Test &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd()&#123;</span><br><span class="line">        // 断言 我期望值 3 和 Add_Junit4.add(1,1,1) 的结果是相等的</span><br><span class="line">        Assert.assertEquals(3, Add_Junit4.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAddFail()&#123;</span><br><span class="line">        // 断言 我期望值 4 和 Add_Junit4.add(1,1,1) 的结果是 &quot;不相等的&quot;</span><br><span class="line">        Assert.assertNotEquals(4, Add_Junit4.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>junit5</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.test.demo;</span><br><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Assertions;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line">class Add_Junit5Test &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd()&#123;</span><br><span class="line">        // 断言 我期望值 3 和 Add_Junit5.add(1,1,1) 的结果是相等的</span><br><span class="line">        Assertions.assertEquals(3, Add_Junit5.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAddFail()&#123;</span><br><span class="line">        // 断言 我期望值 4 和 Add_Junit5.add(1,1,1) 的结果是 &quot;不相等的&quot;</span><br><span class="line">        Assertions.assertNotEquals(4, Add_Junit5.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="junit深入"><a href="#junit深入" class="headerlink" title="junit深入"></a>junit深入</h4><ul>
<li>上面的test类的里每个 <code>@Test</code>的方法不是 static 而是 实例方法<ul>
<li>这个对象谁创建的？</li>
<li>这个对象在哪里创建的？怎么看不到</li>
</ul>
</li>
</ul>
<blockquote>
<p>答案是： junit框架帮你做的</p>
</blockquote>
<ul>
<li>首先 junit 通过反射扫描<code>@Test注解的地方</code>，然后通过把它包出来<ul>
<li>可以通过在构造器哪里打断点，来验证</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Add_Junit5Test &#123;</span><br><span class="line"></span><br><span class="line">    public Add_Junit5Test() &#123;</span><br><span class="line">        System.out.println(&quot;Created!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd()&#123;</span><br><span class="line">        // 断言 我期望值 3 和 Add_Junit5.add(1,1,1) 的结果是相等的</span><br><span class="line">        Assertions.assertEquals(3, Add_Junit5.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAddFail()&#123;</span><br><span class="line">        // 断言 我期望值 4 和 Add_Junit5.add(1,1,1) 的结果是 &quot;不相等的&quot;</span><br><span class="line">        Assertions.assertNotEquals(4, Add_Junit5.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q:为什么测试方法是实例方法</p>
</blockquote>
<ul>
<li>答案是：junit 通过反射偷偷帮你创建该类的实例</li>
</ul>
<blockquote>
<p>Q:已知我现在有两个测试用例</p>
</blockquote>
<ul>
<li>原始类：注意<code>add()</code>已经是实例方法了!!!</li>
<li>原始类：注意<code>add()</code>已经是实例方法了!!!</li>
<li>原始类：注意<code>add()</code>已经是实例方法了!!!</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Add_Junit5_1 &#123;</span><br><span class="line">    public int add(int a, int b, int c)&#123;</span><br><span class="line">        return a + b + c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>测试类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Add_Junit5_1Test &#123;</span><br><span class="line"></span><br><span class="line">    Add_Junit5_1 adder = new Add_Junit5_1();</span><br><span class="line">    @BeforeAll</span><br><span class="line">    public static void setUpAll()&#123;</span><br><span class="line">        System.out.println(&quot;在所有的测试用例运行之前运行且只运行一次&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @BeforeEach</span><br><span class="line">    public void setUp()&#123;</span><br><span class="line">        System.out.println(&quot;初始化测试类的实例&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAdd()&#123;</span><br><span class="line">        Assertions.assertEquals(3, adder.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testAddFail()&#123;</span><br><span class="line">        Assertions.assertNotEquals(4, adder.add(1,1,1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这两个测试实例所用的<code>Add_Junit5_1</code>类的 adder 对象是同一个吗？</li>
<li>这两个实例如果是同一个对象，那么它们的调用顺序是怎样的？从上到下？还是从下到上？还是其他顺序？我能改变这个顺序吗？</li>
<li>如果不是同一个对象，那么它们又是什么时候被分别创建的？</li>
</ul>
<blockquote>
<p>答案是：</p>
</blockquote>
<ul>
<li>每次你运行的时候,在测试函数执行之前,junit 会通过反射帮我们创建 <code>Add_Junit5_1类的实例</code> adder </li>
<li>而且里面所有测试方法用到的<code>Add_Junit5_1类的实例</code> adder 都是新的<ul>
<li>为什么？因为不希望测试方法之间互相干扰</li>
<li>每个测试方法开始之前：期望这个实例对象 是全新的。跟其他测试方法是隔离的，没有依赖关系</li>
</ul>
</li>
<li>debug运行 你会发现运行时候测试方法的执行顺序不是按照声明顺序<ul>
<li>因为这是java反射顺序不是按照声明顺序</li>
</ul>
</li>
</ul>
<h3 id="测试的⽣命周期"><a href="#测试的⽣命周期" class="headerlink" title="测试的⽣命周期"></a>测试的⽣命周期</h3><ul>
<li>Maven约定：所有放在src/test下的都是测试代码(在 maven test 阶段会被自动识别)</li>
<li>Maven的⽣命周期：<ul>
<li>test</li>
<li>integration-test(集成测试)</li>
</ul>
</li>
<li>测试的时候到底发⽣了什么？(mvn test 之后发生了什么)<ul>
<li>新的JVM</li>
<li>每个测试⽤例新建⼀个测试类的实例<ul>
<li>额外的操作</li>
<li>before</li>
<li>forEach</li>
<li>beforeAll</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>mvn test 后发生了什么</p>
</blockquote>
<ul>
<li>首先在当前运行环境里：寻找 mvn 命令(mvn 的本质就是 拼一个java命令)<ul>
<li>java 所有工具都是 帮你拼一个命令行</li>
</ul>
</li>
<li>mvn 本质就是一个 jvm<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">开始走一个 maven 生命周期 </span><br><span class="line">clean --&gt; validate --&gt; compile --&gt; test --&gt; ... </span><br><span class="line"></span><br><span class="line">首先会启动一个 jvm，当走到 test 周期的时候它会 重新启动一个 jvm</span><br><span class="line">原因是 你的测试可能会破坏 jvm 某个属性，因此放在一个新的 jvm 是更安全的 ，隔离的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">验证它：开启新的 jvm</span><br><span class="line"></span><br><span class="line">第一步：在一个测试函数内 睡 60秒</span><br><span class="line">@Test</span><br><span class="line">public void testAddFail() throws InterruptedException &#123;</span><br><span class="line">    Thread.sleep(60 * 1000);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第二步：命令行运行 jps</span><br><span class="line"></span><br><span class="line">22385 surefirebooter7222466039461078627.jar</span><br><span class="line">22404 Jps</span><br><span class="line">20090 KotlinCompileDaemon</span><br><span class="line">19628 </span><br><span class="line">19965 RemoteMavenServer</span><br><span class="line">21983 Launcher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">surefirebooter 就是默认测试插件新开的 jvm</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编写单元测试"><a href="#编写单元测试" class="headerlink" title="编写单元测试"></a>编写单元测试</h3><ul>
<li>@Test</li>
<li>Assertion 断⾔</li>
<li>Mock 模拟</li>
<li>测试⼀个类/⽅法是否符合预期</li>
</ul>
<h3 id="编写集成测试"><a href="#编写集成测试" class="headerlink" title="编写集成测试"></a>编写集成测试</h3><ul>
<li>启动测试环境</li>
<li>保证测试环境的隔离</li>
<li>使⽤各类⾃动化⼯具模拟外界输⼊</li>
</ul>
<h3 id="运⾏⾃动化测试"><a href="#运⾏⾃动化测试" class="headerlink" title="运⾏⾃动化测试"></a>运⾏⾃动化测试</h3><ul>
<li>mvn verify/test</li>
<li>mvn test -DskipTests</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/ZB-044-01自动化测试/" data-id="cklhjp2aa00v1ulfyl2dt19t2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-043-01操作系统和计算机原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/13/ZB-043-01操作系统和计算机原理/" class="article-date">
  <time datetime="2019-12-13T01:01:05.000Z" itemprop="datePublished">2019-12-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/13/ZB-043-01操作系统和计算机原理/">ZB-043-01操作系统和计算机原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="操作系统和计算机原理简介"><a href="#操作系统和计算机原理简介" class="headerlink" title="操作系统和计算机原理简介"></a>操作系统和计算机原理简介</h1><h3 id="计算机体系原理"><a href="#计算机体系原理" class="headerlink" title="计算机体系原理"></a>计算机体系原理</h3><ul>
<li>最基本的计算</li>
</ul>
<blockquote>
<p>计算机</p>
</blockquote>
<ul>
<li>核心是一个CPU 中央处理器,它是计算机的大脑只有它负责计算，其它所有东西都是为它服务的<ul>
<li>穿孔纸带</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">通俗例子：</span><br><span class="line">一个人（CPU）</span><br><span class="line">手里拿着笔和一个小本本(阅读的说明书就是程序的指令)</span><br><span class="line">他面前有几个临时的桶(寄存器) 大部分人做数学题的时候都会把东西抄在一个地方用于下次计算时使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们通过一个穿孔纸带，根据穿孔纸带 01二进制码识别指令，</span><br><span class="line">往面前这个桶里放一个数字1，</span><br><span class="line">然后看下一个机器码是什么</span><br><span class="line">如 +2</span><br><span class="line">就把刚才桶里的数加一下放进去</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CPU就是一个很聪明的人</span><br><span class="line">它手里拿的小本本——说明书 就是阅读机器码</span><br><span class="line">第一条指令执行 xxx</span><br><span class="line">第二条指令 若 xxx成立 执行 yyy操作</span><br></pre></td></tr></table></figure>
<blockquote>
<p>深入</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CPU（一个聪明的人）</span><br><span class="line">它可以阅读说明书</span><br><span class="line">并且操作面前的内存</span><br><span class="line"></span><br><span class="line">说明书实际也放在内存里</span><br><span class="line">内存除了放说明书他还存放指令</span><br><span class="line"></span><br><span class="line">因此我们称这种结构叫做 —— </span><br><span class="line">冯·诺伊曼结构 https://zh.wikipedia.org/wiki/%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC%E7%BB%93%E6%9E%84</span><br><span class="line">一种将程序指令存储器和数据存储器合并在一起的电脑设计概念结构</span><br></pre></td></tr></table></figure>
<blockquote>
<p>CPU不出错吗？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CPU里放了上亿的晶体管</span><br><span class="line">用特殊的硬件逻辑完成我们的功能</span><br><span class="line"></span><br><span class="line">比如有个东西叫做：与非门  1和0相与取非</span><br><span class="line"></span><br><span class="line">CPU它会出错吗？</span><br><span class="line">我们认为不会，但并不能保证它不会出错——一个著名CPU bug 1994 cpu</span><br><span class="line">https://en.wikipedia.org/wiki/Pentium_FDIV_bug 浮点数错误</span><br><span class="line">https://zh.wikipedia.org/wiki/%E5%A5%94%E8%85%BE%E6%B5%AE%E7%82%B9%E9%99%A4%E9%94%99%E8%AF%AF</span><br><span class="line"></span><br><span class="line">就是用硬件电路预定义了一些除法算数了，不幸的是焊错了，导致这是一个硬件问题,无法通过软件来解决。</span><br></pre></td></tr></table></figure>
<p><strong>内存就是很长很长的连续数据存储空间，每个单元(字节)代表一个数据或者一个指令</strong></p>
<ul>
<li>其他之外都是存储的</li>
</ul>
<p><a href="https://zhuanlan.zhihu.com/p/73937739" target="_blank" rel="noopener">扩展链接:计算机基础 | 多核、缓存…现代CPU是如何工作的</a><br><a href="http://www.ruanyifeng.com/blog/2013/10/register.html" target="_blank" rel="noopener">为什么寄存器比内存快？</a></p>
<h4 id="程序的装载和执行"><a href="#程序的装载和执行" class="headerlink" title="程序的装载和执行"></a>程序的装载和执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">每个程序有不同的说明书，如播放器，浏览器，QQ,微信，它们如何区分呢？</span><br><span class="line"></span><br><span class="line">通过 把说明书和一些数据的打包叫做 可执行程序 如 .exe 文件</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>你在你电脑上运行 .exe文件时发生了什么</code></p>
</blockquote>
<ul>
<li>首先，可执行程序里有一段是 说明书+一些数据 可能它只有说明书<ul>
<li>一个exe可以启动很多个进程</li>
<li>假如你每次双击一些记事本就弹出一个窗口</li>
<li>它每次开始执行，它会装载到内存中某个地方里去</li>
<li>你在次点击记事本，就又弹出了一个窗口</li>
</ul>
</li>
</ul>
<blockquote>
<p>这多个进程和 说明书本身有什么联系吗？</p>
<pre><code>- 说明书本身指导了这个程序如何被启动和执行
- 但是这两个进程的数据是互不相同的
</code></pre></blockquote>
<p><strong>这就引出了物理和虚拟寻址</strong></p>
<h4 id="物理和虚拟寻址"><a href="#物理和虚拟寻址" class="headerlink" title="物理和虚拟寻址"></a>物理和虚拟寻址</h4><blockquote>
<p>你打开了多个记事本，CPU看着说明书 按着exe里的东西一行一行执行</p>
</blockquote>
<p>首先这个exe装载了很多次，你打开了多个记事本，输入不同东西，对其他记事本的内容没任何影响。我们称之为<strong>虚拟寻址空间</strong></p>
<blockquote>
<p>虚拟地址空间</p>
</blockquote>
<ul>
<li>在每个进程自己看来，它自己好像占据了所有内存，实际上是在漫长的内存里分配给它的一小节</li>
</ul>
<blockquote>
<p>假如你有个 32G内存的笔记本</p>
</blockquote>
<p>32G的空间就是物理地址，每个程序里内部跳来跳去的地方叫做虚拟地址空间</p>
<ul>
<li>好处是：每个记事本之间互不干扰的执行，假如一个记事本崩溃了，不会影响其他记事本，同时每个记事本无法获取其他记事本的数据。</li>
</ul>
<blockquote>
<p>为什么一个程序无法跨平台?</p>
</blockquote>
<p>CPU傻傻的执行，这个说明书的 <code>.exe</code>里的指令 一条一条的执行。。。</p>
<p>因此，一种CPU和另外一种CPU他们的说明书肯定是不同的。很容易理解这是因为他们的CPU架构不同</p>
<blockquote>
<p>为什么最新的 win10还能运行 win95的一些游戏呢？</p>
</blockquote>
<ul>
<li>最广泛的桌面架构x86架构 ：它是一种<strong>指令集</strong>的东西<ul>
<li>只要指令集不变，它们就可以用同一份说明书</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果CPU完全相同都是x86为什么 win/linux/mac 它们的程序还不能共用</p>
</blockquote>
<ul>
<li>因为在说明书中可能需要调用在操作系统里的一些相关东西，如windows图形接口这些在linux上没有</li>
<li>一份说明书 <code>.exe</code>需要装载到内存中，这个内存的布局 不同系统是不一样的。</li>
</ul>
<p><strong>因此我们该怎么办呢？</strong></p>
<p>于是我们有了 python/java 各种高级语言，在操作系统上维护的虚拟机。</p>
<p>它可以解释和当前操作系统说明书完全不同的另外一种说明书叫做——<strong>字节码</strong></p>
<blockquote>
<p>go是直接编译成 native的所以没法跨平台</p>
</blockquote>
<p>这就是<strong>程序的装载和执行</strong></p>
<blockquote>
<p>程序启动的本质</p>
</blockquote>
<p>从硬盘上的一份说明书，加载到内存里变成一个可以执行的程序</p>
<h4 id="动态链接库"><a href="#动态链接库" class="headerlink" title="动态链接库"></a>动态链接库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">执行程序的时候，就是按照说明书的指令</span><br><span class="line">12345～～。。。</span><br><span class="line">有些时候这些指令是不全的</span><br><span class="line">比如在执行某个指令时：说请去调用一个foo函数,但是这个foo函数不在本程序中，而在遥远操作系统的另一个地方</span><br><span class="line"></span><br><span class="line">我们称之为 这个程序和它当前要使用的库分离的情况 叫做 动态链接库</span><br></pre></td></tr></table></figure>
<blockquote>
<p>好处</p>
</blockquote>
<ul>
<li>把说明书某些关键功能拆出来，单独放在一个部分 省空间，提取公共</li>
</ul>
<blockquote>
<p>坏处</p>
</blockquote>
<ul>
<li>我们在没有这个依赖的说明书运行我们的程序就会报错<ul>
<li>我们都知道玩游戏的时候有时候会弹出一个报错 xxx找不到</li>
</ul>
</li>
<li>版本问题<ul>
<li>这个游戏需要 一个库版本是0.5</li>
<li>但是你机子安装的是 2.0</li>
</ul>
</li>
<li>最要命的是这个这个崩溃不会立即发生而是项目正常上线一个月之后突然崩了</li>
</ul>
<blockquote>
<p>有关动态链接库推荐看一本书</p>
</blockquote>
<ul>
<li><a href="https://book.douban.com/subject/3652388/" target="_blank" rel="noopener">程序员的自我修养</a></li>
</ul>
<h3 id="程序的分时复用"><a href="#程序的分时复用" class="headerlink" title="程序的分时复用"></a>程序的分时复用</h3><p>假如你只有一个CPU,就是你的电脑上同时只能有一个人可以不停的做各种运算,但是你却可以看网页，听音乐，下载东西。。。。</p>
<p><strong>这就设计一个概念：分时复用</strong></p>
<blockquote>
<p>CPU的速度远远快于内存\IO\磁盘</p>
</blockquote>
<ul>
<li>CPU和内存就差了3个数量级<ul>
<li>内存做1件事，CPU能做1000件事</li>
</ul>
</li>
</ul>
<p>所以在CPU看来其他人都是慢的跟蜗牛一样，于是CPU说请在这个时间我去做点别的。</p>
<p>于是又一个概念就是 <strong>时间片轮转</strong></p>
<ul>
<li>执行一会儿A程序，执行一会儿B程序，因为CPU是在太快了，这些程序的响应时间太慢了。</li>
<li>所以在你看来，它好像同时在做很多件事，只是你的时间感知维度不在一个级别。</li>
<li>CPU所应对的其他外设是在太慢了</li>
</ul>
<p>这就是CPU的基本工作流程</p>
<blockquote>
<p>是谁可以占据它的时间片呢？</p>
</blockquote>
<ul>
<li>进程/线程都可以</li>
</ul>
<blockquote>
<p>什么时候会放弃时间片</p>
</blockquote>
<p>假如有个程序很难缠一直请求 CPU,给你带来直观的感受就是 卡顿。你的鼠标移动的时候都是受CPU控制的。</p>
<blockquote>
<p>因此我们不能让任何一个程序如此霸道的占据CPU,于是有了<strong>调度</strong></p>
</blockquote>
<ul>
<li>进程的调度是 操作系统</li>
</ul>
<blockquote>
<p>看看你的任务管理器</p>
</blockquote>
<p>这里有如此多的进程在进行，因此我们不能让其中的一个程序霸道的占据 CPU的所有，于是有了调度，根据每个程序的优先级来划分程序执行的时间。</p>
<h4 id="挂起和中断"><a href="#挂起和中断" class="headerlink" title="挂起和中断"></a>挂起和中断</h4><ol>
<li>当你听着歌，开着ide,开着浏览器，开着word,</li>
<li>然后在 word里写下一段文字按下 <code>ctrl + s</code> 的瞬间，因为保存操作涉及文件的写入就是磁盘的读写 IO</li>
<li>IO的时间非常慢，CPU很快 所以它不会等word写入后在弹出个保存成功</li>
<li>于是CPU在此时去(轮流)执行其他进程/应用</li>
<li>当文件成功写入磁盘后，发起一个中断</li>
<li>CPU通过中断处理程序接收到这个中断信号来了之后，停下手中其他的程序，恢复word 程序的执行弹出 保存成功</li>
</ol>
<h4 id="上下文切换"><a href="#上下文切换" class="headerlink" title="上下文切换"></a>上下文切换</h4><ul>
<li>上下⽂context：程序运⾏的环境（寄存器、PC）临时的数据</li>
<li>放弃CPU时，保存上下⽂</li>
<li>拥有CPU时，恢复上下⽂</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CPU是一个人</span><br><span class="line">他面前又多个桶 寄存器</span><br><span class="line"></span><br><span class="line">他面前还有一堆说明书（一堆应用程序）</span><br><span class="line"></span><br><span class="line">操作系统告诉它 你现在该执行谁了。</span><br><span class="line"></span><br><span class="line">CPU开始执行 ”说明书1“ 的时候，假如执行到第三条指令，此时“说明书1”的时间片到了，它要去执行 另一个“说明书2”的指令，当恢复执行 “说明书1” 的时候 CPU 如何知道 从那条指令开始？</span><br><span class="line"></span><br><span class="line">一定需要一个东西 把 “说明书1” 当前执行的阶段保留，这个东西就叫 &quot;program counter&quot; 也就是 上下文 context</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例子</p>
</blockquote>
<ul>
<li>CPU轮流执行说明书，当从 说明书2 切换到 说明书1 的时候 </li>
<li>要 保存 说明书2 的上下文</li>
<li>此时 说明书1 拥有了 CPU ，恢复 上下文 继续执行</li>
<li>当 “说明书1” 时间片到了， 就 保存 它的上下文</li>
<li>此时 说明书2 拥有了 CPU ，恢复 上下文 继续执行 </li>
<li>如此循环往复</li>
</ul>
<blockquote>
<p>program counter 只有一个吗？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">是的,program counter 每个CPU只有一个,这也是为什么上下文切换的原因</span><br><span class="line">每当你从一个程序 切换到另一个程序的时候，你都需要把 当前的所有数据 保存到内存中</span><br><span class="line">下次 在此运行这个 程序的时候 再从内存中恢复</span><br><span class="line"></span><br><span class="line">只有当前CPU执行的程序的 pc才被 CPU 持有</span><br><span class="line">其他程序的的 数据都保存在 内存里</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样频繁切换不会造成性能浪费吗？</p>
</blockquote>
<ul>
<li>这也是为什么要有 <strong>协程</strong> 的原因</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">对于 3Ghz CPU</span><br><span class="line">在切换上下文的过程中，大概需要10的4次方个时钟周期，尽管它很慢，但还是比 IO 快</span><br><span class="line">虽然他很浪费，但这是不得已的。因为切换上下文必须这样做。</span><br><span class="line"></span><br><span class="line">可以不用不那么浪费？ 可以的，</span><br><span class="line">我们希望一个线程自己在跑，它自己内部又维护一些分时复用的东西呢，并行的执行一些工作？</span><br><span class="line">于是出了一个新的概念 —— 用户态线程</span><br><span class="line"></span><br><span class="line">还有一个概念叫做 协程</span><br><span class="line"></span><br><span class="line">一个线程单独又一个方法栈 大约 1M</span><br><span class="line">而一个协程 大约 4KB 差距200倍</span><br><span class="line">但是你需要自己写一套调度算法</span><br></pre></td></tr></table></figure>
<blockquote>
<p>协程是操作系统概念还是编程语言概念</p>
</blockquote>
<ul>
<li>答案是 它是编程语言的概念</li>
</ul>
<h3 id="什么是操作系统"><a href="#什么是操作系统" class="headerlink" title="什么是操作系统"></a>什么是操作系统</h3><ul>
<li>欺上瞒下（承上启下）：<ul>
<li>对上层提供统⼀的API，简化应⽤开发逻辑<ul>
<li>例如：通过Windows的CreateProcessA⽅法创建新的进程</li>
<li>通过Unix的fork系统调⽤创建新的进程</li>
<li>只要使用统一的 api</li>
</ul>
</li>
<li>对下层通过硬件驱动提供兼容性<ul>
<li>非常好的向后兼容</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>x86</p>
</blockquote>
<p>来源于8086处理器 也就是 CPU<br>90年代，说一个电脑性能 会说它是386/486/586 的机器</p>
<p>因此当你下载一个软件的时候可以指明它CPU是什么的标准 如 <a href="http://old-releases.ubuntu.com/releases/14.04.0/" target="_blank" rel="noopener">ubuntu i586</a></p>
<blockquote>
<p>驱动的概念</p>
</blockquote>
<ul>
<li>比如显示器/鼠标<ul>
<li>假如你想正常显示你需要给我这个xxx端口发个信号</li>
</ul>
</li>
</ul>
<blockquote>
<p>在此过程我们发现我们一直在抽象</p>
</blockquote>
<ul>
<li>好处：一套代码，到处运行</li>
<li>坏处：效率低。</li>
</ul>
<p><strong>计算机科学领域任何一个问题都可以通过添加一个中间层来解决</strong></p>
<h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><ul>
<li>共同点：<ul>
<li>都拥有独⽴的PC(程序计数器)，可以独⽴地执⾏程序（性格测试题？）</li>
<li>在Linux上甚⾄⽤同⼀种数据结构处理进程和线程</li>
</ul>
</li>
<li>进程：拥有独⽴的内存地址空间、⽂件等资源</li>
<li>线程：和其他线程共享内存地址空间、⽂件等资源</li>
</ul>
<p>你把电脑启动之后，打开 chrome,叮叮，vscode,网易云音乐，有道云笔记之后</p>
<p>一个CPU发现操作系统又若干个说明书，每个程序通过 分时复用 的方式执行各种各样的程序这是<strong>进程</strong></p>
<blockquote>
<p>线程</p>
</blockquote>
<p>把其中某个进程 放大一下，如 java进程，一个程序本来只有一个计数器从上往下，当一个程序执行慢的时候，我想要加快速度，在这个进程内部再开一个小的说明书，我们称之为 <strong>线程</strong></p>
<h3 id="⽂件系统与IO"><a href="#⽂件系统与IO" class="headerlink" title="⽂件系统与IO"></a>⽂件系统与IO</h3><ul>
<li>⽂件的本质是字节流</li>
<li>⽂件与⽂件指针<ul>
<li>读到哪一行，读某块内容</li>
</ul>
</li>
<li>缓存与缓冲区<ul>
<li>IO很慢 从磁盘读到CPU是非常慢的</li>
</ul>
</li>
</ul>
<h3 id="源代码是如何变成程序的"><a href="#源代码是如何变成程序的" class="headerlink" title="源代码是如何变成程序的"></a>源代码是如何变成程序的</h3><ul>
<li>远古时代：用针戳纸带<ul>
<li>剪贴和粘贴才是真的剪贴和粘贴</li>
</ul>
</li>
<li>机器帮你生成机器码：高级语言到机器码的过程——编译<ul>
<li>原理非常简单，编译的过程很复杂</li>
<li>AST 抽象语法树 <a href="https://astexplorer.net/" target="_blank" rel="noopener">在线js AST转换器</a></li>
<li><a href="https://juejin.im/post/5c2714fb51882575f560503c" target="_blank" rel="noopener">AST in JS</a></li>
</ul>
</li>
</ul>
<h4 id="从源代码到AST-编译器前端"><a href="#从源代码到AST-编译器前端" class="headerlink" title="从源代码到AST(编译器前端)"></a>从源代码到AST(编译器前端)</h4><ul>
<li>源代码 -&gt; tokens (解析成一个一个关键字)</li>
<li>tokens -&gt; AST （关键字变成一个抽象语法树）</li>
</ul>
<h4 id="从AST到⽬标代码（编译器后端）"><a href="#从AST到⽬标代码（编译器后端）" class="headerlink" title="从AST到⽬标代码（编译器后端）"></a>从AST到⽬标代码（编译器后端）</h4><ul>
<li>AST -&gt; 字节码 (机器指令 0101…的内容)</li>
<li>AST -&gt; 平台相关的⽬标代码（真正可以执行的说明书）</li>
</ul>
<h4 id="AST-in-JS"><a href="#AST-in-JS" class="headerlink" title="AST in JS"></a>AST in JS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">let a = 1;</span><br><span class="line">let b = 2;</span><br><span class="line">let sum = (a,b)=&gt;a + b;</span><br><span class="line">sum(a,b);</span><br><span class="line"></span><br><span class="line">// 会变成</span><br><span class="line">&#123;</span><br><span class="line">  &quot;type&quot;: &quot;Program&quot;,</span><br><span class="line">  &quot;start&quot;: 0,</span><br><span class="line">  &quot;end&quot;: 55,</span><br><span class="line">  &quot;body&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;VariableDeclaration&quot;,</span><br><span class="line">      &quot;start&quot;: 0,</span><br><span class="line">      &quot;end&quot;: 10,</span><br><span class="line">      &quot;declarations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;VariableDeclarator&quot;,</span><br><span class="line">          &quot;start&quot;: 4,</span><br><span class="line">          &quot;end&quot;: 9,</span><br><span class="line">          &quot;id&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">            &quot;start&quot;: 4,</span><br><span class="line">            &quot;end&quot;: 5,</span><br><span class="line">            &quot;name&quot;: &quot;a&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;init&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Literal&quot;,</span><br><span class="line">            &quot;start&quot;: 8,</span><br><span class="line">            &quot;end&quot;: 9,</span><br><span class="line">            &quot;value&quot;: 1,</span><br><span class="line">            &quot;raw&quot;: &quot;1&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;kind&quot;: &quot;let&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;VariableDeclaration&quot;,</span><br><span class="line">      &quot;start&quot;: 11,</span><br><span class="line">      &quot;end&quot;: 21,</span><br><span class="line">      &quot;declarations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;VariableDeclarator&quot;,</span><br><span class="line">          &quot;start&quot;: 15,</span><br><span class="line">          &quot;end&quot;: 20,</span><br><span class="line">          &quot;id&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">            &quot;start&quot;: 15,</span><br><span class="line">            &quot;end&quot;: 16,</span><br><span class="line">            &quot;name&quot;: &quot;b&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;init&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Literal&quot;,</span><br><span class="line">            &quot;start&quot;: 19,</span><br><span class="line">            &quot;end&quot;: 20,</span><br><span class="line">            &quot;value&quot;: 2,</span><br><span class="line">            &quot;raw&quot;: &quot;2&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;kind&quot;: &quot;let&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;VariableDeclaration&quot;,</span><br><span class="line">      &quot;start&quot;: 22,</span><br><span class="line">      &quot;end&quot;: 45,</span><br><span class="line">      &quot;declarations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;VariableDeclarator&quot;,</span><br><span class="line">          &quot;start&quot;: 26,</span><br><span class="line">          &quot;end&quot;: 44,</span><br><span class="line">          &quot;id&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">            &quot;start&quot;: 26,</span><br><span class="line">            &quot;end&quot;: 29,</span><br><span class="line">            &quot;name&quot;: &quot;sum&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;init&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;ArrowFunctionExpression&quot;,</span><br><span class="line">            &quot;start&quot;: 32,</span><br><span class="line">            &quot;end&quot;: 44,</span><br><span class="line">            &quot;id&quot;: null,</span><br><span class="line">            &quot;expression&quot;: true,</span><br><span class="line">            &quot;generator&quot;: false,</span><br><span class="line">            &quot;async&quot;: false,</span><br><span class="line">            &quot;params&quot;: [</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">                &quot;start&quot;: 33,</span><br><span class="line">                &quot;end&quot;: 34,</span><br><span class="line">                &quot;name&quot;: &quot;a&quot;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">                &quot;start&quot;: 35,</span><br><span class="line">                &quot;end&quot;: 36,</span><br><span class="line">                &quot;name&quot;: &quot;b&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;body&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;BinaryExpression&quot;,</span><br><span class="line">              &quot;start&quot;: 39,</span><br><span class="line">              &quot;end&quot;: 44,</span><br><span class="line">              &quot;left&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">                &quot;start&quot;: 39,</span><br><span class="line">                &quot;end&quot;: 40,</span><br><span class="line">                &quot;name&quot;: &quot;a&quot;</span><br><span class="line">              &#125;,</span><br><span class="line">              &quot;operator&quot;: &quot;+&quot;,</span><br><span class="line">              &quot;right&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">                &quot;start&quot;: 43,</span><br><span class="line">                &quot;end&quot;: 44,</span><br><span class="line">                &quot;name&quot;: &quot;b&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;kind&quot;: &quot;let&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;ExpressionStatement&quot;,</span><br><span class="line">      &quot;start&quot;: 46,</span><br><span class="line">      &quot;end&quot;: 55,</span><br><span class="line">      &quot;expression&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;CallExpression&quot;,</span><br><span class="line">        &quot;start&quot;: 46,</span><br><span class="line">        &quot;end&quot;: 54,</span><br><span class="line">        &quot;callee&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">          &quot;start&quot;: 46,</span><br><span class="line">          &quot;end&quot;: 49,</span><br><span class="line">          &quot;name&quot;: &quot;sum&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;arguments&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">            &quot;start&quot;: 50,</span><br><span class="line">            &quot;end&quot;: 51,</span><br><span class="line">            &quot;name&quot;: &quot;a&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;type&quot;: &quot;Identifier&quot;,</span><br><span class="line">            &quot;start&quot;: 52,</span><br><span class="line">            &quot;end&quot;: 53,</span><br><span class="line">            &quot;name&quot;: &quot;b&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;sourceType&quot;: &quot;module&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/13/ZB-043-01操作系统和计算机原理/" data-id="cklhjp2a900v0ulfy6zxriqtv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/7/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/9/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 13.91px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 14.35px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.3px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.48px;">M01</a> <a href="/tags/M02/" style="font-size: 15.22px;">M02</a> <a href="/tags/M03/" style="font-size: 15.65px;">M03</a> <a href="/tags/M04/" style="font-size: 16.09px;">M04</a> <a href="/tags/M06/" style="font-size: 18.26px;">M06</a> <a href="/tags/M07/" style="font-size: 17.83px;">M07</a> <a href="/tags/M08/" style="font-size: 16.96px;">M08</a> <a href="/tags/M09/" style="font-size: 11.74px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 15.65px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.7px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.52px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15.22px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.78px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.43px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.83px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.17px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.13px;">java</a> <a href="/tags/linux/" style="font-size: 10.87px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.3px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.61px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.61px;">mysql</a> <a href="/tags/node/" style="font-size: 10.43px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.39px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.04px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.57px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/23/Node-web05-09-03博客系统使用nginx/">Node-web05-09-03博客系统使用nginx</a>
          </li>
        
          <li>
            <a href="/2021/02/22/Node-web05-09-02博客系统部署最新版流程/">Node-web05-09-02博客系统部署最新版流程</a>
          </li>
        
          <li>
            <a href="/2021/02/20/Node-web05-09-01博客统部署2/">Node-web05-09-01博客统部署优化解释</a>
          </li>
        
          <li>
            <a href="/2021/02/20/Node-web05-08博客统页面完善/">Node-web05-08博客统页面完善</a>
          </li>
        
          <li>
            <a href="/2021/02/19/Node-web05-07-03服务器端构建/">Node-web05-07-03服务器端构建</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>