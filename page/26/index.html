
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Almost</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stevin">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/26/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">

    
    <link rel="alternative" href="/atom.xml" title="Almost" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Almost" title="Almost"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Almost">Almost</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/12/Py008-01-11归并排序之归并/" title="Py008-01-11归并排序之归并" itemprop="url">Py008-01-11归并排序之归并</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-12T14:21:44.000Z" itemprop="datePublished"> Published 2018-12-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="归并排序——归并"><a href="#归并排序——归并" class="headerlink" title="归并排序——归并"></a>归并排序——归并</h3><blockquote>
<p>假设现在有一个列表 分两段有序，如何将其合并成一个有序列表</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如[2,5,7,8,9|华丽的分割线|1,3,4,6]</span><br></pre></td></tr></table></figure>
<ul>
<li>这种操作称为一次归并</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">res = []</span><br><span class="line">两个列表分别取第一个</span><br><span class="line">[2,5,7,8,9] </span><br><span class="line">[1,3,4,6]</span><br><span class="line">2&gt;1 1出来 res = [1]</span><br><span class="line">[2,5,7,8,9] </span><br><span class="line">[3,4,6]</span><br><span class="line">2&lt;3 2出来 res = [1,2]</span><br><span class="line">[5,7,8,9] </span><br><span class="line">[3,4,6]</span><br><span class="line">5&gt;3 3出来 res = [1,2,3]</span><br><span class="line">[5,7,8,9] </span><br><span class="line">[4,6]</span><br><span class="line">5&gt;4 4出来 res = [1,2,3,4]</span><br><span class="line">[5,7,8,9] </span><br><span class="line">[6]</span><br><span class="line">5&lt;6 5出来 res = [1,2,3,4,5]</span><br><span class="line">[7,8,9] </span><br><span class="line">[6]</span><br><span class="line">7&gt;6 6出来 res = [1,2,3,4,5,6]</span><br><span class="line">[7,8,9] </span><br><span class="line">[]</span><br><span class="line">[7,8,9] 都出来 res = [1,2,3,4,5,6,7,8,9]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码实现</p>
</blockquote>
<ul>
<li>大前提：两段有序的归并</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def merge(li,low,mid,high):</span><br><span class="line">    i = low # 第一个列表起点</span><br><span class="line">    j = mid+1 # 第二个列表起点</span><br><span class="line">    ltmp = [] # 没法用到原地排序了</span><br><span class="line">    while i&lt;=mid and j&lt;=high:# 只要左右两边都有数</span><br><span class="line">        if li[i] &lt; li[j]:</span><br><span class="line">            ltmp.append(li[i])</span><br><span class="line">            i += 1</span><br><span class="line">        else:</span><br><span class="line">            ltmp.append(li[j])</span><br><span class="line">            j += 1</span><br><span class="line"></span><br><span class="line">    # while执行完了，肯定有一头 没数了</span><br><span class="line">    while i &lt;= mid:</span><br><span class="line">        ltmp.append(li[i])</span><br><span class="line">        i += 1</span><br><span class="line">    while j &lt;= high:</span><br><span class="line">        ltmp.append(li[j])</span><br><span class="line">        j += 1</span><br><span class="line">    li[low:high+1] = ltmp</span><br><span class="line"></span><br><span class="line">li = [2,4,5,7,1,3,6,8]</span><br><span class="line">merge(li,0,3,7)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>
<h3 id="归并排序——使用归并"><a href="#归并排序——使用归并" class="headerlink" title="归并排序——使用归并"></a>归并排序——使用归并</h3><ul>
<li>分解：将列表越分越小，直至分成一个元素</li>
<li>终止条件：一个元素是有序的</li>
<li>合并：将两个有序列表归并，列表越来越大。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">def merge(li,low,mid,high):</span><br><span class="line">    i = low # 第一个列表起点</span><br><span class="line">    j = mid+1 # 第二个列表起点</span><br><span class="line">    ltmp = [] # 没法用到原地排序了</span><br><span class="line">    while i&lt;=mid and j&lt;=high:# 只要左右两边都有数</span><br><span class="line">        if li[i] &lt; li[j]:</span><br><span class="line">            ltmp.append(li[i])</span><br><span class="line">            i += 1</span><br><span class="line">        else:</span><br><span class="line">            ltmp.append(li[j])</span><br><span class="line">            j += 1</span><br><span class="line"></span><br><span class="line">    # while执行完了，肯定有一头 没数了</span><br><span class="line">    while i &lt;= mid:</span><br><span class="line">        ltmp.append(li[i])</span><br><span class="line">        i += 1</span><br><span class="line">    while j &lt;= high:</span><br><span class="line">        ltmp.append(li[j])</span><br><span class="line">        j += 1</span><br><span class="line">    li[low:high+1] = ltmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def merge_sort(li,low,high):</span><br><span class="line">    if low &lt; high:#至少有两个元素，递归</span><br><span class="line">        mid = (low + high)//2</span><br><span class="line">        merge_sort(li,low,mid)</span><br><span class="line">        merge_sort(li,mid+1,high)</span><br><span class="line">        merge(li,low,mid,high)</span><br><span class="line"></span><br><span class="line">li = list(range(16))</span><br><span class="line">import random</span><br><span class="line">random.shuffle(li)</span><br><span class="line">print(li)</span><br><span class="line">merge_sort(li,0,len(li)-1)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_1101.png" alt></p>
<h3 id="归并排序复杂度"><a href="#归并排序复杂度" class="headerlink" title="归并排序复杂度"></a>归并排序复杂度</h3><blockquote>
<p>时间复杂度</p>
</blockquote>
<ul>
<li>O(nlogn)</li>
</ul>
<blockquote>
<p>空间复杂度</p>
</blockquote>
<ul>
<li>O(n) 因为不是原地排序需要单独开辟空间</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/12/Py008-01-10堆排序之topk问题/" title="Py008-01-10堆排序之topk问题" itemprop="url">Py008-01-10堆排序之topk问题</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-12T13:37:36.000Z" itemprop="datePublished"> Published 2018-12-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="topk问题"><a href="#topk问题" class="headerlink" title="topk问题"></a>topk问题</h3><ul>
<li>现在有n个数，设计算法得到前k大的数。 (k&lt;n)</li>
<li>解决思路：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- 1.排序后切片 O(nlogn) + k</span><br><span class="line"></span><br><span class="line">- 2.排序lowB三人组 O(kn) </span><br><span class="line">    如果是冒泡只需要k趟就可以</span><br><span class="line"></span><br><span class="line">- 3.堆排序思路  O(nlogk)</span><br></pre></td></tr></table></figure>
<h4 id="堆排序解决思路"><a href="#堆排序解决思路" class="headerlink" title="堆排序解决思路"></a>堆排序解决思路</h4><ul>
<li>取列表前k个元素建立一个小根堆。堆顶就是目前第k大的数。</li>
<li>依次向后遍历原列表，对于列表中的元素，如果小于堆顶，则忽略该元素；如果大于堆顶，则将堆顶更换为该元素，并且对堆进行一次调整；</li>
<li>遍历列表所有元素后，倒序弹出堆顶</li>
</ul>
<blockquote>
<p>如假设一个长度为10的列表,取最大的前5个数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[6,8,1,9,3,0,7,2,4,5]</span><br><span class="line">思路</span><br><span class="line">step001 </span><br><span class="line">从列表里取出前5个数[6,8,1,9,3]</span><br><span class="line">step002 将这5个数变成一个小根堆</span><br><span class="line">      1</span><br><span class="line">  3       6</span><br><span class="line">9   8</span><br><span class="line">step003 循环剩余列表[0,7,2,4,5]依次跟堆顶比较</span><br><span class="line"></span><br><span class="line">0 &lt; 1 不换 [7,2,4,5]</span><br><span class="line"></span><br><span class="line">7 &gt; 1 换 [2,4,5]</span><br><span class="line">      7</span><br><span class="line">  3       6</span><br><span class="line">9   8</span><br><span class="line">此时向上调整</span><br><span class="line">      3</span><br><span class="line">  7       6</span><br><span class="line">9   8</span><br><span class="line">2 &lt; 3 不换 [4,5]</span><br><span class="line">4 &gt; 3 换 [5]</span><br><span class="line">      4</span><br><span class="line">  7       6</span><br><span class="line">9   8</span><br><span class="line">无需调整继续循环</span><br><span class="line">5 &gt; 4 换 []</span><br><span class="line">      5</span><br><span class="line">  7       6</span><br><span class="line">9   8</span><br></pre></td></tr></table></figure>
<ul>
<li>此时时间复杂度是O(nlogk)</li>
</ul>
<h4 id="topk实现"><a href="#topk实现" class="headerlink" title="topk实现"></a>topk实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#-*- encoding:utf-8 -*-</span><br><span class="line"></span><br><span class="line"># 原地排序，所以 大根堆 堆顶下来的元素会放到列表的末尾</span><br><span class="line"># high则标记 堆的最后一个元素</span><br><span class="line">def sift(li,low,high):</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    :param li: 列表</span><br><span class="line">    :param low: 堆的根节点位置</span><br><span class="line">    :param high: 堆的最后一个元素的位置</span><br><span class="line">    :return:</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    i = low # i最开始指向根节点</span><br><span class="line">    j = 2 * i + 1 # j就是i的左孩子</span><br><span class="line">    tmp = li[low] # 把堆顶存起来</span><br><span class="line">    while j &lt;= high: # 只要j位置有数</span><br><span class="line">        if j + 1 &lt;= high and li[j+1] &lt; li[j]: # 如果有右孩子而且 右孩子比左孩子小</span><br><span class="line">            j = j + 1 # 指向右孩子</span><br><span class="line"></span><br><span class="line">        if li[j] &lt; tmp: # 要么是左孩子  要么是右孩子</span><br><span class="line">            li[i] = li[j]</span><br><span class="line">            i = j    # 往下看一层</span><br><span class="line">            j = 2 * i + 1</span><br><span class="line"></span><br><span class="line">        else: # tmp最大，把tmp放到i的位置上</span><br><span class="line">            li[i] = tmp # 把tmp放到某一级领导位置上</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        li[i] = tmp # 把tmp放到叶子节点上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">def topk(li,k):</span><br><span class="line">    heap = li[0:k];</span><br><span class="line">    for i in range((k-2)//2,-1,-1):</span><br><span class="line">        sift(heap,i,k-1)</span><br><span class="line">    # 1。建堆</span><br><span class="line">    # 循环 k到 len(li)-1</span><br><span class="line">    for i in range(k,len(li)-1):</span><br><span class="line">        if li[i] &gt; heap[0]:</span><br><span class="line">            heap[0] = li[i]</span><br><span class="line">            sift(heap,0,k-1)</span><br><span class="line">    # 2。遍历</span><br><span class="line">    for i in range(k-1,-1,-1):</span><br><span class="line">        heap[0],heap[i] = heap[i],heap[0]</span><br><span class="line">        sift(heap,0,i-1)</span><br><span class="line"></span><br><span class="line">    # 3。出数</span><br><span class="line">    return heap</span><br><span class="line"></span><br><span class="line">import random</span><br><span class="line">li = list(range(1000))</span><br><span class="line">random.shuffle(li)</span><br><span class="line"></span><br><span class="line">print(topk(li,10))</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/12/Py008-01-09堆排序/" title="Py008-01-09堆排序" itemprop="url">Py008-01-09堆排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-12T12:36:39.000Z" itemprop="datePublished"> Published 2018-12-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="堆排序过程"><a href="#堆排序过程" class="headerlink" title="堆排序过程"></a>堆排序过程</h3><ul>
<li>1.建立堆</li>
<li>2.得到堆顶元素，为最大元素</li>
<li>3.去掉堆顶，将堆最后一个元素放到堆顶，此时可通过一次调整重新使堆有序</li>
<li>4.堆顶元素为第二最大元素</li>
<li>5.重复步骤3，直到堆变空</li>
</ul>
<h4 id="堆向下调整实现"><a href="#堆向下调整实现" class="headerlink" title="堆向下调整实现"></a>堆向下调整实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 原地排序，所以 大根堆 堆顶下来的元素会放到列表的末尾</span><br><span class="line"># high则标记 堆的最后一个元素</span><br><span class="line">def sift(li,low,high):</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    :param li: 列表</span><br><span class="line">    :param low: 堆的根节点位置</span><br><span class="line">    :param high: 堆的最后一个元素的位置</span><br><span class="line">    :return:</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    i = low # i最开始指向根节点</span><br><span class="line">    j = 2 * i + 1 # j就是i的左孩子</span><br><span class="line">    tmp = li[low] # 把堆顶存起来</span><br><span class="line">    while j &lt;= high: # 只要j位置有数</span><br><span class="line">        if j + 1 &lt;= high and li[j+1] &gt; li[j]: # 如果有右孩子而且 右孩子比左孩子大</span><br><span class="line">            j = j + 1 # 指向右孩子</span><br><span class="line"></span><br><span class="line">        if li[j] &gt; tmp: # 要么是左孩子  要么是右孩子</span><br><span class="line">            li[i] = li[j]</span><br><span class="line">            i = j    # 往下看一层</span><br><span class="line">            j = 2 * i + 1</span><br><span class="line"></span><br><span class="line">        else: # tmp最大，把tmp放到i的位置上</span><br><span class="line">            li[i] = tmp # 把tmp放到某一级领导位置上</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        li[i] = tmp # 把tmp放到叶子节点上</span><br></pre></td></tr></table></figure>
<h4 id="建立堆"><a href="#建立堆" class="headerlink" title="建立堆"></a>建立堆</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def heap_sort(li):</span><br><span class="line">    n = len(li)</span><br><span class="line">    # 倒着循环 找村级别</span><br><span class="line">    for i in range((n-2)//2,-1,-1):</span><br><span class="line">        # i表示建堆时候调整的部分的根的下标</span><br><span class="line">        # 此时的high不用 2*i+1</span><br><span class="line">        sift(li,i,n-1)</span><br><span class="line">    # 建堆完成了</span><br></pre></td></tr></table></figure>
<h4 id="挨个出数"><a href="#挨个出数" class="headerlink" title="挨个出数"></a>挨个出数</h4><ul>
<li>因为是原地排序</li>
<li>所以堆顶下台的元素会放到末尾</li>
<li>high = 列表长度 - 下太元素的个数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 原地排序，所以 大根堆 堆顶下来的元素会放到列表的末尾</span><br><span class="line"># high则标记 堆的最后一个元素</span><br><span class="line">def sift(li,low,high):</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    :param li: 列表</span><br><span class="line">    :param low: 堆的根节点位置</span><br><span class="line">    :param high: 堆的最后一个元素的位置</span><br><span class="line">    :return:</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    i = low # i最开始指向根节点</span><br><span class="line">    j = 2 * i + 1 # j就是i的左孩子</span><br><span class="line">    tmp = li[low] # 把堆顶存起来</span><br><span class="line">    while j &lt;= high: # 只要j位置有数</span><br><span class="line">        if j + 1 &lt;= high and li[j+1] &gt; li[j]: # 如果有右孩子而且 右孩子比左孩子大</span><br><span class="line">            j = j + 1 # 指向右孩子</span><br><span class="line"></span><br><span class="line">        if li[j] &gt; tmp: # 要么是左孩子  要么是右孩子</span><br><span class="line">            li[i] = li[j]</span><br><span class="line">            i = j    # 往下看一层</span><br><span class="line">            j = 2 * i + 1</span><br><span class="line"></span><br><span class="line">        else: # tmp最大，把tmp放到i的位置上</span><br><span class="line">            li[i] = tmp # 把tmp放到某一级领导位置上</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        li[i] = tmp # 把tmp放到叶子节点上</span><br><span class="line"></span><br><span class="line">def heap_sort(li):</span><br><span class="line">    n = len(li)</span><br><span class="line">    # 倒着循环 找村级别</span><br><span class="line">    for i in range((n-2)//2,-1,-1):</span><br><span class="line">        # i表示建堆时候调整的部分的根的下标</span><br><span class="line">        # 此时的high不用 2*i+1</span><br><span class="line">        sift(li,i,n-1)</span><br><span class="line">    # 建堆完成了</span><br><span class="line"></span><br><span class="line">    for i in range(n-1,-1,-1):</span><br><span class="line">        # i 指向当前堆的最后一个元素</span><br><span class="line">        # 把堆的最后一个元素放到堆顶</span><br><span class="line">        li[0],li[i] = li[i],li[0]</span><br><span class="line">        # 此时high = i-1 就是前一个元素</span><br><span class="line">        sift(li,0,i-1)</span><br><span class="line"></span><br><span class="line">li = [i for i in range(100)]</span><br><span class="line">import random</span><br><span class="line">random.shuffle(li)</span><br><span class="line">print(li)</span><br><span class="line"></span><br><span class="line">heap_sort(li)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>
<h3 id="堆排序的时间复杂度"><a href="#堆排序的时间复杂度" class="headerlink" title="堆排序的时间复杂度"></a>堆排序的时间复杂度</h3><ul>
<li>时间复杂度：O(nlogn)</li>
</ul>
<h3 id="堆排序——内置模块-heapq"><a href="#堆排序——内置模块-heapq" class="headerlink" title="堆排序——内置模块 heapq"></a>堆排序——内置模块 heapq</h3><blockquote>
<p>常用函数</p>
</blockquote>
<ul>
<li>heapify(x)</li>
<li>heappush(heap,item)</li>
<li>heappop(heap)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import heapq # q=&gt;queue 优先队列</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">li = [i for i in range(100)]</span><br><span class="line">random.shuffle(li)</span><br><span class="line">print(li)</span><br><span class="line"></span><br><span class="line">heapq.heapify(li) # 建堆</span><br><span class="line"></span><br><span class="line">n = len(li)</span><br><span class="line">for i in range(n):</span><br><span class="line">    # 每次出数</span><br><span class="line">    print(heapq.heappop(li),end=&apos;,&apos;)</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/10/Py008-01-08堆和堆的向下调整/" title="Py008-01-08堆和堆的向下调整" itemprop="url">Py008-01-08堆和堆的向下调整</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-10T14:08:21.000Z" itemprop="datePublished"> Published 2018-12-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>一种特殊的完全二叉树结构</p>
<ul>
<li>大根堆：一颗完全二叉树，任意节点都比其孩子节点大</li>
<li>小根堆：一颗完全二叉树，任意节点都比其孩子节点小</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0801.png" alt></p>
<blockquote>
<h4 id="一个具体的方式来看堆的问题-如上图的大根堆"><a href="#一个具体的方式来看堆的问题-如上图的大根堆" class="headerlink" title="一个具体的方式来看堆的问题(如上图的大根堆)"></a>一个具体的方式来看堆的问题(如上图的大根堆)</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一层 9 好比 省长</span><br><span class="line">第二层 8，7 好比 县长</span><br><span class="line">第三层 6，5，0，1 好比 村长</span><br><span class="line">第四层 2，4，3  好比 村民</span><br></pre></td></tr></table></figure>
<h4 id="堆的向下调整性"><a href="#堆的向下调整性" class="headerlink" title="堆的向下调整性"></a>堆的向下调整性</h4><blockquote>
<h4 id="假设：节点的左右子树都是堆，但自身不是堆"><a href="#假设：节点的左右子树都是堆，但自身不是堆" class="headerlink" title="假设：节点的左右子树都是堆，但自身不是堆"></a>假设：节点的左右子树都是堆，但自身不是堆</h4></blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0802.png" alt></p>
<blockquote>
<h4 id="很明显第一层坐在省长位置的2不合格"><a href="#很明显第一层坐在省长位置的2不合格" class="headerlink" title="很明显第一层坐在省长位置的2不合格"></a>很明显第一层坐在省长位置的2不合格</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">于是把 2 撸下来</span><br><span class="line">            ?</span><br><span class="line">    9                  7</span><br><span class="line">  8         5        0  1</span><br><span class="line">6   4     3</span><br><span class="line"></span><br><span class="line">让谁上去？待选人肯定是县长级别的   所以是 9 和 7，但是肯定要权限值大的上去</span><br><span class="line"></span><br><span class="line">            9</span><br><span class="line">    ？                 7</span><br><span class="line">  8         5        0  1</span><br><span class="line">6   4     3</span><br><span class="line">此时问？ 2能做一个县长吗？ 不能因为它领导不了下面的村长 8和5 而此时需要上位一个县长 8&gt;5  8上位了</span><br><span class="line">            9</span><br><span class="line">    8                 7</span><br><span class="line">  ?         5        0  1</span><br><span class="line">6   4     3</span><br><span class="line">此时问？ 2能做一个村长吗？ 不能因为它领导不了下面的村民 6，4和3 而此时需要上位一个村长 6&gt;4&gt;3  6上位了</span><br><span class="line"></span><br><span class="line">            9</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">?   4     3</span><br><span class="line"></span><br><span class="line">最后没法在撸了 ，所以2只能当村民了</span><br><span class="line">        9</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     3</span><br></pre></td></tr></table></figure>
<h3 id="堆排序过程演示"><a href="#堆排序过程演示" class="headerlink" title="堆排序过程演示"></a>堆排序过程演示</h3><blockquote>
<p>原理就是挨个出数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">res = []</span><br><span class="line">如大根堆的情况：</span><br><span class="line">            9</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     3</span><br><span class="line">step001 第一次 先让最大的下台 9下台了 </span><br><span class="line">res=[9]</span><br><span class="line">            ？</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     3</span><br><span class="line">---------------------------------</span><br><span class="line">思考假设  让谁上台</span><br><span class="line">如果是8上台</span><br><span class="line">导致8的位置空了</span><br><span class="line">            8</span><br><span class="line">    ?                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     3</span><br><span class="line">就必须 6上台</span><br><span class="line">导致6的位置空了</span><br><span class="line">            8</span><br><span class="line">    6                 7</span><br><span class="line">  ?         5        0  1</span><br><span class="line">2   4     3</span><br><span class="line">就必须 4上台</span><br><span class="line">导致4的位置空了</span><br><span class="line">            8</span><br><span class="line">    6                 7</span><br><span class="line">  4        5        0  1</span><br><span class="line">2   ?     3</span><br><span class="line">此时就不知道4的位置有一个空位</span><br><span class="line">这样就很麻烦</span><br><span class="line">这样就很麻烦</span><br><span class="line">这样就很麻烦</span><br><span class="line">---------------------------------</span><br><span class="line">            ？</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     3</span><br><span class="line">另一种思路 选一个备胎上去 取树的最后一层的最后的孩子也就是3</span><br><span class="line">            3</span><br><span class="line">    8                 7</span><br><span class="line">  6         5        0  1</span><br><span class="line">2   4     </span><br><span class="line">此时只要通过一次向下调整就能保持堆的层级:如下</span><br><span class="line">            8</span><br><span class="line">    6                 7</span><br><span class="line">  4         5        0  1</span><br><span class="line">2   3   </span><br><span class="line">step002  先让最大的下台 8下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是3</span><br><span class="line">res=[9,8]</span><br><span class="line">            3</span><br><span class="line">    6                 7</span><br><span class="line">  4         5        0  1</span><br><span class="line">2     </span><br><span class="line">通过一次向下调整就能保持堆的层级</span><br><span class="line">res=[9,8]</span><br><span class="line">            7</span><br><span class="line">    6                 3</span><br><span class="line">  4         5        0  1</span><br><span class="line">2   </span><br><span class="line">step003  先让最大的下台 7下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是2</span><br><span class="line">res=[9,8,7]</span><br><span class="line">          2</span><br><span class="line">    6            3</span><br><span class="line">  4   5        0  1</span><br><span class="line">通过一次向下调整就能保持堆的层级</span><br><span class="line">          6</span><br><span class="line">    5            3</span><br><span class="line">  4   2        0  1</span><br><span class="line">step004  先让最大的下台 6下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是1</span><br><span class="line">res = [9,8,7,6]</span><br><span class="line">          1</span><br><span class="line">    5            3</span><br><span class="line">  4   2        0 </span><br><span class="line">通过一次向下调整就能保持堆的层级</span><br><span class="line">           5</span><br><span class="line">    4            3</span><br><span class="line">  1   2        0 </span><br><span class="line">step005  先让最大的下台 5下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是0</span><br><span class="line">res = [9,8,7,6,5]</span><br><span class="line">           0</span><br><span class="line">    4            3</span><br><span class="line">  1   2  </span><br><span class="line">通过一次向下调整就能保持堆的层级       </span><br><span class="line">           4</span><br><span class="line">    2            3</span><br><span class="line">  1   0 </span><br><span class="line">step006  先让最大的下台 4下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是0</span><br><span class="line">res = [9,8,7,6,5,4]</span><br><span class="line">          0</span><br><span class="line">    2            3</span><br><span class="line">  1   </span><br><span class="line">通过一次向下调整就能保持堆的层级 </span><br><span class="line">          3</span><br><span class="line">    2            0</span><br><span class="line">  1 </span><br><span class="line">step007  先让最大的下台 3下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是1</span><br><span class="line">res = [9,8,7,6,5,4,3]</span><br><span class="line">           1</span><br><span class="line">    2            0</span><br><span class="line">通过一次向下调整就能保持堆的层级 </span><br><span class="line">        2</span><br><span class="line">    1        0</span><br><span class="line">step008  先让最大的下台 2下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是0</span><br><span class="line">res = [9,8,7,6,5,4,3,2]</span><br><span class="line">        0</span><br><span class="line">    1        </span><br><span class="line">通过一次向下调整就能保持堆的层级</span><br><span class="line">        1</span><br><span class="line">    0 </span><br><span class="line">step008  先让最大的下台 1下台了</span><br><span class="line">取树的最后一层的最后的孩子也就是0</span><br><span class="line">res = [9,8,7,6,5,4,3,2,1] </span><br><span class="line">    0</span><br><span class="line">step008  先让最大的下台 0下台了</span><br><span class="line">res = [9,8,7,6,5,4,3,2,1,0]</span><br></pre></td></tr></table></figure>
<h3 id="构造堆"><a href="#构造堆" class="headerlink" title="构造堆"></a>构造堆</h3><ul>
<li>堆一开始是没有秩序的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">如</span><br><span class="line">                6</span><br><span class="line">        8               1</span><br><span class="line">    9       3          0  7</span><br><span class="line">   2  4    5</span><br><span class="line"></span><br><span class="line">先管理一个村 3</span><br><span class="line">3和5调换</span><br><span class="line">看前一个村 9发现是好的 </span><br><span class="line">                6</span><br><span class="line">        8               1</span><br><span class="line">    9       5          0  7</span><br><span class="line">   2  4    3</span><br><span class="line">村都好了</span><br><span class="line">管理县7</span><br><span class="line">                6</span><br><span class="line">        8               7</span><br><span class="line">    9       5          0  1</span><br><span class="line">   2  4    3</span><br><span class="line">管理前一个县8</span><br><span class="line">                6</span><br><span class="line">        9               7</span><br><span class="line">    8       5          0  1</span><br><span class="line">   2  4    3</span><br><span class="line">县管理好了，管理省6</span><br><span class="line">                9</span><br><span class="line">        8               7</span><br><span class="line">    6       5          0  1</span><br><span class="line">   2  4    3</span><br><span class="line">此时构造堆的过程就结束了</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结论就是：每次从最底层构建堆</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">管理村级别的最后一个村</span><br><span class="line">村级别都好了</span><br><span class="line">管理县级别的最后一个县</span><br><span class="line">县级别都好了</span><br><span class="line">管理省级别的最后一个省</span><br><span class="line">县级别都好了</span><br><span class="line">最后就成了一个堆</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/10/Py008-01-07堆排序前传树与二叉树/" title="Py008-01-07堆排序前传树与二叉树" itemprop="url">Py008-01-07堆排序前传树与二叉树</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-10T13:02:13.000Z" itemprop="datePublished"> Published 2018-12-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="树"><a href="#树" class="headerlink" title="树"></a>树</h3><blockquote>
<p>树是一种数据结构</p>
</blockquote>
<p>比如：目录结构</p>
<ul>
<li>树是一种可以递归定义的数据结构</li>
<li>树由n个节点组成的集合<ul>
<li>如果n=0,那是一棵空树</li>
<li>如果n&gt;0,那存在一个节点作为树的根节点，其他节点可以分为m个集合，每个集合本身又是一棵树</li>
</ul>
</li>
</ul>
<h4 id="树的基本概念"><a href="#树的基本概念" class="headerlink" title="树的基本概念"></a>树的基本概念</h4><p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0701.png" alt></p>
<blockquote>
<p>根节点，叶子节点</p>
</blockquote>
<ul>
<li>如上图，A就是根节点</li>
<li>不能分叉的节点就是叶子节点 如B,C,H,I,P,Q,K,L,M,N</li>
</ul>
<blockquote>
<p>树的深度(高度) </p>
</blockquote>
<ul>
<li>看它的递归深度  如上为 4</li>
</ul>
<blockquote>
<p>树的度</p>
</blockquote>
<ul>
<li>就是最大分叉的个数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如 E 的度是2</span><br><span class="line">如 F 的度是3</span><br><span class="line">如 A 的度是6</span><br><span class="line"></span><br><span class="line">所以如上图   树的度就是6</span><br></pre></td></tr></table></figure>
<blockquote>
<p>孩子节点，父节点</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E是I的父节点</span><br><span class="line">I是E的子节点</span><br></pre></td></tr></table></figure>
<blockquote>
<p>子树</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如 把 E,I,J,P,Q拎出来 E就是一个子树</span><br></pre></td></tr></table></figure>
<h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><ul>
<li>二叉树就是度不超过2的树</li>
<li>每个节点最多有两个子节点</li>
<li>两个孩子节点被区分为左孩子节点和右孩子节点</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0702.png" alt></p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0703.png" alt></p>
<blockquote>
<h4 id="二叉树的存储方式"><a href="#二叉树的存储方式" class="headerlink" title="二叉树的存储方式"></a>二叉树的存储方式</h4></blockquote>
<ul>
<li>链式存储方式</li>
<li>顺序存储方式(就是用一个列表来存储)</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_01_0704.png" alt></p>
<blockquote>
<h4 id="思考：如果从孩子找父亲该怎么找？"><a href="#思考：如果从孩子找父亲该怎么找？" class="headerlink" title="思考：如果从孩子找父亲该怎么找？"></a>思考：如果从孩子找父亲该怎么找？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如子节点下标为9</span><br><span class="line">(9-1)整除2=4</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/09/Py008-01-06快速排序/" title="Py008-01-06快速排序" itemprop="url">Py008-01-06快速排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-09T03:45:23.000Z" itemprop="datePublished"> Published 2018-12-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><blockquote>
<p>第一个实现方式</p>
</blockquote>
<p>非原地排序，非常费空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import math</span><br><span class="line"># 非原地排序  每次都把列表分为左右两个区间</span><br><span class="line">def quickSort(arr):</span><br><span class="line">    if len(arr) &lt;= 1: return arr</span><br><span class="line"></span><br><span class="line">    # 取中间位</span><br><span class="line">    pivotIndex = math.ceil(len(arr) / 2);</span><br><span class="line">    pivot = arr[pivotIndex];</span><br><span class="line">    del arr[pivotIndex];</span><br><span class="line"></span><br><span class="line">    # 左右区间，用于存放排序后的数</span><br><span class="line">    left = [];</span><br><span class="line">    right = [];</span><br><span class="line">    for i in range(len(arr)):</span><br><span class="line">        print(&apos;分区操作的第 &apos; + str(i + 1) + &apos; 次循环：&apos;);</span><br><span class="line">        # 小于基准，放于左区间，大于基准，放于右区间</span><br><span class="line">        if arr[i] &lt; pivot:</span><br><span class="line">            left.append(arr[i]);</span><br><span class="line">            print(&apos;左边：&apos; + str(arr[i]))</span><br><span class="line">        else:</span><br><span class="line">            right.append(arr[i]);</span><br><span class="line">            print(&apos;右边：&apos; + str(arr[i]))</span><br><span class="line">    print(left, right)</span><br><span class="line">    return quickSort(left) + [pivot] + quickSort(right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr = [14, 3, 15, 7, 2, 76, 11];</span><br><span class="line">print(quickSort(arr));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>原地排序</p>
</blockquote>
<ul>
<li>以第一个值为起点 li[0] </li>
<li>从右开始找 li[len(li)-1] 比 li[0] 小则交换，索引往左移动一位。</li>
<li>然后从左往右找 比li[0]大 则交换，索引往右移动一位</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def partition(li,left,right):</span><br><span class="line">    tmp = li[left]</span><br><span class="line">    while left &lt; right:</span><br><span class="line">        while left &lt; right and li[right] &gt;= tmp: # 从右面找比tmp小的数</span><br><span class="line">            right -= 1 # 往左走一步</span><br><span class="line">            print(li,&apos;right&apos;)</span><br><span class="line">        li[left] = li[right] # 把右边的值填到左边的空位上</span><br><span class="line"></span><br><span class="line">        while left &lt; right and li[left] &lt;= tmp: # 从左面找比tmp大的数</span><br><span class="line">            left += 1 # 往右走一步</span><br><span class="line">            print(li,&apos;left&apos;)</span><br><span class="line">        li[right] = li[left] # 把左边的值填到右边的空位上</span><br><span class="line"></span><br><span class="line">    li[left] = tmp # 把tmp归位</span><br><span class="line">    return left # 返回中间值</span><br><span class="line"></span><br><span class="line">li = [5,7,4,6,3,1,2,9,8]</span><br><span class="line"></span><br><span class="line">print(li)</span><br><span class="line">partition(li,0,len(li)-1)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二步，递归的方式来排序左面的和右边</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">def partition(li,left,right):</span><br><span class="line">    tmp = li[left]</span><br><span class="line">    while left &lt; right:</span><br><span class="line">        while left &lt; right and li[right] &gt;= tmp: # 从右面找比tmp小的数</span><br><span class="line">            right -= 1 # 往左走一步</span><br><span class="line">        li[left] = li[right] # 把右边的值填到左边的空位上</span><br><span class="line"></span><br><span class="line">        while left &lt; right and li[left] &lt;= tmp: # 从左面找比tmp大的数</span><br><span class="line">            left += 1 # 往右走一步</span><br><span class="line">        li[right] = li[left] # 把左边的值填到右边的空位上</span><br><span class="line"></span><br><span class="line">    li[left] = tmp # 把tmp归位</span><br><span class="line">    return left # 返回中间值</span><br><span class="line"></span><br><span class="line">def quick_sort(li,left,right):</span><br><span class="line">    if left&lt;right :# 至少两个元素</span><br><span class="line">        mid = partition(li,left,right)</span><br><span class="line">        quick_sort(li,left,mid-1)</span><br><span class="line">        quick_sort(li,mid+1,right)</span><br><span class="line"></span><br><span class="line">li = [5,7,4,6,3,1,2,9,8]</span><br><span class="line">quick_sort(li,0,len(li)-1)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>
<h4 id="快速排序的效率"><a href="#快速排序的效率" class="headerlink" title="快速排序的效率"></a>快速排序的效率</h4><ul>
<li>时间复杂度 O(n*log n)</li>
</ul>
<h4 id="快排的问题"><a href="#快排的问题" class="headerlink" title="快排的问题"></a>快排的问题</h4><ul>
<li>递归 (python有个递归层数的问题默认1000)</li>
<li>最坏情况</li>
</ul>
<blockquote>
<p>什么是最坏情况</p>
</blockquote>
<ul>
<li>当列表是 倒序排列的时候 [9,8,7,6,5,4,3,2,1]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">基本和冒泡一样了</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="解决方案就是随机一个数字-而不是固定取第一位"><a href="#解决方案就是随机一个数字-而不是固定取第一位" class="headerlink" title="解决方案就是随机一个数字,而不是固定取第一位"></a>解决方案就是随机一个数字,而不是固定取第一位</h4></blockquote>
<ul>
<li>随机快排</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M08/">M08</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/04/Py007-03-02权限系统介绍/" title="Py007-03-02权限系统介绍" itemprop="url">Py007-03-02权限系统介绍</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-04T15:07:43.000Z" itemprop="datePublished"> Published 2018-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><ul>
<li><p>回顾电影 《2012》 那些能登上“诺亚方舟”的人都是有“权”有“势”的人，而不能登上船的人就只能等死。——说明他们 level不够</p>
</li>
<li><p>公司里员工的薪水——保密</p>
</li>
</ul>
<h4 id="为什么开发权限组件？"><a href="#为什么开发权限组件？" class="headerlink" title="为什么开发权限组件？"></a>为什么开发权限组件？</h4><blockquote>
<p>为什么那些在公司的老员工开发系统时，比你要快。</p>
</blockquote>
<ul>
<li>年限多，写的熟，经验多</li>
<li>老油条</li>
<li>最最重要的是——自己的组件(通用性的组件)</li>
</ul>
<h4 id="web程序中什么是权限"><a href="#web程序中什么是权限" class="headerlink" title="web程序中什么是权限"></a>web程序中什么是权限</h4><blockquote>
<h4 id="一个url"><a href="#一个url" class="headerlink" title="一个url"></a>一个url</h4></blockquote>
<blockquote>
<h4 id="一个url-1"><a href="#一个url-1" class="headerlink" title="一个url"></a>一个url</h4></blockquote>
<blockquote>
<h4 id="一个url-2"><a href="#一个url-2" class="headerlink" title="一个url"></a>一个url</h4></blockquote>
<blockquote>
<p>结论</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url ==&gt; 权限</span><br><span class="line"></span><br><span class="line">人  ==&gt; url</span><br></pre></td></tr></table></figure>
<h3 id="第一版权限控制"><a href="#第一版权限控制" class="headerlink" title="第一版权限控制"></a>第一版权限控制</h3><ul>
<li>多对多关系</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">用户表 </span><br><span class="line">id  user</span><br><span class="line">1   马云 CEO</span><br><span class="line">2   CTO</span><br><span class="line">3   技术</span><br><span class="line">4   前台</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">权限表</span><br><span class="line">id  auth</span><br><span class="line">1   user/list/  查看用户列表</span><br><span class="line">2   user/add/   增加用户</span><br><span class="line">3   user/edit/  编辑用户</span><br><span class="line">4   user/del/   删除用户</span><br><span class="line">5   sale/list   商品销售列表</span><br><span class="line">6   sale/add</span><br><span class="line">7   sale/edit</span><br><span class="line">8   sale/del</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一些虚拟条件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 用户权限关系表</span><br><span class="line">id uid aid</span><br><span class="line"></span><br><span class="line">CEO——1,2,3,4,5,6,7,8所有权限</span><br><span class="line">CTO——1,2,3,4,5,6</span><br><span class="line">技术——1,2,3,4</span><br><span class="line">前台——1,2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>问题来了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//假设又来了一个cto</span><br><span class="line">此时这个cto要新增  1，2，3，4，5，6的权限</span><br><span class="line"></span><br><span class="line">如果此时ceo宣布 cto权限加2个</span><br><span class="line">此时就是两个cto操作2*2 新增数据为4条</span><br><span class="line"></span><br><span class="line">过了一周，ceo说，cto权限删除3个</span><br><span class="line">此时就是两个cto操作2*3 删除数据为6条</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时问题就来了，每次新增用户和新增权限都会导致批量的处理权限</p>
</blockquote>
<ul>
<li>麻烦</li>
</ul>
<blockquote>
<h4 id="角色的概念来了"><a href="#角色的概念来了" class="headerlink" title="角色的概念来了"></a>角色的概念来了</h4></blockquote>
<ul>
<li>不再给人指定权限，而是针对角色</li>
<li>每个角色对应一个权限列表 一个或者多个</li>
<li>每个用户对应一个角色</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M07/">M07</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/04/Py007-03-01crm介绍/" title="Py007-03-01crm介绍" itemprop="url">Py007-03-01crm介绍</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-04T15:00:43.000Z" itemprop="datePublished"> Published 2018-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="CRM"><a href="#CRM" class="headerlink" title="CRM"></a>CRM</h3><p>你一定听说过crm</p>
<blockquote>
<p>但是这次要分为三个目标来讲述crm</p>
</blockquote>
<ul>
<li>权限</li>
<li>stark组件</li>
<li>CRM</li>
</ul>
<h4 id="权限组件"><a href="#权限组件" class="headerlink" title="权限组件"></a>权限组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通用的权限组件</span><br></pre></td></tr></table></figure>
<h4 id="stark组件"><a href="#stark组件" class="headerlink" title="stark组件"></a>stark组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 20分钟的实现</span><br><span class="line">通用的增删改查组件</span><br></pre></td></tr></table></figure>
<h4 id="CRM系统"><a href="#CRM系统" class="headerlink" title="CRM系统"></a>CRM系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">真实业务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">权限+增删改查</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M07/">M07</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/02/Py007-02-13分布式爬虫简介/" title="Py007-02-13分布式爬虫简介" itemprop="url">Py007-02-13分布式爬虫简介</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-02T14:12:31.000Z" itemprop="datePublished"> Published 2018-12-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="分布式爬虫概念"><a href="#分布式爬虫概念" class="headerlink" title="分布式爬虫概念"></a>分布式爬虫概念</h3><ol>
<li>多台机器可以执行同一个爬虫程序，实现网站数据的分布爬取</li>
<li>原生的scrapy是不可以实现分布式爬虫的<ul>
<li>调度器无法在多台机器共享</li>
<li>管道无法共享</li>
</ul>
</li>
<li>scrapy-redis组件：专门为scrapy开发的一套组件。<ul>
<li>该组件可以让scrapy实现分布式</li>
</ul>
</li>
</ol>
<h3 id="scrapy-redis组件"><a href="#scrapy-redis组件" class="headerlink" title="scrapy-redis组件"></a>scrapy-redis组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">pip install scrapy-redis</span><br></pre></td></tr></table></figure>
<h4 id="分布式爬取的流程"><a href="#分布式爬取的流程" class="headerlink" title="分布式爬取的流程"></a>分布式爬取的流程</h4><blockquote>
<h4 id="1-redis配置-事先安装好redis"><a href="#1-redis配置-事先安装好redis" class="headerlink" title="1. redis配置(事先安装好redis)"></a>1. redis配置(事先安装好redis)</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">我的是 5.0版本</span><br><span class="line">切换到 redis5.0.0 的文件目录</span><br><span class="line">找到redis.conf</span><br><span class="line"></span><br><span class="line">    - 注释掉 bind 127.0.0.1 ::1  ==&gt; # bind 127.0.0.1 ::1</span><br><span class="line">    - 关闭保护模式 protected-mode yes ==&gt; protected-mode no</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="2-redis服务器的开启-基于配置文件进行开启"><a href="#2-redis服务器的开启-基于配置文件进行开启" class="headerlink" title="2. redis服务器的开启 基于配置文件进行开启"></a>2. redis服务器的开启 基于配置文件进行开启</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server  ../redis.conf</span><br></pre></td></tr></table></figure>
<p>再开一个客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="3-创建scrapy工程"><a href="#3-创建scrapy工程" class="headerlink" title="3. 创建scrapy工程"></a>3. 创建scrapy工程</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject redisPro</span><br><span class="line"></span><br><span class="line">cd redisPro</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意： 此时要创建一个基于 crawlSpider 的应用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 我们现在就爬取  糗百 糗图的数据</span><br><span class="line">scrapy genspider -t crawl qiubai www.qiushibaike.com/pic</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="4-导入RedisCrawlSpider-类-，然后将爬虫文件修改成基于该类的源文件"><a href="#4-导入RedisCrawlSpider-类-，然后将爬虫文件修改成基于该类的源文件" class="headerlink" title="4. 导入RedisCrawlSpider 类 ，然后将爬虫文件修改成基于该类的源文件"></a>4. 导入RedisCrawlSpider 类 ，然后将爬虫文件修改成基于该类的源文件</h4></blockquote>
<p>spiders/qiubai.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">from scrapy_redis.spiders import RedisCrawlSpider</span><br><span class="line"># class QiubaiSpider(CrawlSpider):</span><br><span class="line"># 修改原先继承的 CrawlSpider 为 RedisCrawlSpider</span><br><span class="line">class QiubaiSpider(RedisCrawlSpider):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="5-将-start-urls-修改成-redis-key-‘调度器队列的名称’"><a href="#5-将-start-urls-修改成-redis-key-‘调度器队列的名称’" class="headerlink" title="5. 将 start_urls 修改成 redis_key = ‘调度器队列的名称’"></a>5. 将 start_urls 修改成 redis_key = ‘调度器队列的名称’</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line">from scrapy_redis.spiders import RedisCrawlSpider</span><br><span class="line">class QiubaiSpider(CrawlSpider):</span><br><span class="line">    name = &apos;qiubai&apos;</span><br><span class="line"></span><br><span class="line">    # 此时要注释掉 allowed_domains 和 start_urls</span><br><span class="line">    # allowed_domains = [&apos;https://www.qiushibaike.com/pic&apos;]</span><br><span class="line">    # start_urls = [&apos;http://https://www.qiushibaike.com/pic/&apos;]</span><br><span class="line"></span><br><span class="line">    # redis_key 它代表调度器队列的名称</span><br><span class="line">    redis_key = &apos;qiubaispider&apos; # 该行代码和 start_urls 一样</span><br><span class="line">    rules = (</span><br><span class="line">        Rule(LinkExtractor(allow=r&apos;Items/&apos;), callback=&apos;parse_item&apos;, follow=True),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        i = &#123;&#125;</span><br><span class="line">        #i[&apos;domain_id&apos;] = response.xpath(&apos;//input[@id=&quot;sid&quot;]/@value&apos;).extract()</span><br><span class="line">        #i[&apos;name&apos;] = response.xpath(&apos;//div[@id=&quot;name&quot;]&apos;).extract()</span><br><span class="line">        #i[&apos;description&apos;] = response.xpath(&apos;//div[@id=&quot;description&quot;]&apos;).extract()</span><br><span class="line">        return i</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="6-将项目的管道和调度器配置成基于-scrapy-redis的组件"><a href="#6-将项目的管道和调度器配置成基于-scrapy-redis的组件" class="headerlink" title="6. 将项目的管道和调度器配置成基于 scrapy-redis的组件"></a>6. 将项目的管道和调度器配置成基于 scrapy-redis的组件</h4></blockquote>
<blockquote>
<p>修改爬虫的代码</p>
</blockquote>
<ul>
<li>处理链接提取器</li>
<li>处理规则处理器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line">from scrapy_redis.spiders import RedisCrawlSpider</span><br><span class="line">class QiubaiSpider(CrawlSpider):</span><br><span class="line">    name = &apos;qiubai&apos;</span><br><span class="line"></span><br><span class="line">    # 此时要注释掉 allowed_domains 和 start_urls</span><br><span class="line">    # allowed_domains = [&apos;https://www.qiushibaike.com/pic&apos;]</span><br><span class="line">    # start_urls = [&apos;http://https://www.qiushibaike.com/pic/&apos;]</span><br><span class="line"></span><br><span class="line">    # redis_key 它代表调度器队列的名称</span><br><span class="line">    redis_key = &apos;qiubaispider&apos; # 该行代码和 start_urls 一样</span><br><span class="line"></span><br><span class="line">    # 糗百糗图  底部分页器</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    &lt;a href=&quot;/pic/page/2?s=5145873&quot; rel=&quot;nofollow&quot;&gt;</span><br><span class="line">    解析规则</span><br><span class="line">    /pic/page/2/?s=5145873</span><br><span class="line">    为啥有个s=5145873  刷新下页面后  发现 s会变化 所以可以把s参数忽略</span><br><span class="line">    /pic/page/\d+</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    link = LinkExtractor(allow=r&apos;/pic/page/\d+&apos;)</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        Rule(link, callback=&apos;parse_item&apos;, follow=True),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        div_list = response.xpath(&apos;//div[@id=&quot;content-left&quot;]/div&apos;)</span><br><span class="line"></span><br><span class="line">        for div in div_list:</span><br><span class="line">            img_url = &apos;https:&apos;+ div.xpath(&apos;.//div[@class=&quot;thumb&quot;]/a/img/@src&apos;).extract_first()</span><br><span class="line"></span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>
<blockquote>
<p>定义items  </p>
</blockquote>
<p>items.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import scrapy</span><br><span class="line"></span><br><span class="line">class RedisproItem(scrapy.Item):</span><br><span class="line">    # define the fields for your item here like:</span><br><span class="line">    # name = scrapy.Field()</span><br><span class="line">    img_url = scrapy.Field()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>导入items类</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import scrapy</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line">from scrapy_redis.spiders import RedisCrawlSpider</span><br><span class="line">from redisPro.items import RedisproItem</span><br><span class="line"></span><br><span class="line">class QiubaiSpider(RedisCrawlSpider):</span><br><span class="line">    name = &apos;qiubai&apos;</span><br><span class="line"></span><br><span class="line">    # 此时要注释掉 allowed_domains 和 start_urls</span><br><span class="line">    # allowed_domains = [&apos;https://www.qiushibaike.com/pic&apos;]</span><br><span class="line">    # start_urls = [&apos;http://https://www.qiushibaike.com/pic/&apos;]</span><br><span class="line"></span><br><span class="line">    # redis_key 它代表调度器队列的名称</span><br><span class="line">    redis_key = &apos;qiubaispider&apos; # 该行代码和 start_urls 一样</span><br><span class="line"></span><br><span class="line">    # 糗百糗图  底部分页器</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    &lt;a href=&quot;/pic/page/2?s=5145873&quot; rel=&quot;nofollow&quot;&gt;</span><br><span class="line">    解析规则</span><br><span class="line">    /pic/page/2/?s=5145873</span><br><span class="line">    为啥有个s=5145873  刷新下页面后  发现 s会变化 所以可以把s参数忽略</span><br><span class="line">    /pic/page/\d+</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    link = LinkExtractor(allow=r&apos;/pic/page/\d+&apos;)</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        Rule(link, callback=&apos;parse_item&apos;, follow=True),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        div_list = response.xpath(&apos;//div[@id=&quot;content-left&quot;]/div&apos;)</span><br><span class="line"></span><br><span class="line">        for div in div_list:</span><br><span class="line">            img_url = &apos;https:&apos;+ div.xpath(&apos;.//div[@class=&quot;thumb&quot;]/a/img/@src&apos;).extract_first()</span><br><span class="line">            item = RedisproItem()</span><br><span class="line">            item[&apos;img_url&apos;] = img_url</span><br><span class="line"></span><br><span class="line">            # 现在是 scrapy的管道， 此时要使用 scrapy_redis 提供的管道 去settings.py 里修改配置</span><br><span class="line">            yield item</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="使用scrapy-redis-提供的管道-RedisPipeline"><a href="#使用scrapy-redis-提供的管道-RedisPipeline" class="headerlink" title="使用scrapy_redis 提供的管道 RedisPipeline"></a>使用scrapy_redis 提供的管道 RedisPipeline</h4></blockquote>
<ul>
<li>修改settings.py</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   &apos;scrapy_redis.pipelines.RedisPipeline&apos;: 400,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="同时对-RedisPipeline-的调度器进行配置"><a href="#同时对-RedisPipeline-的调度器进行配置" class="headerlink" title="同时对 RedisPipeline 的调度器进行配置"></a>同时对 RedisPipeline 的调度器进行配置</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 使用scrapy-redis组件的去重队列</span><br><span class="line">DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="line"># 使用scrapy-redis组件自己的调度器</span><br><span class="line">SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="line"># 是否允许暂停 </span><br><span class="line">SCHEDULER_PERSIST = True</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">SCHEDULER_PERSIST = True 代表 如果分布的一台机器宕机了，</span><br><span class="line">当机器重启后  继续爬虫时， 从上次失败的地方开始爬取，而不是从头爬取</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="7-REDIS-HOST-配置"><a href="#7-REDIS-HOST-配置" class="headerlink" title="7. REDIS_HOST 配置"></a>7. REDIS_HOST 配置</h4></blockquote>
<p>爬虫程序为分布式的所以不仅部署在你的机子上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REDIS_HOST = &apos;redis服务的ip地址&apos;</span><br><span class="line">REDIS_PORT = 6379</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="8-执行爬虫文件"><a href="#8-执行爬虫文件" class="headerlink" title="8.执行爬虫文件"></a>8.执行爬虫文件</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 此时要定位到 爬虫文件的目录 </span><br><span class="line">cd redisPro/spiders</span><br><span class="line">scrapy runspider qiubai.py</span><br><span class="line"></span><br><span class="line"># 最后你发现有一句</span><br><span class="line">linstening at xxxx 代表监听在一个端口</span><br></pre></td></tr></table></figure>
<h4 id="还记得刚刚开启的redis-cli吗？"><a href="#还记得刚刚开启的redis-cli吗？" class="headerlink" title="还记得刚刚开启的redis-cli吗？"></a>还记得刚刚开启的redis-cli吗？</h4><blockquote>
<p>此时你要告诉redis-spider 起始url</p>
</blockquote>
<blockquote>
<p>还记得刚刚起名的 redis_key 吗？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis_key = &apos;qiubaispider&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>糗百-糗图的起始url</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.qiushibaike.com/pic/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在redis-cli里 输入如下信息</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lpush 队列名称  起始url</span><br><span class="line"></span><br><span class="line"># 我们当前应用为</span><br><span class="line"></span><br><span class="line">lpush qiubaispider https://www.qiushibaike.com/pic/</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[scrapy.statscollectors] INFO: Dumping Scrapy stats:</span><br><span class="line">&#123;&apos;finish_reason&apos;: &apos;finished&apos;,</span><br><span class="line"> &apos;finish_time&apos;: datetime.datetime(2018, 12, 2, 15, 26, 8, 106343),</span><br><span class="line"> &apos;log_count/DEBUG&apos;: 1,</span><br><span class="line"> &apos;log_count/INFO&apos;: 7,</span><br><span class="line"> &apos;memusage/max&apos;: 49971200,</span><br><span class="line"> &apos;memusage/startup&apos;: 49971200,</span><br><span class="line"> &apos;start_time&apos;: datetime.datetime(2018, 12, 2, 15, 26, 8, 96989)&#125;</span><br><span class="line">2018-12-02 23:26:08 [scrapy.core.engine] INFO: Spider closed (finished)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="出现这个就去看看-继承的类是否是-RedisCrawlSpider"><a href="#出现这个就去看看-继承的类是否是-RedisCrawlSpider" class="headerlink" title="出现这个就去看看 继承的类是否是 RedisCrawlSpider"></a>出现这个就去看看 继承的类是否是 RedisCrawlSpider</h4></blockquote>
<blockquote>
<h4 id="出现这个就去看看-继承的类是否是-RedisCrawlSpider-1"><a href="#出现这个就去看看-继承的类是否是-RedisCrawlSpider-1" class="headerlink" title="出现这个就去看看 继承的类是否是 RedisCrawlSpider"></a>出现这个就去看看 继承的类是否是 RedisCrawlSpider</h4></blockquote>
<blockquote>
<h4 id="出现这个就去看看-继承的类是否是-RedisCrawlSpider-2"><a href="#出现这个就去看看-继承的类是否是-RedisCrawlSpider-2" class="headerlink" title="出现这个就去看看 继承的类是否是 RedisCrawlSpider"></a>出现这个就去看看 继承的类是否是 RedisCrawlSpider</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class QiubaiSpider(RedisCrawlSpider)</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M07/">M07</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/12/02/Py007-02-12scrapy之CrawlSpider/" title="Py007-02-12scrapy之CrawlSpider" itemprop="url">Py007-02-12scrapy之CrawlSpider</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2018-12-02T12:36:00.000Z" itemprop="datePublished"> Published 2018-12-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<h4 id="如果想对网址进行全站的爬取？"><a href="#如果想对网址进行全站的爬取？" class="headerlink" title="如果想对网址进行全站的爬取？"></a>如果想对网址进行全站的爬取？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">解决方案：</span><br><span class="line">1. 手动请求的发送 (yield) 递归调用</span><br><span class="line"></span><br><span class="line">2. CrawlSpider(推荐)</span><br></pre></td></tr></table></figure>
<h3 id="CrawlSpider"><a href="#CrawlSpider" class="headerlink" title="CrawlSpider"></a>CrawlSpider</h3><ul>
<li>其实就是Spider的一个子类。</li>
<li>功能更加强大(链接提取器，规则解析器)</li>
</ul>
<h3 id="项目实战"><a href="#项目实战" class="headerlink" title="项目实战"></a>项目实战</h3><blockquote>
<p>项目初始化</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject crawlSpiderPro</span><br><span class="line"></span><br><span class="line">cd crawlSpiderPro</span><br><span class="line"></span><br><span class="line"># 以前生成应用是 scrapy genspider chouti dig.chouti.com</span><br><span class="line"></span><br><span class="line"># 此时我们的项目是 CrawlSpider的  所以 生成命令要修改一下</span><br><span class="line"># 此时我们的项目是 CrawlSpider的  所以 生成命令要修改一下</span><br><span class="line"># 此时我们的项目是 CrawlSpider的  所以 生成命令要修改一下</span><br><span class="line"></span><br><span class="line">scrapy genspider -t crawl  chouti dig.chouti.com</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建基于CrawlSpider的的爬虫文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider -t 爬虫名称 起始url</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时 spiders/chouti.py 内容如下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line"># 链接提取器</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line"># 规则解析器</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line">class ChoutiSpider(CrawlSpider):</span><br><span class="line">    name = &apos;chouti&apos;</span><br><span class="line">    # allowed_domains = [&apos;dig.chouti.com&apos;]</span><br><span class="line">    start_urls = [&apos;https://dig.chouti.com/&apos;]</span><br><span class="line">    </span><br><span class="line">    # 实例化一个链接提取器</span><br><span class="line">    # 链接提取器：用来提取指定的链接 (url)</span><br><span class="line">    # allow参数：赋值一个正则表达式</span><br><span class="line">    # 链接提取器就可以根据正则在页面中提取指定的链接</span><br><span class="line">    # 提取到的链接会全部交给规则解析器</span><br><span class="line">    link = LinkExtractor(allow=r&apos;Items/&apos;)</span><br><span class="line">    rules = (</span><br><span class="line">        # 实例化一个规则解析器</span><br><span class="line">        # 规则解析器接收了 链接提取器发送的链接后，就会对这些链接发起请求，获取链接对应的页面内容，就会根据指定的规则对页面内容中指定的数据值进行解析</span><br><span class="line">        # callback:指定一个解析规则(方法/函数)</span><br><span class="line">        Rule(link, callback=&apos;parse_item&apos;, follow=True),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>
<blockquote>
<p>settings.py修改</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 伪装请求载体身份</span><br><span class="line">19行：USER_AGENT = &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36&apos; </span><br><span class="line"></span><br><span class="line">22行：ROBOTSTXT_OBEY = False  #可以忽略或者不遵守robots协议</span><br><span class="line"># 不遵守robots协议</span><br></pre></td></tr></table></figure>
<h4 id="经过如上初始化-我们来对抽屉新热榜进行-爬取"><a href="#经过如上初始化-我们来对抽屉新热榜进行-爬取" class="headerlink" title="经过如上初始化 我们来对抽屉新热榜进行 爬取"></a>经过如上初始化 我们来对抽屉新热榜进行 爬取</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">访问 https://dig.chouti.com/</span><br><span class="line"></span><br><span class="line">看到底部的分页器中的 a标签的href=&quot;/all/hot/recent/12&quot;</span><br><span class="line"></span><br><span class="line">这就是对应的页面url路径</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="修改代码里的-rule"><a href="#修改代码里的-rule" class="headerlink" title="修改代码里的 rule"></a>修改代码里的 rule</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line"># 链接提取器</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line"># 规则解析器</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ChoutiSpider(CrawlSpider):</span><br><span class="line">    name = &apos;chouti&apos;</span><br><span class="line">    # allowed_domains = [&apos;dig.chouti.com&apos;]</span><br><span class="line">    start_urls = [&apos;https://dig.chouti.com/&apos;]</span><br><span class="line"></span><br><span class="line">    # 实例化一个链接提取器</span><br><span class="line">    # 链接提取器：用来提取指定的链接 (url)</span><br><span class="line">    # allow参数：赋值一个正则表达式</span><br><span class="line">    # 链接提取器就可以根据正则在页面中提取指定的链接</span><br><span class="line">    # 提取到的链接会全部交给规则解析器</span><br><span class="line">    link = LinkExtractor(allow=r&apos;/all/hot/recent/\d+&apos;)</span><br><span class="line">    rules = (</span><br><span class="line">        # 实例化一个规则解析器</span><br><span class="line">        # 规则解析器接收了 链接提取器发送的链接后，就会对这些链接发起请求，获取链接对应的页面内容，就会根据指定的规则对页面内容中指定的数据值进行解析</span><br><span class="line">        # callback:指定一个解析规则(方法/函数)</span><br><span class="line">        # follow: 先设置为False 后期详细说明</span><br><span class="line">        Rule(link, callback=&apos;parse_item&apos;, follow=False),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        print(response)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl chouti --nolog</span><br><span class="line"></span><br><span class="line"># 打印如下信息</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/1&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/5&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/4&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/7&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/9&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/3&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/6&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/10&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/2&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/8&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="follow参数"><a href="#follow参数" class="headerlink" title="follow参数"></a>follow参数</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># follow代表 是否将提取器继续作用到 链接提取器取出的链接所表示的页面数据中</span><br><span class="line"></span><br><span class="line"># 刚刚执行爬虫命令后</span><br><span class="line">scrapy crawl chouti --nolog</span><br><span class="line"># 仅仅打印了 10个页码的链接</span><br><span class="line"># 而我们在 到第十页的时候 https://dig.chouti.com/all/hot/recent/10</span><br><span class="line"></span><br><span class="line"># 底部的分页器是</span><br><span class="line">1. 。。。 7 8 9 10 11 12 13 14 </span><br><span class="line"></span><br><span class="line"># 这就意味着 当到第十页的时候  会继续提取后面的页面链接 ==&gt; 直到最后一页数据</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="修改follow-True"><a href="#修改follow-True" class="headerlink" title="修改follow:True"></a>修改follow:True</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import scrapy</span><br><span class="line"># 链接提取器</span><br><span class="line">from scrapy.linkextractors import LinkExtractor</span><br><span class="line"># 规则解析器</span><br><span class="line">from scrapy.spiders import CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ChoutiSpider(CrawlSpider):</span><br><span class="line">    name = &apos;chouti&apos;</span><br><span class="line">    # allowed_domains = [&apos;dig.chouti.com&apos;]</span><br><span class="line">    start_urls = [&apos;https://dig.chouti.com/&apos;]</span><br><span class="line"></span><br><span class="line">    # 实例化一个链接提取器</span><br><span class="line">    # 链接提取器：用来提取指定的链接 (url)</span><br><span class="line">    # allow参数：赋值一个正则表达式</span><br><span class="line">    # 链接提取器就可以根据正则在页面中提取指定的链接</span><br><span class="line">    # 提取到的链接会全部交给规则解析器</span><br><span class="line">    link = LinkExtractor(allow=r&apos;/all/hot/recent/\d+&apos;)</span><br><span class="line">    rules = (</span><br><span class="line">        # 实例化一个规则解析器</span><br><span class="line">        # 规则解析器接收了 链接提取器发送的链接后，就会对这些链接发起请求，获取链接对应的页面内容，就会根据指定的规则对页面内容中指定的数据值进行解析</span><br><span class="line">        # callback:指定一个解析规则(方法/函数)</span><br><span class="line">        # follow: 先设置为False 后期详细说明</span><br><span class="line">        # follow代表 是否将提取器继续作用到 链接提取器取出的链接所表示的页面数据中</span><br><span class="line">        Rule(link, callback=&apos;parse_item&apos;, follow=True),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    def parse_item(self, response):</span><br><span class="line">        print(response)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次执行爬虫命令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl chouti --nolog</span><br><span class="line"></span><br><span class="line"># 打印如下</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/1&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/2&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/3&gt;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/115&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/116&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/117&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/118&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/119&gt;</span><br><span class="line">&lt;200 https://dig.chouti.com/all/hot/recent/120&gt;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/M07/">M07</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/25/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/27/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/oak/" title="oak">oak<sup>71</sup></a></li>
			
		
			
				<li><a href="/tags/前端知识点/" title="前端知识点">前端知识点<sup>43</sup></a></li>
			
		
			
				<li><a href="/tags/java/" title="java">java<sup>37</sup></a></li>
			
		
			
				<li><a href="/tags/Node后端/" title="Node后端">Node后端<sup>36</sup></a></li>
			
		
			
				<li><a href="/tags/M06/" title="M06">M06<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/fullstack/" title="fullstack">fullstack<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/M07/" title="M07">M07<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/M08/" title="M08">M08<sup>25</sup></a></li>
			
		
			
				<li><a href="/tags/ReactWheels/" title="ReactWheels">ReactWheels<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/M04/" title="M04">M04<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/M03/" title="M03">M03<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/M02/" title="M02">M02<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/React入门/" title="React入门">React入门<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/TS入门/" title="TS入门">TS入门<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/CSS/" title="CSS">CSS<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ES6速学/" title="ES6速学">ES6速学<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/M01/" title="M01">M01<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/vue/" title="vue">vue<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>7</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/slTrust/" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="https://huangheping.com/" target="_blank" title="个人网站">个人网站</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021 
		
		<a href="/about" target="_blank" title="Stevin">Stevin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
