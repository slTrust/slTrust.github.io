<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/26/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-React入门004之React通信Redux代替eventHub" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/14/React入门004之React通信Redux代替eventHub/" class="article-date">
  <time datetime="2019-01-14T14:36:38.000Z" itemprop="datePublished">2019-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/14/React入门004之React通信Redux代替eventHub/">React入门004之React通信Redux代替eventHub.html</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="eventHub模式的理解"><a href="#eventHub模式的理解" class="headerlink" title="eventHub模式的理解"></a>eventHub模式的理解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            money.amount -= data</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>特点</p>
</blockquote>
<ol>
<li>所有的数据放在顶层 上一篇我们的money放在了 app中 Redux 推荐把所有数据放归置在一个地方，然后把数据传递给最顶层组件(App)</li>
</ol>
<blockquote>
<p>此时有一个问题发生了,假如我有多个数据呢？ 你就要一个一个属性的传下去</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line">var user = &#123;</span><br><span class="line">    id:321312,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 此时需要在app里</span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money:money,</span><br><span class="line">            user:user</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.money&#125;</span><br><span class="line">                user=&#123;this.state.user&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="eventHub-深入"><a href="#eventHub-深入" class="headerlink" title="eventHub 深入"></a>eventHub 深入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var user = &#123;</span><br><span class="line">    id:3213123,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var store = &#123;</span><br><span class="line">    money:money,</span><br><span class="line">    user:user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;  //订阅 subscribe</span><br><span class="line">            store.money.amount -= data // reducer 对数据的变动</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            store:store</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.store.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.state.store.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        // active       </span><br><span class="line">        eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        eventHub.on(&apos;我要花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                money:money</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>store 就是 集中管理数据的地方</li>
<li>action 就是事件 </li>
<li>我要花钱就是  action type</li>
<li>100金额 就是 payload 载荷</li>
<li>reducer 对数据的变动</li>
<li>subscribe 订阅</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var user = &#123;</span><br><span class="line">    id:3213123,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var store = &#123;</span><br><span class="line">    money:money,</span><br><span class="line">    user:user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line"></span><br><span class="line">eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;  //订阅 subscribe</span><br><span class="line">    store.money.amount -= data // reducer 对数据的变动</span><br><span class="line">    render();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="用-Redux代替-eventHub"><a href="#用-Redux代替-eventHub" class="headerlink" title="用 Redux代替 eventHub"></a>用 Redux代替 eventHub</h3><ul>
<li>bootcdn  里 搜索 redux 并引入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.0/redux.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>由于我们是 JS引入 和 webpack或许有差异</li>
<li>此时我们不知道咋用，咋办？ crm</li>
</ul>
<ol>
<li>谷歌搜 Redux  科学上网的重要性</li>
<li><a href="https://cn.redux.js.org/" target="_blank" rel="noopener">https://cn.redux.js.org/</a> (翻墙可看)</li>
<li>找到 例子   示例 –&gt; <a href="https://cn.redux.js.org/docs/introduction/Examples.html" target="_blank" rel="noopener">https://cn.redux.js.org/docs/introduction/Examples.html</a></li>
<li>Counter 例子 <a href="https://github.com/reduxjs/redux/tree/master/examples/counter" target="_blank" rel="noopener">https://github.com/reduxjs/redux/tree/master/examples/counter</a></li>
<li>crm</li>
<li><p>抄它怎么调的redux <a href="https://github.com/reduxjs/redux/blob/master/examples/counter/src/index.js" target="_blank" rel="noopener">https://github.com/reduxjs/redux/blob/master/examples/counter/src/index.js</a></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;</span><br><span class="line">import Counter from &apos;./components/Counter&apos;</span><br><span class="line">import counter from &apos;./reducers&apos;</span><br><span class="line"></span><br><span class="line">const store = createStore(counter)</span><br><span class="line">const rootEl = document.getElementById(&apos;root&apos;)</span><br><span class="line"></span><br><span class="line">const render = () =&gt; ReactDOM.render(</span><br><span class="line">&lt;Counter</span><br><span class="line">    value=&#123;store.getState()&#125;</span><br><span class="line">    onIncrement=&#123;() =&gt; store.dispatch(&#123; type: &apos;INCREMENT&apos; &#125;)&#125;</span><br><span class="line">    onDecrement=&#123;() =&gt; store.dispatch(&#123; type: &apos;DECREMENT&apos; &#125;)&#125;</span><br><span class="line">/&gt;,</span><br><span class="line">rootEl</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">render()</span><br><span class="line">store.subscribe(render)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//别忘记引入redux.js</span><br><span class="line">// 通过抄别人的  我们造出了 自己的store</span><br><span class="line">let createStore = Redux.createStore;</span><br><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amoune:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;a&apos;:</span><br><span class="line">            return state + 1</span><br><span class="line">        case &apos;b&apos;:</span><br><span class="line">            return state - 1</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducers);</span><br><span class="line">console.log(store.getState())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时之前的 eventHub 和 管家都不需要了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.0/redux.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">let createStore = Redux.createStore;</span><br><span class="line"></span><br><span class="line">//管家 ——一个函数 他会得到（之前的state，花钱的动作）</span><br><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    //初始化</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amount:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;我想花钱&apos;:</span><br><span class="line">            return &#123;</span><br><span class="line">                money:&#123;</span><br><span class="line">                    amount:state.money.amount - action.payload</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducers);</span><br><span class="line">console.log(store.getState())</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.props.store.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.props.store.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        // active       </span><br><span class="line">        // eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line">        store.dispatch(&#123;type:&apos;我想花钱&apos;,payload:100&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App store=&#123;store.getState()&#125;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render()</span><br><span class="line">// 订阅数据的改变同步更新</span><br><span class="line">store.subscribe(render)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>是不是觉得Redux很啰嗦</p>
</blockquote>
<ul>
<li>eventHub能看懂</li>
<li>用 redux反而很恶心</li>
</ul>
<blockquote>
<h4 id="Redux为啥这样做"><a href="#Redux为啥这样做" class="headerlink" title="Redux为啥这样做"></a>Redux为啥这样做</h4></blockquote>
<ul>
<li>所有的框架都有一个使命——防呆(怕你的队友是个猪队友)</li>
<li>所以Redux最大的功能就是防呆</li>
</ul>
<blockquote>
<p>eventHub的问题</p>
</blockquote>
<ul>
<li><p>事件名可能任意的，分散在各处，而你用redux强制要求你集中的在 switch里</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    //初始化</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amount:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;我想花钱&apos;:</span><br><span class="line">            return &#123;</span><br><span class="line">                money:&#123;</span><br><span class="line">                    amount:state.money.amount - action.payload</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>redux的约束 你必须每个事件给我一个事件名和 payload 并且列在一起</p>
</li>
<li><p>你只能用 props的方式 使用 store={store.getState()}</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//getState()只读的方式告诉你  不要修改</span><br><span class="line">//因为通过 props能防猪队友 </span><br><span class="line"></span><br><span class="line">// 猪队友</span><br><span class="line">// 通过引用修改数据</span><br><span class="line">this.props.money.amount -= 200</span><br><span class="line">// 即使用redux 依然也是可以通过引用改的</span><br><span class="line">这是 JS的 bug</span><br></pre></td></tr></table></figure>
</li>
<li><p>redux可以让不懂英语的前端 走远一点</p>
</li>
<li>比如 payload 实际就是个 data </li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/14/React入门004之React通信Redux代替eventHub/" data-id="cknvgpu5700p50xjp15ny3u4m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React入门/">React入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React入门004之React通信eventHub" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/13/React入门004之React通信eventHub/" class="article-date">
  <time datetime="2019-01-13T09:25:41.000Z" itemprop="datePublished">2019-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/13/React入门004之React通信eventHub/">React入门004之React通信eventHub</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="组件通信的回顾"><a href="#组件通信的回顾" class="headerlink" title="组件通信的回顾"></a>组件通信的回顾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            msg :&apos;你好！&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    changeMsg()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            msg:&apos;你也好！&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;Box msg=&#123;this.state.msg&#125; </span><br><span class="line">                        fn=&#123;this.changeMsg.bind(this)&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Box(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;得到父组件的消息为&#123;props.msg&#125;&lt;/h2&gt;</span><br><span class="line">            &lt;div onClick=&#123;props.fn&#125;&gt;回复&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="一个家族的通信模型"><a href="#一个家族的通信模型" class="headerlink" title="一个家族的通信模型"></a>一个家族的通信模型</h3><ul>
<li>打开jsbin</li>
<li>添加react支持的库文件</li>
<li>Javascript选择 React(JSX)</li>
</ul>
<p>如图<br><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-01.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function FirstFather(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">            &lt;div&gt;大爸&lt;/div&gt;</span><br><span class="line">            &lt;Son1/&gt;</span><br><span class="line">            &lt;Son2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function SecondFather(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">            &lt;div&gt;二爸&lt;/div&gt;</span><br><span class="line">            &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子1</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">function Son2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子2</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son3()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子3</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son4()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子4</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个家族里爷爷留给后代的所有财产 100000元，后代们一起使用</p>
</blockquote>
<ol>
<li>二儿子用100 其他人怎么同步余额</li>
<li>把所有金额通知给所有人</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1/&gt;</span><br><span class="line">                &lt;Son2/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        money.amount -= 100</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.state.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在点击消费按钮，只有二儿子的数据更新了</p>
</blockquote>
<ul>
<li>虽然用的是同一个 money 对象</li>
<li>但是这些组件你都没有去调用它的setState方法，所以它们不知道你消费的动作，所以一直保留旧的金额</li>
</ul>
<blockquote>
<p>一种假设 假如 大儿子 二儿子 都是败家子 </p>
</blockquote>
<ol>
<li>二儿子去酒店把100000  花完了</li>
<li>大儿子不知道钱已经没了 还觉得有10万块，去夜店消费 ，消费后发现 没钱了——被暴打了一顿</li>
<li>这样就很不好</li>
</ol>
<blockquote>
<p>如果用上一篇的办法就会导致，用如下迂回的方式</p>
</blockquote>
<ol>
<li>二儿子消费了100后,通知它大爸</li>
<li>大爸通知大儿子 通知二爸 </li>
<li>二爸通知三儿子 二爸通知四儿子</li>
</ol>
<ul>
<li>这样一看就很垃圾</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-02.png" alt></p>
<blockquote>
<h4 id="有木有一种方案让任意两个组件之间都可以通信"><a href="#有木有一种方案让任意两个组件之间都可以通信" class="headerlink" title="有木有一种方案让任意两个组件之间都可以通信"></a>有木有一种方案让任意两个组件之间都可以通信</h4></blockquote>
<ul>
<li>雇一个管家 让他专门管理财务</li>
<li>此时二儿子通知管家我要花钱  如果是小金额 管家直接给了</li>
<li>如果是大金额 管家就通知 大爸 这钱能不能给二儿子 大爸说可以  就把钱给 二儿子</li>
<li>这就是我们现实生活中所有人共用一个数据 矛盾的情况</li>
</ul>
<blockquote>
<p>雇一个人专门管这件事</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-03.png" alt></p>
<h3 id="发布订阅模式-EventHub"><a href="#发布订阅模式-EventHub" class="headerlink" title="发布订阅模式(EventHub)"></a>发布订阅模式(EventHub)</h3><p>代码实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//订阅的事件</span><br><span class="line">var eventMap = &#123;</span><br><span class="line">    // 蒙牛:[&apos;张三&apos;,&apos;李四&apos;,&apos;王五&apos;],</span><br><span class="line">    // 光明:[&apos;熊大&apos;,&apos;光头强&apos;]</span><br><span class="line">&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 订阅——事件</span><br><span class="line">eventHub.on(&apos;我要用钱&apos;,function fn1(data)&#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 发布——事件</span><br><span class="line">eventHub.trigger(&apos;我要用钱&apos;,100)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码修改如下 二儿子花钱了 通知 三儿子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1/&gt;</span><br><span class="line">                &lt;Son2/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        money.amount -= 100</span><br><span class="line">        eventHub.trigger(&apos;我要花钱&apos;,100)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.state.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">        eventHub.on(&apos;我要花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                money:money</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="新问题：如果-大爸-二爸-二儿子的兄弟-都想知道呢？"><a href="#新问题：如果-大爸-二爸-二儿子的兄弟-都想知道呢？" class="headerlink" title="新问题：如果 大爸 二爸 二儿子的兄弟 都想知道呢？"></a>新问题：如果 大爸 二爸 二儿子的兄弟 都想知道呢？</h4></blockquote>
<ul>
<li>总不能每个组件都 监听这个 事件吧，这样就太麻烦了</li>
</ul>
<blockquote>
<h4 id="之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息"><a href="#之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息" class="headerlink" title="之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息"></a>之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息</h4></blockquote>
<ul>
<li>先斩后奏(不行)</li>
<li>该如何处理呢？</li>
</ul>
<blockquote>
<h4 id="这个钱你们谁也不准改"><a href="#这个钱你们谁也不准改" class="headerlink" title="这个钱你们谁也不准改"></a>这个钱你们谁也不准改</h4></blockquote>
<ol>
<li>花钱必须通知管家，(你不能把钱花了在告诉管家，管家帮你擦屁股)</li>
<li>所有组件不能修改money</li>
<li>不能修改money我咋花钱呢？ 花钱可以——发消息</li>
<li>移除所有组件里 money的引用 也就是不要用 state</li>
<li>改用 props 放在 顶层的app里</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            money.amount -= data</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.state.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        eventHub.trigger(&apos;我想花钱&apos;,100)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>点击消费按钮时候——如何触发的更新呢？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome里查看dom解构，只有文字改变了元素还在</span><br><span class="line"></span><br><span class="line">这就是 React的 NB之处——只更新需要更新的地方 DOM diff</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="这就是——单向数据流"><a href="#这就是——单向数据流" class="headerlink" title="这就是——单向数据流"></a>这就是——单向数据流</h4></blockquote>
<ul>
<li>数据放在顶层</li>
<li>通过props一层层的传递下去</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-05.png" alt></p>
<p>以前我们只能这样：有上有下 (就不是单向数据流)</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-04.png" alt></p>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/13/React入门004之React通信eventHub/" data-id="cknvgpu5700p70xjptfkuynzk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React入门/">React入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React入门003之React通信" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/13/React入门003之React通信/" class="article-date">
  <time datetime="2019-01-13T02:50:28.000Z" itemprop="datePublished">2019-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/13/React入门003之React通信/">React入门003之React通信</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="生趣例子——龟兔赛跑"><a href="#生趣例子——龟兔赛跑" class="headerlink" title="生趣例子——龟兔赛跑"></a>生趣例子——龟兔赛跑</h3><ul>
<li>请使用 jsbin</li>
<li>拷贝对应代码到对应区域</li>
<li>JavaScript 选择 (React)Javascript</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    .header&#123;</span><br><span class="line">    display:flex;</span><br><span class="line">    justify-content:center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .track&#123;</span><br><span class="line">    border:1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1/&gt;</span><br><span class="line">        &lt;Track2/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">function Track1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div&gt;🐰&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">function Track2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div&gt;🐢&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="需求2：如何让兔子动？"><a href="#需求2：如何让兔子动？" class="headerlink" title="需求2：如何让兔子动？"></a>需求2：如何让兔子动？</h3><ul>
<li>css就可以做到</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">只要让 Track1里的  </span><br><span class="line">&lt;div style=&quot;transform: translateX(12%);&quot;&gt;🐰&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>新问题:让兔子动就要改变 这个div的style===》如何改变div的style</li>
</ul>
<ol>
<li>你不能在内部改变函数组件的东西</li>
<li>你需要把 Track1变成一个 class组件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            progress:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&quot;transfrom:translateX(0%);&quot;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>卡壳了：React如何设置 style</p>
</blockquote>
<p>google搜 react style</p>
<p>得到一个结果 <a href="https://zhenyong.github.io/react/tips/inline-styles.html" target="_blank" rel="noopener"> Inline Styles | React</a>点进去</p>
<p>给了个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var divStyle = &#123;</span><br><span class="line">  color: &apos;white&apos;,</span><br><span class="line">  backgroundImage: &apos;url(&apos; + imgUrl + &apos;)&apos;,</span><br><span class="line">  WebkitTransition: &apos;all&apos;, // note the capital &apos;W&apos; here</span><br><span class="line">  msTransition: &apos;all&apos; // &apos;ms&apos; is the only lowercase vendor prefix</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;div style=&#123;divStyle&#125;&gt;Hello World!&lt;/div&gt;, mountNode);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>继续改写我们的 Track</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX(20%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>定时器让 兔子 动</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 1</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,100)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>兔子速度快一点，乌龟跑的慢一点（改写两个track）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 1</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么一跳一跳的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 线性匀速</span><br><span class="line">.player&#123;</span><br><span class="line">    transition:all 1s linear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>跑到终点就停下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重点环节-通信"><a href="#重点环节-通信" class="headerlink" title="重点环节 (通信)"></a>重点环节 (通信)</h3><blockquote>
<p> 跑到终点告诉裁判我停了</p>
</blockquote>
<ul>
<li>父组件传递监听的事件 success1/success2</li>
<li>props传递属性 success</li>
<li>事件完成后 调用 props.success()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    let success1 = ()=&gt;&#123;console.log(&apos;兔子跑完了&apos;)&#125;</span><br><span class="line">    let success2 = ()=&gt;&#123;console.log(&apos;乌龟跑完了&apos;)&#125;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">        &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 5</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个小bug就是 兔子没跑到终点就打印了 跑完了 因为 css里的 线性动画( 移除 player样式即可)</p>
</blockquote>
<blockquote>
<p>跑到终点所用时间</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    let t0 = new Date();</span><br><span class="line"></span><br><span class="line">    let success1 = ()=&gt;&#123;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;)</span><br><span class="line">        console.log(new Date() - t0)</span><br><span class="line">    &#125;</span><br><span class="line">    let success2 = ()=&gt;&#123;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;)</span><br><span class="line">        console.log(new Date() - t0)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ...</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="将结束时间更新到-Time1-Time2上"><a href="#将结束时间更新到-Time1-Time2上" class="headerlink" title="将结束时间更新到 Time1/Time2上"></a>将结束时间更新到 Time1/Time2上</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1 result=&#123;&#125;/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">        &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如何单独把结果render 到Timer1呢？</li>
<li>不好意思函数组件是做不到的</li>
</ul>
<blockquote>
<p>用 class组件改写 app</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;)</span><br><span class="line">        console.log(new Date() - this.t0)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;)</span><br><span class="line">        console.log(new Date() - this.t0)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Track1 success=&#123;this.success1.bind(this)&#125;/&gt;</span><br><span class="line">                &lt;Track2 success=&#123;this.success2.bind(this)&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>完整版</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        let t1 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;,t1)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result1:t1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        let t2 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;,t2)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result2:t2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result2&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Track1 success=&#123;this.success1.bind(this)&#125;/&gt;</span><br><span class="line">                &lt;Track2 success=&#123;this.success2.bind(this)&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 25</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 15</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><blockquote>
<p>请问 React的父子组件如何通信</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">父组件通过props传递一个函数给子元素 </span><br><span class="line">子元素在恰当的时候调用这个函数</span><br></pre></td></tr></table></figure>
<h3 id="需求变更-添加操场"><a href="#需求变更-添加操场" class="headerlink" title="需求变更(添加操场)"></a>需求变更(添加操场)</h3><ul>
<li>App里是 操场 Playground</li>
<li>操场Playground里有跑道Track</li>
</ul>
<blockquote>
<p>咋办呢？ 很简单 把success传递给 操场<br>然后在操场里通过 props接受 再次传递给 Track</p>
</blockquote>
<p>代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    *&#123;margin:0;padding:0;box-sizing: border-box;&#125;</span><br><span class="line">    .header&#123;</span><br><span class="line">        display:flex;</span><br><span class="line">        justify-content:center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .track&#123;</span><br><span class="line">        border:1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">    .player&#123;</span><br><span class="line">        transition:all 1s linear;</span><br><span class="line">    &#125;</span><br><span class="line">    .playground&#123;</span><br><span class="line">        border:1px solid black;</span><br><span class="line">        background: green;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        let t1 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;,t1)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result1:t1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        let t2 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;,t2)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result2:t2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result2&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Playground success1=&#123;this.success1.bind(this)&#125;</span><br><span class="line">                            success2=&#123;this.success2.bind(this)&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Playground(props)&#123;</span><br><span class="line">    let success1 = props.success1</span><br><span class="line">    let success2 = props.success2</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;playground&quot;&gt;</span><br><span class="line">            &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">            &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 25</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 15</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="面试肯定问爷孙通信是咋实现的"><a href="#面试肯定问爷孙通信是咋实现的" class="headerlink" title="面试肯定问爷孙通信是咋实现的"></a>面试肯定问爷孙通信是咋实现的</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就像上面一样 Playground 从 App哪里把属性props传递下来(继承下来) 传递给 Track</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果是曾爷爷怎么办</p>
</blockquote>
<p>当然是顺着这个家族在多传递一次了</p>
<blockquote>
<h4 id="思考？如果是-兄弟之间如何通信呢？"><a href="#思考？如果是-兄弟之间如何通信呢？" class="headerlink" title="思考？如果是 兄弟之间如何通信呢？"></a>思考？如果是 兄弟之间如何通信呢？</h4></blockquote>
<p>下一篇我们来解决</p>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/13/React入门003之React通信/" data-id="cknvgpu5a00pd0xjp7wu0dmsi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React入门/">React入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React入门002之React组件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/11/React入门002之React组件/" class="article-date">
  <time datetime="2019-01-11T12:54:17.000Z" itemprop="datePublished">2019-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/11/React入门002之React组件/">React入门002之React组件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h3><p>上一篇文章我们实现了 JSX语法写 html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="假如我们写淘宝页面呢？"><a href="#假如我们写淘宝页面呢？" class="headerlink" title="假如我们写淘宝页面呢？"></a>假如我们写淘宝页面呢？</h3></blockquote>
<ul>
<li>1000行铁定不够的</li>
<li>总不能在一个render里 写1000行以上这样的结构吧</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            .... 写xxx行</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="于是React作者就在想，如何能避免所有代码写在一坨呢？"><a href="#于是React作者就在想，如何能避免所有代码写在一坨呢？" class="headerlink" title="于是React作者就在想，如何能避免所有代码写在一坨呢？"></a>于是React作者就在想，如何能避免所有代码写在一坨呢？</h4></blockquote>
<ul>
<li>最简单的方法就是用一个——函数 来把代码包裹起来</li>
</ul>
<blockquote>
<h3 id="看看我们的代码-请使用jsbin"><a href="#看看我们的代码-请使用jsbin" class="headerlink" title="看看我们的代码(请使用jsbin)"></a>看看我们的代码(请使用jsbin)</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 使用这个</span><br><span class="line">https://jsbin.com/</span><br><span class="line"></span><br><span class="line"># 引入</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"># javascript选择 (JSX)React 否则报错</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="一个非常大的坑-return-后面不要直接换行——-那样返回的是-undefined"><a href="#一个非常大的坑-return-后面不要直接换行——-那样返回的是-undefined" class="headerlink" title="一个非常大的坑 return 后面不要直接换行—— 那样返回的是 undefined"></a>一个非常大的坑 return 后面不要直接换行—— 那样返回的是 undefined</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 返回的是 undefined</span><br><span class="line">// 返回的是 undefined</span><br><span class="line">// 返回的是 undefined</span><br><span class="line">function App()&#123;</span><br><span class="line">    return </span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;span&gt;&#123;number&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="我就想换行咋办-加"><a href="#我就想换行咋办-加" class="headerlink" title="我就想换行咋办,加()"></a>我就想换行咋办,加()</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;span&gt;&#123;number&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="看代码"><a href="#看代码" class="headerlink" title="看代码"></a>看代码</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">  number += 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">  number -= 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">        &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        React.createElement(App),</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ------华丽的分割线---------------------------------------------------</span><br><span class="line">// render里 React.createElement(App), 是不是很丑</span><br><span class="line">// 由于我们用的是 JSX</span><br><span class="line">// 你可以这样</span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 或者</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App&gt;&lt;/App&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>JSX语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;App&gt;&lt;/App&gt;  &lt;==等价于==&gt;  React.createElement(App)</span><br><span class="line"></span><br><span class="line">标签还可以再次简写为 ，因为它不是 html语法 它是 xml语法(标签里没有任何东西，可以自闭合)</span><br><span class="line">&lt;App/&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>优化一下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">  number += 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">  number -= 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Box1/&gt;</span><br><span class="line">        &lt;Box2/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;App/&gt;,</span><br><span class="line">    document.querySelector(&apos;#root&apos;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="以上就是组件的萌芽想法"><a href="#以上就是组件的萌芽想法" class="headerlink" title="以上就是组件的萌芽想法"></a>以上就是组件的萌芽想法</h3></blockquote>
<h3 id="如何给-标签传递参数呢？"><a href="#如何给-标签传递参数呢？" class="headerlink" title="如何给 标签传递参数呢？"></a>如何给 标签传递参数呢？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">    number += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">    number -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>react的作者非常聪明，他把属性理解为对象的一个key/value</li>
</ul>
<blockquote>
<p>React的创举就是</p>
</blockquote>
<ul>
<li>虚拟dom</li>
<li>标签就是函数，函数就是对象，标签的属性就是函数的参数</li>
</ul>
<h3 id="上述代码的Box1和Box2有一个bug"><a href="#上述代码的Box1和Box2有一个bug" class="headerlink" title="上述代码的Box1和Box2有一个bug"></a>上述代码的Box1和Box2有一个bug</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">点击 Box1的 &quot;+&quot; Box2的数字也增加了。</span><br><span class="line"></span><br><span class="line">因为点击 Box1的 时候 触发了 add 导致 number++ 然后 render() </span><br><span class="line"></span><br><span class="line">在render()的时候重新渲染了，而且 Box1 和 Box2使用的是同一个 number</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时你肯定想，既然能给组件传递参数，那我们传递一个number 这样 Box1和Box2就互不影响了</p>
</blockquote>
<ul>
<li>答案是不行，因为React规定了一个事——不允许修改别人传递给你的参数</li>
<li>我就要改，会给你一个警告。</li>
<li>永远不要修改别人给你的属性，你修改了，不会有什么后果，但是后果自负。肯定会有bug,可能你现在不会觉得有bug，但是过了几个月一定会有bug</li>
</ul>
<blockquote>
<p>最朴素的想法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">let number1 = 0 ;</span><br><span class="line">let add1 = ()=&gt;&#123;</span><br><span class="line">    number1 += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus1 = ()=&gt;&#123;</span><br><span class="line">    number1 -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let number2 = 0 ;</span><br><span class="line">let add2 = ()=&gt;&#123;</span><br><span class="line">    number2 += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus2 = ()=&gt;&#123;</span><br><span class="line">    number2 -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number1 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add1 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus1 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number2 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add2 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="虽然不相互影响了"><a href="#虽然不相互影响了" class="headerlink" title="虽然不相互影响了"></a>虽然不相互影响了</h4></blockquote>
<ul>
<li>但是多出了很多无用变量</li>
<li>如果是100个组件呢？ 声明100个这样的岂不是疯了</li>
</ul>
<blockquote>
<p>卡壳了</p>
</blockquote>
<ul>
<li>我不能修改别人给我的属性</li>
<li>如果有100个组件就要100个这样的重复声明，一看页面要懵了</li>
</ul>
<blockquote>
<p>又想到一个好办法，将 number属性内置</p>
</blockquote>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    let number1 = 0 ;</span><br><span class="line">    console.log(&apos;把number变成 0&apos;,number1)</span><br><span class="line">    let add1 = ()=&gt;&#123;</span><br><span class="line">        number1 += 1;</span><br><span class="line">        console.log(&apos;把number变成 1&apos;,number1)</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    let minus1 = ()=&gt;&#123;</span><br><span class="line">        number1 -= 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number1 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add1 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus1 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    let number2 = 0 ;</span><br><span class="line">    let add2 = ()=&gt;&#123;</span><br><span class="line">        number2 += 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    let minus2 = ()=&gt;&#123;</span><br><span class="line">        number2 -= 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number2 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add2 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">思路是没错的</span><br><span class="line">错就错在了 render </span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>此时 点击 add 没反应了</p>
</blockquote>
<ul>
<li>思路很好将变量内置</li>
<li>错就错在 render了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">点击 add 触发 number+=1 </span><br><span class="line">然后 调用 render()</span><br><span class="line">render 执行会调用 Box1</span><br><span class="line">Box1里  let number = 0 </span><br><span class="line">所以你怎么点击 都是0</span><br><span class="line"></span><br><span class="line">--------------------------------</span><br><span class="line">虽然思路非常好，但是现实把你打败了，你做不到，因为函数的功能过于单一了</span><br><span class="line">此时再次陷入窘境</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们为什么出错,因为这个render，一render就render整个页面</p>
</blockquote>
<blockquote>
<p>如果不render整个页面，只render自己呢？</p>
</blockquote>
<ul>
<li>肯定不能用函数来搞组件了</li>
<li>不能render整个app</li>
</ul>
<blockquote>
<p>react作者想到，什么比函数高级呢？——类</p>
</blockquote>
<h3 id="class组件"><a href="#class组件" class="headerlink" title="class组件"></a>class组件</h3><p>语法规定</p>
<ul>
<li>继承React.Component</li>
<li>必须实现 render方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;app2&lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="传递参数呢？"><a href="#传递参数呢？" class="headerlink" title="传递参数呢？"></a>传递参数呢？</h4></blockquote>
<ul>
<li>注意！ 我们管接受到的参数叫 props</li>
<li>注意！ 我们管接受到的参数叫 props</li>
<li>注意！ 我们管接受到的参数叫 props</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 之前传递参数</span><br><span class="line">function App(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            app &#123;props.name&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 现在使用参数</span><br><span class="line">// 这个 props 是由父类React.Component构造的 你不继承就没有</span><br><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    render()&#123; // 局部 render</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;app2 &#123;this.props.name&#125; &#123;this.props.age&#125;&lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2 name=&quot;hjx&quot; age=&quot;18&quot;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">// 注意在 html里 没有 数字 只有字符串</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="组件的局部变量呢？可以了这次"><a href="#组件的局部变量呢？可以了这次" class="headerlink" title="组件的局部变量呢？可以了这次"></a>组件的局部变量呢？可以了这次</h4></blockquote>
<ul>
<li>文档规定局部变量必须在 constructor 里设置</li>
<li>this.state = {k:v,k2:v2}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">// 规定组件的参数叫做 props </span><br><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">        //报错</span><br><span class="line">        this.state.number +=1</span><br><span class="line">        // 而且这里的this 是 undefined</span><br><span class="line">        // 因为react 调用 onClick的时候是这样调用的</span><br><span class="line">        onClick = add.call(undefined, 参数)</span><br><span class="line">        React强制把this变成 undefined</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        // 这样也是不能修改的</span><br><span class="line">        // this.state.number +=1</span><br><span class="line">        // 必须要用 setState</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                app2&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">        // 新手必犯错 onClick = &#123;this.add()&#125;  </span><br><span class="line">        // add()是函数的返回值</span><br><span class="line">        // &lt;button onClick=&#123;this.add()&#125;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">        // 绑定this有两种方式</span><br><span class="line">        /*</span><br><span class="line">        第一种 bind(this)</span><br><span class="line">        onClick=&#123;this.add.bind(this)&#125;</span><br><span class="line">        第二种 箭头函数</span><br><span class="line">        onClick=&#123;()=&gt;this.add&#125;</span><br><span class="line">        */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2 name=&quot;hjx&quot;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="使用class组件的限制"><a href="#使用class组件的限制" class="headerlink" title="使用class组件的限制"></a>使用class组件的限制</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 必须继承  React.Component</span><br><span class="line">2. 想自定义属性，必须写 constructor() constructor必须接受一个 props参数</span><br><span class="line">3.  在 constructor里 必须用super(props) 这是 js规定的</span><br><span class="line">4. 必须在 constructor 初始化 state</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            x:0,</span><br><span class="line">            y:1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">你的事件可以放到 class内部</span><br><span class="line"></span><br><span class="line">你必须要有一个render函数 同时 render必须 返回一个标签 而且这个标签只能有一个根元素</span><br><span class="line"></span><br><span class="line">如果你在标签里想用porps必须 是 &#123;this.props.xxx&#125;</span><br><span class="line">如果你想用state 必须是 &#123;this.state.xxx&#125;</span><br><span class="line"></span><br><span class="line">如果你想用 onClick 事件 必须 自己绑定this</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="用class组件实现-box1-box2"><a href="#用class组件实现-box1-box2" class="headerlink" title="用class组件实现 box1 box2"></a>用class组件实现 box1 box2</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">class Box1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    minus()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number - 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                Box1-&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                    &lt;button onClick=&#123;this.minus.bind(this)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Box2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    minus()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number - 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                Box2-&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                    &lt;button onClick=&#123;this.minus.bind(this)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;hjx1&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;hjx2&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="你的疑惑为什么更新数据要-setState-而不是直接改？"><a href="#你的疑惑为什么更新数据要-setState-而不是直接改？" class="headerlink" title="你的疑惑为什么更新数据要 setState 而不是直接改？"></a>你的疑惑为什么更新数据要 setState 而不是直接改？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add()&#123;</span><br><span class="line">    //为什么是 setState</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">    为什么不是这样写，这样更方便理解啊！</span><br><span class="line">    this.state.number += 1</span><br><span class="line">    render()</span><br><span class="line">    */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="setState-优点"><a href="#setState-优点" class="headerlink" title="setState 优点"></a>setState 优点</h4></blockquote>
<ul>
<li><p>setState可以对更新进行优化，有的时候你自己render很容易 重复调用，这样页面就卡了,减少更新的损耗</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this.state.number +=1</span><br><span class="line">render()</span><br><span class="line">this.state.name = &apos;aa&apos;</span><br><span class="line">render()</span><br><span class="line">this.state.age = 19</span><br><span class="line">render()</span><br></pre></td></tr></table></figure>
</li>
<li><p>setState会将 大批量的更新合并为一次更新</p>
</li>
</ul>
<blockquote>
<p>Box2的 点击 加二 或者 减二</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// 这个肯定没问题</span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我能不能分两次 setState呢？</span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 答案是不行的</span><br><span class="line">假设初始的时候 number = 0</span><br><span class="line">第一次 setState</span><br><span class="line">this.setState(&#123;</span><br><span class="line">    number:this.state.number + 1</span><br><span class="line">&#125;)</span><br><span class="line">但是第二次 setState 时候 this.state.number到底是0还是1呢？</span><br><span class="line"></span><br><span class="line">你会说 不是已经 setState 过了吗？</span><br><span class="line"></span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如何解决 add函数内两次 setState呢？ —— 函数回调</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">add()&#123;</span><br><span class="line">    this.setState((state)=&gt;&#123;</span><br><span class="line">        return &#123;number:state.number+1&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    this.setState((state)=&gt;&#123;</span><br><span class="line">        return &#123;number:state.number+1&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 但是明显你不会这么智障的写代码</span><br><span class="line"></span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">       number:this.state.number + 2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>至此我们知道我们有个 应用App 它内部有两个盒子 Box1和 Box2,然后你就去看Box1的实现，又继续去看Box2的实现，此时代码非常的模块化</p>
</blockquote>
<blockquote>
<p>而且 Box1中 点击 add就会 number+=1 然后自己调用 render，而且render只会更新 Box1 里的div 而且只会更新你改的number</p>
</blockquote>
<blockquote>
<p>Box1的 render过程每次都会去跟上一次对比 发现 span里的number变了 ,那么就找到这个位置只改 <span>内的 {this.state.number}</span></p>
</blockquote>
<h4 id="寻找两次render结果不同之处的过程-叫做——-DOM-diff"><a href="#寻找两次render结果不同之处的过程-叫做——-DOM-diff" class="headerlink" title="寻找两次render结果不同之处的过程 叫做—— DOM diff"></a>寻找两次render结果不同之处的过程 叫做—— DOM diff</h4><ul>
<li>如果面试官问你 dom diff的细节，就要看给多少工资 你给10K以下，你就呸，我会这个还跟你来面试</li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/11/React入门002之React组件/" data-id="cknvgpu5500p10xjpqiaglo1f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React入门/">React入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React入门001之React诞生" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/09/React入门001之React诞生/" class="article-date">
  <time datetime="2019-01-09T14:41:19.000Z" itemprop="datePublished">2019-01-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/09/React入门001之React诞生/">React入门001之React诞生</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简单的-add-reduce-需求"><a href="#简单的-add-reduce-需求" class="headerlink" title="简单的 add / reduce 需求"></a>简单的 add / reduce 需求</h3><ul>
<li>实现 页面显示 一个数字 </li>
<li>点击add +1 </li>
<li>点击reduce -1</li>
</ul>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span id=&quot;result&quot;&gt;0&lt;/span&gt;</span><br><span class="line">        &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button id=&quot;minus&quot;&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    let result = document.querySelector(&apos;#result&apos;);</span><br><span class="line">    let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line">    let minus = document.querySelector(&apos;#minus&apos;);</span><br><span class="line"></span><br><span class="line">    add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let number = parseInt(result.innerText,10);</span><br><span class="line">        number += 1;</span><br><span class="line">        result.innerText = number;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    minus.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let number = parseInt(result.innerText,10);</span><br><span class="line">        number -= 1;</span><br><span class="line">        result.innerText = number;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-01.png" alt></p>
<blockquote>
<p>如上代码无论如何优化,本质没有改变，过程如下</p>
</blockquote>
<ul>
<li>获取节点元素的值,js中修改元素的值</li>
<li>获取节点元素的值,js中回填修改后的值</li>
</ul>
<blockquote>
<p>如果是你呢？</p>
</blockquote>
<ul>
<li>要么把获取值(num = xx.innerText)干掉 (不去获取了，直接更新dom)</li>
<li>要么把回填值(xx.innerText = xxx)干掉 (不现实，这样就js无法通知页面了)</li>
</ul>
<h3 id="React诞生"><a href="#React诞生" class="headerlink" title="React诞生"></a>React诞生</h3><blockquote>
<h3 id="React的思路"><a href="#React的思路" class="headerlink" title="React的思路"></a>React的思路</h3></blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-02.png" alt></p>
<ul>
<li>在一开始页面就什么都没有</li>
<li>先声明一个变量叫 number=0</li>
<li>js里生成 一个 <span>0</span>(虚拟的span) 并把它同步到页面中   <span>0</span>(真实的span)</li>
<li>number+=1</li>
<li>此时重新生成一个 <span>1</span>(虚拟的span) 并把它同步到页面中   <span>1</span>(真实的span)</li>
</ul>
<blockquote>
<p>此时永远不需要去页面获取 number了，同时页面里显示的数字永远是我number的最新值</p>
</blockquote>
<blockquote>
<p>实现我们刚刚的需求</p>
</blockquote>
<ul>
<li>在 <a href="https://www.bootcdn.cn/" target="_blank" rel="noopener">https://www.bootcdn.cn/</a> 里 搜索react</li>
<li>添加 umd格式的react   <a href="https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js" target="_blank" rel="noopener">https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js</a></li>
<li>添加 umd格式react-dom  <a href="https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js" target="_blank" rel="noopener">https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line"></span><br><span class="line">        let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">        ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line"></span><br><span class="line">        let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line"></span><br><span class="line">        add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">            number += 1;</span><br><span class="line"></span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在我们的span没有任何的获取元素,只有从虚拟的span到 页面真实的span</p>
</blockquote>
<p>优化一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line"></span><br><span class="line">        render()</span><br><span class="line"></span><br><span class="line">        let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line"></span><br><span class="line">        add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">            number += 1;</span><br><span class="line">            render()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        function render()&#123;</span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>再也不用 querySelector后 取它爸爸取它儿子了</p>
<blockquote>
<h3 id="再次优化，按钮也在render里"><a href="#再次优化，按钮也在render里" class="headerlink" title="再次优化，按钮也在render里"></a>再次优化，按钮也在render里</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line">        let onClickButton = ()=&gt;&#123;</span><br><span class="line">            number += 1;</span><br><span class="line">            render();</span><br><span class="line">        &#125;</span><br><span class="line">        let onClickButton2 = ()=&gt;&#123;</span><br><span class="line">            number -= 1;</span><br><span class="line">            render();</span><br><span class="line">        &#125;</span><br><span class="line">        render()</span><br><span class="line"></span><br><span class="line">        function render()&#123;</span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            let button = React.createElement(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;);</span><br><span class="line">            let button2 = React.createElement(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;);</span><br><span class="line">            let div = React.createElement(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,span,button,button2);</span><br><span class="line">            ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>千万不要以为 render的时候是重新造了一个 dom</p>
</blockquote>
<ul>
<li>react没那么傻</li>
<li>它是局部刷新, 不会整个更新<blockquote>
<p>点击add后 虚拟的 <span>1</span> 会和 页面里<span>0</span> 比较后发现只变了 中间部分的文案 其他没变</p>
</blockquote>
</li>
</ul>
<h3 id="JSX的发明"><a href="#JSX的发明" class="headerlink" title="JSX的发明"></a>JSX的发明</h3><blockquote>
<h4 id="第一次优化"><a href="#第一次优化" class="headerlink" title="第一次优化"></a>第一次优化</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    let h = React.createElement;</span><br><span class="line">    let span = h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">    let button = h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;);</span><br><span class="line">    let button2 = h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;);</span><br><span class="line">    let div = h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">                    span,</span><br><span class="line">                    button,</span><br><span class="line">                    button2</span><br><span class="line">                );</span><br><span class="line">    ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="第二次优化，移除临时变量-直接用函数嵌套"><a href="#第二次优化，移除临时变量-直接用函数嵌套" class="headerlink" title="第二次优化，移除临时变量,直接用函数嵌套"></a>第二次优化，移除临时变量,直接用函数嵌套</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    let h = React.createElement;</span><br><span class="line">    let div = h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">                h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number),</span><br><span class="line">                h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;),</span><br><span class="line">                h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;)</span><br><span class="line">            );</span><br><span class="line">    ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="第三次优化-最重要的优化"><a href="#第三次优化-最重要的优化" class="headerlink" title="第三次优化(最重要的优化)"></a>第三次优化(最重要的优化)</h4></blockquote>
<p>此时的解构已经蕴含了 html解构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">    h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number),</span><br><span class="line">    h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;),</span><br><span class="line">    h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt;number&lt;/span&gt;</span><br><span class="line">    &lt;button onClick=onClickButton&gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick=onClickButton2&gt;-&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>React开发者惊讶的发现自己代码和html没什么区别</p>
</blockquote>
<ul>
<li>想能不能以这种形式写代码，然后用程序翻译成上面的代码呢？</li>
</ul>
<blockquote>
<h3 id="JSX语法"><a href="#JSX语法" class="headerlink" title="JSX语法"></a>JSX语法</h3></blockquote>
<p>用html的形式写js,终于这种形式被babel采纳了(招安)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 所有变量的地方====&gt; &#123; 变量 &#125;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">// 以上代码被翻译为</span><br><span class="line">React.createElement(</span><br><span class="line">    &quot;div&quot;,</span><br><span class="line">    &#123; class:&quot;container&quot; &#125;,</span><br><span class="line">    React.createElement(&quot;span&quot;,&#123; class:&quot;red&quot;&#125;,number),</span><br><span class="line">    React.createElement(&quot;button&quot;,&#123; onClick: onClickButton&#125;,&quot;+&quot;),</span><br><span class="line">    React.createElement(&quot;button&quot;,&#123; onClick: onClickButton2&#125;,&quot;-&quot;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="但是，我们这样写是运行不了的，有两种方法可以支持我们这样写"><a href="#但是，我们这样写是运行不了的，有两种方法可以支持我们这样写" class="headerlink" title="但是，我们这样写是运行不了的，有两种方法可以支持我们这样写"></a>但是，我们这样写是运行不了的，有两种方法可以支持我们这样写</h4></blockquote>
<ul>
<li>webpack</li>
<li>用jsbin</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 注意 render2是无法运行的  必须webpack 编译 或者 用jsbin 添加jsx模式</span><br><span class="line">function render2()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="很多人疑惑为什么-onClickButton-不加-呢？"><a href="#很多人疑惑为什么-onClickButton-不加-呢？" class="headerlink" title="很多人疑惑为什么 onClickButton 不加()呢？"></a>很多人疑惑为什么 onClickButton 不加()呢？</h4></blockquote>
<ul>
<li>加()代表这个 函数的返回值传递给 onClick</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onClick= &#123; onClickButton &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次回到之前那张图</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-01.png" alt></p>
<ul>
<li>我们以前不管用原生js还是 jquery都是 取对应元素节点 获取节点的值,然后对值进行一些逻辑处理，然后回填页面</li>
</ul>
<blockquote>
<p>React的思路</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-02.png" alt></p>
<ul>
<li>页面你先给我空着</li>
<li>所有的东西都通过对象表示，然后把对象放到页面里，你想修改就直接改值，然后更新下这个对象</li>
<li>就是 改值 render / 改值 render / 改值 render</li>
</ul>
<blockquote>
<h4 id="由于-dom-API太难用了"><a href="#由于-dom-API太难用了" class="headerlink" title="由于 dom API太难用了"></a>由于 dom API太难用了</h4></blockquote>
<ul>
<li>React不择手段的做到：不去访问dom,只用你更新数据，构造出一个虚拟dom(就是不是真实的dom)</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>虚拟dom就是一个对象，没有什么特别之处(如果你不知道你就console.log打印啊)</li>
<li>JSX：就是用html的形式写 JS(js的扩展)</li>
<li>虚拟dom：非真实的dom，表示dom节点的对象</li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/09/React入门001之React诞生/" data-id="cknvgpu5400oz0xjpjumb1xiw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React入门/">React入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-11-03部署实例之发布网站" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/07/Py008-11-03部署实例之发布网站/" class="article-date">
  <time datetime="2019-01-07T14:11:35.000Z" itemprop="datePublished">2019-01-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/07/Py008-11-03部署实例之发布网站/">Py008-11-03部署实例之发布网站</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="部署web发布环境"><a href="#部署web发布环境" class="headerlink" title="部署web发布环境"></a>部署web发布环境</h3><p>我们先前已经安装了 nginx/mysql/python/django</p>
<p>但是仍然不能算完成</p>
<ul>
<li>因为nginx只能处理 静态文件</li>
</ul>
<blockquote>
<p>处理python的数据要使用其他模块</p>
</blockquote>
<ul>
<li>wsgi</li>
<li>uwsgi </li>
</ul>
<h3 id="安装-UWSGI"><a href="#安装-UWSGI" class="headerlink" title="安装 UWSGI"></a>安装 UWSGI</h3><ul>
<li>UWSGI是服务器和服务器端应用程序通信协议，规定了如何把请求转发给应用程序和返回</li>
<li>uWSGI是一个Web服务器，它实现了WSGI协议、uwsgi、http等协议。Nginx中HttpUwsgiModule的作用是与uWSGI服务器进⾏交换。</li>
<li>nginx 和 uWSGI交互就必须使⽤同一个协议，而上⾯说了uwsgi支持fastcgi,uwsgi,http协议，这些都是nginx⽀持的协议，只要大家沟通好使用哪个协议，就可以正常运行了。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install uwsgi</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编辑uwsgi配置⽂文件!</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 新建目录</span><br><span class="line">mkdir /etc/uwsgi</span><br><span class="line"></span><br><span class="line">vi /etc/uwsgi/uwsgi.ini</span><br><span class="line"># 内容如下</span><br><span class="line">[uwsgi]</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">socket = 127.0.0.1:9090</span><br><span class="line">master = true //启动主进程</span><br><span class="line">vhost = true //多站模式</span><br><span class="line">no-site = true //多站模式时不设置⼊口模块和⽂文件</span><br><span class="line">workers = 2 //⼦进程数</span><br><span class="line">reload-mercy = 10 //平滑的重启 </span><br><span class="line">vacuum = true //退出、重启时清理文件</span><br><span class="line">max-requests = 1000 //开启10000个进程后, ⾃动respawn下 </span><br><span class="line">limit-as = 512 // 将进程的总内存量控制在512M </span><br><span class="line">buffer-size = 30000  </span><br><span class="line">pidfile = /var/run/uwsgi9090.pid //pid⽂文件，⽤于下面的脚本启动、停止该进程 </span><br><span class="line">daemonize = /var/log/uwsgi9090.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 移除注释</span><br><span class="line">[uwsgi]</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">socket = 127.0.0.1:9090</span><br><span class="line">master = true </span><br><span class="line">vhost = true </span><br><span class="line">no-site = true </span><br><span class="line">workers = 2 </span><br><span class="line">reload-mercy = 10 </span><br><span class="line">vacuum = true </span><br><span class="line">max-requests = 1000  </span><br><span class="line">limit-as = 512  </span><br><span class="line">buffer-size = 30000  </span><br><span class="line">pidfile = /var/run/uwsgi9090.pid  </span><br><span class="line">daemonize = /var/log/uwsgi9090.log</span><br><span class="line"></span><br><span class="line"># 启动uwsgi</span><br><span class="line">uwsgi --ini /etc/uwsgi/uwsgi.int</span><br><span class="line"></span><br><span class="line"># 验证是否启动</span><br><span class="line">netstat -ntpl</span><br><span class="line"></span><br><span class="line"># 如何关闭 uwsgi</span><br><span class="line"># 获取进程号</span><br><span class="line">cat /var/run/uwsgi9090.pid</span><br><span class="line"># 进程号</span><br><span class="line">10111</span><br><span class="line"># 杀掉进程</span><br><span class="line">kill -9  10111</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="管理-uwsgi服务"><a href="#管理-uwsgi服务" class="headerlink" title="管理 uwsgi服务"></a>管理 uwsgi服务</h4></blockquote>
<p>一个脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/init.d/uwsgi</span><br></pre></td></tr></table></figure>
<p>内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">  DESC=&quot;uwsgi daemon&quot;</span><br><span class="line">  NAME=uwsgi</span><br><span class="line">  DAEMON=/usr/local/bin/uwsgi</span><br><span class="line">  CONFIGFILE=/etc/uwsgi/$NAME.ini</span><br><span class="line">  PIDFILE=/var/run/$NAME.pid</span><br><span class="line">  SCRIPTNAME=/etc/init.d/$NAME</span><br><span class="line">  FIFOFILE=/tmp/uwsgififo</span><br><span class="line">  set -e</span><br><span class="line">  [ -x &quot;$DAEMON&quot; ] || exit 0</span><br><span class="line">do_start() &#123;</span><br><span class="line">    if [ ! -f $PIDFILE ];then</span><br><span class="line">        $DAEMON $CONFIGFILE || echo -n &quot;uwsgi  running&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;The PID is exist...&quot;</span><br><span class="line">        fi</span><br><span class="line">&#125;</span><br><span class="line">do_stop() &#123;</span><br><span class="line">    if [ -f $PIDFILE ];then</span><br><span class="line">        $DAEMON --stop $PIDFILE || echo -n &quot;uwsgi not running&quot;</span><br><span class="line">        rm -f $PIDFILE</span><br><span class="line">        echo &quot;$DAEMON STOPED.&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;The $PIDFILE doesn&apos;t found&quot;</span><br><span class="line">    fi </span><br><span class="line">&#125;</span><br><span class="line">do_reload() &#123;</span><br><span class="line">    if [ -p $FIFOFILE ];then</span><br><span class="line">        echo w &gt; $FIFOFILE</span><br><span class="line">    else</span><br><span class="line">        $DAEMON --touch-workers-reload $PIDFILE || echo -n &quot;uwsgi</span><br><span class="line">        can&apos;t reload&quot;</span><br><span class="line">    fi </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_status() &#123;</span><br><span class="line">    ps aux|grep $DAEMON</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">status)</span><br><span class="line">    echo -en &quot;Status $NAME: \n&quot;</span><br><span class="line">    do_status </span><br><span class="line">;;</span><br><span class="line">start)</span><br><span class="line">    echo -en &quot;Starting $NAME: \n&quot;</span><br><span class="line">    do_start</span><br><span class="line">;; </span><br><span class="line">stop)</span><br><span class="line">    echo -en &quot;Stopping $NAME: \n&quot;</span><br><span class="line">    do_stop </span><br><span class="line">;;</span><br><span class="line">reload|graceful)</span><br><span class="line">    echo -en &quot;Reloading $NAME: \n&quot;</span><br><span class="line">    do_reload</span><br><span class="line">;; </span><br><span class="line">*)</span><br><span class="line">    echo &quot;Usage: $SCRIPTNAME &#123;start|stop|reload&#125;&quot; &gt;&amp;2</span><br><span class="line">    exit 3 </span><br><span class="line">;;</span><br><span class="line">esac </span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分配执行权限</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /etc/init.d/uwsgi </span><br><span class="line"></span><br><span class="line"># 查看状态</span><br><span class="line">/etc/init.d/uwsgi status</span><br><span class="line"># 启动</span><br><span class="line">/etc/init.d/uwsgi start</span><br><span class="line"># 关闭</span><br><span class="line">/etc/init.d/uwsgi stop</span><br><span class="line"></span><br><span class="line"># 关闭的时候可能会报错 </span><br><span class="line">因为 PIDFILE=/var/run/$NAME.pid 里指定的文件 </span><br><span class="line">我们配置的时候改了 pidfile = /var/run/uwsgi9090.pid  </span><br><span class="line">PIDFILE=/var/run/$&#123;NAME&#125;9090.pid</span><br></pre></td></tr></table></figure>
<h3 id="发布我们的网站"><a href="#发布我们的网站" class="headerlink" title="发布我们的网站"></a>发布我们的网站</h3><blockquote>
<p>修改nginx</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"># 将 server 里的内容删掉 最后如下</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 将server修改如下</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    #access_log   logs/abc.log main;</span><br><span class="line">    location / &#123;</span><br><span class="line">        include  uwsgi_params;</span><br><span class="line">        uwsgi_pass  127.0.0.1:9090;</span><br><span class="line">        uwsgi_param UWSGI_SCRIPT myweb.wsgi;</span><br><span class="line">        uwsgi_param UWSGI_CHDIR  /usr/local/nginx/html/myweb;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">        client_max_body_size 35m;</span><br><span class="line">        #uwsgi_cache_valid 1m;</span><br><span class="line">        #uwsgi_temp_file_write_size 64k;</span><br><span class="line">        #uwsgi_busy_buffers_size 64k;</span><br><span class="line">        #uwsgi_buffers 8 64k;</span><br><span class="line">        #uwsgi_buffer_size 64k;</span><br><span class="line">        #uwsgi_read_timeout 300;</span><br><span class="line">        #uwsgi_send_timeout 300;</span><br><span class="line">        #uwsgi_connect_timeout 300;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 注释部分为优化方案</span><br><span class="line"># include  uwsgi_params; 包含 uwsgi的参数</span><br><span class="line"># 设置端口  uwsgi_pass  127.0.0.1:9090;</span><br><span class="line"># 设置目录  uwsgi_param UWSGI_SCRIPT myweb.wsgi;</span><br><span class="line"># 设置目录(注意不能在root下 没权限)  uwsgi_param UWSGI_CHDIR  /usr/local/nginx/html/myweb;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>移动我们之前创建的 django项目 到 nginx下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mv myweb  /usr/local/nginx/html/</span><br><span class="line"></span><br><span class="line"># 先关闭nginx</span><br><span class="line">/etc/init.d/uwsgi stop</span><br><span class="line"># 启动 nginx</span><br><span class="line">/etc/init.d/uwsgi start</span><br><span class="line"></span><br><span class="line"># 启动nginx</span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="此时-访问-我的ip结果返回-Internal-Server-Error-报错了"><a href="#此时-访问-我的ip结果返回-Internal-Server-Error-报错了" class="headerlink" title="此时 访问  我的ip结果返回 Internal Server Error  报错了"></a>此时 访问  我的ip结果返回 Internal Server Error  报错了</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 切换到项目文件目录里</span><br><span class="line">cd /usr/local/nginx/html</span><br><span class="line"></span><br><span class="line"># 查看日志</span><br><span class="line">tailf /var/log/uwsgi9090.log</span><br><span class="line"></span><br><span class="line"># 浏览器里刷新 地址看看日志显示什么</span><br><span class="line">No module named &apos;django&apos;</span><br><span class="line"></span><br><span class="line"># 意思是  你没有指定python对应的环境</span><br><span class="line">vi /etc/uwsgi/uwsgi.ini</span><br><span class="line"></span><br><span class="line"># 查看 python包环境</span><br><span class="line">ls /usr/local/lib/python3.7/site-packages</span><br><span class="line">发现没有django</span><br><span class="line"></span><br><span class="line"># 因为我们安装在虚拟环境了  就是 虚拟环境的 web</span><br><span class="line">切换到web目录  我的是在 /usr/local/src/web</span><br><span class="line">cd lib/python3.7</span><br><span class="line"></span><br><span class="line">ls /usr/local/src/web/lib/python3.7/site-packages</span><br><span class="line">里面有我们安装的django</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#####################################</span><br><span class="line"># 修改我们的uwsgi配置文件</span><br><span class="line"># 添加一行</span><br><span class="line">pythonpath = /usr/local/src/web/lib/python3.7/site-packages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">######################################</span><br><span class="line"># 关闭uwsgi</span><br><span class="line">/etc/init.d/uwsgi stop</span><br><span class="line"># 启动</span><br><span class="line">/etc/init.d/uwsgi start</span><br><span class="line"></span><br><span class="line"># 然后刷新网页 访问你的服务器ip</span><br><span class="line">这个是假的IP</span><br><span class="line">50.77.161.112</span><br><span class="line"></span><br><span class="line">### 成功</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/07/Py008-11-03部署实例之发布网站/" data-id="cknvgpu3s00lw0xjph0pyctfc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-11-02部署实例之安装python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/07/Py008-11-02部署实例之安装python/" class="article-date">
  <time datetime="2019-01-07T13:39:58.000Z" itemprop="datePublished">2019-01-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/07/Py008-11-02部署实例之安装python/">Py008-11-02部署实例之安装python</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 远程登录服务器后 </span><br><span class="line"></span><br><span class="line">cd /usr/local/src</span><br><span class="line"></span><br><span class="line"># python3.7.1</span><br><span class="line">wget https://www.python.org/ftp/python/3.7.1/Python-3.7.1.tar.xz</span><br><span class="line"># 解压</span><br><span class="line">tar xf Python-3.7.1.tar.xz</span><br><span class="line"># 进入解压文件目录</span><br><span class="line">cd Python-3.7.1</span><br><span class="line"></span><br><span class="line"># 安装依赖</span><br><span class="line">yum -y install gcc-* openssl-* libffi-devel  sqlite-devel</span><br><span class="line"></span><br><span class="line"># configure</span><br><span class="line">./configure --enable-optimizations --with-openssl=/usr/bin/openssl</span><br><span class="line"></span><br><span class="line"># make</span><br><span class="line">make -j4</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"># 默认安装路径为</span><br><span class="line">/usr/local/lib/python3.7</span><br><span class="line"></span><br><span class="line"># 验证python</span><br><span class="line">python3</span><br></pre></td></tr></table></figure>
<h4 id="安装pip3"><a href="#安装pip3" class="headerlink" title="安装pip3"></a>安装pip3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade pip</span><br><span class="line"># 此时会警告一个 ssl问题</span><br><span class="line"># pip is configured with locations that require TLS/SSL, however the</span><br><span class="line"># ssl module in Python is not available.</span><br><span class="line"></span><br><span class="line"># 解决方案</span><br><span class="line"># 去python源码目录</span><br><span class="line">vi Modules/Setup </span><br><span class="line"># 把下边这段话的#去掉 211 SSL=/usr/local/ssl</span><br><span class="line">212 _ssl _ssl.c \</span><br><span class="line">213 -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \</span><br><span class="line">214         -L$(SSL)/lib -lssl -lcrypto</span><br><span class="line"></span><br><span class="line"># 再次make</span><br><span class="line">make -j4</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"># 再次升级pip</span><br><span class="line">pip3 install --upgrade pip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>pip安装软件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">pip3 install ipython</span><br><span class="line"># 卸载</span><br><span class="line">pip3 uninstall ipython</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="安装python虚拟环境"><a href="#安装python虚拟环境" class="headerlink" title="安装python虚拟环境"></a>安装python虚拟环境</h4></blockquote>
<ul>
<li>virtualenv 是⼀一个创建隔绝的Python环境的⼯工具。virtualenv创建⼀一个包含所有必要 的可执⾏行行⽂文件的⽂文件夹，⽤用来使⽤用Python⼯工程所需的包。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pip3 install virtualenv</span><br><span class="line"></span><br><span class="line">#  virtualenv 使用</span><br><span class="line"># 当前目录 创建一个基于python3的虚拟环境 web</span><br><span class="line">virtualenv -p python3 web</span><br><span class="line"># 如何生效这个 环境呢</span><br><span class="line">source web/bin/activate</span><br><span class="line"></span><br><span class="line"># 此时如果你想在 web环境里安装 django</span><br><span class="line">pip3 install django</span><br><span class="line"># 创建一个django项目</span><br><span class="line">django-admin.py startproject myweb</span><br><span class="line"># 进入目录</span><br><span class="line">cd myweb</span><br><span class="line"># 启动项目</span><br><span class="line">python3 manage.py runserver localhost:8080</span><br><span class="line"></span><br><span class="line"># 默认你是访问不到的 要设置 allowhost</span><br><span class="line">vi myweb/settings.py</span><br><span class="line"># 修改如下</span><br><span class="line">ALLOWED_HOSTS = [&apos;*&apos;]</span><br><span class="line"># 重新启动django</span><br><span class="line">python3 manage.py runserver localhost:8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p>退出  virtualenv 虚拟环境</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/07/Py008-11-02部署实例之安装python/" data-id="cknvgpu3r00lu0xjpsz0wytk5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-11-01部署实例" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/03/Py008-11-01部署实例/" class="article-date">
  <time datetime="2019-01-03T12:54:07.000Z" itemprop="datePublished">2019-01-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/03/Py008-11-01部署实例/">Py008-11-01部署实例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="部署环境"><a href="#部署环境" class="headerlink" title="部署环境"></a>部署环境</h3><ul>
<li>Centos7.5</li>
<li>Nginx</li>
<li>python</li>
<li>Django</li>
<li>uwsgi</li>
<li>mysql</li>
</ul>
<blockquote>
<p>前置条件</p>
</blockquote>
<ul>
<li>Centos7.5</li>
<li>防火墙：关闭</li>
<li>Selinux:关闭</li>
<li>有一个服务器IP</li>
</ul>
<h3 id="部署流程"><a href="#部署流程" class="headerlink" title="部署流程"></a>部署流程</h3><ol>
<li>安装nginx</li>
<li>安装python</li>
<li>安装mysql</li>
<li>部署发布平台</li>
<li>测试</li>
</ol>
<h4 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h4><p>参考之前的文章安装</p>
<p><a href="https://sltrust.github.io/2018/12/27/Py008-10-01nginx%E4%BB%8B%E7%BB%8D/" target="_blank" rel="noopener">nginx安装</a></p>
<h4 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h4><p>一个关系型数据库，后来卖给oracle 目前分为商业版和社区版</p>
<p>目前有两大版本 mysql5/mysql8</p>
<p>目前建议使用5.7最新版本就行。官方提供RPM和源码包两种方式</p>
<blockquote>
<p>mysql安装步骤</p>
</blockquote>
<ol>
<li>安装依赖包</li>
<li>升级cmake工具</li>
<li>升级boost库文件</li>
<li>安装mysql</li>
<li>启动测试</li>
</ol>
<ul>
<li>安装依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ncurses-devel gcc-* bzip2-*</span><br><span class="line"></span><br><span class="line">安装好之后看看你本地有木有 cmake</span><br><span class="line">yum search cmake</span><br></pre></td></tr></table></figure>
<ul>
<li>cmake安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">需要先升级 cmake </span><br><span class="line">1.获取软件</span><br><span class="line"></span><br><span class="line">https://cmake.org/download/</span><br><span class="line">复制下载链接</span><br><span class="line">https://github.com/Kitware/CMake/releases/download/v3.13.2/cmake-3.13.2.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://github.com/Kitware/CMake/releases/download/v3.13.2/cmake-3.13.2.tar.gz</span><br><span class="line"></span><br><span class="line"># 我用的是3.6.0</span><br><span class="line">wget https://github.com/Kitware/CMake/archive/v3.6.0-rc1.tar.gz</span><br><span class="line"></span><br><span class="line">2.安装软件</span><br><span class="line"></span><br><span class="line">tar xf cmake-3.6.0-rc1.tar</span><br><span class="line"></span><br><span class="line">cd cmake-3.6.0-rc1</span><br><span class="line"></span><br><span class="line">./configure</span><br><span class="line"></span><br><span class="line"># 还差一些依赖</span><br><span class="line">yum -y install ncurses-devel gcc-* bzip2-* bison</span><br><span class="line"></span><br><span class="line"># 编译</span><br><span class="line">make -j4</span><br><span class="line"># 安装</span><br><span class="line">make install </span><br><span class="line"></span><br><span class="line"># 验证安装</span><br><span class="line">cmake --version</span><br></pre></td></tr></table></figure>
<ul>
<li>boost安装</li>
</ul>
<p><a href="https://www.boost.org/" target="_blank" rel="noopener">https://www.boost.org/</a></p>
<p>我下载的1.59版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">https://nchc.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.bz2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd ~</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.bz2</span><br><span class="line"></span><br><span class="line">tar xf boost_1_59_0.tar.bz2</span><br><span class="line"></span><br><span class="line">mv boost_1_59_0 /usr/local/boost</span><br></pre></td></tr></table></figure></p>
<ul>
<li>mysql安装</li>
</ul>
<p><a href="https://www.oracle.com/index.html" target="_blank" rel="noopener">https://www.oracle.com/index.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">访问 https://www.oracle.com/index.html 去页脚的 software downloads </span><br><span class="line">获得网址 https://www.oracle.com/downloads/</span><br><span class="line">选择 database -&gt;mysql   ---&gt; https://www.mysql.com/downloads/ </span><br><span class="line">访问 https://www.mysql.com/downloads/  拉到最后 选择社区版本  Community (GPL) Downloads »</span><br><span class="line"></span><br><span class="line">选第一个 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">此时有8.0 和 5.7 我们使用 5.7</span><br><span class="line">选择 MySQL Community Server 5.7 »</span><br><span class="line"></span><br><span class="line">Select Operating System:</span><br><span class="line">- 如果你想选 rpm的  系统选择 红帽</span><br><span class="line">- 选择源码包安装就选择 source code</span><br><span class="line"></span><br><span class="line">我们使用 源码包安装 选择 source code</span><br><span class="line"></span><br><span class="line">Select OS Version:我们选择通用版</span><br><span class="line">Generic Linux (Architecture Independent)</span><br><span class="line">然后下载列表里选择</span><br><span class="line">Compressed TAR Archive	</span><br><span class="line">然后下载</span><br><span class="line"></span><br><span class="line">cd ~</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.24.tar.gz</span><br><span class="line">tar xf mysql-5.7.24.tar.gz</span><br><span class="line"></span><br><span class="line">cd mysql-5.7.24</span><br><span class="line"></span><br><span class="line">使用cmake安装</span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data/ -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock -DDOWNLOAD_BOOST=0 -DWITH_INNODBBASE_STORAGE_ENGINE=1 -DENABLE_LOCAL_INFILE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DMYSQL_USER=mysql -DWITH_DEBUG=0 -DWITH_EMBEDED_SERVER=0 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost</span><br><span class="line"></span><br><span class="line"># -DMYSQL_USER=mysql 这个会有问题去掉</span><br><span class="line"></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data/ -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock -DDOWNLOAD_BOOST=0 -DWITH_INNODBBASE_STORAGE_ENGINE=1 -DENABLE_LOCAL_INFILE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_DEBUG=0 -DWITH_EMBEDED_SERVER=0 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost</span><br><span class="line"></span><br><span class="line"># 注意如果你想要重新配置</span><br><span class="line">就在这个目录里 mysql-5.7.24/删除  CMackCache.txt</span><br><span class="line">rm -rf CMakeCache.txt</span><br><span class="line"></span><br><span class="line"># 然后重新配置</span><br><span class="line"></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data/ -DMYSQL_UNIX_ADDR=/usr/local/mysql/mysql.sock -DDOWNLOAD_BOOST=0 -DWITH_INNODBBASE_STORAGE_ENGINE=1 -DENABLE_LOCAL_INFILE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DWITH_DEBUG=0 -DWITH_EMBEDED_SERVER=0 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"># 如果你用的服务器是单核的很可能会报错  什么到45%的时候 报错 </span><br><span class="line">Building CXX object sql/CMakeFiles/sql.dir/geometry_rtree.cc.o</span><br><span class="line">c++: 编译器内部错误：已杀死(程序 cc1plus)</span><br><span class="line">Please submit a full bug report,</span><br><span class="line"></span><br><span class="line">解决方案 https://blog.csdn.net/razertang/article/details/45694567/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="源码安装特容易失败"><a href="#源码安装特容易失败" class="headerlink" title="源码安装特容易失败"></a>源码安装特容易失败</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># yum 安装</span><br><span class="line">https://blog.csdn.net/z13615480737/article/details/78906598</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改密码</span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"># 登录数据库</span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/03/Py008-11-01部署实例/" data-id="cknvgpu3q00ls0xjpzblaowpe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-10-08url重写" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/02/Py008-10-08url重写/" class="article-date">
  <time datetime="2019-01-02T14:43:00.000Z" itemprop="datePublished">2019-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/02/Py008-10-08url重写/">Py008-10-08url重写</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="url重写"><a href="#url重写" class="headerlink" title="url重写"></a>url重写</h3><ul>
<li>rewrite模块(ngx_http_rewrite_module)</li>
<li>Rewrite功能是Nginx服务器提供的⼀个重要功能。⼏乎是所有的web产品必备技能，⽤于实现URL重写。URL重写是⾮常有用的功能，比如它可以在 我们在改变网站结构后，不需要客户端修改原来的书签，也不需要其他⽹站修改对我们⽹站的友情链接，还可以在一定程度上提⾼网站的安全性，能够让我们的网站显得更专业。</li>
<li>Nginx服务器Rewrite功能的实现是依赖于PCRE(Perl Compatible Regular Expression。Perl兼容的正则表达式)的支持，所以在编译安装Nginx之前， 需要安装PCRE库。</li>
</ul>
<p>如 <a href="http://www.360buy.com" target="_blank" rel="noopener">www.360buy.com</a> 就是京东的url重写</p>
<blockquote>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4></blockquote>
<ul>
<li>域名变更(京东)</li>
<li>用户跳转(从某个链接跳到另一个链接)</li>
<li>伪静态场景(便于CDN缓存动态页面数据)</li>
</ul>
<h4 id="重写原理"><a href="#重写原理" class="headerlink" title="重写原理"></a>重写原理</h4><p>你找我，我不给你数据，我告诉你哪里有数据</p>
<p>张三找李四借钱，李四说王五有钱去找王五</p>
<h4 id="URL-rewrite实现"><a href="#URL-rewrite实现" class="headerlink" title="URL rewrite实现"></a>URL rewrite实现</h4><blockquote>
<h4 id="url模块指令"><a href="#url模块指令" class="headerlink" title="url模块指令"></a>url模块指令</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) set 设置变量</span><br><span class="line">2) if 负责判断</span><br><span class="line">3) return  返回返回值或 url</span><br><span class="line">4) break   终止后续的rewtite规则</span><br><span class="line">5) rewrite 重定向URL</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="set指令"><a href="#set指令" class="headerlink" title="set指令"></a>set指令</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># set指令 ⾃自定义变量量 </span><br><span class="line"># Syntax:语法</span><br><span class="line">set $variable value; </span><br><span class="line">Default:</span><br><span class="line">—</span><br><span class="line"># Context:作用域 可以放在 server/location/if里</span><br><span class="line">server, location, if</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 将http://www.baidu.com 重写为 http://www.baidu.com/xxx </span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    set $name hjx;</span><br><span class="line">    rewrite ^(.*)$ http://www.baidu.com/$name; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="if指令"><a href="#if指令" class="headerlink" title="if指令"></a>if指令</h4></blockquote>
<ul>
<li>nginx有一些内置变量 自行百度</li>
<li>匹配规则  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 模糊匹配</span><br><span class="line">～ 匹配</span><br><span class="line">!~ 不匹配</span><br><span class="line">~* 匹配而且不区分大小写</span><br><span class="line"></span><br><span class="line"># 精确匹配</span><br><span class="line">=</span><br><span class="line">!=</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if指令 负责判断 Syntax:</span><br><span class="line">if (condition) &#123; ... &#125; Default:</span><br><span class="line"></span><br><span class="line">—</span><br><span class="line">Context: server, location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    # 日志里 $http_user_agent是用来代表客户端访问的浏览器(它其实是nginx的内置变量)</span><br><span class="line">    # 这里针对 google访问 返回403</span><br><span class="line">    if ($http_user_agent ~* &apos;Chrome&apos;) &#123;</span><br><span class="line">        </span><br><span class="line">        return 403;</span><br><span class="line">        #return http://www.jd.com; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="return指令"><a href="#return指令" class="headerlink" title="return指令"></a>return指令</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">return 指令 定义返回数据 Syntax: return code [text]; return code URL;</span><br><span class="line">return URL;</span><br><span class="line">Default: —</span><br><span class="line">Context: server, location, if</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------- 如果chrome浏览器访问就返回 京东</span><br><span class="line">location / &#123;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    if ($http_user_agent ~* &apos;Chrome&apos;) &#123;</span><br><span class="line">        # return 403;</span><br><span class="line">        # return指令 既可以返回状态码 还可以返回url</span><br><span class="line">        return http://www.jd.com; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="break指令"><a href="#break指令" class="headerlink" title="break指令"></a>break指令</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 本来是匹配chrome浏览器访问就返回 京东 但是有 break 就导致提前结束 后续的url重写就失效了</span><br><span class="line">location / &#123;</span><br><span class="line">    root html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    if ($http_user_agent ~* &apos;Chrome&apos;) &#123;</span><br><span class="line">        break;</span><br><span class="line">        # return 403;</span><br><span class="line">        # return指令 既可以返回状态码 还可以返回url</span><br><span class="line">        return http://www.jd.com; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="rewrite-语法"><a href="#rewrite-语法" class="headerlink" title="rewrite 语法"></a>rewrite 语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rewrite  &lt;regex&gt;  &lt;replacement&gt; [flag];</span><br><span class="line">关键字    正则          替代内容 flag标记</span><br><span class="line"></span><br><span class="line">flag:</span><br><span class="line">last  # 本条规则匹配完成后，继续向下匹配新的location URL规则</span><br><span class="line">break # 本条规则匹配完成即终止，不再匹配后面的任何规则</span><br><span class="line">redirect # 返回302临时重定向，浏览器地址会显示跳转后URL地址</span><br><span class="line">permanent #返回301永久重定向，浏览器器地址栏会显示跳转后的URL地址</span><br></pre></td></tr></table></figure>
<blockquote>
<p>案例</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">域名跳转</span><br><span class="line">www.ayitula.com 重写为 www.jd.com</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    # 修改本地host 里添加www.ayitula.com的解析</span><br><span class="line">    server_name www.ayitula.com; </span><br><span class="line">    location / &#123;</span><br><span class="line">        # 临时重定向301</span><br><span class="line">        rewrite ^/$ http://www.jd.com permanent ;</span><br><span class="line">        # 永久重定向302</span><br><span class="line">        rewrite ^/$ http://www.jd.com redirect ; </span><br><span class="line">        # 碰到break不往后处理了 直接返回 www.jd.com  也是302</span><br><span class="line">        rewrite ^/$ http://www.jd.com break ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">重定向就是将⽹页自动转向重定向 </span><br><span class="line"># 对新域名推广</span><br><span class="line">301永久性重定向:新网址完全继承旧网址，旧网址的排名等完全清零</span><br><span class="line">   301重定向是⽹页更改地址后对搜索引擎友好的最好⽅法，只要不是暂时搬移的情况，都建议使用301来做转址。</span><br><span class="line">   </span><br><span class="line"># 对老域名推广</span><br><span class="line">302临时性重定向:对旧⽹址没有影响，但新网址不会有排名</span><br><span class="line">    搜索引擎会抓取新的内容而保留旧的⽹址</span><br></pre></td></tr></table></figure>
<blockquote>
<p>last指令</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果是chrome浏览器器 就将 http://192.168.10.42/$URI 重写为 http://192.168.10.42/chrome/$URI</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">如果是chrome浏览器器 就将 http://192.168.10.42/$URI 重写为 http://192.168.10.42/chrome/$URI</span><br><span class="line">location / &#123;</span><br><span class="line">    if ($http_user_agent ~* &apos;chrome&apos;)&#123; </span><br><span class="line">        rewrite ^(.*)$ /chrome/$1 last;</span><br><span class="line">    &#125;</span><br><span class="line">    # 对重写为 http://192.168.10.42/chrome/$URI 匹配</span><br><span class="line">    location /chrome &#123;</span><br><span class="line">        root html ;</span><br><span class="line">        index index.html; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">根据⽤用户浏览器器重写访问⽬目录</span><br><span class="line">#^ 以什什么开头 ^a</span><br><span class="line">#$ 以什什么结尾 c$</span><br><span class="line">#. 除了了回⻋车以外的任意⼀一个字符</span><br><span class="line">#* 前⾯面的字符可以出现多次或者不不出现 #更更多内容看正则表达式 re</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/02/Py008-10-08url重写/" data-id="cknvgpu3p00lq0xjpmoghmslv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Py008-10-07限速" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/02/Py008-10-07限速/" class="article-date">
  <time datetime="2019-01-02T13:37:18.000Z" itemprop="datePublished">2019-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/02/Py008-10-07限速/">Py008-10-07限速</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="限速"><a href="#限速" class="headerlink" title="限速"></a>限速</h3><ul>
<li>限速该特性可以限制某个用户在⼀个给定时间段内能够产生的HTTP请求数。请求可以简单到就是⼀一个对于主页的GET请求或者一个登陆表格的POST请求。</li>
<li>限速也可以⽤用于安全⽬的上，⽐如暴力密码破解攻击。通过限制进来的请求速率，并且(结合⽇志)标记出⽬目标URLs来帮助防范DDoS攻击。⼀般地说，限流是用在 保护上游应⽤服务器不被在同一时刻的大量⽤户请求湮没。</li>
</ul>
<blockquote>
<p>经典案例 12306</p>
</blockquote>
<p>并非12306的开发人员low，而是因为环境太特殊。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">买票就是在浏览器里刷新。每刷新一次就会产生大量链接给服务器,服务器就要开很多的子进程来处理请求。</span><br><span class="line">频繁的刷服务器肯定受不了。</span><br><span class="line"></span><br><span class="line">服务器收到海量的刷新。</span><br><span class="line">承受不住就挂了。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>阮一峰的博客被攻击过——DDOS </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">比如：你在肯德基，一个肯德基店铺最多接受50来人。</span><br><span class="line">但是这一地点突然来了 几千个人。堵得水泄不通。导致KFC没法工作</span><br></pre></td></tr></table></figure>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>DDOS防御</li>
<li>下载场景保护IO （多个客户端打开迅雷下载一个文件）</li>
</ul>
<h3 id="nginx限速原理"><a href="#nginx限速原理" class="headerlink" title="nginx限速原理"></a>nginx限速原理</h3><p>漏桶原理</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/img/py/py008_10_0701.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">水(请求)从上方倒入⽔桶，从⽔桶下方流出(被处理);</span><br><span class="line">来不及流出的水存在⽔桶中(缓冲)，以固定速率流出;</span><br><span class="line">⽔桶满后⽔溢出(丢弃)。</span><br><span class="line">这个算法的核⼼是:缓存请求、匀速处理、多余的请求直接丢弃。</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Nginx官⽅版本限制IP的连接和并发分别有两个模块:</span><br><span class="line">limit_req_zone 用来限制单位时间内的请求数，即速率限制。 </span><br><span class="line">limit_req_conn ⽤来限制同一时间连接数，即并发限制</span><br></pre></td></tr></table></figure>
<ul>
<li>limit_req_zone 参数配置</li>
<li>Syntax: limit_req zone=name [burst=number] [nodelay];</li>
<li>Default: —</li>
<li>Context: http, server, location</li>
</ul>
<blockquote>
<h4 id="限速案例一（请求限速）"><a href="#限速案例一（请求限速）" class="headerlink" title="限速案例一（请求限速）"></a>限速案例一（请求限速）</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#基于IP对下载速率做限制 限制每秒处理1次请求，对突发超过5个以后的请求放⼊缓存区 </span><br><span class="line">http &#123;</span><br><span class="line">    # 设置缓存区那个 桶</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=hjx:10m rate=1r/s; </span><br><span class="line">    server &#123;</span><br><span class="line">        # 对abc目录进行限速</span><br><span class="line">        location /abc/ &#123;</span><br><span class="line">            # 使用缓存区 最大请求为5个，超过5个返回503</span><br><span class="line">            limit_req zone=hjx burst=5 nodelay;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">limit_req_zone $binary_remote_addr zone=baism:10m rate=1r/s;</span><br><span class="line">第⼀个参数:$binary_remote_addr 表示通过remote_addr这个标识来做限制，“binary_”的⽬的是缩写内存占⽤量，是限制同⼀一客户端ip地址。</span><br><span class="line"></span><br><span class="line">第二个参数:zone=baism:10m表示生成⼀一个⼤⼩为10M，名字为one的内存区域，⽤来存储访问的频次信息。</span><br><span class="line"></span><br><span class="line">第三个参数:rate=1r/s表示允许相同标识的客户端的访问频次，这里限制的是每秒1次，还可以有⽐如30r/m的。</span><br><span class="line">limit_req zone=baism burst=5 nodelay;</span><br><span class="line"></span><br><span class="line">第⼀个参数:zone=baism 设置使⽤哪个配置区域来做限制，与上面limit_req_zone 里的name对应。</span><br><span class="line"></span><br><span class="line">第二个参数:burst=5，重点说明一下这个配置，burst爆发的意思，这个配置的意思是设置一个⼤小为5的缓冲区当有⼤大量请求(爆发)过来时，超过了访问频次限制的请求可以先放到这个缓冲区内。</span><br><span class="line"></span><br><span class="line">第三个参数:nodelay，如果设置，超过访问频次⽽且缓冲区也满了的时候就会直接返回503，如果没有设置，则所有请求会等待排队。</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="限速案例二（下载限速）"><a href="#限速案例二（下载限速）" class="headerlink" title="限速案例二（下载限速）"></a>限速案例二（下载限速）</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#基于IP做连接限制 限制同⼀IP并发为1 下载速度为100K </span><br><span class="line">limit_conn_zone $binary_remote_addr zone=addr:10m; </span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80; </span><br><span class="line">    server_name localhost; </span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html index.htm; </span><br><span class="line">    &#125;</span><br><span class="line">    location /abc &#123; </span><br><span class="line">        limit_conn addr 1; </span><br><span class="line">        limit_rate 100k;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>准备一个大文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 造一个300m的文件</span><br><span class="line">dd if=/dev/zero of=/usr/local/nginx/html/abc/bigfile bs=1M count=300</span><br><span class="line"></span><br><span class="line"># 切换到临时目录下载这个文件</span><br><span class="line">wget http://45.77.47.0/abc/bigfile</span><br><span class="line"># 下载就很快,而且还能多台机器同时下载</span><br><span class="line"></span><br><span class="line"># 修改配置 nginx.conf</span><br><span class="line"></span><br><span class="line">limit_conn_zone $binary_remote_addr zone=addr:10m; </span><br><span class="line">server &#123;</span><br><span class="line">    listen 80; </span><br><span class="line">    server_name localhost; </span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html index.htm; </span><br><span class="line">    &#125;</span><br><span class="line">    location /abc &#123; </span><br><span class="line">        # 限制同时连接的数量</span><br><span class="line">        limit_conn addr 1; </span><br><span class="line">        # 限制下载速率</span><br><span class="line">        limit_rate 100k;</span><br><span class="line">        # 下载100M的时候限速（这个参数不太重要，因为不是按比例只能按大小）</span><br><span class="line">        limit_rate_after 100m;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/02/Py008-10-07限速/" data-id="cknvgpu3p00lo0xjptho3toj6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/M08/">M08</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/25/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/27/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 13.91px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 14.35px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.3px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.48px;">M01</a> <a href="/tags/M02/" style="font-size: 15.22px;">M02</a> <a href="/tags/M03/" style="font-size: 15.65px;">M03</a> <a href="/tags/M04/" style="font-size: 16.09px;">M04</a> <a href="/tags/M06/" style="font-size: 18.26px;">M06</a> <a href="/tags/M07/" style="font-size: 17.83px;">M07</a> <a href="/tags/M08/" style="font-size: 16.96px;">M08</a> <a href="/tags/M09/" style="font-size: 11.74px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 15.65px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.7px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.52px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15.22px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.78px;">TS入门</a> <a href="/tags/Webpack/" style="font-size: 11.3px;">Webpack</a> <a href="/tags/express/" style="font-size: 10.43px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.83px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.17px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.13px;">java</a> <a href="/tags/linux/" style="font-size: 10.87px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.3px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.61px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.61px;">mysql</a> <a href="/tags/node/" style="font-size: 10.43px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.39px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.04px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.57px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/28/Webpack-03loader/">Webpack-03loader</a>
          </li>
        
          <li>
            <a href="/2021/02/27/Webpack-02打包器/">Webpack-02打包器</a>
          </li>
        
          <li>
            <a href="/2021/02/27/Webpack-01AST-Babel-依赖/">Webpack-01AST_Babel_依赖</a>
          </li>
        
          <li>
            <a href="/2021/02/26/Webpack-00前置内容理解webpack/">Webpack-00前置内容理解webpack</a>
          </li>
        
          <li>
            <a href="/2021/02/23/Node-web05-09-03博客系统使用nginx/">Node-web05-09-03博客系统使用nginx</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>