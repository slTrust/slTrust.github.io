<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/15/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-TS入门009_01Vue_ts配置cli版本" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/11/TS入门009_01Vue_ts配置cli版本/" class="article-date">
  <time datetime="2019-08-11T09:11:52.000Z" itemprop="datePublished">2019-08-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/11/TS入门009_01Vue_ts配置cli版本/">TS入门009_01Vue_ts配置cli版本</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="直接上官网"><a href="#直接上官网" class="headerlink" title="直接上官网"></a>直接上官网</h3><ul>
<li><a href="https://vuejs.org/" target="_blank" rel="noopener">https://vuejs.org/</a></li>
<li><p>找到 TS 支持,我的是 3.0版本</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 1. Install Vue CLI, if it&apos;s not already installed</span><br><span class="line">npm install --global @vue/cli</span><br><span class="line"></span><br><span class="line"># 2. Create a new project, then choose the &quot;Manually select features&quot; option</span><br><span class="line">vue create my-project-name</span><br><span class="line"></span><br><span class="line"># 提示你是否在当前目录生成 y</span><br><span class="line">Vue CLI v3.0.0</span><br><span class="line">? Generate project in current directory? (Y/n) </span><br><span class="line">#  是否选择预置的？ 选 Manually</span><br><span class="line">Vue CLI v3.0.0</span><br><span class="line">? Please pick a preset: (Use arrow keys)</span><br><span class="line">❯ default (babel, eslint) </span><br><span class="line">Manually select features </span><br><span class="line"></span><br><span class="line"># 选择你要的内容 router / vuex  做项目可以选上，这里必须的是 ts / babel </span><br><span class="line">? Check the features needed for your project: </span><br><span class="line">◉ Babel</span><br><span class="line">◉ TypeScript</span><br><span class="line">◯ Progressive Web App (PWA) Support</span><br><span class="line">◯ Router</span><br><span class="line">◯ Vuex</span><br><span class="line">❯◉ CSS Pre-processors</span><br><span class="line">◉ Linter / Formatter</span><br><span class="line">◯ Unit Testing</span><br><span class="line">◯ E2E Testing</span><br><span class="line"></span><br><span class="line">? Use class-style component syntax? Yes</span><br><span class="line">? Use Babel alongside TypeScript for auto-detected polyfills? Yes</span><br><span class="line">? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported </span><br><span class="line">by default): SCSS/SASS</span><br><span class="line">? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In dedica</span><br><span class="line">ted config files</span><br><span class="line"># 是否以后都用这个当作默认配置</span><br><span class="line">? Save this as a preset for future projects? (y/N) n</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建好项目 yarn serve</p>
</li>
</ul>
<blockquote>
<p>来看 app.vue</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;</span><br><span class="line">    &lt;HelloWorld msg=&quot;Welcome to Your Vue.js + TypeScript App&quot;/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">// 这是 js 语法</span><br><span class="line">import &#123; Component, Vue &#125; from &apos;vue-property-decorator&apos;;</span><br><span class="line">// 这是 js 语法</span><br><span class="line">import HelloWorld from &apos;./components/HelloWorld.vue&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 这里是新的组件写法 装饰器语法</span><br><span class="line">@Component(&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">export default class App extends Vue &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>新建我们的组件 Hjx</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        I am hjx!</span><br><span class="line">        &lt;HelloWorld msg=&quot;Welcome to Your Vue.js + TypeScript App&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import Component from &apos;vue-class-component&apos;;</span><br><span class="line">import HelloWorld from &apos;./HelloWorld.vue&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">components: &#123;</span><br><span class="line">    HelloWorld</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">export default class Hjx extends Vue&#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>App.vue 里 使用 它</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Hjx/&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; Component, Vue &#125; from &apos;vue-property-decorator&apos;;</span><br><span class="line">import Hjx from &apos;./components/Hjx.vue&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">components: &#123;</span><br><span class="line">    Hjx</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">export default class App extends Vue &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">#app &#123;</span><br><span class="line">font-family: &apos;Avenir&apos;, Helvetica, Arial, sans-serif;</span><br><span class="line">-webkit-font-smoothing: antialiased;</span><br><span class="line">-moz-osx-font-smoothing: grayscale;</span><br><span class="line">text-align: center;</span><br><span class="line">color: #2c3e50;</span><br><span class="line">margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><ul>
<li>代码库<a href="https://github.com/slTrust/ts-study" target="_blank" rel="noopener">https://github.com/slTrust/ts-study</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/11/TS入门009_01Vue_ts配置cli版本/" data-id="cklhgn2kf00q7kyfyfl0zi37u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TS入门/">TS入门</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-019-01超详细网址输入url过程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/29/ZB-019-01超详细网址输入url过程/" class="article-date">
  <time datetime="2019-07-29T12:27:13.000Z" itemprop="datePublished">2019-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/ZB-019-01超详细网址输入url过程/">ZB-019-01超详细网址输入url过程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="浏览器输入url过程"><a href="#浏览器输入url过程" class="headerlink" title="浏览器输入url过程"></a>浏览器输入url过程</h3><ol>
<li>当你打开一个网页的时候，这个世界上一定有一个<strong>地方</strong>处理这个请求，这个页面不可能凭空掉下来。</li>
<li>这个地方在那里呢？</li>
</ol>
<p>这就不可避免的说：<strong>计算机网络的基础架构</strong>。</p>
<h4 id="计算机网络的基础架构"><a href="#计算机网络的基础架构" class="headerlink" title="计算机网络的基础架构"></a>计算机网络的基础架构</h4><p>在互联网上有很多很多的计算机，假设它们之间用网线连接起来。</p>
<p>通过运营商 联通/电信 连接到你家的小区里，然后在小区里跟你家里牵根线。此时你躺在床上拿着手机。</p>
<p>你的手机通过无线路由器，和这个网络相连的。</p>
<blockquote>
<h4 id="一个概念"><a href="#一个概念" class="headerlink" title="一个概念"></a>一个概念</h4></blockquote>
<p>在计算机世界里有很多很多的电脑，这个电脑就叫<strong>主机 HOST </strong>，和你的笔记本没什么区别。把你的笔记本放机房里也可以充当一台主机。</p>
<p>因此,<strong>这个世界上有很多很多相连的计算机，我们称之为主机</strong></p>
<blockquote>
<h4 id="每个主机有一个IP地址。"><a href="#每个主机有一个IP地址。" class="headerlink" title="每个主机有一个IP地址。"></a>每个主机有一个IP地址。</h4></blockquote>
<p>在IPV4的世界里，IP地址是 32位地址(4个字节),形如 192.118.112.3，IP地址就是网络上计算机的地址</p>
<p>这个地址可以唯一的定位一台计算机就是<strong>主机</strong>。 </p>
<blockquote>
<p>1个byte -128~127, 而无符号的byte最大值刚好是 255。</p>
</blockquote>
<p>因此<strong>IP地址最大不超过255</strong></p>
<blockquote>
<p>32位可以存多少数字呢？</p>
</blockquote>
<p>42亿个数字，也就是说这个世界上最多有42亿IPV4的IP地址，但是发展到现在 发现42亿的IP地址果然不够用。于是有了<strong>IPV6</strong></p>
<h4 id="但是，无论访问什么网站，我们都不会用IP地址"><a href="#但是，无论访问什么网站，我们都不会用IP地址" class="headerlink" title="但是，无论访问什么网站，我们都不会用IP地址"></a>但是，无论访问什么网站，我们都不会用IP地址</h4><p>因为IP地址难记啊！</p>
<p>如果不难，请问 百度/淘宝 的IP地址是什么？</p>
<h4 id="有一天你躺在床上在QQ上和妹子聊天"><a href="#有一天你躺在床上在QQ上和妹子聊天" class="headerlink" title="有一天你躺在床上在QQ上和妹子聊天"></a>有一天你躺在床上在QQ上和妹子聊天</h4><ul>
<li>你的手机必须知道和这个世界上一台主机(HOST)在通信,所以你必须知道这个主机的IP地址，但是IP地址很难记。</li>
</ul>
<blockquote>
<p>我们需要另一种服务<strong>DNS</strong></p>
</blockquote>
<h4 id="DNS-Domain-Name-Service-域名服务"><a href="#DNS-Domain-Name-Service-域名服务" class="headerlink" title="DNS Domain Name Service 域名服务"></a>DNS Domain Name Service 域名服务</h4><p>当你网址输入 <a href="http://www.taobao.com的时候，" target="_blank" rel="noopener">www.taobao.com的时候，</a></p>
<ol>
<li>如果计算机不知道淘宝的主页在哪里，它就会向 DNS 请求查询 taobao.com</li>
<li>dns会返回一个IP地址给你</li>
<li>此时通过这个地址你就可以访问淘宝了</li>
</ol>
<h4 id="本地HOST"><a href="#本地HOST" class="headerlink" title="本地HOST"></a>本地HOST</h4><p>如果你本地保存有 一个淘宝的映射，那么请求taobao.com的时候，就不会去查找DNS了</p>
<p>mac的host文件在 /etc/hosts,当你做如下修改的时候。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   www.taobao.com</span><br></pre></td></tr></table></figure>
<p>你再次访问 taobao.com 时，会直接到 127.0.0.1 </p>
<h4 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h4><p>一台机子有很多的端口最多有65536个端口，如 mysql 3306。</p>
<p>在网线上传输的数据，每一个数据的数据包里面都指定了一个端口，指名和对应的端口通信。</p>
<blockquote>
<h4 id="HTTPS协议的默认端口是-443"><a href="#HTTPS协议的默认端口是-443" class="headerlink" title="HTTPS协议的默认端口是 443"></a>HTTPS协议的默认端口是 443</h4></blockquote>
<blockquote>
<h4 id="HTTP协议的默认端口是-80"><a href="#HTTP协议的默认端口是-80" class="headerlink" title="HTTP协议的默认端口是 80"></a>HTTP协议的默认端口是 80</h4></blockquote>
<p>意思就是 你输入 <a href="http://www.taobao.com" target="_blank" rel="noopener">http://www.taobao.com</a> 和 <a href="http://www.taobao.com:80" target="_blank" rel="noopener">http://www.taobao.com:80</a> 没区别</p>
<p>相似的 你输入 <a href="https://www.taobao.com" target="_blank" rel="noopener">https://www.taobao.com</a> 和 <a href="https://www.taobao.com:443" target="_blank" rel="noopener">https://www.taobao.com:443</a> 没区别</p>
<blockquote>
<h4 id="端口指定了你通信的主机的归属地"><a href="#端口指定了你通信的主机的归属地" class="headerlink" title="端口指定了你通信的主机的归属地"></a>端口指定了你通信的主机的归属地</h4></blockquote>
<h4 id="更进一步，为什么输入网址后能看到绚丽多彩的页面呢？"><a href="#更进一步，为什么输入网址后能看到绚丽多彩的页面呢？" class="headerlink" title="更进一步，为什么输入网址后能看到绚丽多彩的页面呢？"></a>更进一步，为什么输入网址后能看到绚丽多彩的页面呢？</h4><p>最基本的通信协议有两种</p>
<ul>
<li>TCP 传输控制协议</li>
<li>UDP 用户数据包协议(http协议里一般不用，不再详述)</li>
</ul>
<p>TCP 可以想像成一条双向的高速公路,公路上跑的是数据</p>
<p>TCP 是基于 <strong>Stream 流</strong>的协议</p>
<p>TCP 是一个 全双工协议 ，比如 打电话，双方都可以同时说话。</p>
<p>半双工协议——对讲机。每个时刻只有一个对讲机说话。</p>
<blockquote>
<h4 id="TCP的本质就是"><a href="#TCP的本质就是" class="headerlink" title="TCP的本质就是"></a>TCP的本质就是</h4></blockquote>
<p><strong>定义了字节流在网络上如何发送和接收</strong></p>
<h4 id="在TCP之上的协议——HTTP-HyperText-Transfer-Protocol"><a href="#在TCP之上的协议——HTTP-HyperText-Transfer-Protocol" class="headerlink" title="在TCP之上的协议——HTTP HyperText Transfer Protocol"></a>在TCP之上的协议——<a href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">HTTP HyperText Transfer Protocol</a></h4><p><strong>HTTP就是丰富网络世界的基石，它定义了文本之外的东西如何被传输。</strong></p>
<ul>
<li>request</li>
<li>response</li>
</ul>
<h4 id="一个网址如何变成美轮美奂的页面呢？"><a href="#一个网址如何变成美轮美奂的页面呢？" class="headerlink" title="一个网址如何变成美轮美奂的页面呢？"></a>一个网址如何变成美轮美奂的页面呢？</h4><blockquote>
<p>浏览器是如何工作的</p>
</blockquote>
<p>当你访问 <a href="http://www.taobao.com" target="_blank" rel="noopener">www.taobao.com</a> 时候，响应给你如下内容，但是页面却显示的是美轮美奂的页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;renderer&quot; content=&quot;webkit&quot; /&gt;</span><br><span class="line">&lt;title&gt;淘宝网 - 淘！我喜欢&lt;/title&gt;</span><br><span class="line">&lt;meta name=&quot;spm-id&quot; content=&quot;a21bo&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;description&quot; content=&quot;淘宝网 - 亚洲较大的网上交易平台，提供各类服饰、美容、家居、数码、话费/点卡充值… 数亿优质商品，同时提供担保交易(先收货后付款)等安全交易保障服务，并由商家提供退货承诺、破损补寄等消费者保障服务，让你安心享受网上购物乐趣！&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;aplus-xplug&quot; content=&quot;NONE&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;keyword&quot; content=&quot;淘宝,掏宝,网上购物,C2C,在线交易,交易市场,网上交易,交易市场,网上买,网上卖,购物网站,团购,网上贸易,安全购物,电子商务,放心买,供应,买卖信息,网店,一口价,拍卖,网上开店,网络购物,打折,免费开店,网购,频道,店铺&quot; /&gt;</span><br><span class="line">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//ald.taobao.com&quot; /&gt;</span><br><span class="line">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//gw.alicdn.com&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">。。。</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>当浏览器看到一个标签<code>&lt;html lang=&quot;zh-CN&quot;&gt;</code>的时候，就知道这是一个文档树，它会把它解析成一颗HTML树，然后决定它如何被显示。</p>
<blockquote>
<h4 id="HTML-规定了很多东西"><a href="#HTML-规定了很多东西" class="headerlink" title="HTML 规定了很多东西"></a>HTML 规定了很多东西</h4></blockquote>
<ul>
<li>如 link 是一个 css</li>
<li>如 script 是一段 js</li>
</ul>
<p>当浏览器遇到如上内容的时候，浏览器就开始解析它，每当看到一个 link 就知道要去下载这个 css ,CSS规定了页面如何渲染，比如两个按钮之间的间距，背景色。</p>
<p>当这个 link 解析完成之后，就去解析下一个标签。</p>
<p>当浏览器看到 <code>script</code>的时候，它就知道自己要执行一段js代码。</p>
<p>当浏览器看到 <code>img</code>的时候，它就知道去把这个图片下载下来然后把它放在页面的某个位置上去。这就是为什么你访问 <a href="http://www.taobao.com" target="_blank" rel="noopener">www.taobao.com</a> 的时候，会发送许多许多你不知道的请求。</p>
<p>因为解析 如上 文档树的时候，发现里面还有许多许多东西需要加载，于是它就循环往复这个过程<strong>发起一个请求，拿到响应，直到把所有的事情都做完</strong></p>
<blockquote>
<h4 id="一个问题，是整个HTML下载完毕就去解析，还是来一点响应就解析一点"><a href="#一个问题，是整个HTML下载完毕就去解析，还是来一点响应就解析一点" class="headerlink" title="一个问题，是整个HTML下载完毕就去解析，还是来一点响应就解析一点"></a>一个问题，是整个HTML下载完毕就去解析，还是来一点响应就解析一点</h4></blockquote>
<ul>
<li>答案是 <strong>来一点解析一点</strong></li>
</ul>
<h4 id="同步加载和异步加载"><a href="#同步加载和异步加载" class="headerlink" title="同步加载和异步加载"></a>同步加载和异步加载</h4><ul>
<li>浏览器一次返回所有的数据</li>
<li>浏览器返回部分数据，使用 ajax 异步加载</li>
</ul>
<h4 id="只要浏览器能做到的，其他代码一定能做到"><a href="#只要浏览器能做到的，其他代码一定能做到" class="headerlink" title="只要浏览器能做到的，其他代码一定能做到"></a>只要浏览器能做到的，其他代码一定能做到</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/29/ZB-019-01超详细网址输入url过程/" data-id="cklhgn2ld00sbkyfyzwci832c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-03Hooks全解4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/25/ReactWheels07-03Hooks全解4/" class="article-date">
  <time datetime="2019-07-25T01:34:01.000Z" itemprop="datePublished">2019-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/25/ReactWheels07-03Hooks全解4/">ReactWheels07-03Hooks全解4</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h3 id="自定义Hooks"><a href="#自定义Hooks" class="headerlink" title="自定义Hooks"></a>自定义Hooks</h3><p>useList.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">const useList = () =&gt; &#123;</span><br><span class="line">  const [list, setList] = useState(null);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/list&quot;).then(list =&gt; &#123;</span><br><span class="line">      setList(list);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []); // [] 确保只在第一次运行</span><br><span class="line">  return &#123;</span><br><span class="line">    list: list,</span><br><span class="line">    addItem: name =&gt; &#123;</span><br><span class="line">      setList([...list, &#123; id: Math.random(), name: name &#125;]);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteIndex: index =&gt; &#123;</span><br><span class="line">      setList(list.slice(0, index).concat(list.slice(index + 1)));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">export default useList;</span><br><span class="line"></span><br><span class="line">function ajax() &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      resolve([</span><br><span class="line">        &#123; id: &quot;1&quot;, name: &quot;Frank&quot; &#125;,</span><br><span class="line">        &#123; id: &quot;2&quot;, name: &quot;Jack&quot; &#125;,</span><br><span class="line">        &#123; id: &quot;3&quot;, name: &quot;Alice&quot; &#125;,</span><br><span class="line">        &#123; id: &quot;4&quot;, name: &quot;Bob&quot; &#125;</span><br><span class="line">      ]);</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HooksDemo.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import useList from &quot;../hooks/useList&quot;;</span><br><span class="line"></span><br><span class="line">function HooksDemo() &#123;</span><br><span class="line">  const &#123; list, deleteIndex &#125; = useList();</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;List&lt;/h1&gt;</span><br><span class="line">      &#123;list ? (</span><br><span class="line">        &lt;ol&gt;</span><br><span class="line">          &#123;list.map((item, index) =&gt; (</span><br><span class="line">            &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">              &#123;item.name&#125;</span><br><span class="line">              &lt;button</span><br><span class="line">                onClick=&#123;() =&gt; &#123;</span><br><span class="line">                  deleteIndex(index);</span><br><span class="line">                &#125;&#125;</span><br><span class="line">              &gt;</span><br><span class="line">                x</span><br><span class="line">              &lt;/button&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/ol&gt;</span><br><span class="line">      ) : (</span><br><span class="line">          &quot;加载中...&quot;</span><br><span class="line">        )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default HooksDemo;</span><br></pre></td></tr></table></figure>
<h3 id="Stale-Closure"><a href="#Stale-Closure" class="headerlink" title="Stale Closure"></a>Stale Closure</h3><ul>
<li><a href="https://dmitripavlutin.com/react-hooks-stale-closures/" target="_blank" rel="noopener">过时闭包</a></li>
<li>只要你不觉得头疼！</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/25/ReactWheels07-03Hooks全解4/" data-id="cklhgn2jk00o5kyfyea8r2vdk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-03Hooks全解3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/25/ReactWheels07-03Hooks全解3/" class="article-date">
  <time datetime="2019-07-25T00:34:01.000Z" itemprop="datePublished">2019-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/25/ReactWheels07-03Hooks全解3/">ReactWheels07-03Hooks全解3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h3 id="Memo"><a href="#Memo" class="headerlink" title="Memo"></a>Memo</h3><ul>
<li>React.Memo</li>
<li>Child3 可以用 React.Memo(Child)代替</li>
<li>如果props不变，就不会再次执行一个函数组件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line">function UseMemoDemo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  const [m, setM] = useState(0)</span><br><span class="line">  const onChangeN = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  const onChangeM = () =&gt; &#123;</span><br><span class="line">    setM(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      没有缓存，Child组件 依赖的是m，点击按钮更新的是n,也会触发 Child从新执行</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      n:&#123;n&#125;,</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      m:&#123;m&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeN&#125;&gt;onChangeN&lt;/button&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeM&#125;&gt;onChangeM&lt;/button&gt;</span><br><span class="line">      &lt;Child data=&#123;m&#125; /&gt;</span><br><span class="line">      &lt;Child3 data=&#123;m&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(props) &#123;</span><br><span class="line">  console.log(&apos;Child执行了&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑1&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑2&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑3&apos;)</span><br><span class="line">  return (&lt;div&gt;child:&#123;props.data&#125;&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child2(props) &#123;</span><br><span class="line">  console.log(&apos;Child2执行了&apos;)</span><br><span class="line">  console.log(&apos;Child2内大量逻辑1&apos;)</span><br><span class="line">  console.log(&apos;Child2内大量逻辑2&apos;)</span><br><span class="line">  console.log(&apos;Child2内大量逻辑3&apos;)</span><br><span class="line">  return (&lt;div&gt;child2:&#123;props.data&#125;&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 被缓存，第一次执行后，当依赖的值变了才会更新</span><br><span class="line">const Child3 = React.memo(Child2)</span><br><span class="line"></span><br><span class="line">export default UseMemoDemo1;</span><br></pre></td></tr></table></figure>
<h3 id="Memo的Bug-如果-传递一个props-fn"><a href="#Memo的Bug-如果-传递一个props-fn" class="headerlink" title="Memo的Bug: 如果 传递一个props.fn"></a>Memo的Bug: 如果 传递一个props.fn</h3><ul>
<li>每次渲染的时候 父组件的 fn会重新生成一个，这样就导致，props变了， memo的组件失效了</li>
<li>解决办法就是：<strong>useMemo</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useCallback, useMemo, useState &#125; from &apos;react&apos;;</span><br><span class="line">// useMemo</span><br><span class="line">function UseMemoDemo2() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  const [m, setM] = useState(0)</span><br><span class="line">  const onChangeN = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  const onChangeM = () =&gt; &#123;</span><br><span class="line">    setM(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  const onClickChild = () =&gt; &#123; &#125; // 这个每次执行的时候 都会重新生成一个 而且是引用的地址 ，child依赖它，它变了，child无法被缓存</span><br><span class="line"></span><br><span class="line">  /*</span><br><span class="line">  useMemo(()=&gt;&#123;</span><br><span class="line">    return 复用的函数</span><br><span class="line">  &#125;,[依赖的变量]) </span><br><span class="line">  这个函数复用 </span><br><span class="line">    return 就是复用的函数</span><br><span class="line">    第二个参数里的 [] 内是依赖变化的值</span><br><span class="line">  */</span><br><span class="line">  const onClickChildMemo = useMemo(() =&gt; &#123;</span><br><span class="line">    // return的东西 就是你要缓存的函数</span><br><span class="line">    return () =&gt; &#123; &#125;</span><br><span class="line">  &#125;, [m]) // []里是依赖的东西变了才更新</span><br><span class="line"></span><br><span class="line">  /*</span><br><span class="line">  useCallback(fn,[m]) </span><br><span class="line">  等价于</span><br><span class="line">  useMemo(()=&gt;fn,[m])</span><br><span class="line">  */</span><br><span class="line">  const fn = () =&gt; console.log(m)</span><br><span class="line">  const onClickChildMemo2 = useMemo(() =&gt; fn, [m])</span><br><span class="line">  const onClickChildMemo3 = useCallback(fn, [m])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      没有缓存，Child组件 依赖的是m，点击按钮更新的是n,也会触发 Child从新执行</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      n:&#123;n&#125;,</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      m:&#123;m&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeN&#125;&gt;onChangeN&lt;/button&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeM&#125;&gt;onChangeM&lt;/button&gt;</span><br><span class="line">      &lt;Child2 data=&#123;m&#125; onClick=&#123;onClickChild&#125; /&gt;</span><br><span class="line">      &lt;Child4 data=&#123;m&#125; onChilk=&#123;onClickChildMemo&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(props) &#123;</span><br><span class="line">  console.log(&apos;Child执行了&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑1&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑2&apos;)</span><br><span class="line">  console.log(&apos;Child内大量逻辑3&apos;)</span><br><span class="line">  return (&lt;div onClick=&#123;props.onClick&#125;&gt;child:&#123;props.data&#125;&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Child2 = React.memo(Child)</span><br><span class="line"></span><br><span class="line">function Child3(props) &#123;</span><br><span class="line">  console.log(&apos;Child3执行了&apos;)</span><br><span class="line">  console.log(&apos;Child3内大量逻辑1&apos;)</span><br><span class="line">  console.log(&apos;Child3内大量逻辑2&apos;)</span><br><span class="line">  console.log(&apos;Child3内大量逻辑3&apos;)</span><br><span class="line">  return (&lt;div onClick=&#123;props.onClick&#125;&gt;child:&#123;props.data&#125;&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Child4 = React.memo(Child3)</span><br><span class="line"></span><br><span class="line">export default UseMemoDemo2;</span><br></pre></td></tr></table></figure>
<h3 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h3><blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>第一个参数是 ()=&gt;value</li>
<li>第二个参数是 依赖 <code>[m,n]</code></li>
<li>只有依赖变了的时候，才会计算出新的 value,反之复用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">useMemo(()=&gt;&#123;</span><br><span class="line">  return 复用的函数</span><br><span class="line">&#125;,[依赖的变量]) </span><br><span class="line">这个函数复用 </span><br><span class="line">  return 就是复用的函数</span><br><span class="line">  第二个参数里的 [] 内是依赖变化的值</span><br><span class="line">*/</span><br><span class="line">const onClickChildMemo = useMemo(() =&gt; &#123;</span><br><span class="line">  // return的东西 就是你要缓存的函数</span><br><span class="line">  return () =&gt; &#123; &#125;</span><br><span class="line">&#125;, [m]) // []里是依赖的东西变了才更新</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li>如果你的 value是个函数你就要这样</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useMemo(()=&gt;(x)=&gt;&#123;console.log(1)&#125;&#125;,[依赖1，依赖2])</span><br></pre></td></tr></table></figure>
<ul>
<li>useCallback的优化</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 两个箭头看着很懵逼</span><br><span class="line">useMemo(()=&gt;(x)=&gt;&#123;console.log(x)&#125;&#125;,[依赖1，依赖2])</span><br><span class="line"></span><br><span class="line">// useCallback 你可以这样</span><br><span class="line">useCallback((x)=&gt;&#123;console.log(x)&#125;&#125;,[依赖1，依赖2])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">useCallback(fn,[m]) </span><br><span class="line">等价于</span><br><span class="line">useMemo(()=&gt;fn,[m])</span><br></pre></td></tr></table></figure>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><ul>
<li>当你需要一个值，在组件不断render的时候保持不变(addr)</li>
<li>初始化 <code>const count = useRef(0)</code></li>
<li>读取 count.current</li>
<li>为什么需要 current?<ul>
<li>为了保证多次 useRef 都是同一个值(只有引用能做到) </li>
<li><code>count = {current:0}</code> 地址101</li>
<li>下次 +1 后  <code>count = {current:1}</code> 地址101</li>
</ul>
</li>
</ul>
<h4 id="扩展vue3内容"><a href="#扩展vue3内容" class="headerlink" title="扩展vue3内容"></a>扩展vue3内容</h4><ul>
<li><p>vue3的ref 改变ref的值，会触发UI更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 初始化</span><br><span class="line">cosnt count = ref(0)</span><br><span class="line">// 读取</span><br><span class="line">count.value</span><br><span class="line">// 更新,它会触发UI更新，vue3会自动 render</span><br><span class="line">count.value +=1</span><br></pre></td></tr></table></figure>
</li>
<li><p>而 react的 ref不会触发 UI更新</p>
</li>
</ul>
<h4 id="想要给React的ref改变的时候触发UI更新咋办？"><a href="#想要给React的ref改变的时候触发UI更新咋办？" class="headerlink" title="想要给React的ref改变的时候触发UI更新咋办？"></a>想要给React的ref改变的时候触发UI更新咋办？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useEffect, useRef, useState &#125; from &apos;react&apos;;</span><br><span class="line">function UseRefDemo1() &#123;</span><br><span class="line">  const count = useRef(0)</span><br><span class="line">  const [_, set_] = useState(null)</span><br><span class="line">  const onChangeN = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    count.current += 1</span><br><span class="line">  &#125;</span><br><span class="line">  const onChangeNUpdatedUI = () =&gt; &#123;</span><br><span class="line">    count.current += 1</span><br><span class="line">    set_(Math.random())</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(count)</span><br><span class="line">  &#125;)</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      count:&#123;count.current&#125;,</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeN&#125;&gt;onChangeRef不更新UI&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onChangeNUpdatedUI&#125;&gt;onChangeRef更新UI&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UseRefDemo1;</span><br></pre></td></tr></table></figure>
<h3 id="forwardRef-仅限函数组件"><a href="#forwardRef-仅限函数组件" class="headerlink" title="forwardRef : 仅限函数组件"></a>forwardRef : 仅限函数组件</h3><ul>
<li>props无法传递 ref</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useRef &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const buttonRef = useRef(null);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;Button2 ref=&#123;buttonRef&#125;&gt;按钮&lt;/Button2&gt;</span><br><span class="line">      &#123;/* 看浏览器控制台的报错 */&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Button2 = props =&gt; &#123;</span><br><span class="line">  return &lt;button className=&quot;red&quot; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li>实现ref传递</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useRef &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const buttonRef = useRef(null);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;Button3 ref=&#123;buttonRef&#125;&gt;按钮&lt;/Button3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Button2 = (props,ref)=&gt;&#123;</span><br><span class="line">  return &lt;button className=&quot;red&quot; ref=&#123;ref&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// React.forwardRef 可以额外多传递一个参数</span><br><span class="line">// 把ref参数 转发给 Button2</span><br><span class="line">const Button3 = React.forwardRef(Button2);</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h4 id="useRef-1"><a href="#useRef-1" class="headerlink" title="useRef"></a>useRef</h4><ul>
<li>可用来引用DOM,避免来 docuemt.querySelector</li>
<li>也可以引用普通对象</li>
</ul>
<h4 id="forwardRef"><a href="#forwardRef" class="headerlink" title="forwardRef"></a>forwardRef</h4><ul>
<li>由于 props不能传递 ref,所以需要 forwardRef</li>
<li>为什么props不包含 ref呢？，因为大部分时候不需要</li>
</ul>
<h3 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h3><ul>
<li>名字起的稀巴烂</li>
<li>应该叫做 setRef</li>
<li>用于自定义 ref的属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;</span><br><span class="line">  useRef,</span><br><span class="line">  useEffect,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">  createRef</span><br><span class="line">&#125; from &quot;react&quot;;</span><br><span class="line"></span><br><span class="line">function SetRefDemo() &#123;</span><br><span class="line">  const buttonRef = useRef(null);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(buttonRef.current);</span><br><span class="line">  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;Button2 ref=&#123;buttonRef&#125;&gt;按钮&lt;/Button2&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        className=&quot;close&quot;</span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          console.log(buttonRef);</span><br><span class="line">          buttonRef.current.x();</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Button2 = React.forwardRef((props, ref) =&gt; &#123;</span><br><span class="line">  const realButton = createRef(null);</span><br><span class="line">  const setRef = useImperativeHandle;</span><br><span class="line">  // 对 ref进行自定义的包装返回</span><br><span class="line">  setRef(ref, () =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      x: () =&gt; &#123;</span><br><span class="line">        realButton.current.remove();</span><br><span class="line">      &#125;,</span><br><span class="line">      realButton: realButton</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  return &lt;button ref=&#123;realButton&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default SetRefDemo;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/25/ReactWheels07-03Hooks全解3/" data-id="cklhgn2jm00o7kyfyxns5nvgj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-03Hooks全解2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/24/ReactWheels07-03Hooks全解2/" class="article-date">
  <time datetime="2019-07-24T15:34:01.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/24/ReactWheels07-03Hooks全解2/">ReactWheels07-03Hooks全解2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h3 id="用useReducer代替redux"><a href="#用useReducer代替redux" class="headerlink" title="用useReducer代替redux"></a>用useReducer代替redux</h3><p><strong>一共七步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useContext, useReducer, useEffect &#125; from &quot;react&quot;;</span><br><span class="line">// step01 将数据集中在store里</span><br><span class="line">const store = &#123;</span><br><span class="line">  user: null,</span><br><span class="line">  books: null,</span><br><span class="line">  movies: null</span><br><span class="line">&#125;</span><br><span class="line">// step02 将所有操作集中在 reducer里</span><br><span class="line">const reducer = (state, action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &apos;setUser&apos;:</span><br><span class="line">      return &#123; ...state, user: action.user &#125;</span><br><span class="line">    case &apos;setBooks&apos;:</span><br><span class="line">      return &#123; ...state, books: action.books &#125;</span><br><span class="line">    case &apos;setMovies&apos;:</span><br><span class="line">      return &#123; ...state, movies: action.movies &#125;</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;no match action&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// step03 创建 Context</span><br><span class="line">const Context = React.createContext(null)</span><br><span class="line"></span><br><span class="line">function ReducerDemo1() &#123;</span><br><span class="line">  // step04 创建对数据的 读/写 API</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, store)</span><br><span class="line">  return (</span><br><span class="line">    // step05 将 step04的 读写api放到 Context提供的组件上</span><br><span class="line">    // step06 Context.Provider  将 Context 提供给所有组件</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; state, dispatch &#125;&#125;&gt;</span><br><span class="line">      &lt;User /&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &lt;Books /&gt;</span><br><span class="line">      &lt;Movies /&gt;</span><br><span class="line">    &lt;/Context.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// step07 各个组件用 useContext 获取读写API</span><br><span class="line">function User() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/user&quot;).then(user =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setUser&quot;, user: user &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;个人信息&lt;/h1&gt;</span><br><span class="line">      &lt;div&gt;name: &#123;state.user ? state.user.name : &quot;&quot;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Books() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/books&quot;).then(books =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setBooks&quot;, books: books &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;我的书籍&lt;/h1&gt;</span><br><span class="line">      &lt;ol&gt;</span><br><span class="line">        &#123;state.books ? state.books.map(book =&gt; &lt;li key=&#123;book.id&#125;&gt;&#123;book.name&#125;&lt;/li&gt;) : &quot;加载中&quot;&#125;</span><br><span class="line">      &lt;/ol&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Movies() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/movies&quot;).then(movies =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setMovies&quot;, movies: movies &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;我的电影&lt;/h1&gt;</span><br><span class="line">      &lt;ol&gt;</span><br><span class="line">        &#123;state.movies</span><br><span class="line">          ? state.movies.map(movie =&gt; &lt;li key=&#123;movie.id&#125;&gt;&#123;movie.name&#125;&lt;/li&gt;)</span><br><span class="line">          : &quot;加载中&quot;&#125;</span><br><span class="line">      &lt;/ol&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ReducerDemo1;</span><br><span class="line"></span><br><span class="line">// 帮助函数</span><br><span class="line"></span><br><span class="line">// 假 ajax</span><br><span class="line">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败</span><br><span class="line">function ajax(path) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      if (path === &quot;/user&quot;) &#123;</span><br><span class="line">        resolve(&#123;</span><br><span class="line">          id: 1,</span><br><span class="line">          name: &quot;hjx&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else if (path === &quot;/books&quot;) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            name: &quot;JavaScript 高级程序设计&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: 2,</span><br><span class="line">            name: &quot;JavaScript 精粹&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]);</span><br><span class="line">      &#125; else if (path === &quot;/movies&quot;) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            name: &quot;爱在黎明破晓前&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: 2,</span><br><span class="line">            name: &quot;恋恋笔记本&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><ul>
<li>上下文<ul>
<li>全局变量是全局的上下文</li>
<li>上下文是局部的全局变量</li>
</ul>
</li>
<li>使用方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">step1 const C = createContext(null);</span><br><span class="line">step2 &lt;C.Provider value=&#123;&#123; n, setN &#125;&#125;&gt; 圈定作用域</span><br><span class="line">step3 在作用域内(任意级子组件内)使用 useContext(c) 来使用上下文</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>不是响应式的<ul>
<li>你在一个组件内将 C变化 setN</li>
<li>另一个模块不会感知这个变化</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; createContext, useState, useContext &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const C = createContext(null);</span><br><span class="line"></span><br><span class="line">function UseContextDemo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  return (</span><br><span class="line">    &lt;C.Provider value=&#123;&#123; n, setN &#125;&#125;&gt;</span><br><span class="line">      &lt;div className=&quot;UseContextDemo1&quot;&gt;</span><br><span class="line">        &lt;Baba /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/C.Provider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Baba() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      我是爸爸</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child() &#123;</span><br><span class="line">  const &#123; n, setN &#125; = useContext(C);</span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      我是儿子，我得到n:&#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">export default UseContextDemo1</span><br></pre></td></tr></table></figure>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><ul>
<li><p>副作用</p>
<ul>
<li>对环境的改变即为副作用，如 <code>document.title = &#39;xxx&#39;</code></li>
<li>不一定把 这个副作用 放在 useEffect里</li>
<li>每次 render后执行</li>
</ul>
</li>
<li><p>用途</p>
<ul>
<li>作为 componentDidMount 使用 <code>[]</code> 作为第二个参数</li>
<li>作为 componentDidUpdate 使用 <code>[n]</code> 数组内可以指定依赖,n变了才会触发</li>
<li>作为 componentWillUnmount 使用 ，通过return 代表销毁的时候</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>存在多个 useEffect,会按照出现次序执行</li>
</ul>
</li>
</ul>
<h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useEffect, useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function UseEffectDemo1() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;Demo1 /&gt;</span><br><span class="line">      &lt;Demo2 /&gt;</span><br><span class="line">      &lt;Demo3 /&gt;</span><br><span class="line">      &lt;Demo4 /&gt;</span><br><span class="line">      &lt;Demo5 /&gt;</span><br><span class="line">      &lt;Demo6 /&gt;</span><br><span class="line">      &lt;Demo7 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // 任何一个变了变量变了都执行</span><br><span class="line">    // 第一次 和 第二三四 。。。 次</span><br><span class="line">    console.log(&apos;demo1:第一次 和 第二三四 。。。 次,任何一个变量变了都执行&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect不传递第二个参数， 第一二三。。。次执行,任何一个变量变了都执行&lt;/h1&gt;</span><br><span class="line">      n:&#123;n&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo2() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // n更新之后</span><br><span class="line">    console.log(&apos;demo2:n更新之后&apos;)</span><br><span class="line">  &#125;, [n])</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect传递第二个参数[n]， 第一次执行,以及n变了执行&lt;/h1&gt;</span><br><span class="line">      n:&#123;n&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo3() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const [y, setY] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // x更新之后,</span><br><span class="line">    console.log(&apos;demo3:第一次执行，以及x更新之后才变，y改变不会触发effect&apos;)</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  const onClickY = () =&gt; &#123;</span><br><span class="line">    setY(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect传递第二个参数[x]，第一次执行，以及x更新之后才变，y改变不会触发effect&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      y:&#123;y&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickY&#125;&gt;y+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo4() &#123;</span><br><span class="line">  const initValue = 0;</span><br><span class="line">  const [z, setZ] = useState(initValue)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // 跳过第一次</span><br><span class="line">    if (z !== initValue) &#123;</span><br><span class="line">      // 跳过第一次</span><br><span class="line">      console.log(&apos;demo4:通过if(z!== initValue)判断，跳过第一次，z修改后执行&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [z])</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setZ(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      z:&#123;z&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;z+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo5() &#123;</span><br><span class="line">  const [z, setZ] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo5:useEffect 第二个参数为空数组[],只执行一次&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setZ(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo5&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo5:useEffect 第二个参数为空数组[],只执行一次&lt;/h1&gt;</span><br><span class="line">      z:&#123;z&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;z+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo6() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;demo6:useEffect 移除时执行 return里写一个函数&apos;)</span><br><span class="line">    &#125;, 3000)</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.clearInterval(id);</span><br><span class="line">      console.log(&apos;demo6:组件销毁的时候执行&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo6&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo6:useEffect 移除时执行操作 return一个函数进行操作&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo7() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo7:1&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo7:2&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo7&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo7:多个useEffect 按顺序执行&lt;/h1&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UseEffectDemo1</span><br></pre></td></tr></table></figure>
<h3 id="useLayoutEffext"><a href="#useLayoutEffext" class="headerlink" title="useLayoutEffext"></a>useLayoutEffext</h3><h4 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h4><p>执行流程</p>
<ul>
<li>App执行</li>
<li>vDom</li>
<li>生成真实Dom</li>
<li>render完毕，改变外观 <code>&lt;div&gt;0&lt;/div&gt;</code></li>
<li>effect 执行=》<code>div.innerText = 1000</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Demo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.querySelector(&apos;#x&apos;).innerText = `n:1000`</span><br><span class="line">  &#125;, [n])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect&lt;/h1&gt;</span><br><span class="line">      &lt;div id=&quot;x&quot;&gt;n:&#123;n&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<h4 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h4><p>执行流程</p>
<ul>
<li>App执行</li>
<li>vDom</li>
<li>生成真实Dom<ul>
<li><code>&lt;div&gt;0&lt;/div&gt;</code></li>
<li>useLayoutEffect 执行=》<code>div.innerText = 1000</code></li>
<li>作为浏览器不会看见 n = 0 的过程</li>
</ul>
</li>
<li>render完毕，改变外观 <code>&lt;div&gt;1000&lt;/div&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Demo2() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useLayoutEffect(() =&gt; &#123;</span><br><span class="line">    document.querySelector(&apos;#x2&apos;).innerText = `n:1000`</span><br><span class="line">  &#125;, [n])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect&lt;/h1&gt;</span><br><span class="line">      &lt;div id=&quot;x2&quot;&gt;n:&#123;n&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useLayoutEffect-和-useEffect-区别"><a href="#useLayoutEffect-和-useEffect-区别" class="headerlink" title="useLayoutEffect 和 useEffect 区别"></a>useLayoutEffect 和 useEffect 区别</h4><ul>
<li>useLayoutEffect 是 render之前(看不到闪烁)<ul>
<li>是不是用这个更好呢？<ul>
<li>不是，因为大部分时间，我们不回去改变 dom</li>
<li>useEffect 满足不了需求的时候用 useLayoutEffect</li>
<li>优先级更高</li>
</ul>
</li>
</ul>
</li>
<li>useEffect 是 render之后触发(能看见闪烁)</li>
</ul>
<h4 id="useLayoutEffect-和-useEffect-性能测试"><a href="#useLayoutEffect-和-useEffect-性能测试" class="headerlink" title="useLayoutEffect 和 useEffect 性能测试"></a>useLayoutEffect 和 useEffect 性能测试</h4><ul>
<li>useLayoutEffect 耗时更短</li>
<li>useEffect 耗时更长</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">function Demo3() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const time = useRef(null)</span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">    time.current = performance.now()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (time.current) &#123;</span><br><span class="line">      console.log(&apos;demo3:&apos; + (performance.now() - time.current))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo3&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect的更新UI时间更长&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo4() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const time = useRef(null)</span><br><span class="line"></span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">    time.current = performance.now()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useLayoutEffect(() =&gt; &#123;</span><br><span class="line">    if (time.current) &#123;</span><br><span class="line">      console.log(&apos;demo4:&apos; + (performance.now() - time.current))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo4&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useLayoutEffect的更新UI时间更短&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useEffect注意事项"><a href="#useEffect注意事项" class="headerlink" title="useEffect注意事项"></a>useEffect注意事项</h3><ul>
<li>如果 useLayoutEffect 和 useEffect 同时存在 useLayoutEffect先执行</li>
<li>如果 用 useLayoutEffect ，你最好改变Layout</li>
<li>为了用户体验，优先使用 useEffect(优先渲染)</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/24/ReactWheels07-03Hooks全解2/" data-id="cklhgn2jo00obkyfyz1ydhoke" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-03Hooks全解1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/24/ReactWheels07-03Hooks全解1/" class="article-date">
  <time datetime="2019-07-24T14:34:01.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/24/ReactWheels07-03Hooks全解1/">ReactWheels07-03Hooks全解1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><ul>
<li>状态：useState</li>
<li>副作用: useEffect<ul>
<li>useLayoutEffect</li>
</ul>
</li>
<li>上下文: useContext</li>
<li>Redux : useReducer</li>
<li>记忆: useMemo<ul>
<li>useCallback</li>
</ul>
</li>
<li>引用: useRef<ul>
<li>useImperativeHandle</li>
</ul>
</li>
<li>自定义Hook<ul>
<li>useDebugValue</li>
</ul>
</li>
</ul>
<h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 使用</span><br><span class="line">const [n, setN] = useState(0);</span><br><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="注意事项：不能局部更新"><a href="#注意事项：不能局部更新" class="headerlink" title="注意事项：不能局部更新"></a>注意事项：不能局部更新</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;,age:19&#125;);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setUser(&#123;</span><br><span class="line">    age:20</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这样操作之后， name属性就没了</span><br><span class="line"></span><br><span class="line">你只能这样</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setUser(&#123;</span><br><span class="line">    ...user,</span><br><span class="line">    age:20</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注意事项2-不能直接改地址"><a href="#注意事项2-不能直接改地址" class="headerlink" title="注意事项2:不能直接改地址"></a>注意事项2:不能直接改地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;,age:19&#125;);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  user.name = &apos;xxx&apos; // 千万不要改之前的对象</span><br><span class="line">  setUser(user)</span><br><span class="line">  // 这样也不会触发更新</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useState补充"><a href="#useState补充" class="headerlink" title="useState补充"></a>useState补充</h4><ul>
<li>useState接受函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 这样每次 js解析 都会 算一下 18+18</span><br><span class="line">const [user,setUser] = useState(&#123;name:&apos;aaa&apos;,age:18+18&#125;) </span><br><span class="line"></span><br><span class="line">对比这样的好处是 函数只会执行一次，减少多余的计算过程</span><br><span class="line">const [user,setUser] = useState(()=&gt;&#123;</span><br><span class="line">  return (&#123;name:&apos;aaa&apos;,age:18+18&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 基本用不到</span><br></pre></td></tr></table></figure>
<ul>
<li>setState 可以用函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const [n, setN] = useState(0);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setN(n+1) // n不会变</span><br><span class="line">  setN(n+2) // 只有最后一次会生效</span><br><span class="line">  // n = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 多次操作n的正确姿势</span><br><span class="line">onClick()&#123;</span><br><span class="line">  setN(x =&gt; x+1) </span><br><span class="line">  setN(y =&gt; y+1) </span><br><span class="line">  // n = 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><ul>
<li><strong>用来践行 Flue/Redux思想</strong> 一共四步<ul>
<li>创建 initState</li>
<li>创建所有 reducer(state,action)</li>
<li>传给 useReducer ,得到 读/写 api</li>
<li>调用写 <code>{type:&#39;操作类型&#39;}</code></li>
</ul>
</li>
<li><p>useReducer 就是 useState的复杂版</p>
</li>
<li><p><a href="https://codesandbox.io/s/eager-dewdney-6jj23" target="_blank" rel="noopener">代码</a></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useReducer &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 1创建初始值</span><br><span class="line">const initial = &#123;</span><br><span class="line">  n: 0</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 2创建所有 reducer</span><br><span class="line">const reducer = (state, action) =&gt; &#123;</span><br><span class="line">  if (action.type === &quot;add&quot;) &#123;</span><br><span class="line">    return &#123; n: state.n + action.number &#125;;</span><br><span class="line">  &#125; else if (action.type === &quot;multi&quot;) &#123;</span><br><span class="line">    return &#123; n: state.n * 2 &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error(&quot;unknown type&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, initial);</span><br><span class="line">  const &#123; n &#125; = state;</span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;add&quot;, number: 1 &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  const onClick2 = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;add&quot;, number: 2 &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n: &#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick2&#125;&gt;+2&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/competent-resonance-ksz9v" target="_blank" rel="noopener">高级例子</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useReducer &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">const initFormData = &#123;</span><br><span class="line">  name: &quot;&quot;,</span><br><span class="line">  age: 18,</span><br><span class="line">  nationality: &quot;汉族&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &quot;patch&quot;:</span><br><span class="line">      return &#123; ...state, ...action.formData &#125;;</span><br><span class="line">    case &quot;reset&quot;:</span><br><span class="line">      return initFormData;</span><br><span class="line">    default:</span><br><span class="line">      throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [formData, dispatch] = useReducer(reducer, initFormData);</span><br><span class="line">  // const patch = (key, value)=&gt;&#123;</span><br><span class="line">  //   dispatch(&#123; type: &quot;patch&quot;, formData: &#123; [key]: value &#125; &#125;)</span><br><span class="line">  // &#125;</span><br><span class="line">  const onSubmit = () =&gt; &#123;&#125;;</span><br><span class="line">  const onReset = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;reset&quot; &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;form onSubmit=&#123;onSubmit&#125; onReset=&#123;onReset&#125;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          姓名</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.name&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; type: &quot;patch&quot;, formData: &#123; name: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          年龄</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.age&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; type: &quot;patch&quot;, formData: &#123; age: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          民族</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.nationality&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123;</span><br><span class="line">                type: &quot;patch&quot;,</span><br><span class="line">                formData: &#123; nationality: e.target.value &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt;</span><br><span class="line">        &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &#123;JSON.stringify(formData)&#125;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/24/ReactWheels07-03Hooks全解1/" data-id="cklhgn2jj00o1kyfydhjsex5y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-02useState原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/23/ReactWheels07-02useState原理/" class="article-date">
  <time datetime="2019-07-23T14:34:01.000Z" itemprop="datePublished">2019-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/23/ReactWheels07-02useState原理/">ReactWheels07-02useState原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="useState原理"><a href="#useState原理" class="headerlink" title="useState原理"></a>useState原理</h2><h3 id="useState用法"><a href="#useState用法" class="headerlink" title="useState用法"></a>useState用法</h3><ul>
<li><a href="https://codesandbox.io/s/pensive-mendeleev-tvut2" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = useState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAdd&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<p><strong>脑补过程</strong></p>
<ul>
<li>首次渲染 <code>render(&lt;App/&gt;)</code></li>
<li>调用 App 函数 =&gt; 得到 虚拟div，然后创建真实的div</li>
<li>用户点击 button,调用 <code>setN(n+1)</code> </li>
<li>再次 <code>render(&lt;App/&gt;)</code><ul>
<li>调用 App函数 ，</li>
<li>得到 虚拟div</li>
<li>DOM Diff 更新真实 div</li>
</ul>
</li>
<li>每次都调用 App(),都会运行 useState(0)<ul>
<li>第一次的时候 n = 0</li>
<li>之后每次 n = n+1</li>
</ul>
</li>
</ul>
<p><strong>分析</strong></p>
<blockquote>
<p>setN</p>
</blockquote>
<ul>
<li>setN 一定会修改数据 x,将 n+1 存入 x</li>
<li>setN 一定会触发 <code>&lt;App/&gt;</code> 重新渲染 re-render</li>
</ul>
<blockquote>
<p>useState</p>
</blockquote>
<ul>
<li>useState 肯定会从 x 读取 n的最新值</li>
</ul>
<blockquote>
<p>x</p>
</blockquote>
<ul>
<li>每个组件有自己的数据x,我们将它命名为 state</li>
</ul>
<h3 id="自己实现一个-useState"><a href="#自己实现一个-useState" class="headerlink" title="自己实现一个 useState"></a>自己实现一个 useState</h3><h4 id="最简单的-useState-实现"><a href="#最简单的-useState-实现" class="headerlink" title="最简单的 useState 实现"></a>最简单的 useState 实现</h4><ul>
<li><a href="https://codesandbox.io/s/zealous-cloud-ik020" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">let _state;</span><br><span class="line">const myUseState = (initValue) =&gt; &#123;</span><br><span class="line">  console.log(&quot;myUseState run&quot;);</span><br><span class="line">  _state = _state === undefined ? initValue : _state;</span><br><span class="line">  const setState = (newValue) =&gt; &#123;</span><br><span class="line">    _state = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  return [_state, setState];</span><br><span class="line">&#125;;</span><br><span class="line">function render() &#123;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<ul>
<li>存在问题 ，App内 有两个变量的时候咋办 m，n 那样就会使用两次 useState</li>
</ul>
<h4 id="改进思路"><a href="#改进思路" class="headerlink" title="改进思路"></a>改进思路</h4><blockquote>
<p>把 _state 做成一个对象</p>
</blockquote>
<ul>
<li><code>_state = {n:0,m:0}</code></li>
<li>不行，因为 <code>useState(0)</code> 的时候 不知道变量 叫做 n 还是 m</li>
</ul>
<blockquote>
<p>把 _state 做成数组</p>
</blockquote>
<ul>
<li>比如 _state = [0,0]</li>
<li>貌似可以</li>
</ul>
<h4 id="解决多个-值-setState问题"><a href="#解决多个-值-setState问题" class="headerlink" title="解决多个 值 setState问题"></a>解决多个 值 setState问题</h4><ul>
<li><a href="https://codesandbox.io/s/morning-water-djeyz" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">let _state = [];</span><br><span class="line">let index = 0;</span><br><span class="line">const myUseState = (initValue) =&gt; &#123;</span><br><span class="line">  const currentIndex = index;</span><br><span class="line">  _state[currentIndex] =</span><br><span class="line">    _state[currentIndex] === undefined ? initValue : _state[currentIndex];</span><br><span class="line">  const setState = (newValue) =&gt; &#123;</span><br><span class="line">    _state[currentIndex] = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  index += 1;</span><br><span class="line">  return [_state[currentIndex], setState];</span><br><span class="line">&#125;;</span><br><span class="line">function render() &#123;</span><br><span class="line">  // 每次重新渲染的时候 重置 index</span><br><span class="line">  index = 0;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  const [m, setM] = myUseState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n:&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">      &lt;h1&gt;m:&#123;m&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setM(m + 1)&#125;&gt;onAddM&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<h3 id="useState数组方案缺陷"><a href="#useState数组方案缺陷" class="headerlink" title="useState数组方案缺陷"></a>useState数组方案缺陷</h3><h4 id="注意事项：外面不能加-if"><a href="#注意事项：外面不能加-if" class="headerlink" title="注意事项：外面不能加 if"></a>注意事项：外面不能加 if</h4><blockquote>
<p>因为上面的实现我们知道了，实际state是一个<code>[]</code>,你加了 if的时候 ，这个 index索引就乱了</p>
</blockquote>
<ul>
<li>第一次调用 n 是第一个，第二次调用 m 是第二个</li>
<li>必须保证他们的顺序是一致的</li>
<li>所以不能这样</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  let m,setM</span><br><span class="line">  if(n%2 === 1)&#123;</span><br><span class="line">    [m, setM] = myUseState(0);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n:&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">      &lt;h1&gt;m:&#123;m&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setM(m + 1)&#125;&gt;onAddM&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>vue3克服了这个问题</li>
</ul>
<h3 id="现在存在的问题"><a href="#现在存在的问题" class="headerlink" title="现在存在的问题"></a>现在存在的问题</h3><ul>
<li><p>App 用了 _state 和 index，其他组件咋办</p>
<ul>
<li>解决办法<strong>给每个组件创建一个 _state 和 index</strong></li>
</ul>
</li>
<li><p>放在全局变量重名了咋办？</p>
<ul>
<li>放在组件对应的 虚拟dom节点身上</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">开始的时候 render(&lt;App/&gt;)</span><br><span class="line"></span><br><span class="line">生成虚拟dom</span><br><span class="line">vnode  = &#123;</span><br><span class="line">  tag:&apos;div&apos;,</span><br><span class="line">  type:&apos;App&apos;</span><br><span class="line">  _state:[],</span><br><span class="line">  index:0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">第一次渲染的时候 触发 useState(0)</span><br><span class="line">渲染 0</span><br><span class="line">第二次 onAdd的时候</span><br><span class="line">产生新的 vnode2 同时 测试的 n = n+1</span><br><span class="line"></span><br><span class="line">diff算法 分析差异 ，patch打补丁，更新 &lt;App/&gt;</span><br><span class="line">渲染更新后的 vnode2,n = 1</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>每个函数组件对应一个 React节点， 虚拟dom</li>
<li>每个节点保存着 state和 index<ul>
<li>_state 真实名称为 memoizedState</li>
<li>index的实现用到了 链表</li>
</ul>
</li>
<li>useState 会读取 <code>state[index]</code></li>
<li>index 由 useState 出现的次数 依次递增</li>
<li>setState 会修改 state,并触发更新</li>
</ul>
<h3 id="useState的错误理解"><a href="#useState的错误理解" class="headerlink" title="useState的错误理解"></a>useState的错误理解</h3><ul>
<li><a href="https://codesandbox.io/s/eloquent-jackson-j8w9p" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [n, setN] = useState(0);</span><br><span class="line">  const log = () =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(`n:$&#123;n&#125;`);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先 log 在 +1</p>
</blockquote>
<ul>
<li>打印 0</li>
</ul>
<blockquote>
<p>先+1 在 log</p>
</blockquote>
<ul>
<li>打印 n+1</li>
</ul>
<h4 id="错误理解就是：setN会改变n"><a href="#错误理解就是：setN会改变n" class="headerlink" title="错误理解就是：setN会改变n"></a>错误理解就是：setN会改变n</h4><ul>
<li>setN 不会改变 n</li>
<li>每次<code>+1</code>都会有一个新的n</li>
<li>n有分身</li>
</ul>
<h4 id="能不能一个-n贯穿始终"><a href="#能不能一个-n贯穿始终" class="headerlink" title="能不能一个 n贯穿始终"></a>能不能一个 n贯穿始终</h4><ul>
<li>推荐你用 vue3</li>
<li>因为react推行 函数式，每次都是一个迭代，原来的已经不复存在了</li>
</ul>
<h4 id="贯穿始终"><a href="#贯穿始终" class="headerlink" title="贯穿始终"></a>贯穿始终</h4><ul>
<li>全局变量<ul>
<li>window.xxx 即可 太low</li>
</ul>
</li>
<li>useRef<ul>
<li>useRef不仅可用于 div,还能用于 任意数据</li>
<li>但是 n+1 后 ，不会触发UI更新，我就想让它更新咋办？ <strong>用vue3</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const nRef = React.useRef(0)</span><br><span class="line">  const log = () =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(`n:$&#123;nRef.current&#125;`);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;nRef.current&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;()=&gt;(nRef.current+=1)&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>变通的触发UI更新，只要你不觉得自己蛋疼</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line"> import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line"> function App() &#123;</span><br><span class="line">   const nRef = React.useRef(0)</span><br><span class="line">   // 通过 跟初始值不同，来update</span><br><span class="line">   // 但是非常的蛋疼这样写。还是用 vue3吧</span><br><span class="line">   const update = React.useState(null)[1]</span><br><span class="line">   const log = () =&gt; &#123;</span><br><span class="line">     setTimeout(() =&gt; &#123;</span><br><span class="line">       console.log(`n:$&#123;nRef.current&#125;`);</span><br><span class="line">     &#125;, 3000);</span><br><span class="line">   &#125;;</span><br><span class="line">   return (</span><br><span class="line">     &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">       &lt;h1&gt;&#123;nRef.current&#125;&lt;/h1&gt;</span><br><span class="line">       &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class="line">         nRef.current+=1;</span><br><span class="line">         update(nRef.current)</span><br><span class="line">         &#125;&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">       &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line"> ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li>vue3 的 ref 变更后会触发 UI更新，同时这个 ref贯穿始终</li>
</ul>
<h4 id="useContext来实现贯穿始终"><a href="#useContext来实现贯穿始终" class="headerlink" title="useContext来实现贯穿始终"></a>useContext来实现贯穿始终</h4><ul>
<li><p><a href="https://codesandbox.io/s/dazzling-kilby-84ehg?file=/src/index.js" target="_blank" rel="noopener">代码</a></p>
</li>
<li><p>不管你组件嵌套多少层都可以</p>
</li>
<li></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line"></span><br><span class="line">const themeContext = React.createContext(null);</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [theme, setTheme] = React.useState(&quot;red&quot;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;themeContext.Provider value=&#123;&#123; theme, setTheme &#125;&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;`App $&#123;theme&#125;`&#125;&gt;</span><br><span class="line">        &lt;p&gt;&#123;theme&#125;&lt;/p&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ChildA /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ChildB /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/themeContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ChildA() &#123;</span><br><span class="line">  const &#123; setTheme &#125; = React.useContext(themeContext);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setTheme(&quot;red&quot;)&#125;&gt;red&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ChildB() &#123;</span><br><span class="line">  const &#123; setTheme &#125; = React.useContext(themeContext);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setTheme(&quot;blue&quot;)&#125;&gt;blue&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/23/ReactWheels07-02useState原理/" data-id="cklhgn2jk00o3kyfy0k1y4qdj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-01组件的两种写法Class和函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/" class="article-date">
  <time datetime="2019-07-22T14:34:01.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/">ReactWheels07-01组件的两种写法Class和函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Class组件写法"><a href="#Class组件写法" class="headerlink" title="Class组件写法"></a>Class组件写法</h3><ul>
<li><a href="https://codesandbox.io/" target="_blank" rel="noopener">打开 codesandbox</a></li>
<li><a href="https://codesandbox.io/s/sad-dream-dodjz" target="_blank" rel="noopener">代码</a></li>
</ul>
<p>index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  n: number;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  static displayName = &quot;Hjx&quot;;</span><br><span class="line">  y: () =&gt; void;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      n: 1</span><br><span class="line">    &#125;;</span><br><span class="line">    this.y = this.x1.bind(this);</span><br><span class="line">    // 等价于 this.y = ()=&gt; this.x1.bind(this)</span><br><span class="line">  &#125;</span><br><span class="line">  x = () =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      n: this.state.n + 1</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 这种写法相当于 this.y = this.x1.bind(this);</span><br><span class="line">  &#125;;</span><br><span class="line">  x1() &#123;</span><br><span class="line">    console.log(this);</span><br><span class="line">    //1 当前实例</span><br><span class="line">    //2 undefined</span><br><span class="line">    // 答案是 2</span><br><span class="line">    // react 不帮你绑定 this</span><br><span class="line">    // 你只能 onClick=&#123;this.x1.bind(this)&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.state.n&#125;&lt;/div&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x1&#125;&gt;默认不绑定this&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x1.bind(this)&#125;&gt;bind(this)绑定this&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.y&#125;&gt;内部声明的y函数&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line"></span><br><span class="line">  x() &#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">这样写相当于 x() 挂载在 原型上， 也就是多个实例共享一个 x()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>推荐使用的方式</p>
</blockquote>
<p>这种写法有缺陷,相当于 <code>this.x = ()=&gt;{}</code> ,也就是每个实例有一个 <code>x()</code></p>
<p><strong>浪费内存</strong></p>
<p>如何解决？ <strong>无解</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = () =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        n: this.state.n + 1</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="defaultProps"><a href="#defaultProps" class="headerlink" title="defaultProps"></a>defaultProps</h4></blockquote>
<ul>
<li>为 props 设置默认值，就是当用户不传递 message的时候</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="displayName"><a href="#displayName" class="headerlink" title="displayName"></a>displayName</h4></blockquote>
<ul>
<li><a href="https://dodjz.codesandbox.io/" target="_blank" rel="noopener">https://dodjz.codesandbox.io/</a> 打开开发者工具 如果你装了 React developer tools 就能看到你的组件显示为一个 <code>&lt;Hjx&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static displayName = &quot;Hjx&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="如果我们的用户是-JS-呢？"><a href="#如果我们的用户是-JS-呢？" class="headerlink" title="如果我们的用户是 JS 呢？"></a>如果我们的用户是 JS 呢？</h4><ul>
<li>它绕过类型检查传递一个 <code>message=1</code> 数字1 如何处理</li>
<li>你需要安装依赖 <strong><code>prop-types</code></strong> 用来检查 js 传参的类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">// 引入 prop-types</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  n: number;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  static displayName = &quot;Hjx&quot;;</span><br><span class="line">  // 使用 prop-types 限制用户传递的 message 类型</span><br><span class="line">  static propTypes = &#123;</span><br><span class="line">    message: PropTypes.string</span><br><span class="line">  &#125;;</span><br><span class="line">  y: () =&gt; void;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      n: 1</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h4 id="React-也有计算属性"><a href="#React-也有计算属性" class="headerlink" title="React 也有计算属性"></a>React 也有计算属性</h4><ul>
<li><a href="https://codesandbox.io/s/busy-chebyshev-tlzdh" target="_blank" rel="noopener">代码</a></li>
</ul>
<p>index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  firstName: string;</span><br><span class="line">  lastName: string;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  // 除了可以用计算属性</span><br><span class="line">  get name() &#123;</span><br><span class="line">    return this.state.firstName + &quot; &quot; + this.state.lastName;</span><br><span class="line">  &#125;</span><br><span class="line">  // 还可以给计算属性 赋值</span><br><span class="line">  set name(newName) &#123;</span><br><span class="line">    const [firstName, lastName] = newName.split(&quot; &quot;);</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      firstName,</span><br><span class="line">      lastName</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      firstName: &quot;Frank&quot;,</span><br><span class="line">      lastName: &quot;Aaa&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.name&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h3 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h3><ul>
<li><a href>代码</a></li>
<li><h4 id="注意！！-必须-React在-16-8及以上版本才能用-state"><a href="#注意！！-必须-React在-16-8及以上版本才能用-state" class="headerlink" title="注意！！ 必须 React在 16.8及以上版本才能用 state"></a>注意！！ 必须 React在 16.8及以上版本才能用 state</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        Hello</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="使用-state"><a href="#使用-state" class="headerlink" title="使用 state"></a>使用 state</h4></blockquote>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = props =&gt; &#123;</span><br><span class="line">  const [n, setN] = useState(1);</span><br><span class="line">  const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;&#123;n&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;x&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App message=&quot;hello&quot; /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="完整的-函数组件"><a href="#完整的-函数组件" class="headerlink" title="完整的 函数组件"></a>完整的 函数组件</h4></blockquote>
<ul>
<li><a href="https://codesandbox.io/s/morning-pine-udjm2" target="_blank" rel="noopener">代码</a></li>
<li><p><code>useState</code> 来作 state.n 的初始化和设置</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// useState(1) 初始化 n = 1;</span><br><span class="line">const [n, setN] = useState(1);</span><br><span class="line">const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>useEffect</code> 来监听 state 改变 第二个参数为<code>[监听的state]</code></p>
</li>
<li><code>useEffect</code> 做 once 操作 第二个参数为<code>[]</code> mounted操作</li>
<li><code>useEffect</code> 做组件销毁的处理, return 里写处理</li>
<li><code>prop-types</code> 做js参数类型检查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  // message 可有可无 此时有个坑</span><br><span class="line">  // 你在 函数组件里 props.message.split(&apos; &apos;)</span><br><span class="line">  // 报错不通过</span><br><span class="line">  message?: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = props =&gt; &#123;</span><br><span class="line">  const [n, setN] = useState(1);</span><br><span class="line">  const [m, setM] = useState(2);</span><br><span class="line">  const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  const y = () =&gt; &#123;</span><br><span class="line">    setM(m + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  // 在每次UI更新之后执行 mounted或 updated之后</span><br><span class="line">  /*</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;UI更新之后，mounted或 updated之后&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line">  */</span><br><span class="line">  // 单独监听 n 的改变</span><br><span class="line">  /*</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;UI更新之后，n&quot;);</span><br><span class="line">  &#125;, [n]);</span><br><span class="line">  */</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;只执行一次&quot;);</span><br><span class="line">    // 组件死之前想做什么 就 return</span><br><span class="line">    return () =&gt; console.log(&quot;我死了&quot;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  // 因为 你定义的 message?:string 代表可有可无</span><br><span class="line">  // props.message.split(&quot; &quot;);</span><br><span class="line">  // 你只能用以下两种方式 强制断言</span><br><span class="line">  (props.message as string).split(&quot; &quot;);</span><br><span class="line">  props.message!.split(&quot; &quot;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;&#123;n&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;x&#125;&gt;n+1&lt;/button&gt;</span><br><span class="line">      &lt;div&gt;&#123;m&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;y&#125;&gt;m+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">App.defaultProps = &#123;</span><br><span class="line">  message: &quot;default message&quot;</span><br><span class="line">&#125;;</span><br><span class="line">App.displayName = &quot;Hjx&quot;;</span><br><span class="line">App.propTypes = &#123;</span><br><span class="line">  message: PropTypes.string</span><br><span class="line">&#125;;</span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h3 id="两种组件方式的区别"><a href="#两种组件方式的区别" class="headerlink" title="两种组件方式的区别"></a>两种组件方式的区别</h3><ul>
<li>16.8.0及以上 才可以使用 <code>useState / useEffect API</code> 也就是 hooks API </li>
<li><strong>16.8.0以前的函数组件为 无状态组件</strong></li>
<li><strong>16.8.0以后的函数组件可以代替 class组件</strong></li>
</ul>
<blockquote>
<h4 id="解决-props可有可无"><a href="#解决-props可有可无" class="headerlink" title="解决 props可有可无"></a>解决 props可有可无</h4></blockquote>
<p>使用解构赋值，但是这样代码不好理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const App: React.FunctionComponent&lt;Props&gt; = (</span><br><span class="line">    &#123;message = &apos;default message&apos;&#125;) =&gt; &#123;</span><br><span class="line">  props.message.split(&quot; &quot;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="函数组件和class组件区别"><a href="#函数组件和class组件区别" class="headerlink" title="函数组件和class组件区别"></a>函数组件和class组件区别</h3><table>
<thead>
<tr>
<th>函数</th>
<th>vs</th>
<th>类</th>
</tr>
</thead>
<tbody>
<tr>
<td>无状态(useState)</td>
<td></td>
<td>有状态(state)</td>
</tr>
<tr>
<td>可以实现函数式</td>
<td></td>
<td>很难实现函数式</td>
</tr>
<tr>
<td>setN执行之后原来的状态[n,setN]等都不要了，会得到一个新的[n,setN]</td>
<td></td>
<td>this.setState({n:1}) ，n一直在this.state.n </td>
</tr>
<tr>
<td>迭代，每次得到一个最新的状态，之前的全部不要了</td>
<td></td>
<td>在一个对象上不停的进行赋值，修改的都是同一个对象</td>
</tr>
</tbody>
</table>
<blockquote>
<h4 id="函数式的本质就是-不能进行第二次赋值"><a href="#函数式的本质就是-不能进行第二次赋值" class="headerlink" title="函数式的本质就是 不能进行第二次赋值"></a>函数式的本质就是 不能进行第二次赋值</h4></blockquote>
<ul>
<li>函数式好处就是 <code>可以使用数学知识</code></li>
<li>面向对象的好处是 <code>适合人类</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = 1</span><br><span class="line">a = 2  就不行</span><br><span class="line"></span><br><span class="line">而面向对象可以</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/" data-id="cklhgn2ji00nzkyfyyu1njvl2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-018-Collection体系原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/22/ZB-018-Collection体系原理/" class="article-date">
  <time datetime="2019-07-22T12:03:07.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/22/ZB-018-Collection体系原理/">ZB-018-Collection体系原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Collection体系简介"><a href="#Collection体系简介" class="headerlink" title="Collection体系简介"></a>Collection体系简介</h3><ul>
<li>Collection 是接口，无法实例化</li>
<li>有非常非常多的类继承它</li>
<li>它是整个<code>Collection</code>的根接口</li>
</ul>
<blockquote>
<p>最重要的两个实现（接口）</p>
</blockquote>
<ul>
<li>List </li>
<li>Set</li>
</ul>
<p>list添加元素的三种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Collection&lt;Integer&gt; c = new LinkedList&lt;Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList(c);</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list2 = new ArrayList();</span><br><span class="line">        list2.addAll(c);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list3 = new ArrayList();</span><br><span class="line">        for (Integer i: c) &#123;</span><br><span class="line">            list3.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Collection常用方法</p>
</blockquote>
<ul>
<li>new: <code>new ArrayList(Collection) 或者 new ArrayList()</code></li>
<li>R:<code>size()/isEmpty()/contains()/for()/stream()</code></li>
<li><p>C/U:<code>add()/addAll()/retainAll()</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 求交集</span><br><span class="line">List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">list.add(1);</span><br><span class="line">list.add(2);</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; list2 = new ArrayList();</span><br><span class="line">list2.add(2);</span><br><span class="line">list2.add(3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list.retainAll(list2);</span><br><span class="line">System.out.println(list); // [2]</span><br></pre></td></tr></table></figure>
</li>
<li><p>D:<code>clear()/remove()/removeAll()</code></p>
</li>
</ul>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><ul>
<li>最常用的ArrayList<br>  本质就是一个数组</li>
<li>面试题：动态扩容的实现<ul>
<li>创建一个更大的空间，然后把原先的所有元素拷贝过去</li>
</ul>
</li>
<li>add()方法</li>
</ul>
<blockquote>
<p>ArrayList扩容源代码</p>
</blockquote>
<ul>
<li>非常非常好的代码风格</li>
<li>代码清晰易懂，<strong>命名</strong>非常好(见名知意)</li>
<li>傻子都可以写出让机器识别的代码，但优秀的程序员应该写出人类轻松识别的代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        // 确保容量够</span><br><span class="line">        ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br><span class="line">        elementData[size++] = e;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensureCapacityInternal(int minCapacity) &#123;</span><br><span class="line">        // 计算容量</span><br><span class="line">        ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensureExplicitCapacity(int minCapacity) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void grow(int minCapacity) &#123;</span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        int oldCapacity = elementData.length;</span><br><span class="line">        // 右移一位就是 除2</span><br><span class="line">        int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line">        if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        // minCapacity is usually close to size, so this is a win:</span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     private static int calculateCapacity(Object[] elementData, int minCapacity) &#123;</span><br><span class="line">        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            return Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">        return minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>疑问?扩容后，之前的数组是不是变成垃圾了</p>
</blockquote>
<ul>
<li>是</li>
<li>垃圾回收帮你处理，你不用操心，你操心也操心不上。不归你管</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">        list.add(1);</span><br><span class="line">        list.add(2);</span><br><span class="line">        list.add(2);</span><br><span class="line">        list.add(3);</span><br><span class="line"></span><br><span class="line">        Set&lt;Integer&gt; set = new HashSet(list); // [1,2,3]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>equals约定：不允许有重复元素<br>  判断重复：equals</li>
<li><p>如果你有一个Set,如何实现？</p>
<ul>
<li>容易想到的办法都比较低效<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class MySet &#123;</span><br><span class="line">    List&lt;Object&gt; elements;</span><br><span class="line"></span><br><span class="line">    void add(Object object)&#123;</span><br><span class="line">        if(!elements.contains(object))&#123;</span><br><span class="line">            elements.add(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 每次添加的时候都要比较当前列表里是否存在，非常的低效</span><br><span class="line">// 假设Set有100万数据,每次都比较100万次 非常低效</span><br><span class="line">set ==&gt; [张三，李四，王五]</span><br><span class="line"></span><br><span class="line">set.add(&quot;张三&quot;); </span><br><span class="line">挨个比较非常低效</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Java世界里第二最大重要的约定：hashCode</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">改良上面的低效问题， 百家姓</span><br><span class="line">张:张三，张三丰</span><br><span class="line">李:李四</span><br><span class="line">赵:赵六</span><br><span class="line"></span><br><span class="line">这样每次添加的时候 如 添加 赵奕欢</span><br><span class="line">先找 “赵”</span><br><span class="line">这样无形中提高了效率</span><br><span class="line"></span><br><span class="line">这个“百家姓”就是 hashCode</span><br><span class="line"></span><br><span class="line">同理我们想知道我们的 Object是不是重复的 </span><br><span class="line">- 新建很多“桶”  ==&gt;哈希桶 </span><br><span class="line">- 映射成一个 int值 均匀的分配到 桶里面去</span><br><span class="line">- 此时有一个 obj 来了，想知道它存在不存在，只需要算一下它的 hashCode</span><br><span class="line">- 然后去对应的 hash桶里找就好了</span><br></pre></td></tr></table></figure>
<ul>
<li>同一个对象必须始终返回相同的hashCode</li>
<li>两个对象的 equals 返回 true,必须返回相同的 hashCode</li>
<li>两个对象不等，也可能返回相同的hashCode<ul>
<li>百家姓里 “张” 姓 张三，张三丰 都姓“张” ==&gt; hashCode相同</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h4><ul>
<li>哈希就是一个单向的映射</li>
<li>例子：从姓名到姓的哈希运算</li>
<li>从任意对象到一个整数的hashCode</li>
</ul>
<blockquote>
<p>注意！ 整数int的值是有范围的 正副21亿，而对象是无限多的可能</p>
</blockquote>
<h4 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h4><ul>
<li><p>最常用！最高效的Set实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">        Set&lt;Integer&gt; set = new HashSet();</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 1000_0000; i++) &#123;</span><br><span class="line">            set.add(i);</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long t0 = System.nanoTime();</span><br><span class="line">        set.contains(9999_9999);</span><br><span class="line"></span><br><span class="line">        long t1 = System.nanoTime();</span><br><span class="line">        list.contains(9999_9999);</span><br><span class="line"></span><br><span class="line">        long t2 = System.nanoTime();</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;set:&quot;+(t1-t0)/1000.0/1000);</span><br><span class="line">        System.out.println(&quot;list:&quot;+(t2-t1)/1000.0/1000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 执行效率</span><br><span class="line">set:0.016948</span><br><span class="line">list:29.803517</span><br></pre></td></tr></table></figure>
</li>
<li><p>HashSet 是无序的！如果有需要使用LinkedHashSet(双向链表)</p>
</li>
</ul>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><ul>
<li>C/U:<code>put/putAll</code></li>
<li>R<ul>
<li><code>get/size</code></li>
<li><code>containsKey/containsValue</code></li>
<li><code>keySet/values/entrySet</code></li>
</ul>
</li>
<li>D:<code>remove/clear</code></li>
</ul>
<blockquote>
<h4 id="Map非常容易踩到的坑"><a href="#Map非常容易踩到的坑" class="headerlink" title="Map非常容易踩到的坑"></a>Map非常容易踩到的坑</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">map.put(&quot;a&quot;:&quot;1&quot;);</span><br><span class="line">map.put(&quot;b&quot;:&quot;2&quot;);</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; keyset = map.keySet(); // [&quot;a&quot;,&quot;b&quot;]</span><br><span class="line"></span><br><span class="line">// 坑来了</span><br><span class="line">// 你修改 map 里的 key 会映射到 keyset里</span><br><span class="line">// 你修改 keyset 里的值 会映射到 map里</span><br><span class="line">map.remove(&quot;a&quot;);</span><br><span class="line">// 此时 keyset ==》[&quot;b&quot;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>entrySet</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">map.put(&quot;a&quot;:&quot;1&quot;);</span><br><span class="line">map.put(&quot;b&quot;:&quot;2&quot;);</span><br><span class="line">for(Map.Entry&lt;String,String&gt; entry:map.entrySet())&#123;</span><br><span class="line">    System.out.println(entry.getKey());</span><br><span class="line">    System.out.println(entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><blockquote>
<h4 id="HashMap-和-HashSet-区别"><a href="#HashMap-和-HashSet-区别" class="headerlink" title="HashMap 和 HashSet 区别"></a>HashMap 和 HashSet 区别</h4></blockquote>
<ul>
<li>HashMap的key的Set就是一个 HashSet</li>
</ul>
<blockquote>
<h4 id="请说一下-HashMap-扩容过程"><a href="#请说一下-HashMap-扩容过程" class="headerlink" title="请说一下 HashMap 扩容过程"></a>请说一下 HashMap 扩容过程</h4></blockquote>
<ul>
<li>跟 ArrayList 一样，创建一个更大的 HashMap</li>
<li>然后把之前的元素拷贝过来</li>
</ul>
<blockquote>
<p>问到唬住就50K唬不住就5K</p>
</blockquote>
<blockquote>
<h4 id="HashMap的线程不安全性"><a href="#HashMap的线程不安全性" class="headerlink" title="HashMap的线程不安全性"></a>HashMap的线程不安全性</h4></blockquote>
<ul>
<li>多线程用HashMap 有坑</li>
<li><a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">google hashMap 死循环 site: coolshell.cn</a></li>
<li>扩容时候(多线程)可能变成一个死循环列表</li>
<li><strong>我们多线程时要用 <code>ConcurrentHashMap</code></strong></li>
</ul>
<blockquote>
<h4 id="HashMap在-Java7-后的改变：-链表-gt-红黑树"><a href="#HashMap在-Java7-后的改变：-链表-gt-红黑树" class="headerlink" title="HashMap在 Java7+ 后的改变： 链表==&gt; 红黑树"></a>HashMap在 Java7+ 后的改变： 链表==&gt; 红黑树</h4></blockquote>
<ul>
<li>我们知道 <code>HashSet/HashMap</code> 本质实现是有很多 哈希桶 存储相同 hashCode</li>
<li>但是之前说到 <strong>桶的个数是有限的，而对象可能是无限的</strong> 此时可能发生碰撞</li>
<li>以致于 hashCode相同 因此被放到同一个 Hash桶里 ，但是 它们是不同对象所以equals 返回false</li>
<li>问题来了，假如一组数据 它们hashCode都一样。你会发现 HashSet 就退化成了一个 <strong>链表</strong> </li>
<li>假如你有100万个元素 你希望平均的分配在10万个桶里，但如遇到碰巧精心设计的一组数据 hashCode 相同，此时这个桶的性能就会急剧恶化</li>
<li>坏处就是 HashSet 的性能和 List 一样了 </li>
</ul>
<p>因此在JDK7之后，当发生 哈希碰撞的时候，这个东西就不是链表了而是 <strong>红黑树</strong></p>
<ul>
<li>红黑树 超级复杂的数据结构<ul>
<li>如被问到知道是什么东西就行了</li>
<li>原理都不用知道</li>
<li>面试官也够呛知道，如果让你手写，就说我不会，等面试结束的反问问题，我不会红黑树，你给我写一个红黑树！</li>
</ul>
</li>
</ul>
<h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><blockquote>
<h4 id="Set-1"><a href="#Set-1" class="headerlink" title="Set"></a>Set</h4></blockquote>
<ul>
<li>HashSet 完全随机</li>
<li>LinkedHashSet 保证和插入顺序一样</li>
<li>TreeSet 有序的(会进行一个排序) 自然顺序从小到大</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(100000,142,-2,-323121,321321,15);</span><br><span class="line"></span><br><span class="line">        Set set1 = new HashSet(list);</span><br><span class="line">        Set set2 = new LinkedHashSet(list);</span><br><span class="line">        Set set3 = new TreeSet(list);</span><br><span class="line"></span><br><span class="line">        set1.forEach(System.out::println); // 无序的</span><br><span class="line">        set2.forEach(System.out::println); // 按添加顺序</span><br><span class="line">        set3.forEach(System.out::println); // 排好序的</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="TreeSet-ArrayList查找时间复杂度"><a href="#TreeSet-ArrayList查找时间复杂度" class="headerlink" title="TreeSet / ArrayList查找时间复杂度"></a>TreeSet / ArrayList查找时间复杂度</h4></blockquote>
<ul>
<li>ArrayList O(n)</li>
<li>TreeSet O(log n)</li>
</ul>
<p>把算法的复杂度从 线性时间下降到对数时间</p>
<blockquote>
<h4 id="TreeSet-TreeMap"><a href="#TreeSet-TreeMap" class="headerlink" title="TreeSet/TreeMap"></a>TreeSet/TreeMap</h4></blockquote>
<ul>
<li>二叉树/红黑树</li>
<li>使用Comparable约定，认定排序相等的元素相等</li>
<li>二叉树查找/插入</li>
</ul>
<blockquote>
<h4 id="Collections-工具方法集合"><a href="#Collections-工具方法集合" class="headerlink" title="Collections 工具方法集合"></a>Collections 工具方法集合</h4></blockquote>
<ul>
<li>emptySet() 返回一个空的集合</li>
<li>synchronizedCollection: 将一个集合变成线程安全的</li>
<li>unmodifiableCollection: 将一个集合变成不可变的  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(100000,142,-2,-323121,321321,15);</span><br><span class="line">Set set1 = new HashSet(list);</span><br><span class="line">Set unmodifiableSet = Collections.unmodifiableSet(set1);</span><br><span class="line"></span><br><span class="line">unmodifiableSet.add(1); //报错</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="Collection-其他实现"><a href="#Collection-其他实现" class="headerlink" title="Collection 其他实现"></a>Collection 其他实现</h4></blockquote>
<ul>
<li>Queue 队列/Deque 双端队列<ul>
<li>任何你想用 Stack的时候都可以使用 Deque</li>
</ul>
</li>
<li>Vector/Stack</li>
<li>LinkedList 链表</li>
<li>ConcurrentHashMap</li>
<li>PriorityQueue 优先级队列 比如你的 闹钟列表 离你最近的那个会响</li>
</ul>
<blockquote>
<h4 id="Guava-番石榴"><a href="#Guava-番石榴" class="headerlink" title="Guava 番石榴"></a>Guava 番石榴</h4></blockquote>
<p>补充java中 不完整的Collection实现</p>
<ul>
<li>Lists/Sets/Maps</li>
<li>ImmutableMap/ImmutableSet 不可变的Map/Set</li>
<li><p>MultiSet/MultiMap </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set =&gt; 1,2,3,4</span><br><span class="line"></span><br><span class="line">#除了告诉你唯一的元素有那些，还可以告诉你 3 被加了几次</span><br><span class="line">MultiSet =&gt; 1,2,3x3,4 </span><br><span class="line"></span><br><span class="line">Map  key:value</span><br><span class="line"></span><br><span class="line">MultiMap </span><br><span class="line">key:对应多个value</span><br></pre></td></tr></table></figure>
</li>
<li><p>BiMap 双向Map</p>
<ul>
<li>普通的Map是 value对key的映射</li>
<li>BiMap 是双向映射</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/22/ZB-018-Collection体系原理/" data-id="cklhgn2l900s3kyfyt24qko4d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-017-java包管理和maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/ZB-017-java包管理和maven/" class="article-date">
  <time datetime="2019-07-16T12:47:35.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/ZB-017-java包管理和maven/">ZB-017-java包管理和maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="什么是包"><a href="#什么是包" class="headerlink" title="什么是包"></a>什么是包</h3><ul>
<li>JVM的⼯作被设计地相当简单：<ol>
<li>执⾏⼀个类的字节码</li>
<li>假如这个过程中碰到了新的类，加载它，然后回到第一步，这样循环往复</li>
</ol>
</li>
</ul>
<blockquote>
<p>那么，去哪⾥加载这些类呢？</p>
</blockquote>
<ul>
<li>答案是 classpath<strong>类路径</strong></li>
</ul>
<h3 id="类路径（Classpath）"><a href="#类路径（Classpath）" class="headerlink" title="类路径（Classpath）"></a>类路径（Classpath）</h3><ul>
<li>在哪⾥可以找到类<ul>
<li>-classpath/-cp</li>
</ul>
</li>
<li>类的全限定类名（⽬录层级）唯⼀确定了⼀个类</li>
<li>包就是把许多类放在⼀起打的压缩包 <strong>jar 包</strong></li>
</ul>
<p>每次 IDEA 运行java项目显示的命令行</p>
<p><strong>程序运行时：会挨个在 classpath路径里找。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/bin/java &quot;-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=51272:</span><br><span class="line">/Applications/IntelliJ IDEA.app/Contents/bin&quot; </span><br><span class="line">-Dfile.encoding=UTF-8 </span><br><span class="line">-classpath </span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/charsets.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/deploy.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/cldrdata.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/dnsns.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jaccess.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jfxrt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/localedata.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/nashorn.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunec.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/zipfs.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/javaws.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jce.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfr.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfxswt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jsse.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/management-agent.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/plugin.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/resources.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/rt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/dt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/javafx-mx.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/jconsole.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/packager.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/sa-jdi.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/tools.jar:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 当前目录的 target/classes 就是本项目里的 类文件</span><br><span class="line"></span><br><span class="line">/Users/huangjiaxi/Desktop/java-fork-process/target/classes </span><br><span class="line"></span><br><span class="line">com.github.hcsp.shell.Fork</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="什么是-jar-文件"><a href="#什么是-jar-文件" class="headerlink" title="什么是 jar 文件"></a>什么是 jar 文件</h4></blockquote>
<ul>
<li>实际就是 跟<code>zip</code>一样压缩后的文件，只不过这里叫 <code>jar包</code></li>
</ul>
<h5 id="每当-JVM-需要一个类时，它就会在当前的-classpath里-按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出-classNotFound"><a href="#每当-JVM-需要一个类时，它就会在当前的-classpath里-按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出-classNotFound" class="headerlink" title="每当 JVM 需要一个类时，它就会在当前的 classpath里 按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出 classNotFound"></a>每当 JVM 需要一个类时，它就会在当前的 classpath里 按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出 classNotFound</h5><blockquote>
<p>如果你依赖的类中还依赖了别的包呢？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A 依赖 B , B 依赖 C , C 又依赖 D</span><br><span class="line">D 从那里找呢？</span><br></pre></td></tr></table></figure>
<p>这就是 <strong>传递性依赖</strong> ,这就是为什么上面的命令行里 classpach 那么长的原因，要把所有依赖的path 添加进来</p>
<p>一个简单的项目命令行尚且如此之长，而一个真实项目可能有成百上千的依赖，如果你手动拼接，肯定又各种各样的问题，这就是为什么使用自动化工具的原因。</p>
<p>自动化的本质就是：帮我们把一些很啰嗦很累赘变成自动化</p>
<h3 id="别急，还没完"><a href="#别急，还没完" class="headerlink" title="别急，还没完"></a>别急，还没完</h3><blockquote>
<p>没有maven时，你要手动导入jar包还有相关依赖，多人协作的时候非常麻烦。</p>
</blockquote>
<ul>
<li>传递性依赖<ul>
<li>你依赖的类还依赖了别的类</li>
</ul>
</li>
<li>Classpath hell<ul>
<li>全限定类名是类的唯⼀标识</li>
<li>当多个同名类同时出现在Classpath中，就是噩梦的开始</li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="当你的-classpath里包含了相同包，但是版本不同会发生什么"><a href="#当你的-classpath里包含了相同包，但是版本不同会发生什么" class="headerlink" title="当你的 classpath里包含了相同包，但是版本不同会发生什么"></a>当你的 classpath里包含了相同包，但是版本不同会发生什么</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-classpath </span><br><span class="line">xxx.5.0.0.jar:</span><br><span class="line">xxx.4.0.0.jar</span><br></pre></td></tr></table></figure>
<ul>
<li>此时两个jar包里 有同名类 a</li>
<li>在你程序运行时 会引用那个 类？</li>
</ul>
<p>答案是 <strong>谁在前面用谁</strong></p>
<blockquote>
<h4 id="问题升级，引入版本不同，但是同名的jar包"><a href="#问题升级，引入版本不同，但是同名的jar包" class="headerlink" title="问题升级，引入版本不同，但是同名的jar包"></a>问题升级，引入版本不同，但是同名的jar包</h4></blockquote>
<ul>
<li>版本不同的时候，代码可能是不一样的，以致于你的程序看上去可以运行。突然三天或三年后的某一天突然运行到一个地方出错了。你就很懵  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-classpath </span><br><span class="line">xxx.4.0.0.jar: </span><br><span class="line">xxx.5.0.0.jar</span><br><span class="line"></span><br><span class="line"># 4.0.0 是你实际使用的jar包</span><br><span class="line"># 5.0.0 是更新后的一个大版本修复了4.0.0的某些bug, 可能一些方法 API 已经变的面目全非了。</span><br><span class="line">但是在你看在程序还是正常的跑，只是没运行到出bug的地方</span><br><span class="line">你的项目如期上线，然后某天爆出个bug</span><br><span class="line">这个情况就叫 Classpath hell 依赖地狱</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="什么是包管理"><a href="#什么是包管理" class="headerlink" title="什么是包管理"></a>什么是包管理</h3><ul>
<li>你要使⽤⼀些第三⽅类，总要告诉JVM从哪⾥找吧？</li>
<li>包管理的本质就是告诉JVM如何找到所需的第三⽅类库</li>
<li>以及成功地解决其中的冲突问题</li>
</ul>
<h3 id="没有Maven的蛮荒年代"><a href="#没有Maven的蛮荒年代" class="headerlink" title="没有Maven的蛮荒年代"></a>没有Maven的蛮荒年代</h3><blockquote>
<p>以前怎么做的这些依赖</p>
</blockquote>
<h4 id="黑暗时代"><a href="#黑暗时代" class="headerlink" title="黑暗时代"></a>黑暗时代</h4><ul>
<li>⼿动写命令进⾏编译运⾏</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javac -cp  xx.jar xx2.jar Main.java</span><br><span class="line">java -cp xx.jar xx2.jar Main</span><br><span class="line"></span><br><span class="line"># 假设此时 jar包成百上千呢？</span><br></pre></td></tr></table></figure>
<h4 id="启蒙时代"><a href="#启蒙时代" class="headerlink" title="启蒙时代"></a>启蒙时代</h4><ul>
<li>Apache Ant<ul>
<li>⼿动下载jar包，放在⼀个⽬录中</li>
<li>写XML配置，指定编译的源代码⽬录、依赖的jar包、输出<br>⽬录等</li>
</ul>
</li>
<li>缺点<ul>
<li>每个⼈都要⾃⼰造⼀套轮⼦<ol>
<li>我的放在 libs</li>
<li>你的放在 sources</li>
<li>他的放在 libaray </li>
</ol>
</li>
<li>依赖的第三⽅类库都需要⼿动下载，费时费⼒<ul>
<li>假如你的应⽤依赖了⼀万个第三⽅的类库呢？都需要把依赖的库挨个下载下来</li>
</ul>
</li>
<li>没有解决Classpath地狱的问题，碰上重复的库你就完蛋了</li>
</ul>
</li>
</ul>
<h4 id="Maven——划时代的包管理"><a href="#Maven——划时代的包管理" class="headerlink" title="Maven——划时代的包管理"></a>Maven——划时代的包管理</h4><ul>
<li>Convention over configuration</li>
<li>约定优于配置</li>
<li>必须强调，Maven远远不⽌是包管理⼯具</li>
<li>Maven的中央仓库<ul>
<li>按照⼀定的约定存储包（坐标）</li>
</ul>
</li>
<li>Maven的本地仓库<ul>
<li>默认位于~/.m2</li>
<li>下载的第三⽅包放在这⾥进⾏缓存</li>
</ul>
</li>
<li>Maven的包<ul>
<li>按照约定为所有的包编号，⽅便检索</li>
<li>groupId/artifactId/version<ul>
<li>扩展：语义化版本</li>
</ul>
</li>
<li>SNAPSHOT快照版本</li>
</ul>
</li>
</ul>
<blockquote>
<p>当你不知道一个包的坐标你就搜 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxx.xxx.xxx maven 通常第一个就是包的正确的名字</span><br><span class="line"></span><br><span class="line">每个包有自己的版本</span><br><span class="line">如 junit-jupiter-api 5.5.0</span><br><span class="line">它会不停的升级。版本一旦发布，maven的约定是不能更改只能继续升级。 </span><br><span class="line">目的是 maven 想要实现一个可重现的构建，就是你机子上跑的和我机子上跑的 是一样的。 </span><br><span class="line"></span><br><span class="line">因为一旦同版本允许修改，就可能你跑的时候是好的，我跑的时候是坏的</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="maven-为什么知道包从哪里下载呢？"><a href="#maven-为什么知道包从哪里下载呢？" class="headerlink" title="maven 为什么知道包从哪里下载呢？"></a>maven 为什么知道包从哪里下载呢？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">当你引入依赖</span><br><span class="line"></span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">maven 就会去它的主仓库 https://repo1.maven.org/maven2/</span><br><span class="line">按照你的 groupId 里的路径 </span><br><span class="line">https://repo1.maven.org/maven2/org</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter</span><br><span class="line"></span><br><span class="line">然后按照 artifactId 找路径</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/</span><br><span class="line"></span><br><span class="line">然后按照版本号 5.4.2</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/5.4.2/</span><br></pre></td></tr></table></figure>
<p>里面有一堆文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar            2019-04-07 17:29    683506      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc        2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc.md...  2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc.sh...  2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.md5        2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.sha1       2019-04-07 17:29        40    </span><br><span class="line"># 源代码  </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar            2019-04-07 17:29    110900      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc        2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc.md...  2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc.sh...  2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.md5        2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.sha1       2019-04-07 17:29        40      </span><br><span class="line"># 真正的 jar包</span><br><span class="line">junit-jupiter-engine-5.4.2.jar                    2019-04-07 17:29    177798      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc                2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc.md5            2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc.sha1           2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.md5                2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.sha1               2019-04-07 17:29        40    </span><br><span class="line"># 当前包所依赖的包  </span><br><span class="line">junit-jupiter-engine-5.4.2.pom                    2019-04-07 17:29      2395      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc                2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc.md5            2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc.sha1           2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.md5                2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.sha1               2019-04-07 17:29        40</span><br></pre></td></tr></table></figure>
<p>这样就实现了。你pom引入了一个junit-jupiter-engine-5.4.2的依赖，然后它下载后根据junit-jupiter-engine-5.4.2.pom文件去下载 当前包的依赖(传递性依赖)</p>
<p><strong>这样就形成了一颗依赖树</strong>，你可以在 IDEA maven工具栏的<code>Dependencies</code> 里看到</p>
<p><code>pom.xml</code>里的aliyun镜像,就是为了下载更快。也可以配置到你本地安装的maven里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line">&lt;/repositories&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="Maven的包"><a href="#Maven的包" class="headerlink" title="Maven的包"></a>Maven的包</h4></blockquote>
<ul>
<li>按照约定为所有的包编号，⽅便检索</li>
<li>groupId/artifactId/version<ul>
<li>扩展：<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">语义化版本 x.y.z</a></li>
</ul>
</li>
<li>SNAPSHOT快照版本  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/</span><br><span class="line"></span><br><span class="line">里 你开发的包可能不会立马上线，需要一直测一直改一直发布。但是总不能每次都发布一个版本吧！ </span><br><span class="line">5.0.0/                                            2017-09-10 18:09         -      </span><br><span class="line">5.0.0-M1/                                         2016-07-07 09:05         -      </span><br><span class="line">5.0.0-M2/                                         2016-07-23 18:14         -      </span><br><span class="line">5.0.0-M3/                                         2016-11-30 09:06         -      </span><br><span class="line">5.0.0-M4/                                         2017-04-01 19:23         -      </span><br><span class="line">5.0.0-M5/                                         2017-07-04 16:39         -      </span><br><span class="line">5.0.0-M6/                                         2017-07-18 19:27         -      </span><br><span class="line"># RC叫做 发布准备版 但是它们都不是 SNAPSHOT快照版本，也基本不会在中央仓库里放置</span><br><span class="line"># 中央仓库都是放成熟的。</span><br><span class="line">5.0.0-RC1/                                        2017-07-30 19:13         -      </span><br><span class="line">5.0.0-RC2/                                        2017-07-30 20:37         -</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>maven 默认会帮你下载字节码的包，如需看源码 可以在 IDEA 点击下载 </p>
<h4 id="包冲突"><a href="#包冲突" class="headerlink" title="包冲突"></a>包冲突</h4><blockquote>
<p>当你看到如下的异常的时候，<strong>包冲突发生了</strong></p>
<ul>
<li>AbstractMethodError</li>
<li>NoClassDefFoundError</li>
<li>ClassNotFoundException</li>
<li>LinkageError</li>
</ul>
</blockquote>
<blockquote>
<p>举个例子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">你的项目里</span><br><span class="line">依赖了 A</span><br><span class="line">依赖了 D</span><br><span class="line"></span><br><span class="line">A 又依赖了 B , B又依赖了 C</span><br><span class="line">D 又依赖了 C</span><br><span class="line"></span><br><span class="line">|A</span><br><span class="line">--|B</span><br><span class="line">--|--|C 1.0</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|C 2.0</span><br><span class="line"></span><br><span class="line">此时 两个 C 就导致了 包冲突</span><br><span class="line"></span><br><span class="line">-classpath A:B:C1.0:D:C2.0</span><br><span class="line"></span><br><span class="line"># 因为之前说了 classpath hell 依赖地狱</span><br><span class="line">由于全限定类名是类的唯一标识，此时如果存在两个同名不同版本的库 同时出现在 classpath 中 那么噩梦开始了</span><br><span class="line"></span><br><span class="line">如果有同名的库出现在 classpath 中 JVM 会选择靠前的那个 也就是 C1.0</span><br><span class="line"></span><br><span class="line">但是 靠前的那个 C1.0 不一定是你想要的那个，有可能只是你忘了。</span><br></pre></td></tr></table></figure>
<p><strong>对此</strong> maven 的原则是</p>
<ul>
<li>传递性依赖的⾃动管理<ul>
<li>原则：绝对不允许最终的classpath出现同名不同版本的jar包</li>
</ul>
</li>
<li><p>依赖冲突的解决：原则：<strong>最近的胜出</strong> </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">你的项目里</span><br><span class="line">依赖了 A</span><br><span class="line">依赖了 D</span><br><span class="line"></span><br><span class="line">A 又依赖了 B , B又依赖了 C</span><br><span class="line">D 又依赖了 C</span><br><span class="line"></span><br><span class="line">|A</span><br><span class="line">--|B</span><br><span class="line">--|--|C 1.0</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|C 2.0</span><br><span class="line"></span><br><span class="line">C2.0 更加离 依赖树的根更近</span><br><span class="line">也就是 C2.0 获胜，淘汰 C1.0</span><br><span class="line">-classpath A:B:D:C2.0</span><br></pre></td></tr></table></figure>
<ul>
<li>这个过程绝大多数是可以正常工作的，但是</li>
<li><code>mvn dependency:tree</code>  </li>
</ul>
</li>
<li>依赖的scope</li>
</ul>
<blockquote>
<h4 id="实战：解决包冲突"><a href="#实战：解决包冲突" class="headerlink" title="实战：解决包冲突"></a>实战：解决包冲突</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">你的项目依赖了 A / D</span><br><span class="line"></span><br><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line"></span><br><span class="line">此时 maven 帮你淘汰了 C0.2 版本 因为它离得太远</span><br><span class="line">-classpath A0.1:D0.1:B0.1:C0.1</span><br><span class="line"></span><br><span class="line">此时就有 bug ,因为你想要的是 C0.2</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="为什么会干掉-C0-2-而不是C0-1"><a href="#为什么会干掉-C0-2-而不是C0-1" class="headerlink" title="为什么会干掉 C0.2,而不是C0.1"></a>为什么会干掉 C0.2,而不是C0.1</h4></blockquote>
<ul>
<li>答案是 <strong>maven就是这样设计的，它不分析语义版本，对于人类我们知道 0.2&gt;0.1,但是maven在设计上的原则是谁离得更近，Gradle的策略是选择版本高的，但这也不是万能的。</strong></li>
<li>很多时候还是要人工介入</li>
</ul>
<blockquote>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4></blockquote>
<ol>
<li><p>强行引入 C0.2版本</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line"></span><br><span class="line">|C0.2</span><br><span class="line"></span><br><span class="line">C0.2 离得比 C0.1近。所以淘汰 C0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>exclusion 排除指定依赖</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line">通过 exclusion 来告诉 maven 忽略某个依赖 的子依赖</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;xxx.xxx&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;D&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.1&lt;/version&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;groupId&gt;yyy.yyyy&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;C&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.1&lt;/version&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一个IDEA 插件 <code>maven helper</code></p>
<ul>
<li>能帮你分析当前的依赖树 和被淘汰的依赖标红显示</li>
<li>你想排除指定版本只需要选中依赖 点击 <code>Exclude</code></li>
<li>一目了然帮你看到依赖树</li>
</ul>
</li>
</ol>
<blockquote>
<h4 id="如下依赖谁会被淘汰"><a href="#如下依赖谁会被淘汰" class="headerlink" title="如下依赖谁会被淘汰"></a>如下依赖谁会被淘汰</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|A </span><br><span class="line">--|B </span><br><span class="line">--|--|C0.1</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|E </span><br><span class="line">----|C0.2</span><br><span class="line"></span><br><span class="line">C0.1 获胜，因为C0.1 路径相同则选择靠前的那个</span><br></pre></td></tr></table></figure>
<h4 id="依赖的-scope"><a href="#依赖的-scope" class="headerlink" title="依赖的 scope"></a>依赖的 scope</h4><blockquote>
<p>实现代码的隔离</p>
</blockquote>
<ul>
<li><code>&lt;scope&gt;test&lt;/scope&gt;</code> 代表只在 src/test目录可见</li>
<li><code>&lt;scope&gt;compile&lt;/scope&gt;</code> 在 src/main 和 src/test 都有效</li>
<li><code>&lt;scope&gt;provided&lt;/scope&gt;</code> 只在编译的时候有效<ol>
<li>我们运行java的时候 右键 run 会先编译，此时会把依赖包在 -classpath 里体现</li>
<li>而在运行的时候 -classpath 不包含依赖包的路径</li>
<li>它的意思就是 编译的时候需要，运行的时候别人帮我提供，你不需要帮我加,防止包冲突。 最经典的就是 tomcat ，你的项目编译后会放在 tomcat容器里，tomcat 会帮你提供这些依赖包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="maven-不仅仅是包管理工具还是一个自动化构建工具"><a href="#maven-不仅仅是包管理工具还是一个自动化构建工具" class="headerlink" title="maven 不仅仅是包管理工具还是一个自动化构建工具"></a>maven 不仅仅是包管理工具还是一个自动化构建工具</h3><blockquote>
<p>推荐一本书 Maven实战 google搜 <a href="https://github.com/skyformat99/books-1/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E2%97%8F%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E2%97%8F%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/Maven%E5%AE%9E%E6%88%98.pdf" target="_blank" rel="noopener">Maven实战 site:github.com</a></p>
</blockquote>
<ul>
<li>Maven实战哪些章节是值得看的？<ul>
<li>1 简介可以看看</li>
<li>3.1-3.4 代码是过时的</li>
<li>4 可以看 背景案例也是过时的 看场景</li>
<li>5  </li>
<li>6</li>
<li>7 </li>
<li>8</li>
<li>其他选看</li>
</ul>
</li>
<li>Maven项⽬的基本结构（传世经典）</li>
<li>基本概念：坐标和依赖/⽣命周期/仓库/聚合和继承</li>
<li>使⽤Maven进⾏测试</li>
<li>如果需要开发插件的话：</li>
<li>Maven的插件</li>
</ul>
<h3 id="真实世界中的Maven"><a href="#真实世界中的Maven" class="headerlink" title="真实世界中的Maven"></a>真实世界中的Maven</h3><ul>
<li>分析若⼲真实世界的Maven仓库</li>
<li>pom的含义 <strong>project object model</strong> 项目说明书</li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ol>
<li><a href="https://github.com/hcsp/fix-commons-lang-pom" target="_blank" rel="noopener">修复commons-lang项目的pom文件</a><br> <a href="https://github.com/hcsp/fix-commons-lang-pom/pull/6" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/resolve-package-conflict" target="_blank" rel="noopener">解决包冲突</a><br> <a href="https://github.com/hcsp/resolve-package-conflict/pull/4" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/implement-sem-version" target="_blank" rel="noopener">实现语义化版本</a><br> <a href="https://github.com/hcsp/implement-sem-version/pull/1" target="_blank" rel="noopener">我的pr</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/16/ZB-017-java包管理和maven/" data-id="cklhgn2l800s1kyfy0xzbrlwf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/14/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/16/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 13.75px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 14.17px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.25px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.33px;">M01</a> <a href="/tags/M02/" style="font-size: 15px;">M02</a> <a href="/tags/M03/" style="font-size: 15.83px;">M03</a> <a href="/tags/M04/" style="font-size: 16.25px;">M04</a> <a href="/tags/M06/" style="font-size: 18.33px;">M06</a> <a href="/tags/M07/" style="font-size: 17.92px;">M07</a> <a href="/tags/M08/" style="font-size: 17.08px;">M08</a> <a href="/tags/M09/" style="font-size: 11.67px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 15.42px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.75px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.67px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.58px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.42px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.92px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.08px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.17px;">java</a> <a href="/tags/linux/" style="font-size: 10.83px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.25px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.5px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/node/" style="font-size: 10.42px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.5px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 12.92px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.58px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/22/Node-web05-09-02博客系统部署最新版流程/">Node-web05-09-02博客系统部署最新版流程</a>
          </li>
        
          <li>
            <a href="/2021/02/22/Node-web05-07-03服务器端构建/">Node-web05-07-03服务器端构建</a>
          </li>
        
          <li>
            <a href="/2021/02/22/Node-web05-07-02服务器相关配置及使用/">Node-web05-07-02服务器相关配置及使用</a>
          </li>
        
          <li>
            <a href="/2021/02/20/Node-web05-09-01博客统部署2/">Node-web05-09-01博客统部署优化解释</a>
          </li>
        
          <li>
            <a href="/2021/02/20/Node-web05-08博客统页面完善/">Node-web05-08博客统页面完善</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>