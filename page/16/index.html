<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/16/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-ReactWheels07-03Hooks全解2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/24/ReactWheels07-03Hooks全解2/" class="article-date">
  <time datetime="2019-07-24T15:34:01.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/24/ReactWheels07-03Hooks全解2/">ReactWheels07-03Hooks全解2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h3 id="用useReducer代替redux"><a href="#用useReducer代替redux" class="headerlink" title="用useReducer代替redux"></a>用useReducer代替redux</h3><p><strong>一共七步</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useContext, useReducer, useEffect &#125; from &quot;react&quot;;</span><br><span class="line">// step01 将数据集中在store里</span><br><span class="line">const store = &#123;</span><br><span class="line">  user: null,</span><br><span class="line">  books: null,</span><br><span class="line">  movies: null</span><br><span class="line">&#125;</span><br><span class="line">// step02 将所有操作集中在 reducer里</span><br><span class="line">const reducer = (state, action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &apos;setUser&apos;:</span><br><span class="line">      return &#123; ...state, user: action.user &#125;</span><br><span class="line">    case &apos;setBooks&apos;:</span><br><span class="line">      return &#123; ...state, books: action.books &#125;</span><br><span class="line">    case &apos;setMovies&apos;:</span><br><span class="line">      return &#123; ...state, movies: action.movies &#125;</span><br><span class="line">    default:</span><br><span class="line">      throw new Error(&apos;no match action&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// step03 创建 Context</span><br><span class="line">const Context = React.createContext(null)</span><br><span class="line"></span><br><span class="line">function ReducerDemo1() &#123;</span><br><span class="line">  // step04 创建对数据的 读/写 API</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, store)</span><br><span class="line">  return (</span><br><span class="line">    // step05 将 step04的 读写api放到 Context提供的组件上</span><br><span class="line">    // step06 Context.Provider  将 Context 提供给所有组件</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; state, dispatch &#125;&#125;&gt;</span><br><span class="line">      &lt;User /&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &lt;Books /&gt;</span><br><span class="line">      &lt;Movies /&gt;</span><br><span class="line">    &lt;/Context.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// step07 各个组件用 useContext 获取读写API</span><br><span class="line">function User() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/user&quot;).then(user =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setUser&quot;, user: user &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;个人信息&lt;/h1&gt;</span><br><span class="line">      &lt;div&gt;name: &#123;state.user ? state.user.name : &quot;&quot;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Books() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/books&quot;).then(books =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setBooks&quot;, books: books &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;我的书籍&lt;/h1&gt;</span><br><span class="line">      &lt;ol&gt;</span><br><span class="line">        &#123;state.books ? state.books.map(book =&gt; &lt;li key=&#123;book.id&#125;&gt;&#123;book.name&#125;&lt;/li&gt;) : &quot;加载中&quot;&#125;</span><br><span class="line">      &lt;/ol&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Movies() &#123;</span><br><span class="line">  const &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ajax(&quot;/movies&quot;).then(movies =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &quot;setMovies&quot;, movies: movies &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;我的电影&lt;/h1&gt;</span><br><span class="line">      &lt;ol&gt;</span><br><span class="line">        &#123;state.movies</span><br><span class="line">          ? state.movies.map(movie =&gt; &lt;li key=&#123;movie.id&#125;&gt;&#123;movie.name&#125;&lt;/li&gt;)</span><br><span class="line">          : &quot;加载中&quot;&#125;</span><br><span class="line">      &lt;/ol&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default ReducerDemo1;</span><br><span class="line"></span><br><span class="line">// 帮助函数</span><br><span class="line"></span><br><span class="line">// 假 ajax</span><br><span class="line">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败</span><br><span class="line">function ajax(path) &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      if (path === &quot;/user&quot;) &#123;</span><br><span class="line">        resolve(&#123;</span><br><span class="line">          id: 1,</span><br><span class="line">          name: &quot;hjx&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; else if (path === &quot;/books&quot;) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            name: &quot;JavaScript 高级程序设计&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: 2,</span><br><span class="line">            name: &quot;JavaScript 精粹&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]);</span><br><span class="line">      &#125; else if (path === &quot;/movies&quot;) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            name: &quot;爱在黎明破晓前&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: 2,</span><br><span class="line">            name: &quot;恋恋笔记本&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h3><ul>
<li>上下文<ul>
<li>全局变量是全局的上下文</li>
<li>上下文是局部的全局变量</li>
</ul>
</li>
<li>使用方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">step1 const C = createContext(null);</span><br><span class="line">step2 &lt;C.Provider value=&#123;&#123; n, setN &#125;&#125;&gt; 圈定作用域</span><br><span class="line">step3 在作用域内(任意级子组件内)使用 useContext(c) 来使用上下文</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>不是响应式的<ul>
<li>你在一个组件内将 C变化 setN</li>
<li>另一个模块不会感知这个变化</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; createContext, useState, useContext &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const C = createContext(null);</span><br><span class="line"></span><br><span class="line">function UseContextDemo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  return (</span><br><span class="line">    &lt;C.Provider value=&#123;&#123; n, setN &#125;&#125;&gt;</span><br><span class="line">      &lt;div className=&quot;UseContextDemo1&quot;&gt;</span><br><span class="line">        &lt;Baba /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/C.Provider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Baba() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      我是爸爸</span><br><span class="line">      &lt;Child /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child() &#123;</span><br><span class="line">  const &#123; n, setN &#125; = useContext(C);</span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      我是儿子，我得到n:&#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">export default UseContextDemo1</span><br></pre></td></tr></table></figure>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><ul>
<li><p>副作用</p>
<ul>
<li>对环境的改变即为副作用，如 <code>document.title = &#39;xxx&#39;</code></li>
<li>不一定把 这个副作用 放在 useEffect里</li>
<li>每次 render后执行</li>
</ul>
</li>
<li><p>用途</p>
<ul>
<li>作为 componentDidMount 使用 <code>[]</code> 作为第二个参数</li>
<li>作为 componentDidUpdate 使用 <code>[n]</code> 数组内可以指定依赖,n变了才会触发</li>
<li>作为 componentWillUnmount 使用 ，通过return 代表销毁的时候</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li>存在多个 useEffect,会按照出现次序执行</li>
</ul>
</li>
</ul>
<h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useEffect, useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function UseEffectDemo1() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;Demo1 /&gt;</span><br><span class="line">      &lt;Demo2 /&gt;</span><br><span class="line">      &lt;Demo3 /&gt;</span><br><span class="line">      &lt;Demo4 /&gt;</span><br><span class="line">      &lt;Demo5 /&gt;</span><br><span class="line">      &lt;Demo6 /&gt;</span><br><span class="line">      &lt;Demo7 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // 任何一个变了变量变了都执行</span><br><span class="line">    // 第一次 和 第二三四 。。。 次</span><br><span class="line">    console.log(&apos;demo1:第一次 和 第二三四 。。。 次,任何一个变量变了都执行&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect不传递第二个参数， 第一二三。。。次执行,任何一个变量变了都执行&lt;/h1&gt;</span><br><span class="line">      n:&#123;n&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo2() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // n更新之后</span><br><span class="line">    console.log(&apos;demo2:n更新之后&apos;)</span><br><span class="line">  &#125;, [n])</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setN(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect传递第二个参数[n]， 第一次执行,以及n变了执行&lt;/h1&gt;</span><br><span class="line">      n:&#123;n&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo3() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const [y, setY] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // x更新之后,</span><br><span class="line">    console.log(&apos;demo3:第一次执行，以及x更新之后才变，y改变不会触发effect&apos;)</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  const onClickY = () =&gt; &#123;</span><br><span class="line">    setY(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect传递第二个参数[x]，第一次执行，以及x更新之后才变，y改变不会触发effect&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      y:&#123;y&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickY&#125;&gt;y+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo4() &#123;</span><br><span class="line">  const initValue = 0;</span><br><span class="line">  const [z, setZ] = useState(initValue)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // 跳过第一次</span><br><span class="line">    if (z !== initValue) &#123;</span><br><span class="line">      // 跳过第一次</span><br><span class="line">      console.log(&apos;demo4:通过if(z!== initValue)判断，跳过第一次，z修改后执行&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [z])</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setZ(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      z:&#123;z&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;z+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo5() &#123;</span><br><span class="line">  const [z, setZ] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo5:useEffect 第二个参数为空数组[],只执行一次&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    setZ(i =&gt; i + 1)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo5&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo5:useEffect 第二个参数为空数组[],只执行一次&lt;/h1&gt;</span><br><span class="line">      z:&#123;z&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;z+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo6() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;demo6:useEffect 移除时执行 return里写一个函数&apos;)</span><br><span class="line">    &#125;, 3000)</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.clearInterval(id);</span><br><span class="line">      console.log(&apos;demo6:组件销毁的时候执行&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo6&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo6:useEffect 移除时执行操作 return一个函数进行操作&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Demo7() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo7:1&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;demo7:2&apos;)</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo7&quot;&gt;</span><br><span class="line">      &lt;h1&gt;demo7:多个useEffect 按顺序执行&lt;/h1&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default UseEffectDemo1</span><br></pre></td></tr></table></figure>
<h3 id="useLayoutEffext"><a href="#useLayoutEffext" class="headerlink" title="useLayoutEffext"></a>useLayoutEffext</h3><h4 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h4><p>执行流程</p>
<ul>
<li>App执行</li>
<li>vDom</li>
<li>生成真实Dom</li>
<li>render完毕，改变外观 <code>&lt;div&gt;0&lt;/div&gt;</code></li>
<li>effect 执行=》<code>div.innerText = 1000</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Demo1() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.querySelector(&apos;#x&apos;).innerText = `n:1000`</span><br><span class="line">  &#125;, [n])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo1&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect&lt;/h1&gt;</span><br><span class="line">      &lt;div id=&quot;x&quot;&gt;n:&#123;n&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<h4 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h4><p>执行流程</p>
<ul>
<li>App执行</li>
<li>vDom</li>
<li>生成真实Dom<ul>
<li><code>&lt;div&gt;0&lt;/div&gt;</code></li>
<li>useLayoutEffect 执行=》<code>div.innerText = 1000</code></li>
<li>作为浏览器不会看见 n = 0 的过程</li>
</ul>
</li>
<li>render完毕，改变外观 <code>&lt;div&gt;1000&lt;/div&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Demo2() &#123;</span><br><span class="line">  const [n, setN] = useState(0)</span><br><span class="line">  useLayoutEffect(() =&gt; &#123;</span><br><span class="line">    document.querySelector(&apos;#x2&apos;).innerText = `n:1000`</span><br><span class="line">  &#125;, [n])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo2&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect&lt;/h1&gt;</span><br><span class="line">      &lt;div id=&quot;x2&quot;&gt;n:&#123;n&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useLayoutEffect-和-useEffect-区别"><a href="#useLayoutEffect-和-useEffect-区别" class="headerlink" title="useLayoutEffect 和 useEffect 区别"></a>useLayoutEffect 和 useEffect 区别</h4><ul>
<li>useLayoutEffect 是 render之前(看不到闪烁)<ul>
<li>是不是用这个更好呢？<ul>
<li>不是，因为大部分时间，我们不回去改变 dom</li>
<li>useEffect 满足不了需求的时候用 useLayoutEffect</li>
<li>优先级更高</li>
</ul>
</li>
</ul>
</li>
<li>useEffect 是 render之后触发(能看见闪烁)</li>
</ul>
<h4 id="useLayoutEffect-和-useEffect-性能测试"><a href="#useLayoutEffect-和-useEffect-性能测试" class="headerlink" title="useLayoutEffect 和 useEffect 性能测试"></a>useLayoutEffect 和 useEffect 性能测试</h4><ul>
<li>useLayoutEffect 耗时更短</li>
<li>useEffect 耗时更长</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">function Demo3() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const time = useRef(null)</span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">    time.current = performance.now()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (time.current) &#123;</span><br><span class="line">      console.log(&apos;demo3:&apos; + (performance.now() - time.current))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo3&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useEffect的更新UI时间更长&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Demo4() &#123;</span><br><span class="line">  const [x, setX] = useState(0)</span><br><span class="line">  const time = useRef(null)</span><br><span class="line"></span><br><span class="line">  const onClickX = () =&gt; &#123;</span><br><span class="line">    setX(i =&gt; i + 1)</span><br><span class="line">    time.current = performance.now()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useLayoutEffect(() =&gt; &#123;</span><br><span class="line">    if (time.current) &#123;</span><br><span class="line">      console.log(&apos;demo4:&apos; + (performance.now() - time.current))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [x])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;demo4&quot;&gt;</span><br><span class="line">      &lt;h1&gt;useLayoutEffect的更新UI时间更短&lt;/h1&gt;</span><br><span class="line">      x:&#123;x&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClickX&#125;&gt;x+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useEffect注意事项"><a href="#useEffect注意事项" class="headerlink" title="useEffect注意事项"></a>useEffect注意事项</h3><ul>
<li>如果 useLayoutEffect 和 useEffect 同时存在 useLayoutEffect先执行</li>
<li>如果 用 useLayoutEffect ，你最好改变Layout</li>
<li>为了用户体验，优先使用 useEffect(优先渲染)</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/24/ReactWheels07-03Hooks全解2/" data-id="ckovg9eq500o78yjkyz5goqy3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-03Hooks全解1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/24/ReactWheels07-03Hooks全解1/" class="article-date">
  <time datetime="2019-07-24T14:34:01.000Z" itemprop="datePublished">2019-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/24/ReactWheels07-03Hooks全解1/">ReactWheels07-03Hooks全解1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="代码仓库"><a href="#代码仓库" class="headerlink" title="代码仓库"></a><a href="https://github.com/slTrust/react-hooks-demo" target="_blank" rel="noopener">代码仓库</a></h1><h2 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h2><ul>
<li>状态：useState</li>
<li>副作用: useEffect<ul>
<li>useLayoutEffect</li>
</ul>
</li>
<li>上下文: useContext</li>
<li>Redux : useReducer</li>
<li>记忆: useMemo<ul>
<li>useCallback</li>
</ul>
</li>
<li>引用: useRef<ul>
<li>useImperativeHandle</li>
</ul>
</li>
<li>自定义Hook<ul>
<li>useDebugValue</li>
</ul>
</li>
</ul>
<h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 使用</span><br><span class="line">const [n, setN] = useState(0);</span><br><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="注意事项：不能局部更新"><a href="#注意事项：不能局部更新" class="headerlink" title="注意事项：不能局部更新"></a>注意事项：不能局部更新</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;,age:19&#125;);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setUser(&#123;</span><br><span class="line">    age:20</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这样操作之后， name属性就没了</span><br><span class="line"></span><br><span class="line">你只能这样</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setUser(&#123;</span><br><span class="line">    ...user,</span><br><span class="line">    age:20</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注意事项2-不能直接改地址"><a href="#注意事项2-不能直接改地址" class="headerlink" title="注意事项2:不能直接改地址"></a>注意事项2:不能直接改地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [user, setUser] = useState(&#123;name:&apos;f&apos;,age:19&#125;);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  user.name = &apos;xxx&apos; // 千万不要改之前的对象</span><br><span class="line">  setUser(user)</span><br><span class="line">  // 这样也不会触发更新</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="useState补充"><a href="#useState补充" class="headerlink" title="useState补充"></a>useState补充</h4><ul>
<li>useState接受函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 这样每次 js解析 都会 算一下 18+18</span><br><span class="line">const [user,setUser] = useState(&#123;name:&apos;aaa&apos;,age:18+18&#125;) </span><br><span class="line"></span><br><span class="line">对比这样的好处是 函数只会执行一次，减少多余的计算过程</span><br><span class="line">const [user,setUser] = useState(()=&gt;&#123;</span><br><span class="line">  return (&#123;name:&apos;aaa&apos;,age:18+18&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 基本用不到</span><br></pre></td></tr></table></figure>
<ul>
<li>setState 可以用函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const [n, setN] = useState(0);</span><br><span class="line"></span><br><span class="line">onClick()&#123;</span><br><span class="line">  setN(n+1) // n不会变</span><br><span class="line">  setN(n+2) // 只有最后一次会生效</span><br><span class="line">  // n = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 多次操作n的正确姿势</span><br><span class="line">onClick()&#123;</span><br><span class="line">  setN(x =&gt; x+1) </span><br><span class="line">  setN(y =&gt; y+1) </span><br><span class="line">  // n = 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h3><ul>
<li><strong>用来践行 Flue/Redux思想</strong> 一共四步<ul>
<li>创建 initState</li>
<li>创建所有 reducer(state,action)</li>
<li>传给 useReducer ,得到 读/写 api</li>
<li>调用写 <code>{type:&#39;操作类型&#39;}</code></li>
</ul>
</li>
<li><p>useReducer 就是 useState的复杂版</p>
</li>
<li><p><a href="https://codesandbox.io/s/eager-dewdney-6jj23" target="_blank" rel="noopener">代码</a></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useReducer &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// 1创建初始值</span><br><span class="line">const initial = &#123;</span><br><span class="line">  n: 0</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 2创建所有 reducer</span><br><span class="line">const reducer = (state, action) =&gt; &#123;</span><br><span class="line">  if (action.type === &quot;add&quot;) &#123;</span><br><span class="line">    return &#123; n: state.n + action.number &#125;;</span><br><span class="line">  &#125; else if (action.type === &quot;multi&quot;) &#123;</span><br><span class="line">    return &#123; n: state.n * 2 &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error(&quot;unknown type&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, initial);</span><br><span class="line">  const &#123; n &#125; = state;</span><br><span class="line">  const onClick = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;add&quot;, number: 1 &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  const onClick2 = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;add&quot;, number: 2 &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n: &#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick2&#125;&gt;+2&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/competent-resonance-ksz9v" target="_blank" rel="noopener">高级例子</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useReducer &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">const initFormData = &#123;</span><br><span class="line">  name: &quot;&quot;,</span><br><span class="line">  age: 18,</span><br><span class="line">  nationality: &quot;汉族&quot;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case &quot;patch&quot;:</span><br><span class="line">      return &#123; ...state, ...action.formData &#125;;</span><br><span class="line">    case &quot;reset&quot;:</span><br><span class="line">      return initFormData;</span><br><span class="line">    default:</span><br><span class="line">      throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [formData, dispatch] = useReducer(reducer, initFormData);</span><br><span class="line">  // const patch = (key, value)=&gt;&#123;</span><br><span class="line">  //   dispatch(&#123; type: &quot;patch&quot;, formData: &#123; [key]: value &#125; &#125;)</span><br><span class="line">  // &#125;</span><br><span class="line">  const onSubmit = () =&gt; &#123;&#125;;</span><br><span class="line">  const onReset = () =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &quot;reset&quot; &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;form onSubmit=&#123;onSubmit&#125; onReset=&#123;onReset&#125;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          姓名</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.name&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; type: &quot;patch&quot;, formData: &#123; name: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          年龄</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.age&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; type: &quot;patch&quot;, formData: &#123; age: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          民族</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.nationality&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123;</span><br><span class="line">                type: &quot;patch&quot;,</span><br><span class="line">                formData: &#123; nationality: e.target.value &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/label&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;提交&lt;/button&gt;</span><br><span class="line">        &lt;button type=&quot;reset&quot;&gt;重置&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &#123;JSON.stringify(formData)&#125;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/24/ReactWheels07-03Hooks全解1/" data-id="ckovg9eq300o38yjkmgygrpgr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-02useState原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/23/ReactWheels07-02useState原理/" class="article-date">
  <time datetime="2019-07-23T14:34:01.000Z" itemprop="datePublished">2019-07-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/23/ReactWheels07-02useState原理/">ReactWheels07-02useState原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="useState原理"><a href="#useState原理" class="headerlink" title="useState原理"></a>useState原理</h2><h3 id="useState用法"><a href="#useState用法" class="headerlink" title="useState用法"></a>useState用法</h3><ul>
<li><a href="https://codesandbox.io/s/pensive-mendeleev-tvut2" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = useState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAdd&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<p><strong>脑补过程</strong></p>
<ul>
<li>首次渲染 <code>render(&lt;App/&gt;)</code></li>
<li>调用 App 函数 =&gt; 得到 虚拟div，然后创建真实的div</li>
<li>用户点击 button,调用 <code>setN(n+1)</code> </li>
<li>再次 <code>render(&lt;App/&gt;)</code><ul>
<li>调用 App函数 ，</li>
<li>得到 虚拟div</li>
<li>DOM Diff 更新真实 div</li>
</ul>
</li>
<li>每次都调用 App(),都会运行 useState(0)<ul>
<li>第一次的时候 n = 0</li>
<li>之后每次 n = n+1</li>
</ul>
</li>
</ul>
<p><strong>分析</strong></p>
<blockquote>
<p>setN</p>
</blockquote>
<ul>
<li>setN 一定会修改数据 x,将 n+1 存入 x</li>
<li>setN 一定会触发 <code>&lt;App/&gt;</code> 重新渲染 re-render</li>
</ul>
<blockquote>
<p>useState</p>
</blockquote>
<ul>
<li>useState 肯定会从 x 读取 n的最新值</li>
</ul>
<blockquote>
<p>x</p>
</blockquote>
<ul>
<li>每个组件有自己的数据x,我们将它命名为 state</li>
</ul>
<h3 id="自己实现一个-useState"><a href="#自己实现一个-useState" class="headerlink" title="自己实现一个 useState"></a>自己实现一个 useState</h3><h4 id="最简单的-useState-实现"><a href="#最简单的-useState-实现" class="headerlink" title="最简单的 useState 实现"></a>最简单的 useState 实现</h4><ul>
<li><a href="https://codesandbox.io/s/zealous-cloud-ik020" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">let _state;</span><br><span class="line">const myUseState = (initValue) =&gt; &#123;</span><br><span class="line">  console.log(&quot;myUseState run&quot;);</span><br><span class="line">  _state = _state === undefined ? initValue : _state;</span><br><span class="line">  const setState = (newValue) =&gt; &#123;</span><br><span class="line">    _state = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  return [_state, setState];</span><br><span class="line">&#125;;</span><br><span class="line">function render() &#123;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<ul>
<li>存在问题 ，App内 有两个变量的时候咋办 m，n 那样就会使用两次 useState</li>
</ul>
<h4 id="改进思路"><a href="#改进思路" class="headerlink" title="改进思路"></a>改进思路</h4><blockquote>
<p>把 _state 做成一个对象</p>
</blockquote>
<ul>
<li><code>_state = {n:0,m:0}</code></li>
<li>不行，因为 <code>useState(0)</code> 的时候 不知道变量 叫做 n 还是 m</li>
</ul>
<blockquote>
<p>把 _state 做成数组</p>
</blockquote>
<ul>
<li>比如 _state = [0,0]</li>
<li>貌似可以</li>
</ul>
<h4 id="解决多个-值-setState问题"><a href="#解决多个-值-setState问题" class="headerlink" title="解决多个 值 setState问题"></a>解决多个 值 setState问题</h4><ul>
<li><a href="https://codesandbox.io/s/morning-water-djeyz" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">let _state = [];</span><br><span class="line">let index = 0;</span><br><span class="line">const myUseState = (initValue) =&gt; &#123;</span><br><span class="line">  const currentIndex = index;</span><br><span class="line">  _state[currentIndex] =</span><br><span class="line">    _state[currentIndex] === undefined ? initValue : _state[currentIndex];</span><br><span class="line">  const setState = (newValue) =&gt; &#123;</span><br><span class="line">    _state[currentIndex] = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  index += 1;</span><br><span class="line">  return [_state[currentIndex], setState];</span><br><span class="line">&#125;;</span><br><span class="line">function render() &#123;</span><br><span class="line">  // 每次重新渲染的时候 重置 index</span><br><span class="line">  index = 0;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  const [m, setM] = myUseState(0);</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n:&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">      &lt;h1&gt;m:&#123;m&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setM(m + 1)&#125;&gt;onAddM&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<h3 id="useState数组方案缺陷"><a href="#useState数组方案缺陷" class="headerlink" title="useState数组方案缺陷"></a>useState数组方案缺陷</h3><h4 id="注意事项：外面不能加-if"><a href="#注意事项：外面不能加-if" class="headerlink" title="注意事项：外面不能加 if"></a>注意事项：外面不能加 if</h4><blockquote>
<p>因为上面的实现我们知道了，实际state是一个<code>[]</code>,你加了 if的时候 ，这个 index索引就乱了</p>
</blockquote>
<ul>
<li>第一次调用 n 是第一个，第二次调用 m 是第二个</li>
<li>必须保证他们的顺序是一致的</li>
<li>所以不能这样</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  console.log(&quot;app 运行了&quot;);</span><br><span class="line">  const [n, setN] = myUseState(0);</span><br><span class="line">  let m,setM</span><br><span class="line">  if(n%2 === 1)&#123;</span><br><span class="line">    [m, setM] = myUseState(0);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(&quot;n:&quot; + n);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;n:&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;onAddN&lt;/button&gt;</span><br><span class="line">      &lt;h1&gt;m:&#123;m&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setM(m + 1)&#125;&gt;onAddM&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>vue3克服了这个问题</li>
</ul>
<h3 id="现在存在的问题"><a href="#现在存在的问题" class="headerlink" title="现在存在的问题"></a>现在存在的问题</h3><ul>
<li><p>App 用了 _state 和 index，其他组件咋办</p>
<ul>
<li>解决办法<strong>给每个组件创建一个 _state 和 index</strong></li>
</ul>
</li>
<li><p>放在全局变量重名了咋办？</p>
<ul>
<li>放在组件对应的 虚拟dom节点身上</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">开始的时候 render(&lt;App/&gt;)</span><br><span class="line"></span><br><span class="line">生成虚拟dom</span><br><span class="line">vnode  = &#123;</span><br><span class="line">  tag:&apos;div&apos;,</span><br><span class="line">  type:&apos;App&apos;</span><br><span class="line">  _state:[],</span><br><span class="line">  index:0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">第一次渲染的时候 触发 useState(0)</span><br><span class="line">渲染 0</span><br><span class="line">第二次 onAdd的时候</span><br><span class="line">产生新的 vnode2 同时 测试的 n = n+1</span><br><span class="line"></span><br><span class="line">diff算法 分析差异 ，patch打补丁，更新 &lt;App/&gt;</span><br><span class="line">渲染更新后的 vnode2,n = 1</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>每个函数组件对应一个 React节点， 虚拟dom</li>
<li>每个节点保存着 state和 index<ul>
<li>_state 真实名称为 memoizedState</li>
<li>index的实现用到了 链表</li>
</ul>
</li>
<li>useState 会读取 <code>state[index]</code></li>
<li>index 由 useState 出现的次数 依次递增</li>
<li>setState 会修改 state,并触发更新</li>
</ul>
<h3 id="useState的错误理解"><a href="#useState的错误理解" class="headerlink" title="useState的错误理解"></a>useState的错误理解</h3><ul>
<li><a href="https://codesandbox.io/s/eloquent-jackson-j8w9p" target="_blank" rel="noopener">代码</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [n, setN] = useState(0);</span><br><span class="line">  const log = () =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(`n:$&#123;n&#125;`);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;n&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>先 log 在 +1</p>
</blockquote>
<ul>
<li>打印 0</li>
</ul>
<blockquote>
<p>先+1 在 log</p>
</blockquote>
<ul>
<li>打印 n+1</li>
</ul>
<h4 id="错误理解就是：setN会改变n"><a href="#错误理解就是：setN会改变n" class="headerlink" title="错误理解就是：setN会改变n"></a>错误理解就是：setN会改变n</h4><ul>
<li>setN 不会改变 n</li>
<li>每次<code>+1</code>都会有一个新的n</li>
<li>n有分身</li>
</ul>
<h4 id="能不能一个-n贯穿始终"><a href="#能不能一个-n贯穿始终" class="headerlink" title="能不能一个 n贯穿始终"></a>能不能一个 n贯穿始终</h4><ul>
<li>推荐你用 vue3</li>
<li>因为react推行 函数式，每次都是一个迭代，原来的已经不复存在了</li>
</ul>
<h4 id="贯穿始终"><a href="#贯穿始终" class="headerlink" title="贯穿始终"></a>贯穿始终</h4><ul>
<li>全局变量<ul>
<li>window.xxx 即可 太low</li>
</ul>
</li>
<li>useRef<ul>
<li>useRef不仅可用于 div,还能用于 任意数据</li>
<li>但是 n+1 后 ，不会触发UI更新，我就想让它更新咋办？ <strong>用vue3</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const nRef = React.useRef(0)</span><br><span class="line">  const log = () =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(`n:$&#123;nRef.current&#125;`);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;nRef.current&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;button onClick=&#123;()=&gt;(nRef.current+=1)&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>变通的触发UI更新，只要你不觉得自己蛋疼</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line"> import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line"> function App() &#123;</span><br><span class="line">   const nRef = React.useRef(0)</span><br><span class="line">   // 通过 跟初始值不同，来update</span><br><span class="line">   // 但是非常的蛋疼这样写。还是用 vue3吧</span><br><span class="line">   const update = React.useState(null)[1]</span><br><span class="line">   const log = () =&gt; &#123;</span><br><span class="line">     setTimeout(() =&gt; &#123;</span><br><span class="line">       console.log(`n:$&#123;nRef.current&#125;`);</span><br><span class="line">     &#125;, 3000);</span><br><span class="line">   &#125;;</span><br><span class="line">   return (</span><br><span class="line">     &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">       &lt;h1&gt;&#123;nRef.current&#125;&lt;/h1&gt;</span><br><span class="line">       &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class="line">         nRef.current+=1;</span><br><span class="line">         update(nRef.current)</span><br><span class="line">         &#125;&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">       &lt;button onClick=&#123;log&#125;&gt;log&lt;/button&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line"> ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li>vue3 的 ref 变更后会触发 UI更新，同时这个 ref贯穿始终</li>
</ul>
<h4 id="useContext来实现贯穿始终"><a href="#useContext来实现贯穿始终" class="headerlink" title="useContext来实现贯穿始终"></a>useContext来实现贯穿始终</h4><ul>
<li><p><a href="https://codesandbox.io/s/dazzling-kilby-84ehg?file=/src/index.js" target="_blank" rel="noopener">代码</a></p>
</li>
<li><p>不管你组件嵌套多少层都可以</p>
</li>
<li></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line"></span><br><span class="line">const themeContext = React.createContext(null);</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [theme, setTheme] = React.useState(&quot;red&quot;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;themeContext.Provider value=&#123;&#123; theme, setTheme &#125;&#125;&gt;</span><br><span class="line">      &lt;div className=&#123;`App $&#123;theme&#125;`&#125;&gt;</span><br><span class="line">        &lt;p&gt;&#123;theme&#125;&lt;/p&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ChildA /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ChildB /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/themeContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ChildA() &#123;</span><br><span class="line">  const &#123; setTheme &#125; = React.useContext(themeContext);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setTheme(&quot;red&quot;)&#125;&gt;red&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ChildB() &#123;</span><br><span class="line">  const &#123; setTheme &#125; = React.useContext(themeContext);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setTheme(&quot;blue&quot;)&#125;&gt;blue&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/23/ReactWheels07-02useState原理/" data-id="ckovg9eq400o58yjkm24lh1p0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ReactWheels07-01组件的两种写法Class和函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/" class="article-date">
  <time datetime="2019-07-22T14:34:01.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/">ReactWheels07-01组件的两种写法Class和函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Class组件写法"><a href="#Class组件写法" class="headerlink" title="Class组件写法"></a>Class组件写法</h3><ul>
<li><a href="https://codesandbox.io/" target="_blank" rel="noopener">打开 codesandbox</a></li>
<li><a href="https://codesandbox.io/s/sad-dream-dodjz" target="_blank" rel="noopener">代码</a></li>
</ul>
<p>index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  n: number;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  static displayName = &quot;Hjx&quot;;</span><br><span class="line">  y: () =&gt; void;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      n: 1</span><br><span class="line">    &#125;;</span><br><span class="line">    this.y = this.x1.bind(this);</span><br><span class="line">    // 等价于 this.y = ()=&gt; this.x1.bind(this)</span><br><span class="line">  &#125;</span><br><span class="line">  x = () =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      n: this.state.n + 1</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 这种写法相当于 this.y = this.x1.bind(this);</span><br><span class="line">  &#125;;</span><br><span class="line">  x1() &#123;</span><br><span class="line">    console.log(this);</span><br><span class="line">    //1 当前实例</span><br><span class="line">    //2 undefined</span><br><span class="line">    // 答案是 2</span><br><span class="line">    // react 不帮你绑定 this</span><br><span class="line">    // 你只能 onClick=&#123;this.x1.bind(this)&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.state.n&#125;&lt;/div&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x1&#125;&gt;默认不绑定this&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.x1.bind(this)&#125;&gt;bind(this)绑定this&lt;/button&gt;</span><br><span class="line">        &lt;br /&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.y&#125;&gt;内部声明的y函数&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line"></span><br><span class="line">  x() &#123;</span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">这样写相当于 x() 挂载在 原型上， 也就是多个实例共享一个 x()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>推荐使用的方式</p>
</blockquote>
<p>这种写法有缺陷,相当于 <code>this.x = ()=&gt;{}</code> ,也就是每个实例有一个 <code>x()</code></p>
<p><strong>浪费内存</strong></p>
<p>如何解决？ <strong>无解</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = () =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        n: this.state.n + 1</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="defaultProps"><a href="#defaultProps" class="headerlink" title="defaultProps"></a>defaultProps</h4></blockquote>
<ul>
<li>为 props 设置默认值，就是当用户不传递 message的时候</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="displayName"><a href="#displayName" class="headerlink" title="displayName"></a>displayName</h4></blockquote>
<ul>
<li><a href="https://dodjz.codesandbox.io/" target="_blank" rel="noopener">https://dodjz.codesandbox.io/</a> 打开开发者工具 如果你装了 React developer tools 就能看到你的组件显示为一个 <code>&lt;Hjx&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static displayName = &quot;Hjx&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="如果我们的用户是-JS-呢？"><a href="#如果我们的用户是-JS-呢？" class="headerlink" title="如果我们的用户是 JS 呢？"></a>如果我们的用户是 JS 呢？</h4><ul>
<li>它绕过类型检查传递一个 <code>message=1</code> 数字1 如何处理</li>
<li>你需要安装依赖 <strong><code>prop-types</code></strong> 用来检查 js 传参的类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">// 引入 prop-types</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  n: number;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  static displayName = &quot;Hjx&quot;;</span><br><span class="line">  // 使用 prop-types 限制用户传递的 message 类型</span><br><span class="line">  static propTypes = &#123;</span><br><span class="line">    message: PropTypes.string</span><br><span class="line">  &#125;;</span><br><span class="line">  y: () =&gt; void;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      n: 1</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h4 id="React-也有计算属性"><a href="#React-也有计算属性" class="headerlink" title="React 也有计算属性"></a>React 也有计算属性</h4><ul>
<li><a href="https://codesandbox.io/s/busy-chebyshev-tlzdh" target="_blank" rel="noopener">代码</a></li>
</ul>
<p>index.tsx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">interface State &#123;</span><br><span class="line">  firstName: string;</span><br><span class="line">  lastName: string;</span><br><span class="line">&#125;</span><br><span class="line">class App extends React.Component&lt;Props, State&gt; &#123;</span><br><span class="line">  static defaultProps = &#123;</span><br><span class="line">    message: &quot;hello&quot;</span><br><span class="line">  &#125;;</span><br><span class="line">  // 除了可以用计算属性</span><br><span class="line">  get name() &#123;</span><br><span class="line">    return this.state.firstName + &quot; &quot; + this.state.lastName;</span><br><span class="line">  &#125;</span><br><span class="line">  // 还可以给计算属性 赋值</span><br><span class="line">  set name(newName) &#123;</span><br><span class="line">    const [firstName, lastName] = newName.split(&quot; &quot;);</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      firstName,</span><br><span class="line">      lastName</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      firstName: &quot;Frank&quot;,</span><br><span class="line">      lastName: &quot;Aaa&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.props.message&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.name&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h3 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h3><ul>
<li><a href>代码</a></li>
<li><h4 id="注意！！-必须-React在-16-8及以上版本才能用-state"><a href="#注意！！-必须-React在-16-8及以上版本才能用-state" class="headerlink" title="注意！！ 必须 React在 16.8及以上版本才能用 state"></a>注意！！ 必须 React在 16.8及以上版本才能用 state</h4></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        Hello</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="使用-state"><a href="#使用-state" class="headerlink" title="使用 state"></a>使用 state</h4></blockquote>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  message: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = props =&gt; &#123;</span><br><span class="line">  const [n, setN] = useState(1);</span><br><span class="line">  const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;&#123;n&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;x&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App message=&quot;hello&quot; /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="完整的-函数组件"><a href="#完整的-函数组件" class="headerlink" title="完整的 函数组件"></a>完整的 函数组件</h4></blockquote>
<ul>
<li><a href="https://codesandbox.io/s/morning-pine-udjm2" target="_blank" rel="noopener">代码</a></li>
<li><p><code>useState</code> 来作 state.n 的初始化和设置</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// useState(1) 初始化 n = 1;</span><br><span class="line">const [n, setN] = useState(1);</span><br><span class="line">const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>useEffect</code> 来监听 state 改变 第二个参数为<code>[监听的state]</code></p>
</li>
<li><code>useEffect</code> 做 once 操作 第二个参数为<code>[]</code> mounted操作</li>
<li><code>useEffect</code> 做组件销毁的处理, return 里写处理</li>
<li><code>prop-types</code> 做js参数类型检查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line">interface Props &#123;</span><br><span class="line">  // message 可有可无 此时有个坑</span><br><span class="line">  // 你在 函数组件里 props.message.split(&apos; &apos;)</span><br><span class="line">  // 报错不通过</span><br><span class="line">  message?: string;</span><br><span class="line">&#125;</span><br><span class="line">const App: React.FunctionComponent&lt;Props&gt; = props =&gt; &#123;</span><br><span class="line">  const [n, setN] = useState(1);</span><br><span class="line">  const [m, setM] = useState(2);</span><br><span class="line">  const x = () =&gt; &#123;</span><br><span class="line">    setN(n + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  const y = () =&gt; &#123;</span><br><span class="line">    setM(m + 1);</span><br><span class="line">  &#125;;</span><br><span class="line">  // 在每次UI更新之后执行 mounted或 updated之后</span><br><span class="line">  /*</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;UI更新之后，mounted或 updated之后&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line">  */</span><br><span class="line">  // 单独监听 n 的改变</span><br><span class="line">  /*</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;UI更新之后，n&quot;);</span><br><span class="line">  &#125;, [n]);</span><br><span class="line">  */</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;只执行一次&quot;);</span><br><span class="line">    // 组件死之前想做什么 就 return</span><br><span class="line">    return () =&gt; console.log(&quot;我死了&quot;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  // 因为 你定义的 message?:string 代表可有可无</span><br><span class="line">  // props.message.split(&quot; &quot;);</span><br><span class="line">  // 你只能用以下两种方式 强制断言</span><br><span class="line">  (props.message as string).split(&quot; &quot;);</span><br><span class="line">  props.message!.split(&quot; &quot;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;props.message&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;&#123;n&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;x&#125;&gt;n+1&lt;/button&gt;</span><br><span class="line">      &lt;div&gt;&#123;m&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;y&#125;&gt;m+1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">App.defaultProps = &#123;</span><br><span class="line">  message: &quot;default message&quot;</span><br><span class="line">&#125;;</span><br><span class="line">App.displayName = &quot;Hjx&quot;;</span><br><span class="line">App.propTypes = &#123;</span><br><span class="line">  message: PropTypes.string</span><br><span class="line">&#125;;</span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<h3 id="两种组件方式的区别"><a href="#两种组件方式的区别" class="headerlink" title="两种组件方式的区别"></a>两种组件方式的区别</h3><ul>
<li>16.8.0及以上 才可以使用 <code>useState / useEffect API</code> 也就是 hooks API </li>
<li><strong>16.8.0以前的函数组件为 无状态组件</strong></li>
<li><strong>16.8.0以后的函数组件可以代替 class组件</strong></li>
</ul>
<blockquote>
<h4 id="解决-props可有可无"><a href="#解决-props可有可无" class="headerlink" title="解决 props可有可无"></a>解决 props可有可无</h4></blockquote>
<p>使用解构赋值，但是这样代码不好理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const App: React.FunctionComponent&lt;Props&gt; = (</span><br><span class="line">    &#123;message = &apos;default message&apos;&#125;) =&gt; &#123;</span><br><span class="line">  props.message.split(&quot; &quot;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="函数组件和class组件区别"><a href="#函数组件和class组件区别" class="headerlink" title="函数组件和class组件区别"></a>函数组件和class组件区别</h3><table>
<thead>
<tr>
<th>函数</th>
<th>vs</th>
<th>类</th>
</tr>
</thead>
<tbody>
<tr>
<td>无状态(useState)</td>
<td></td>
<td>有状态(state)</td>
</tr>
<tr>
<td>可以实现函数式</td>
<td></td>
<td>很难实现函数式</td>
</tr>
<tr>
<td>setN执行之后原来的状态[n,setN]等都不要了，会得到一个新的[n,setN]</td>
<td></td>
<td>this.setState({n:1}) ，n一直在this.state.n </td>
</tr>
<tr>
<td>迭代，每次得到一个最新的状态，之前的全部不要了</td>
<td></td>
<td>在一个对象上不停的进行赋值，修改的都是同一个对象</td>
</tr>
</tbody>
</table>
<blockquote>
<h4 id="函数式的本质就是-不能进行第二次赋值"><a href="#函数式的本质就是-不能进行第二次赋值" class="headerlink" title="函数式的本质就是 不能进行第二次赋值"></a>函数式的本质就是 不能进行第二次赋值</h4></blockquote>
<ul>
<li>函数式好处就是 <code>可以使用数学知识</code></li>
<li>面向对象的好处是 <code>适合人类</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = 1</span><br><span class="line">a = 2  就不行</span><br><span class="line"></span><br><span class="line">而面向对象可以</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/22/ReactWheels07-01组件的两种写法Class和函数/" data-id="ckovg9eq200nz8yjkqmendrb8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-021-Collection体系原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/22/ZB-021-Collection体系原理/" class="article-date">
  <time datetime="2019-07-22T12:03:07.000Z" itemprop="datePublished">2019-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/22/ZB-021-Collection体系原理/">ZB-021-Collection体系原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Collection体系简介"><a href="#Collection体系简介" class="headerlink" title="Collection体系简介"></a>Collection体系简介</h3><ul>
<li>Collection 是接口，无法实例化</li>
<li>有非常非常多的类继承它</li>
<li>它是整个<code>Collection</code>的根接口</li>
</ul>
<blockquote>
<p>最重要的两个实现（接口）</p>
</blockquote>
<ul>
<li>List </li>
<li>Set</li>
</ul>
<p>list添加元素的三种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Collection&lt;Integer&gt; c = new LinkedList&lt;Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList(c);</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list2 = new ArrayList();</span><br><span class="line">        list2.addAll(c);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list3 = new ArrayList();</span><br><span class="line">        for (Integer i: c) &#123;</span><br><span class="line">            list3.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Collection常用方法</p>
</blockquote>
<ul>
<li>new: <code>new ArrayList(Collection) 或者 new ArrayList()</code></li>
<li>R:<code>size()/isEmpty()/contains()/for()/stream()</code></li>
<li><p>C/U:<code>add()/addAll()/retainAll()</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 求交集</span><br><span class="line">List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">list.add(1);</span><br><span class="line">list.add(2);</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; list2 = new ArrayList();</span><br><span class="line">list2.add(2);</span><br><span class="line">list2.add(3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">list.retainAll(list2);</span><br><span class="line">System.out.println(list); // [2]</span><br></pre></td></tr></table></figure>
</li>
<li><p>D:<code>clear()/remove()/removeAll()</code></p>
</li>
</ul>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><ul>
<li>最常用的ArrayList<br>  本质就是一个数组</li>
<li>面试题：动态扩容的实现<ul>
<li>创建一个更大的空间，然后把原先的所有元素拷贝过去</li>
</ul>
</li>
<li>add()方法</li>
</ul>
<blockquote>
<p>ArrayList扩容源代码</p>
</blockquote>
<ul>
<li>非常非常好的代码风格</li>
<li>代码清晰易懂，<strong>命名</strong>非常好(见名知意)</li>
<li>傻子都可以写出让机器识别的代码，但优秀的程序员应该写出人类轻松识别的代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    public boolean add(E e) &#123;</span><br><span class="line">        // 确保容量够</span><br><span class="line">        ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br><span class="line">        elementData[size++] = e;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensureCapacityInternal(int minCapacity) &#123;</span><br><span class="line">        // 计算容量</span><br><span class="line">        ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void ensureExplicitCapacity(int minCapacity) &#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void grow(int minCapacity) &#123;</span><br><span class="line">        // overflow-conscious code</span><br><span class="line">        int oldCapacity = elementData.length;</span><br><span class="line">        // 右移一位就是 除2</span><br><span class="line">        int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line">        if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        // minCapacity is usually close to size, so this is a win:</span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     private static int calculateCapacity(Object[] elementData, int minCapacity) &#123;</span><br><span class="line">        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            return Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">        return minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>疑问?扩容后，之前的数组是不是变成垃圾了</p>
</blockquote>
<ul>
<li>是</li>
<li>垃圾回收帮你处理，你不用操心，你操心也操心不上。不归你管</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">        list.add(1);</span><br><span class="line">        list.add(2);</span><br><span class="line">        list.add(2);</span><br><span class="line">        list.add(3);</span><br><span class="line"></span><br><span class="line">        Set&lt;Integer&gt; set = new HashSet(list); // [1,2,3]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>equals约定：不允许有重复元素<br>  判断重复：equals</li>
<li><p>如果你有一个Set,如何实现？</p>
<ul>
<li>容易想到的办法都比较低效<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class MySet &#123;</span><br><span class="line">    List&lt;Object&gt; elements;</span><br><span class="line"></span><br><span class="line">    void add(Object object)&#123;</span><br><span class="line">        if(!elements.contains(object))&#123;</span><br><span class="line">            elements.add(object);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 每次添加的时候都要比较当前列表里是否存在，非常的低效</span><br><span class="line">// 假设Set有100万数据,每次都比较100万次 非常低效</span><br><span class="line">set ==&gt; [张三，李四，王五]</span><br><span class="line"></span><br><span class="line">set.add(&quot;张三&quot;); </span><br><span class="line">挨个比较非常低效</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Java世界里第二最大重要的约定：hashCode</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">改良上面的低效问题， 百家姓</span><br><span class="line">张:张三，张三丰</span><br><span class="line">李:李四</span><br><span class="line">赵:赵六</span><br><span class="line"></span><br><span class="line">这样每次添加的时候 如 添加 赵奕欢</span><br><span class="line">先找 “赵”</span><br><span class="line">这样无形中提高了效率</span><br><span class="line"></span><br><span class="line">这个“百家姓”就是 hashCode</span><br><span class="line"></span><br><span class="line">同理我们想知道我们的 Object是不是重复的 </span><br><span class="line">- 新建很多“桶”  ==&gt;哈希桶 </span><br><span class="line">- 映射成一个 int值 均匀的分配到 桶里面去</span><br><span class="line">- 此时有一个 obj 来了，想知道它存在不存在，只需要算一下它的 hashCode</span><br><span class="line">- 然后去对应的 hash桶里找就好了</span><br></pre></td></tr></table></figure>
<ul>
<li>同一个对象必须始终返回相同的hashCode</li>
<li>两个对象的 equals 返回 true,必须返回相同的 hashCode</li>
<li>两个对象不等，也可能返回相同的hashCode<ul>
<li>百家姓里 “张” 姓 张三，张三丰 都姓“张” ==&gt; hashCode相同</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h4><ul>
<li>哈希就是一个单向的映射</li>
<li>例子：从姓名到姓的哈希运算</li>
<li>从任意对象到一个整数的hashCode</li>
</ul>
<blockquote>
<p>注意！ 整数int的值是有范围的 正副21亿，而对象是无限多的可能</p>
</blockquote>
<h4 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h4><ul>
<li><p>最常用！最高效的Set实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = new ArrayList();</span><br><span class="line">        Set&lt;Integer&gt; set = new HashSet();</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 1000_0000; i++) &#123;</span><br><span class="line">            set.add(i);</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long t0 = System.nanoTime();</span><br><span class="line">        set.contains(9999_9999);</span><br><span class="line"></span><br><span class="line">        long t1 = System.nanoTime();</span><br><span class="line">        list.contains(9999_9999);</span><br><span class="line"></span><br><span class="line">        long t2 = System.nanoTime();</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;set:&quot;+(t1-t0)/1000.0/1000);</span><br><span class="line">        System.out.println(&quot;list:&quot;+(t2-t1)/1000.0/1000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 执行效率</span><br><span class="line">set:0.016948</span><br><span class="line">list:29.803517</span><br></pre></td></tr></table></figure>
</li>
<li><p>HashSet 是无序的！如果有需要使用LinkedHashSet(双向链表)</p>
</li>
</ul>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><ul>
<li>C/U:<code>put/putAll</code></li>
<li>R<ul>
<li><code>get/size</code></li>
<li><code>containsKey/containsValue</code></li>
<li><code>keySet/values/entrySet</code></li>
</ul>
</li>
<li>D:<code>remove/clear</code></li>
</ul>
<blockquote>
<h4 id="Map非常容易踩到的坑"><a href="#Map非常容易踩到的坑" class="headerlink" title="Map非常容易踩到的坑"></a>Map非常容易踩到的坑</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">map.put(&quot;a&quot;:&quot;1&quot;);</span><br><span class="line">map.put(&quot;b&quot;:&quot;2&quot;);</span><br><span class="line"></span><br><span class="line">Set&lt;String&gt; keyset = map.keySet(); // [&quot;a&quot;,&quot;b&quot;]</span><br><span class="line"></span><br><span class="line">// 坑来了</span><br><span class="line">// 你修改 map 里的 key 会映射到 keyset里</span><br><span class="line">// 你修改 keyset 里的值 会映射到 map里</span><br><span class="line">map.remove(&quot;a&quot;);</span><br><span class="line">// 此时 keyset ==》[&quot;b&quot;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>entrySet</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">map.put(&quot;a&quot;:&quot;1&quot;);</span><br><span class="line">map.put(&quot;b&quot;:&quot;2&quot;);</span><br><span class="line">for(Map.Entry&lt;String,String&gt; entry:map.entrySet())&#123;</span><br><span class="line">    System.out.println(entry.getKey());</span><br><span class="line">    System.out.println(entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><blockquote>
<h4 id="HashMap-和-HashSet-区别"><a href="#HashMap-和-HashSet-区别" class="headerlink" title="HashMap 和 HashSet 区别"></a>HashMap 和 HashSet 区别</h4></blockquote>
<ul>
<li>HashMap的key的Set就是一个 HashSet</li>
</ul>
<blockquote>
<h4 id="请说一下-HashMap-扩容过程"><a href="#请说一下-HashMap-扩容过程" class="headerlink" title="请说一下 HashMap 扩容过程"></a>请说一下 HashMap 扩容过程</h4></blockquote>
<ul>
<li>跟 ArrayList 一样，创建一个更大的 HashMap</li>
<li>然后把之前的元素拷贝过来</li>
</ul>
<blockquote>
<p>问到唬住就50K唬不住就5K</p>
</blockquote>
<blockquote>
<h4 id="HashMap的线程不安全性"><a href="#HashMap的线程不安全性" class="headerlink" title="HashMap的线程不安全性"></a>HashMap的线程不安全性</h4></blockquote>
<ul>
<li>多线程用HashMap 有坑</li>
<li><a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">google hashMap 死循环 site: coolshell.cn</a></li>
<li>扩容时候(多线程)可能变成一个死循环列表</li>
<li><strong>我们多线程时要用 <code>ConcurrentHashMap</code></strong></li>
</ul>
<blockquote>
<h4 id="HashMap在-Java7-后的改变：-链表-gt-红黑树"><a href="#HashMap在-Java7-后的改变：-链表-gt-红黑树" class="headerlink" title="HashMap在 Java7+ 后的改变： 链表==&gt; 红黑树"></a>HashMap在 Java7+ 后的改变： 链表==&gt; 红黑树</h4></blockquote>
<ul>
<li>我们知道 <code>HashSet/HashMap</code> 本质实现是有很多 哈希桶 存储相同 hashCode</li>
<li>但是之前说到 <strong>桶的个数是有限的，而对象可能是无限的</strong> 此时可能发生碰撞</li>
<li>以致于 hashCode相同 因此被放到同一个 Hash桶里 ，但是 它们是不同对象所以equals 返回false</li>
<li>问题来了，假如一组数据 它们hashCode都一样。你会发现 HashSet 就退化成了一个 <strong>链表</strong> </li>
<li>假如你有100万个元素 你希望平均的分配在10万个桶里，但如遇到碰巧精心设计的一组数据 hashCode 相同，此时这个桶的性能就会急剧恶化</li>
<li>坏处就是 HashSet 的性能和 List 一样了 </li>
</ul>
<p>因此在JDK7之后，当发生 哈希碰撞的时候，这个东西就不是链表了而是 <strong>红黑树</strong></p>
<ul>
<li>红黑树 超级复杂的数据结构<ul>
<li>如被问到知道是什么东西就行了</li>
<li>原理都不用知道</li>
<li>面试官也够呛知道，如果让你手写，就说我不会，等面试结束的反问问题，我不会红黑树，你给我写一个红黑树！</li>
</ul>
</li>
</ul>
<h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><blockquote>
<h4 id="Set-1"><a href="#Set-1" class="headerlink" title="Set"></a>Set</h4></blockquote>
<ul>
<li>HashSet 完全随机</li>
<li>LinkedHashSet 保证和插入顺序一样</li>
<li>TreeSet 有序的(会进行一个排序) 自然顺序从小到大</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(100000,142,-2,-323121,321321,15);</span><br><span class="line"></span><br><span class="line">        Set set1 = new HashSet(list);</span><br><span class="line">        Set set2 = new LinkedHashSet(list);</span><br><span class="line">        Set set3 = new TreeSet(list);</span><br><span class="line"></span><br><span class="line">        set1.forEach(System.out::println); // 无序的</span><br><span class="line">        set2.forEach(System.out::println); // 按添加顺序</span><br><span class="line">        set3.forEach(System.out::println); // 排好序的</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="TreeSet-ArrayList查找时间复杂度"><a href="#TreeSet-ArrayList查找时间复杂度" class="headerlink" title="TreeSet / ArrayList查找时间复杂度"></a>TreeSet / ArrayList查找时间复杂度</h4></blockquote>
<ul>
<li>ArrayList O(n)</li>
<li>TreeSet O(log n)</li>
</ul>
<p>把算法的复杂度从 线性时间下降到对数时间</p>
<blockquote>
<h4 id="TreeSet-TreeMap"><a href="#TreeSet-TreeMap" class="headerlink" title="TreeSet/TreeMap"></a>TreeSet/TreeMap</h4></blockquote>
<ul>
<li>二叉树/红黑树</li>
<li>使用Comparable约定，认定排序相等的元素相等</li>
<li>二叉树查找/插入</li>
</ul>
<blockquote>
<h4 id="Collections-工具方法集合"><a href="#Collections-工具方法集合" class="headerlink" title="Collections 工具方法集合"></a>Collections 工具方法集合</h4></blockquote>
<ul>
<li>emptySet() 返回一个空的集合</li>
<li>synchronizedCollection: 将一个集合变成线程安全的</li>
<li>unmodifiableCollection: 将一个集合变成不可变的  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(100000,142,-2,-323121,321321,15);</span><br><span class="line">Set set1 = new HashSet(list);</span><br><span class="line">Set unmodifiableSet = Collections.unmodifiableSet(set1);</span><br><span class="line"></span><br><span class="line">unmodifiableSet.add(1); //报错</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="Collection-其他实现"><a href="#Collection-其他实现" class="headerlink" title="Collection 其他实现"></a>Collection 其他实现</h4></blockquote>
<ul>
<li>Queue 队列/Deque 双端队列<ul>
<li>任何你想用 Stack的时候都可以使用 Deque</li>
</ul>
</li>
<li>Vector/Stack</li>
<li>LinkedList 链表</li>
<li>ConcurrentHashMap</li>
<li>PriorityQueue 优先级队列 比如你的 闹钟列表 离你最近的那个会响</li>
</ul>
<blockquote>
<h4 id="Guava-番石榴"><a href="#Guava-番石榴" class="headerlink" title="Guava 番石榴"></a>Guava 番石榴</h4></blockquote>
<p>补充java中 不完整的Collection实现</p>
<ul>
<li>Lists/Sets/Maps</li>
<li>ImmutableMap/ImmutableSet 不可变的Map/Set</li>
<li><p>MultiSet/MultiMap </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set =&gt; 1,2,3,4</span><br><span class="line"></span><br><span class="line">#除了告诉你唯一的元素有那些，还可以告诉你 3 被加了几次</span><br><span class="line">MultiSet =&gt; 1,2,3x3,4 </span><br><span class="line"></span><br><span class="line">Map  key:value</span><br><span class="line"></span><br><span class="line">MultiMap </span><br><span class="line">key:对应多个value</span><br></pre></td></tr></table></figure>
</li>
<li><p>BiMap 双向Map</p>
<ul>
<li>普通的Map是 value对key的映射</li>
<li>BiMap 是双向映射</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/22/ZB-021-Collection体系原理/" data-id="ckovg9ev301128yjk8gfqbu3c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-020-java包管理和maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/16/ZB-020-java包管理和maven/" class="article-date">
  <time datetime="2019-07-16T12:47:35.000Z" itemprop="datePublished">2019-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/16/ZB-020-java包管理和maven/">ZB-020-java包管理和maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="什么是包"><a href="#什么是包" class="headerlink" title="什么是包"></a>什么是包</h3><ul>
<li>JVM的⼯作被设计地相当简单：<ol>
<li>执⾏⼀个类的字节码</li>
<li>假如这个过程中碰到了新的类，加载它，然后回到第一步，这样循环往复</li>
</ol>
</li>
</ul>
<blockquote>
<p>那么，去哪⾥加载这些类呢？</p>
</blockquote>
<ul>
<li>答案是 classpath<strong>类路径</strong></li>
</ul>
<h3 id="类路径（Classpath）"><a href="#类路径（Classpath）" class="headerlink" title="类路径（Classpath）"></a>类路径（Classpath）</h3><ul>
<li>在哪⾥可以找到类<ul>
<li>-classpath/-cp</li>
</ul>
</li>
<li>类的全限定类名（⽬录层级）唯⼀确定了⼀个类</li>
<li>包就是把许多类放在⼀起打的压缩包 <strong>jar 包</strong></li>
</ul>
<p>每次 IDEA 运行java项目显示的命令行</p>
<p><strong>程序运行时：会挨个在 classpath路径里找。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/bin/java &quot;-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=51272:</span><br><span class="line">/Applications/IntelliJ IDEA.app/Contents/bin&quot; </span><br><span class="line">-Dfile.encoding=UTF-8 </span><br><span class="line">-classpath </span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/charsets.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/deploy.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/cldrdata.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/dnsns.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jaccess.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jfxrt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/localedata.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/nashorn.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunec.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/zipfs.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/javaws.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jce.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfr.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfxswt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jsse.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/management-agent.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/plugin.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/resources.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/rt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/dt.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/javafx-mx.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/jconsole.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/packager.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/sa-jdi.jar:</span><br><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/tools.jar:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 当前目录的 target/classes 就是本项目里的 类文件</span><br><span class="line"></span><br><span class="line">/Users/huangjiaxi/Desktop/java-fork-process/target/classes </span><br><span class="line"></span><br><span class="line">com.github.hcsp.shell.Fork</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="什么是-jar-文件"><a href="#什么是-jar-文件" class="headerlink" title="什么是 jar 文件"></a>什么是 jar 文件</h4></blockquote>
<ul>
<li>实际就是 跟<code>zip</code>一样压缩后的文件，只不过这里叫 <code>jar包</code></li>
</ul>
<h5 id="每当-JVM-需要一个类时，它就会在当前的-classpath里-按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出-classNotFound"><a href="#每当-JVM-需要一个类时，它就会在当前的-classpath里-按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出-classNotFound" class="headerlink" title="每当 JVM 需要一个类时，它就会在当前的 classpath里 按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出 classNotFound"></a>每当 JVM 需要一个类时，它就会在当前的 classpath里 按照这个类的全限定类名挨个找，如果是jar包就解压缩然后在解压缩后的目录里找，如果是一个文件夹就直接按照目录找，找不到就抛出 classNotFound</h5><blockquote>
<p>如果你依赖的类中还依赖了别的包呢？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A 依赖 B , B 依赖 C , C 又依赖 D</span><br><span class="line">D 从那里找呢？</span><br></pre></td></tr></table></figure>
<p>这就是 <strong>传递性依赖</strong> ,这就是为什么上面的命令行里 classpach 那么长的原因，要把所有依赖的path 添加进来</p>
<p>一个简单的项目命令行尚且如此之长，而一个真实项目可能有成百上千的依赖，如果你手动拼接，肯定又各种各样的问题，这就是为什么使用自动化工具的原因。</p>
<p>自动化的本质就是：帮我们把一些很啰嗦很累赘变成自动化</p>
<h3 id="别急，还没完"><a href="#别急，还没完" class="headerlink" title="别急，还没完"></a>别急，还没完</h3><blockquote>
<p>没有maven时，你要手动导入jar包还有相关依赖，多人协作的时候非常麻烦。</p>
</blockquote>
<ul>
<li>传递性依赖<ul>
<li>你依赖的类还依赖了别的类</li>
</ul>
</li>
<li>Classpath hell<ul>
<li>全限定类名是类的唯⼀标识</li>
<li>当多个同名类同时出现在Classpath中，就是噩梦的开始</li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="当你的-classpath里包含了相同包，但是版本不同会发生什么"><a href="#当你的-classpath里包含了相同包，但是版本不同会发生什么" class="headerlink" title="当你的 classpath里包含了相同包，但是版本不同会发生什么"></a>当你的 classpath里包含了相同包，但是版本不同会发生什么</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-classpath </span><br><span class="line">xxx.5.0.0.jar:</span><br><span class="line">xxx.4.0.0.jar</span><br></pre></td></tr></table></figure>
<ul>
<li>此时两个jar包里 有同名类 a</li>
<li>在你程序运行时 会引用那个 类？</li>
</ul>
<p>答案是 <strong>谁在前面用谁</strong></p>
<blockquote>
<h4 id="问题升级，引入版本不同，但是同名的jar包"><a href="#问题升级，引入版本不同，但是同名的jar包" class="headerlink" title="问题升级，引入版本不同，但是同名的jar包"></a>问题升级，引入版本不同，但是同名的jar包</h4></blockquote>
<ul>
<li>版本不同的时候，代码可能是不一样的，以致于你的程序看上去可以运行。突然三天或三年后的某一天突然运行到一个地方出错了。你就很懵  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-classpath </span><br><span class="line">xxx.4.0.0.jar: </span><br><span class="line">xxx.5.0.0.jar</span><br><span class="line"></span><br><span class="line"># 4.0.0 是你实际使用的jar包</span><br><span class="line"># 5.0.0 是更新后的一个大版本修复了4.0.0的某些bug, 可能一些方法 API 已经变的面目全非了。</span><br><span class="line">但是在你看在程序还是正常的跑，只是没运行到出bug的地方</span><br><span class="line">你的项目如期上线，然后某天爆出个bug</span><br><span class="line">这个情况就叫 Classpath hell 依赖地狱</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="什么是包管理"><a href="#什么是包管理" class="headerlink" title="什么是包管理"></a>什么是包管理</h3><ul>
<li>你要使⽤⼀些第三⽅类，总要告诉JVM从哪⾥找吧？</li>
<li>包管理的本质就是告诉JVM如何找到所需的第三⽅类库</li>
<li>以及成功地解决其中的冲突问题</li>
</ul>
<h3 id="没有Maven的蛮荒年代"><a href="#没有Maven的蛮荒年代" class="headerlink" title="没有Maven的蛮荒年代"></a>没有Maven的蛮荒年代</h3><blockquote>
<p>以前怎么做的这些依赖</p>
</blockquote>
<h4 id="黑暗时代"><a href="#黑暗时代" class="headerlink" title="黑暗时代"></a>黑暗时代</h4><ul>
<li>⼿动写命令进⾏编译运⾏</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javac -cp  xx.jar xx2.jar Main.java</span><br><span class="line">java -cp xx.jar xx2.jar Main</span><br><span class="line"></span><br><span class="line"># 假设此时 jar包成百上千呢？</span><br></pre></td></tr></table></figure>
<h4 id="启蒙时代"><a href="#启蒙时代" class="headerlink" title="启蒙时代"></a>启蒙时代</h4><ul>
<li>Apache Ant<ul>
<li>⼿动下载jar包，放在⼀个⽬录中</li>
<li>写XML配置，指定编译的源代码⽬录、依赖的jar包、输出<br>⽬录等</li>
</ul>
</li>
<li>缺点<ul>
<li>每个⼈都要⾃⼰造⼀套轮⼦<ol>
<li>我的放在 libs</li>
<li>你的放在 sources</li>
<li>他的放在 libaray </li>
</ol>
</li>
<li>依赖的第三⽅类库都需要⼿动下载，费时费⼒<ul>
<li>假如你的应⽤依赖了⼀万个第三⽅的类库呢？都需要把依赖的库挨个下载下来</li>
</ul>
</li>
<li>没有解决Classpath地狱的问题，碰上重复的库你就完蛋了</li>
</ul>
</li>
</ul>
<h4 id="Maven——划时代的包管理"><a href="#Maven——划时代的包管理" class="headerlink" title="Maven——划时代的包管理"></a>Maven——划时代的包管理</h4><ul>
<li>Convention over configuration</li>
<li>约定优于配置</li>
<li>必须强调，Maven远远不⽌是包管理⼯具</li>
<li>Maven的中央仓库<ul>
<li>按照⼀定的约定存储包（坐标）</li>
</ul>
</li>
<li>Maven的本地仓库<ul>
<li>默认位于~/.m2</li>
<li>下载的第三⽅包放在这⾥进⾏缓存</li>
</ul>
</li>
<li>Maven的包<ul>
<li>按照约定为所有的包编号，⽅便检索</li>
<li>groupId/artifactId/version<ul>
<li>扩展：语义化版本</li>
</ul>
</li>
<li>SNAPSHOT快照版本</li>
</ul>
</li>
</ul>
<blockquote>
<p>当你不知道一个包的坐标你就搜 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxx.xxx.xxx maven 通常第一个就是包的正确的名字</span><br><span class="line"></span><br><span class="line">每个包有自己的版本</span><br><span class="line">如 junit-jupiter-api 5.5.0</span><br><span class="line">它会不停的升级。版本一旦发布，maven的约定是不能更改只能继续升级。 </span><br><span class="line">目的是 maven 想要实现一个可重现的构建，就是你机子上跑的和我机子上跑的 是一样的。 </span><br><span class="line"></span><br><span class="line">因为一旦同版本允许修改，就可能你跑的时候是好的，我跑的时候是坏的</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="maven-为什么知道包从哪里下载呢？"><a href="#maven-为什么知道包从哪里下载呢？" class="headerlink" title="maven 为什么知道包从哪里下载呢？"></a>maven 为什么知道包从哪里下载呢？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">当你引入依赖</span><br><span class="line"></span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">maven 就会去它的主仓库 https://repo1.maven.org/maven2/</span><br><span class="line">按照你的 groupId 里的路径 </span><br><span class="line">https://repo1.maven.org/maven2/org</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter</span><br><span class="line"></span><br><span class="line">然后按照 artifactId 找路径</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/</span><br><span class="line"></span><br><span class="line">然后按照版本号 5.4.2</span><br><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/5.4.2/</span><br></pre></td></tr></table></figure>
<p>里面有一堆文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar            2019-04-07 17:29    683506      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc        2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc.md...  2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.asc.sh...  2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.md5        2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-javadoc.jar.sha1       2019-04-07 17:29        40    </span><br><span class="line"># 源代码  </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar            2019-04-07 17:29    110900      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc        2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc.md...  2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.asc.sh...  2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.md5        2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2-sources.jar.sha1       2019-04-07 17:29        40      </span><br><span class="line"># 真正的 jar包</span><br><span class="line">junit-jupiter-engine-5.4.2.jar                    2019-04-07 17:29    177798      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc                2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc.md5            2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.asc.sha1           2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.md5                2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.jar.sha1               2019-04-07 17:29        40    </span><br><span class="line"># 当前包所依赖的包  </span><br><span class="line">junit-jupiter-engine-5.4.2.pom                    2019-04-07 17:29      2395      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc                2019-04-07 17:29       821      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc.md5            2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.asc.sha1           2019-04-07 17:29        40      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.md5                2019-04-07 17:29        32      </span><br><span class="line">junit-jupiter-engine-5.4.2.pom.sha1               2019-04-07 17:29        40</span><br></pre></td></tr></table></figure>
<p>这样就实现了。你pom引入了一个junit-jupiter-engine-5.4.2的依赖，然后它下载后根据junit-jupiter-engine-5.4.2.pom文件去下载 当前包的依赖(传递性依赖)</p>
<p><strong>这样就形成了一颗依赖树</strong>，你可以在 IDEA maven工具栏的<code>Dependencies</code> 里看到</p>
<p><code>pom.xml</code>里的aliyun镜像,就是为了下载更快。也可以配置到你本地安装的maven里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line">&lt;/repositories&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="Maven的包"><a href="#Maven的包" class="headerlink" title="Maven的包"></a>Maven的包</h4></blockquote>
<ul>
<li>按照约定为所有的包编号，⽅便检索</li>
<li>groupId/artifactId/version<ul>
<li>扩展：<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener">语义化版本 x.y.z</a></li>
</ul>
</li>
<li>SNAPSHOT快照版本  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/</span><br><span class="line"></span><br><span class="line">你开发的包可能不会立马上线，需要一直测一直改一直发布。但是总不能每次都发布一个版本吧！ </span><br><span class="line">5.0.0/                                            2017-09-10 18:09         -      </span><br><span class="line">5.0.0-M1/                                         2016-07-07 09:05         -      </span><br><span class="line">5.0.0-M2/                                         2016-07-23 18:14         -      </span><br><span class="line">5.0.0-M3/                                         2016-11-30 09:06         -      </span><br><span class="line">5.0.0-M4/                                         2017-04-01 19:23         -      </span><br><span class="line">5.0.0-M5/                                         2017-07-04 16:39         -      </span><br><span class="line">5.0.0-M6/                                         2017-07-18 19:27         -      </span><br><span class="line"># RC叫做 发布准备版 但是它们都不是 SNAPSHOT快照版本，也基本不会在中央仓库里放置</span><br><span class="line"># 中央仓库都是放成熟的。</span><br><span class="line">5.0.0-RC1/                                        2017-07-30 19:13         -      </span><br><span class="line">5.0.0-RC2/                                        2017-07-30 20:37         -</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>maven 默认会帮你下载字节码的包，如需看源码 可以在 IDEA 点击下载 </p>
<h4 id="包冲突"><a href="#包冲突" class="headerlink" title="包冲突"></a>包冲突</h4><blockquote>
<p>当你看到如下的异常的时候，<strong>包冲突发生了</strong></p>
<ul>
<li>AbstractMethodError</li>
<li>NoClassDefFoundError</li>
<li>ClassNotFoundException</li>
<li>LinkageError</li>
</ul>
</blockquote>
<blockquote>
<p>举个例子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">你的项目里</span><br><span class="line">依赖了 A</span><br><span class="line">依赖了 D</span><br><span class="line"></span><br><span class="line">A 又依赖了 B , B又依赖了 C</span><br><span class="line">D 又依赖了 C</span><br><span class="line"></span><br><span class="line">|A</span><br><span class="line">--|B</span><br><span class="line">--|--|C 1.0</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|C 2.0</span><br><span class="line"></span><br><span class="line">此时 两个 C 就导致了 包冲突</span><br><span class="line"></span><br><span class="line">-classpath A:B:C1.0:D:C2.0</span><br><span class="line"></span><br><span class="line"># 因为之前说了 classpath hell 依赖地狱</span><br><span class="line">由于全限定类名是类的唯一标识，此时如果存在两个同名不同版本的库 同时出现在 classpath 中 那么噩梦开始了</span><br><span class="line"></span><br><span class="line">如果有同名的库出现在 classpath 中 JVM 会选择靠前的那个 也就是 C1.0</span><br><span class="line"></span><br><span class="line">但是 靠前的那个 C1.0 不一定是你想要的那个，有可能只是你忘了。</span><br></pre></td></tr></table></figure>
<p><strong>对此</strong> maven 的原则是</p>
<ul>
<li>传递性依赖的⾃动管理<ul>
<li>原则：绝对不允许最终的classpath出现同名不同版本的jar包</li>
</ul>
</li>
<li><p>依赖冲突的解决：原则：<strong>最近的胜出</strong> </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">你的项目里</span><br><span class="line">依赖了 A</span><br><span class="line">依赖了 D</span><br><span class="line"></span><br><span class="line">A 又依赖了 B , B又依赖了 C</span><br><span class="line">D 又依赖了 C</span><br><span class="line"></span><br><span class="line">|A</span><br><span class="line">--|B</span><br><span class="line">--|--|C 1.0</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|C 2.0</span><br><span class="line"></span><br><span class="line">C2.0 更加离 依赖树的根更近</span><br><span class="line">也就是 C2.0 获胜，淘汰 C1.0</span><br><span class="line">-classpath A:B:D:C2.0</span><br></pre></td></tr></table></figure>
<ul>
<li>这个过程绝大多数是可以正常工作的，但是</li>
<li><code>mvn dependency:tree</code>  </li>
</ul>
</li>
<li>依赖的scope</li>
</ul>
<blockquote>
<h4 id="实战：解决包冲突"><a href="#实战：解决包冲突" class="headerlink" title="实战：解决包冲突"></a>实战：解决包冲突</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">你的项目依赖了 A / D</span><br><span class="line"></span><br><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line"></span><br><span class="line">此时 maven 帮你淘汰了 C0.2 版本 因为它离得太远</span><br><span class="line">-classpath A0.1:D0.1:B0.1:C0.1</span><br><span class="line"></span><br><span class="line">此时就有 bug ,因为你想要的是 C0.2</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="为什么会干掉-C0-2-而不是C0-1"><a href="#为什么会干掉-C0-2-而不是C0-1" class="headerlink" title="为什么会干掉 C0.2,而不是C0.1"></a>为什么会干掉 C0.2,而不是C0.1</h4></blockquote>
<ul>
<li>答案是 <strong>maven就是这样设计的，它不分析语义版本，对于人类我们知道 0.2&gt;0.1,但是maven在设计上的原则是谁离得更近，Gradle的策略是选择版本高的，但这也不是万能的。</strong></li>
<li>很多时候还是要人工介入</li>
</ul>
<blockquote>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4></blockquote>
<ol>
<li><p>强行引入 C0.2版本</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line"></span><br><span class="line">|C0.2</span><br><span class="line"></span><br><span class="line">C0.2 离得比 C0.1近。所以淘汰 C0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>exclusion 排除指定依赖</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">|A 0.1</span><br><span class="line">--|B 0.1</span><br><span class="line">--|--|C 0.2</span><br><span class="line"></span><br><span class="line">|D 0.1</span><br><span class="line">--|C 0.1 </span><br><span class="line">通过 exclusion 来告诉 maven 忽略某个依赖 的子依赖</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;xxx.xxx&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;D&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.1&lt;/version&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;groupId&gt;yyy.yyyy&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;C&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.1&lt;/version&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一个IDEA 插件 <code>maven helper</code></p>
<ul>
<li>能帮你分析当前的依赖树 和被淘汰的依赖标红显示</li>
<li>你想排除指定版本只需要选中依赖 点击 <code>Exclude</code></li>
<li>一目了然帮你看到依赖树</li>
</ul>
</li>
</ol>
<blockquote>
<h4 id="如下依赖谁会被淘汰"><a href="#如下依赖谁会被淘汰" class="headerlink" title="如下依赖谁会被淘汰"></a>如下依赖谁会被淘汰</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|A </span><br><span class="line">--|B </span><br><span class="line">--|--|C0.1</span><br><span class="line"></span><br><span class="line">|D</span><br><span class="line">--|E </span><br><span class="line">----|C0.2</span><br><span class="line"></span><br><span class="line">C0.1 获胜，因为C0.1 路径相同则选择靠前的那个</span><br></pre></td></tr></table></figure>
<h4 id="依赖的-scope"><a href="#依赖的-scope" class="headerlink" title="依赖的 scope"></a>依赖的 scope</h4><blockquote>
<p>实现代码的隔离</p>
</blockquote>
<ul>
<li><code>&lt;scope&gt;test&lt;/scope&gt;</code> 代表只在 src/test目录可见</li>
<li><code>&lt;scope&gt;compile&lt;/scope&gt;</code> 在 src/main 和 src/test 都有效</li>
<li><code>&lt;scope&gt;provided&lt;/scope&gt;</code> 只在编译的时候有效<ol>
<li>我们运行java的时候 右键 run 会先编译，此时会把依赖包在 -classpath 里体现</li>
<li>而在运行的时候 -classpath 不包含依赖包的路径</li>
<li>它的意思就是 编译的时候需要，运行的时候别人帮我提供，你不需要帮我加,防止包冲突。 最经典的就是 tomcat ，你的项目编译后会放在 tomcat容器里，tomcat 会帮你提供这些依赖包<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.2&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="maven-不仅仅是包管理工具还是一个自动化构建工具"><a href="#maven-不仅仅是包管理工具还是一个自动化构建工具" class="headerlink" title="maven 不仅仅是包管理工具还是一个自动化构建工具"></a>maven 不仅仅是包管理工具还是一个自动化构建工具</h3><blockquote>
<p>推荐一本书 Maven实战 google搜 <a href="https://github.com/skyformat99/books-1/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E2%97%8F%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E2%97%8F%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/Maven%E5%AE%9E%E6%88%98.pdf" target="_blank" rel="noopener">Maven实战 site:github.com</a></p>
</blockquote>
<ul>
<li>Maven实战哪些章节是值得看的？<ul>
<li>1 简介可以看看</li>
<li>3.1-3.4 代码是过时的</li>
<li>4 可以看 背景案例也是过时的 看场景</li>
<li>5  </li>
<li>6</li>
<li>7 </li>
<li>8</li>
<li>其他选看</li>
</ul>
</li>
<li>Maven项⽬的基本结构（传世经典）</li>
<li>基本概念：坐标和依赖/⽣命周期/仓库/聚合和继承</li>
<li>使⽤Maven进⾏测试</li>
<li>如果需要开发插件的话：</li>
<li>Maven的插件</li>
</ul>
<h3 id="真实世界中的Maven"><a href="#真实世界中的Maven" class="headerlink" title="真实世界中的Maven"></a>真实世界中的Maven</h3><ul>
<li>分析若⼲真实世界的Maven仓库</li>
<li>pom的含义 <strong>project object model</strong> 项目说明书</li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ol>
<li><a href="https://github.com/hcsp/fix-commons-lang-pom" target="_blank" rel="noopener">修复commons-lang项目的pom文件</a><br> <a href="https://github.com/hcsp/fix-commons-lang-pom/pull/6" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/resolve-package-conflict" target="_blank" rel="noopener">解决包冲突</a><br> <a href="https://github.com/hcsp/resolve-package-conflict/pull/4" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/implement-sem-version" target="_blank" rel="noopener">实现语义化版本</a><br> <a href="https://github.com/hcsp/implement-sem-version/pull/1" target="_blank" rel="noopener">我的pr</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/16/ZB-020-java包管理和maven/" data-id="ckovg9ev401148yjkazzsjbl4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-016-命令行详解02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/15/ZB-016-命令行详解02/" class="article-date">
  <time datetime="2019-07-15T13:41:27.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/15/ZB-016-命令行详解02/">ZB-016-命令行详解02</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="输⼊与输出"><a href="#输⼊与输出" class="headerlink" title="输⼊与输出"></a>输⼊与输出</h3><blockquote>
<p>进程启动之后有三个要素，它们不和任何编程语言绑定，而且任何编程语言里都有这样的概念</p>
</blockquote>
<ul>
<li>标准输⼊ stdin</li>
<li>标准输出 stdout</li>
<li>标准错误 stderr</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Main&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        // 标准输出</span><br><span class="line">        System.out.println(&quot;output&quot;)</span><br><span class="line">        // 标准错误</span><br><span class="line">        System.err.println(&quot;error&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行我们的 java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">javac Main.java &amp;&amp; java Main</span><br><span class="line">输出</span><br><span class="line">output</span><br><span class="line">error</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在操作系统中</p>
</blockquote>
<ul>
<li>stdout 叫做 “文件描述符1”</li>
<li>stderr 叫做 “文件描述符2”</li>
</ul>
<blockquote>
<p>将输出放到文件里</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java Main &gt; output.txt</span><br><span class="line"># 发现少了一行，因为输出默认会把标准输出重定向到文件里</span><br><span class="line">&gt; error </span><br><span class="line"></span><br><span class="line"># 一个 “&gt;” 代表重写覆盖， 两个&quot;&gt;&gt;&quot;代表追加</span><br><span class="line"></span><br><span class="line">重定向的 &quot;&gt;&quot; 默认等价于 &quot;文件描述符1&quot;</span><br><span class="line"></span><br><span class="line"># 执行 文件描述符2</span><br><span class="line">java Main 2&gt; output.txt</span><br><span class="line"># error 写在了 文件里</span><br><span class="line">&gt; output</span><br><span class="line"></span><br><span class="line"># 如何把 标准输出和 标准错误 同时输出到一个文件里</span><br><span class="line">java Main &gt; output 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"># 顺序写反是无效的</span><br><span class="line">java Main &gt; output 1&gt;&amp;2</span><br><span class="line">error</span><br><span class="line"></span><br><span class="line"># 现在会同时打印 标准输出和标准错误， 此时我只想要 标准输出,不要标准错误</span><br><span class="line">java Main 2&gt; /dev/null</span><br><span class="line"># 意思是把 错误输出丢到垃圾桶里</span><br></pre></td></tr></table></figure>
<ul>
<li>输出的重定向<ul>
<li>覆盖⽂件</li>
<li>追加⽂件</li>
<li>改变流向</li>
<li>/dev/null</li>
</ul>
</li>
</ul>
<h4 id="Linux常⽤命令"><a href="#Linux常⽤命令" class="headerlink" title="Linux常⽤命令"></a>Linux常⽤命令</h4><ul>
<li>进⼊⽬录 cd (change directory)</li>
<li>展示⽂件 ls/ll/ls -alth (list)</li>
<li>移动/重命名⽂件 mv (move)</li>
<li>删除⽂件 rm/rm -r/rm -rf (remove)</li>
<li>拷⻉⽂件 cp/cp -r (copy)</li>
<li>显示变量 echo</li>
<li>导出变量 export</li>
<li>Git系列操作 git pull/push/add/commit/…</li>
</ul>
<h4 id="Linux常⽤命令-1"><a href="#Linux常⽤命令-1" class="headerlink" title="Linux常⽤命令"></a>Linux常⽤命令</h4><ul>
<li>新建⽬录 mkdir/mkdir -p (make directory)</li>
<li>当前⽬录 pwd (print working directory)</li>
<li>显示⽂件 cat (concatenate and print files)</li>
<li>编辑⽂件 vi</li>
</ul>
<h4 id="怎么才能掌握命令行？"><a href="#怎么才能掌握命令行？" class="headerlink" title="怎么才能掌握命令行？"></a>怎么才能掌握命令行？</h4><blockquote>
<p>以下方式逐级晋升</p>
</blockquote>
<ul>
<li>⾃⼰对着书敲命令</li>
<li>尽可能地在开发中使⽤命令⾏</li>
<li>vi/git/mkdir, etc.</li>
<li>使⽤命令⾏的各种⼩⼯具</li>
<li>开发命令⾏的程序</li>
<li>⾃⾏在云服务器上开发部署博客</li>
<li>⾃⾏在云服务器上进⾏持续集成实战</li>
<li>⽇常使⽤Linux进⾏开发</li>
</ul>
<h4 id="使用命令编译java程序"><a href="#使用命令编译java程序" class="headerlink" title="使用命令编译java程序"></a>使用命令编译java程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 环境变量 </span><br><span class="line">System.getenv(&quot;aaa&quot;)</span><br><span class="line"></span><br><span class="line">// 系统属性 只在 jvm 中有效</span><br><span class="line">System.getProperty(&quot;xxx&quot;)</span><br><span class="line">System.getProperty(&quot;java.version&quot;)</span><br><span class="line">System.getProperty(&quot;user.dir&quot;)</span><br></pre></td></tr></table></figure>
<p>Main.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Main&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;args:&quot;+ java.util.Arrays.toString(args));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;env:&quot;+System.getenv(&quot;AAA&quot;));</span><br><span class="line">        </span><br><span class="line">        System.out.println(&quot;java version:&quot;+System.getProperty(&quot;java.version&quot;));</span><br><span class="line">        // System.getProperty(&quot;user.dir&quot;)</span><br><span class="line"></span><br><span class="line">         System.out.println(&quot;system property:&quot;+System.getProperty(&quot;BBB&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">javac Main.java &amp;&amp; java Main 1 2 3</span><br><span class="line"></span><br><span class="line">args:[1,2,3]</span><br><span class="line">env: null</span><br><span class="line">java version:1.8.0...</span><br><span class="line">system property:null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 传递 系统属性</span><br><span class="line">export AAA=123</span><br><span class="line">java -DBBB=789 Main </span><br><span class="line"></span><br><span class="line">args:[]</span><br><span class="line">env: 123</span><br><span class="line">java version:1.8.0...</span><br><span class="line">system property:789</span><br></pre></td></tr></table></figure>
<h5 id="D-的顺序有要求"><a href="#D-的顺序有要求" class="headerlink" title="-D 的顺序有要求"></a><code>-D</code> 的顺序有要求</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">javac -DBBB=789 Main</span><br><span class="line">args:[]</span><br><span class="line">env: 123</span><br><span class="line">java version:1.8.0...</span><br><span class="line">system property:789</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">javac  Main -DBBB=789</span><br><span class="line">args:[-DBBB=789]</span><br><span class="line">env: 123</span><br><span class="line">java version:1.8.0...</span><br><span class="line">system property:null</span><br></pre></td></tr></table></figure>
<h5 id="classpath应用"><a href="#classpath应用" class="headerlink" title="classpath应用"></a>classpath应用</h5><p>假如我们的<code>Main.java</code> 里 用了第三方包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java Main 报错 class not found</span><br><span class="line"></span><br><span class="line">javac -classpath common-lang3-3.9.jar Main.java</span><br><span class="line">java Main </span><br><span class="line">// 报错，意思只在 common-lang3-3.9.jar 的目录里找不在当前目录找</span><br><span class="line"></span><br><span class="line">还可以简写</span><br><span class="line">java -cp common-lang3-3.9.jar Main</span><br><span class="line"></span><br><span class="line"># 正确写法 除了在 common-lang3-3.9.jar 找还在 当前目录找</span><br><span class="line">java -cp common-lang3-3.9.jar:. Main</span><br></pre></td></tr></table></figure>
<h4 id="在看IDEA里运行main的时候启动时的命令行"><a href="#在看IDEA里运行main的时候启动时的命令行" class="headerlink" title="在看IDEA里运行main的时候启动时的命令行"></a>在看IDEA里运行main的时候启动时的命令行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/bin/java &quot;-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=51272:/Applications/IntelliJ IDEA.app/Contents/bin&quot; -Dfile.encoding=UTF-8 -classpath /Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/deploy.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/cldrdata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/dnsns.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jaccess.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/jfxrt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/localedata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/nashorn.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunec.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/ext/zipfs.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/javaws.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jfxswt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/management-agent.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/plugin.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/resources.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/jre/lib/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/dt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/javafx-mx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/jconsole.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/packager.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/sa-jdi.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_191.jdk/Contents/Home/lib/tools.jar:/Users/huangjiaxi/Desktop/java-fork-process/target/classes com.github.hcsp.shell.Fork</span><br></pre></td></tr></table></figure>
<h3 id="java-中-fork进程"><a href="#java-中-fork进程" class="headerlink" title="java 中 fork进程"></a>java 中 fork进程</h3><ul>
<li><a href="https://github.com/hcsp/java-fork-process" target="_blank" rel="noopener">代码仓库</a></li>
<li><a href="https://github.com/hcsp/java-fork-process/pull/7" target="_blank" rel="noopener">pr</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.shell;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.file.Path;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class Fork &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        // 请在这里使用Java代码fork一个子进程，将fork的子进程的标准输出重定向到指定文件：工作目录下名为output.txt的文件</span><br><span class="line">        // 工作目录是项目目录下的working-directory目录（可以用getWorkingDir()方法得到这个目录对应的File对象）</span><br><span class="line">        // 传递的命令是sh run.sh</span><br><span class="line">        // 环境变量是AAA=123</span><br><span class="line"></span><br><span class="line">        // 1. 可执行程序 2。 参数</span><br><span class="line">        ProcessBuilder pb = new ProcessBuilder(&quot;sh&quot;,&quot;run.sh&quot;);</span><br><span class="line">        // 3。 工作路径</span><br><span class="line">        pb.directory(getWorkingDir());</span><br><span class="line">        // 4。 设置环境变量</span><br><span class="line">        Map&lt;String,String&gt; envs = pb.environment();</span><br><span class="line">        envs.put(&quot;AAA&quot;,&quot;123&quot;);</span><br><span class="line"></span><br><span class="line">        // 把系统输入输出 继承到当前的进程中来</span><br><span class="line">        // pb.inheritIO();</span><br><span class="line"></span><br><span class="line">        // 将输出内容重定向到文件</span><br><span class="line">        pb.redirectOutput(getOutputFile());</span><br><span class="line"></span><br><span class="line">        pb.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static File getWorkingDir() &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        return projectDir.resolve(&quot;working-directory&quot;).toFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static File getOutputFile() &#123;</span><br><span class="line">        return new File(getWorkingDir(), &quot;output.txt&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ol>
<li><a href="https://github.com/hcsp/practise-shell-commands" target="_blank" rel="noopener">Linux命令</a><br> <a href="https://github.com/hcsp/practise-shell-commands/pull/7" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/practise-java-commands" target="_blank" rel="noopener">java命令</a><br> <a href="https://github.com/hcsp/practise-java-commands/pull/4" target="_blank" rel="noopener">我的pr</a></li>
<li><a href="https://github.com/hcsp/java-fork-process" target="_blank" rel="noopener">使用Java代码fork子进程</a><br> <a href="https://github.com/hcsp/java-fork-process/pull/7" target="_blank" rel="noopener">我的pr</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/15/ZB-016-命令行详解02/" data-id="ckovg9ev201108yjkpuz4ufle" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-016-命令行详解01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/15/ZB-016-命令行详解01/" class="article-date">
  <time datetime="2019-07-15T12:08:57.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/15/ZB-016-命令行详解01/">ZB-016-命令行详解01</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="什么是命令行"><a href="#什么是命令行" class="headerlink" title="什么是命令行"></a>什么是命令行</h3><blockquote>
<p>什么是 Kernel</p>
</blockquote>
<p>负责和计算机硬件交互的，负责CPU调度和进程相关的调度/IO之类的操作。操作系统最底层</p>
<blockquote>
<p>我们如何操作内核呢？</p>
</blockquote>
<p>Linux 通过命令行里(终端)来与内核进行交互</p>
<p>通过命令行操作内核的过程 叫做 Shell</p>
<ul>
<li>Kernel(内核) 与 Shell(壳)</li>
<li>广义的命令行一切通过字符终端控制计算机的方式<ul>
<li>Windows cmd/PowerShell/Git bash</li>
<li>UNIX/Linux系列 sh/zsh/Terminal etc</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么需要 Shell</p>
</blockquote>
<ul>
<li>因为你不能直接和操作系统内核进行交互</li>
</ul>
<h3 id="为什么需要命令行"><a href="#为什么需要命令行" class="headerlink" title="为什么需要命令行"></a>为什么需要命令行</h3><ul>
<li>因为你不得不用<ul>
<li>几乎所有的服务器都运行在 linux 上 </li>
</ul>
</li>
<li>将工作自动化<ul>
<li>自动化是一切生产力的来源(提高生产力)</li>
<li>你一台机子需要 点点点操作，10000台呢？</li>
</ul>
</li>
<li>相比GUI,命令行更容易开发和维护<ul>
<li>bug少</li>
</ul>
</li>
<li>远程连接命令行占用资源远远低于GUI</li>
<li>命令行上的开发者工具更丰富</li>
</ul>
<h3 id="命令行的历史和流派"><a href="#命令行的历史和流派" class="headerlink" title="命令行的历史和流派"></a>命令行的历史和流派</h3><ul>
<li>UNIX家族<ul>
<li>POSIX标准</li>
<li>macOS </li>
<li>Linux</li>
<li>Windows Subsystem for Linux</li>
</ul>
</li>
<li>Windows<ul>
<li>奇葩</li>
</ul>
</li>
</ul>
<blockquote>
<p>Windows 和 UNIX 系统的区别</p>
</blockquote>
<ul>
<li>UNIX遵循<strong>POSIX标准</strong>，只要遵循POSIX标准就可以以同样的方式工作<ul>
<li>默认命令行交互</li>
<li>GUI只是个扩展</li>
<li>只有一个盘符</li>
</ul>
</li>
<li>Windows<ul>
<li>GUI主要</li>
<li>命令行是扩展的(导致命令行在windows上是个残废)</li>
<li>多个盘符 cdef</li>
</ul>
</li>
</ul>
<blockquote>
<p>如何安装 windows 的 linux 子系统</p>
</blockquote>
<ul>
<li>搜索 Windows Subsystem for Linux </li>
</ul>
<h3 id="命令的全部要素"><a href="#命令的全部要素" class="headerlink" title="命令的全部要素"></a>命令的全部要素</h3><ul>
<li>可执⾏程序（Executable）</li>
<li>参数</li>
<li>环境变量（Environment variable）</li>
<li>⼯作⽬录（Working directory）<ul>
<li>启动命令的路径</li>
<li>相对路径都是相对于这个路径</li>
<li>在Java中的应⽤</li>
</ul>
</li>
</ul>
<p><strong>以上四个要素相同，就可以完全地“重现”⼀个命令</strong></p>
<p><strong>你碰到的各种各样古怪的问题，原因⼀定是上述四个要素之⼀</strong></p>
<blockquote>
<p>可执行程序和参数</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -al </span><br><span class="line"># ls就是可执行程序</span><br><span class="line"># -al就是参数</span><br></pre></td></tr></table></figure>
<blockquote>
<p>工作目录</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd 就是当前的目录</span><br></pre></td></tr></table></figure>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><ul>
<li>进程（Process）<ul>
<li>进程是计算机程序运⾏的最⼩单位</li>
<li>独占⾃⼰的内存空间和⽂件资源</li>
</ul>
</li>
<li><p>每个进程都和⼀组变量相绑定</p>
<ul>
<li><p>传递不同的环境变量可以让程序表现出不同的⾏为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 当前终端里</span><br><span class="line">export aa=1</span><br><span class="line"></span><br><span class="line"># 当前终端进入node环境</span><br><span class="line">node</span><br><span class="line"># 获取环境变量</span><br><span class="line">&gt; process.env.aa</span><br><span class="line"># 输出 &apos;1&apos;</span><br><span class="line">&apos;1&apos;</span><br><span class="line"></span><br><span class="line"># 此时新开一个终端</span><br><span class="line">node</span><br><span class="line">&gt; process.env.aa</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure>
</li>
<li><p>CLASSPATH/GOPATH</p>
</li>
</ul>
</li>
<li>在进程的fork过程中，环境变量可以被完全继承(fork 就是生进程的过程)</li>
<li>所有的操作系统/编程语⾔都⽀持环境变量</li>
<li>局部和全局的环境变量</li>
</ul>
<blockquote>
<p>进程是那里来的</p>
</blockquote>
<ul>
<li>进程是它爹生的，最开始系统启动的时候只有一个进程，在 Linux 中叫做 init进程，它生了一堆孩子 桌面/终端 </li>
<li>在终端里输入 node 就导致 终端产生一个孩子 node进程</li>
<li>这就形成了一棵树——进程树</li>
<li>环境变量会一级一级的向下继承</li>
<li>意思是 父进程里有一个环境变量 a=1 那么它的子进程也有这个 a=1</li>
</ul>
<h4 id="环境变量实战"><a href="#环境变量实战" class="headerlink" title="环境变量实战"></a>环境变量实战</h4><ul>
<li>通过export/set设置环境变量，通过echo读取环境变量</li>
<li>从Java/Go/Python/Node.js中读取环境变量</li>
<li><p>向Docker容器传递环境变量</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -e 代表环境变量</span><br><span class="line">docker run -it -e AAA=1 ubuntu</span><br></pre></td></tr></table></figure>
</li>
<li><p>快速传递⼀个环境变量</p>
</li>
<li>使⽤环境变量控制程序的⾏为</li>
</ul>
<blockquote>
<p>java中读取环境变量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Main&#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(System.getenv(&quot;aa&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>局部和全局的环境变量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 只在当前终端里有效，新开 终端无效</span><br><span class="line">export a = 1</span><br><span class="line"></span><br><span class="line"># 只对当前的命令有效</span><br><span class="line">a=1 node aa.js</span><br><span class="line"></span><br><span class="line"># 全局的环境变量</span><br><span class="line"># 编辑你的 ~/.bash_profile </span><br><span class="line">vi ~/.bash_profile </span><br><span class="line"># 输入如下内容</span><br><span class="line">export aaa = 123456</span><br><span class="line"></span><br><span class="line"># 然后新开终端输入</span><br><span class="line">echo $aaa</span><br><span class="line"></span><br><span class="line"># 你可能遇到，为什么刚改了现在没生效</span><br><span class="line"># 你要 source 一下</span><br><span class="line">source ~/.bash_profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注意！！！ bash_profile只对 bash有效 </span><br><span class="line"># 注意！！！ bash_profile只对 bash有效 </span><br><span class="line"># 注意！！！ bash_profile只对 bash有效 </span><br><span class="line"></span><br><span class="line">取决于你用的终端是 bash 还是 zsh</span><br></pre></td></tr></table></figure>
<h3 id="可执⾏程序"><a href="#可执⾏程序" class="headerlink" title="可执⾏程序"></a>可执⾏程序</h3><ul>
<li>Windows：exe/bat/com</li>
<li>UNIX/Linux：x权限 - 可执⾏权限</li>
<li><p>去哪⾥找程序？</p>
<ul>
<li>Windows：Path环境变量 + 当前⽬录</li>
<li>UNIX/Linux：PATH环境变量 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo $PATH</span><br><span class="line"></span><br><span class="line">/Users/huangjiaxi/flutter/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/huangjiaxi/Desktop/soft/apache-maven-3.6.1/bin</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>在脚本的第⼀⾏指定解释器（shebang）</p>
</li>
<li>别名（alias）</li>
</ul>
<blockquote>
<p>设置环境变量</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># windows</span><br><span class="line">set ABC=123</span><br><span class="line">echo %ABC%</span><br><span class="line"></span><br><span class="line"># linux</span><br><span class="line">export ABC=123</span><br><span class="line">echo $ABC</span><br></pre></td></tr></table></figure>
<blockquote>
<p>初学命令行的困扰</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 执行命令时，windows会在 PATH 和 当前目录里找，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 而 linux 只会在 PATH 里找</span><br><span class="line"># 假设当前目录有 main 脚本</span><br><span class="line"># 直接 main 不会执行 因为 linux 只会在 PATH里找</span><br><span class="line">./main 才执行</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如何执行一个文本文件</p>
</blockquote>
<p><code>echo.sh</code> 内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo 123</span><br><span class="line">echo 456</span><br></pre></td></tr></table></figure>
<p>分配执行权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 echo.sh</span><br><span class="line"></span><br><span class="line"># 执行你的脚本</span><br><span class="line">./echo.sh</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="写一个-node脚本"><a href="#写一个-node脚本" class="headerlink" title="写一个 node脚本"></a>写一个 node脚本</h4></blockquote>
<p><code>echo.sh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.log(123);</span><br><span class="line">console.log(456);</span><br></pre></td></tr></table></figure>
<p>但是操作系统不认识 node！！！</p>
<p><strong>教操作系统认识node</strong></p>
<ul>
<li><a href="https://stackoverflow.com/questions/24253027/node-and-shebang-help-executing-via-command-line" target="_blank" rel="noopener">搜索 node shebang</a></li>
</ul>
<p><code>echo.sh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br><span class="line">console.log(123);</span><br><span class="line">console.log(456);</span><br></pre></td></tr></table></figure>
<p>shell的约定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shell中 “#” 代表注释</span><br><span class="line"></span><br><span class="line">首行 代表指定当前的文件由谁来解释和执行</span><br><span class="line"># 从当前的上下文环境中查找 node 命令</span><br><span class="line">#!/usr/bin/env node</span><br><span class="line"></span><br><span class="line">为什么不推荐写绝对路径，因为你不知道别人的node是不是安装在这个路径</span><br><span class="line">#!/usr/local/bin/node</span><br></pre></td></tr></table></figure>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>UNIX参数的约定——然鹅Java并不⻦这个约定</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">‘-’ 约定</span><br><span class="line">ls -alth</span><br><span class="line"># 约定，以一个 ‘-’ 开头的可以 -a -l -t -h 也可以合并为 -alth</span><br><span class="line"># 意思就是 &apos;-&apos; 后面跟一个字符</span><br><span class="line"></span><br><span class="line">&apos;--&apos; 约定 后面跟单词</span><br><span class="line">ls -a &lt;==&gt; ls --all</span><br><span class="line">git push -f &lt;==&gt; git push --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但是 java 不遵守这个</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数中包含空格或者字符串</p>
<ul>
<li>单引号</li>
<li>双引号</li>
</ul>
</li>
<li>参数的展开</li>
</ul>
<blockquote>
<h4 id="坑人的-单双引号"><a href="#坑人的-单双引号" class="headerlink" title="坑人的 单双引号"></a>坑人的 单双引号</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 当前环境里没有 A 变量，运行正常</span><br><span class="line">javap Main$A.class</span><br><span class="line"></span><br><span class="line"># 此时 </span><br><span class="line">export A=123</span><br><span class="line">javap Main$A.class 报错了</span><br><span class="line">实际执行的是  javap Main123.class</span><br><span class="line"></span><br><span class="line"># 默认情况下 “$” 是把命令展开的符号</span><br><span class="line"></span><br><span class="line"># 通过单引号来包裹它，运行正常，除了可以让多个空格分开的字符串连接在一起，还可以告诉命令行 里面的内容全不要替换</span><br><span class="line">javap &apos;Main$A.class&apos; </span><br><span class="line"></span><br><span class="line"># 换个 &quot;双引号&quot; 试试</span><br><span class="line">javap &quot;Main$A.class&quot;</span><br><span class="line"></span><br><span class="line">双引号会把 里面的变量展开 ==&gt; javap Main$123.class</span><br><span class="line"></span><br><span class="line"># 想给程序传递 单引号怎么办？</span><br><span class="line"># 包双引号</span><br><span class="line">./main &quot;&apos;I am a boy&apos;&quot;</span><br><span class="line"># 转义</span><br><span class="line">./main \&apos;I am a boy\&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="扩展的参数"><a href="#扩展的参数" class="headerlink" title="扩展的参数"></a>扩展的参数</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ls *.java</span><br><span class="line">此时会把所有 .java扩展名的文件罗列出来</span><br><span class="line"></span><br><span class="line"># 如何想不被扩展原样执行呢？</span><br><span class="line"></span><br><span class="line">ls &apos;*.java&apos;</span><br><span class="line"></span><br><span class="line"># * 代表通配符 默认会展开，如果你不想它自动扩展 就包含 单引号</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/15/ZB-016-命令行详解01/" data-id="ckovg9ev1010x8yjkrj6xvho5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-014-java接口和抽象类02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/10/ZB-014-java接口和抽象类02/" class="article-date">
  <time datetime="2019-07-10T13:39:39.000Z" itemprop="datePublished">2019-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/10/ZB-014-java接口和抽象类02/">ZB-014-java接口和抽象类02</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Comparable-接口"><a href="#Comparable-接口" class="headerlink" title="Comparable 接口"></a>Comparable 接口</h3><ul>
<li><a href="https://www.cnblogs.com/skywang12345/p/3324788.html" target="_blank" rel="noopener">Java 中 Comparable 和 Comparator 比较</a></li>
<li><p><a href="https://blog.csdn.net/wilson27/article/details/90339765" target="_blank" rel="noopener">java中compareable和comparator的区别，比较器实现的原理！</a></p>
</li>
<li><p>JDK 比较重要的约定——<strong>可比较性</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class User&#123;</span><br><span class="line">    int id;</span><br><span class="line">    String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如何进行比较？</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface Comparable&lt;T&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Compares this object with the specified object for order.  Returns a</span><br><span class="line">     * negative integer, zero, or a positive integer as this object is less</span><br><span class="line">     * than, equal to, or greater than the specified object.</span><br><span class="line">        ...</span><br><span class="line">     */</span><br><span class="line">    public int compareTo(T o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>natural ordering 自然顺序(从小到大)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a &lt; b 返回 -1</span><br><span class="line">a &gt; b 返回 1 </span><br><span class="line">a = b 返回 0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实战</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Point implements Comparable&lt;Point&gt;&#123;</span><br><span class="line"></span><br><span class="line">    private final int x;</span><br><span class="line">    private final int y;</span><br><span class="line">    // 代表笛卡尔坐标系中的一个点</span><br><span class="line">    public Point(int x, int y) &#123;</span><br><span class="line">        this.x = x;</span><br><span class="line">        this.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getX() &#123;</span><br><span class="line">        return x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getY() &#123;</span><br><span class="line">        return y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (this == o) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        if (o == null || getClass() != o.getClass()) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Point point = (Point) o;</span><br><span class="line"></span><br><span class="line">        if (x != point.x) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return y == point.y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        int result = x;</span><br><span class="line">        result = 31 * result + y;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return String.format(&quot;(%d,%d)&quot;, x, y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 按照先x再y，从小到大的顺序排序</span><br><span class="line">    // 例如排序后的结果应该是 (-1, 1) (1, -1) (2, -1) (2, 0) (2, 1)</span><br><span class="line">    public static List&lt;Point&gt; sort(List&lt;Point&gt; points) &#123;</span><br><span class="line">        Collections.sort(points);</span><br><span class="line">        return points;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        List&lt;Point&gt; points =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        new Point(2, 0),</span><br><span class="line">                        new Point(-1, 1),</span><br><span class="line">                        new Point(1, -1),</span><br><span class="line">                        new Point(2, 1),</span><br><span class="line">                        new Point(2, -1));</span><br><span class="line">        System.out.println(Point.sort(points));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int compareTo(Point that) &#123;</span><br><span class="line">        // 比较 this 和 that</span><br><span class="line">        if(this.x &lt; that.x)&#123;</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;else if(this.x &gt; that.x)&#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 运行到此说明 this.x = that.x</span><br><span class="line">        // 因此我要可以进行 y 的排序</span><br><span class="line">        if(this.y &lt; that.y)&#123;</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;else if(this.y &gt; that.y)&#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>一个坑的地方千万不要这样比较 <code>return this.x - that.x;</code> <ul>
<li>记得<strong>溢出</strong>吗？ </li>
<li>两个数相减，不一定是你想要的那个数，同理两数相加也是一个道理</li>
</ul>
</li>
<li><code>Comparable</code> 实际也是策略模式，由你来决定策略的各种条件</li>
<li><a href="https://github.com/hcsp/sort-by-multiple-fields" target="_blank" rel="noopener">参考练习</a></li>
<li><a href="https://github.com/hcsp/sort-by-multiple-fields/pull/10" target="_blank" rel="noopener">我的pr</a></li>
</ul>
<blockquote>
<h4 id="另一个坑，注意Comparable在TreeSet中的坑"><a href="#另一个坑，注意Comparable在TreeSet中的坑" class="headerlink" title="另一个坑，注意Comparable在TreeSet中的坑"></a>另一个坑，注意<code>Comparable</code>在<code>TreeSet</code>中的坑</h4></blockquote>
<ul>
<li>Set 它是一个 无重复元素的集合</li>
<li>而你对<code>TreeSet</code> 排序时候也就是实现<code>Comparable</code> 接口的，而调用<code>compareTo</code>时候<ul>
<li>一旦 <code>o1.id = o2.id 导致compareTo 返回 0</code> 这样就会<strong>丢失元素</strong></li>
<li><code>compareTo</code>不要返回0，否则一定踩到坑</li>
</ul>
</li>
<li><a href="https://github.com/hcsp/fix-comparable-bug" target="_blank" rel="noopener">TreeSet排序丢失元素的bug</a></li>
<li><a href="https://github.com/hcsp/fix-comparable-bug/pull/8" target="_blank" rel="noopener">我的pr</a>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public class User implements Comparable&lt;User&gt; &#123;</span><br><span class="line">    /** 用户ID，数据库主键，全局唯一 */</span><br><span class="line">    private final Integer id;</span><br><span class="line"></span><br><span class="line">    /** 用户名 */</span><br><span class="line">    private final String name;</span><br><span class="line"></span><br><span class="line">    public User(Integer id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (this == o) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        if (o == null || getClass() != o.getClass()) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        User person = (User) o;</span><br><span class="line"></span><br><span class="line">        return Objects.equals(id, person.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int hashCode() &#123;</span><br><span class="line">        return id != null ? id.hashCode() : 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** 老板说让我按照用户名排序 */</span><br><span class="line">    @Override</span><br><span class="line">    public int compareTo(User o) &#123;</span><br><span class="line">        if(name == o.name)&#123;</span><br><span class="line">            return id.compareTo(o.id);</span><br><span class="line">        &#125;</span><br><span class="line">        return name.compareTo(o.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;User&gt; users =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        new User(100, &quot;b&quot;),</span><br><span class="line">                        new User(10, &quot;z&quot;),</span><br><span class="line">                        new User(1, &quot;a&quot;),</span><br><span class="line">                        new User(2000, &quot;a&quot;));</span><br><span class="line">        TreeSet&lt;User&gt; treeSet = new TreeSet&lt;&gt;(users);</span><br><span class="line">        // 为什么这里的输出是3？试着修复其中的bug</span><br><span class="line">        System.out.println(treeSet.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    /** 用户ID，数据库主键，全局唯一 */</span><br><span class="line">    private final Integer id;</span><br><span class="line"></span><br><span class="line">    /** 用户名 */</span><br><span class="line">    private final String name;</span><br><span class="line"></span><br><span class="line">    public User(Integer id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤ID为偶数的用户</span><br><span class="line">    public static List&lt;User&gt; filterUsersWithEvenId(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            if (user.id % 2 == 0) &#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓张的用户</span><br><span class="line">    public static List&lt;User&gt; filterZhangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            if (user.name.startsWith(&quot;张&quot;)) &#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓王的用户</span><br><span class="line">    public static List&lt;User&gt; filterWangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            if (user.name.startsWith(&quot;王&quot;)) &#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line">    // 你可以发现，在上面三个函数中包含大量的重复代码。</span><br><span class="line">    // 请尝试通过Predicate接口将上述代码抽取成一个公用的过滤器函数</span><br><span class="line">    // 并简化上面三个函数</span><br><span class="line">    public static List&lt;User&gt; filter(List&lt;User&gt; users, Predicate&lt;User&gt; predicate) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用策略模式 和 匿名内部类 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    /** 用户ID，数据库主键，全局唯一 */</span><br><span class="line">    private final Integer id;</span><br><span class="line"></span><br><span class="line">    /** 用户名 */</span><br><span class="line">    private final String name;</span><br><span class="line"></span><br><span class="line">    public User(Integer id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 你可以发现，在上面三个函数中包含大量的重复代码。</span><br><span class="line">    // 请尝试通过Predicate接口将上述代码抽取成一个公用的过滤器函数</span><br><span class="line">    // 并简化上面三个函数</span><br><span class="line">    public static List&lt;User&gt; filter(List&lt;User&gt; users, 判断条件是否成立 条件) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user: users) &#123;</span><br><span class="line">            if(条件.这个用户是否满足条件(user))&#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private interface 判断条件是否成立 &#123;</span><br><span class="line">        boolean 这个用户是否满足条件(User user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class 用户ID是偶数的条件 implements 判断条件是否成立&#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean 这个用户是否满足条件(User user) &#123;</span><br><span class="line">            return user.id % 2 == 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;User&gt; res = filterUsersWithEvenId(Arrays.asList(new User(1,&quot;a&quot;),new User(2,&quot;b&quot;)));</span><br><span class="line">        System.out.println(res);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; res2 =  filterZhangUsers(Arrays.asList(new User(1,&quot;张三&quot;),new User(2,&quot;李四&quot;)));</span><br><span class="line">        System.out.println(res2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤ID为偶数的用户(接口实现类的实例)</span><br><span class="line">    public static List&lt;User&gt; filterUsersWithEvenId(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        return filter(users,new 用户ID是偶数的条件());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓张的用户(匿名内部类)</span><br><span class="line">    public static List&lt;User&gt; filterZhangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        return filter(users, new 判断条件是否成立() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean 这个用户是否满足条件(User user) &#123;</span><br><span class="line">                return user.name.startsWith(&quot;张&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓王的用户</span><br><span class="line">    public static List&lt;User&gt; filterWangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user : users) &#123;</span><br><span class="line">            if (user.name.startsWith(&quot;王&quot;)) &#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><code>Predicate</code></strong></p>
</blockquote>
<ul>
<li>判定</li>
<li>接口内部只有一个方法，返回值是boolean</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.function.Predicate;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line">    /** 用户ID，数据库主键，全局唯一 */</span><br><span class="line">    private final Integer id;</span><br><span class="line"></span><br><span class="line">    /** 用户名 */</span><br><span class="line">    private final String name;</span><br><span class="line"></span><br><span class="line">    public User(Integer id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 你可以发现，在上面三个函数中包含大量的重复代码。</span><br><span class="line">    // 请尝试通过Predicate接口将上述代码抽取成一个公用的过滤器函数</span><br><span class="line">    // 并简化上面三个函数</span><br><span class="line">    public static List&lt;User&gt; filter(List&lt;User&gt; users, Predicate&lt;User&gt; predicate) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        for (User user: users) &#123;</span><br><span class="line">            if(predicate.test(user))&#123;</span><br><span class="line">                results.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        List&lt;User&gt; res = filterUsersWithEvenId(Arrays.asList(new User(1,&quot;a&quot;),new User(2,&quot;b&quot;)));</span><br><span class="line">        System.out.println(res);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; res2 =  filterZhangUsers(Arrays.asList(new User(1,&quot;张三&quot;),new User(2,&quot;李四&quot;)));</span><br><span class="line">        System.out.println(res2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤ID为偶数的用户</span><br><span class="line">    public static List&lt;User&gt; filterUsersWithEvenId(List&lt;User&gt; users) &#123;</span><br><span class="line">        List&lt;User&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">        return filter(users, new Predicate&lt;User&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(User user) &#123;</span><br><span class="line">                return user.id % 2 == 0 ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓张的用户 lambda 表达式</span><br><span class="line">    public static List&lt;User&gt; filterZhangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        return filter(users, user -&gt; user.name.startsWith(&quot;张&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 过滤姓王的用户</span><br><span class="line">    public static List&lt;User&gt; filterWangUsers(List&lt;User&gt; users) &#123;</span><br><span class="line">        return filter(users, user -&gt; user.name.startsWith(&quot;王&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/hcsp/refactor-filters" target="_blank" rel="noopener">代码仓库</a></li>
<li><a href="https://github.com/hcsp/refactor-filters/pull/9" target="_blank" rel="noopener">pr</a></li>
</ul>
<h3 id="内部类详解"><a href="#内部类详解" class="headerlink" title="内部类详解"></a>内部类详解</h3><h4 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h4><ul>
<li>用途：实现更加精细的封装</li>
<li>可以访问外围类的实例方法</li>
<li>非静态内部类<ul>
<li>和一个外围类实例相绑定</li>
<li>可以访问外围类实例的方法</li>
</ul>
</li>
<li>静态内部类<ul>
<li>不和外围类实例绑定</li>
<li>不可以访问外围实例的方法</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class Home &#123;</span><br><span class="line">    void log()&#123;</span><br><span class="line">        System.out.println(111);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new B(new Home()).xx();</span><br><span class="line">    &#125;</span><br><span class="line">    static class B&#123;</span><br><span class="line"></span><br><span class="line">        Home home;</span><br><span class="line">        // 通过构造器把外围类的实例注入到内部类来，使得静态内部类可以调用外围类的实例方法</span><br><span class="line">        B(Home home)&#123;</span><br><span class="line">            this.home = home;</span><br><span class="line">        &#125;</span><br><span class="line">        void xx()&#123;</span><br><span class="line">            home.log();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class C&#123;</span><br><span class="line">        //编译器偷偷帮你注入一个 外围类的实例/对象</span><br><span class="line">        // private Home this$0;</span><br><span class="line">        // 这就是为什么非静态的内部类可以访问外部类的秘密所在</span><br><span class="line">        &#123;</span><br><span class="line">            log();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="静态内部类和非静态内部类使用的原则"><a href="#静态内部类和非静态内部类使用的原则" class="headerlink" title="静态内部类和非静态内部类使用的原则"></a>静态内部类和非静态内部类使用的原则</h4></blockquote>
<ul>
<li>永远使用静态内部类，否则编译报错<ul>
<li>因为使用非静态内部类，编译器偷偷帮你注入一个 this$0的外围类实例，这个对象会占用空间的，如果不用，就浪费类空间</li>
</ul>
</li>
</ul>
<h4 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Home &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 匿名内部类</span><br><span class="line">        new Predicate&lt;Object&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(Object o) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 匿名相当于</span><br><span class="line">class XXXX implements Predicate&lt;Object&gt;&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean test(Object o) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>好处就是非常的短小，逻辑紧密结合</li>
<li>可以访问外围类的成员</li>
<li>还可以变成 lambda 表达式</li>
</ul>
<blockquote>
<p>匿名类最后会变成什么</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class Home &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 匿名内部类</span><br><span class="line">        new Predicate&lt;Object&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(Object o) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        new Predicate&lt;Object&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(Object o) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        new Predicate&lt;Object&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean test(Object o) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 此时三个匿名内部类就会变成</span><br><span class="line"></span><br><span class="line">Home$1.class</span><br><span class="line">Home$2.class</span><br><span class="line">Home$3.class</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/10/ZB-014-java接口和抽象类02/" data-id="ckovg9euy010s8yjkzjsz3lqk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-014-java接口和抽象类01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/09/ZB-014-java接口和抽象类01/" class="article-date">
  <time datetime="2019-07-09T12:54:18.000Z" itemprop="datePublished">2019-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/09/ZB-014-java接口和抽象类01/">ZB-014-java接口和抽象类</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="https://sltrust.github.io/2019/05/14/Java-010-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%BA%8C/" target="_blank" rel="noopener">参考链接</a></li>
</ul>
<h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><ul>
<li>不可实例化<ul>
<li>反证法：假如我们允许实例化抽象类的实例，那么该实例调用抽象方法是怎样的？没有方法体？</li>
</ul>
</li>
<li>可以实例化的东西一定要补全所有的方法体</li>
<li>可以包含抽象方法</li>
<li>可以包含成员变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Animal&#123;</span><br><span class="line">    public abstract void 跑();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Bird extends Animal&#123;</span><br><span class="line">    public void 跑()&#123;</span><br><span class="line">        // 跑的实现逻辑</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><ul>
<li>接口部分的实现了多继承</li>
<li>接口不是类</li>
<li>接口的扩展</li>
<li>接口只代表一种功能</li>
<li>一个类只能继承一个类，但是却能实现若干的接口</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface Aaa &#123;</span><br><span class="line">    // 接口里的成员默认是 public static final </span><br><span class="line">    </span><br><span class="line">    /*</span><br><span class="line">    int a = 1;</span><br><span class="line">    等价于</span><br><span class="line">    public static final  int a = 1;</span><br><span class="line">    而我们知道 final的应该大写</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    // 所以正确的写法应该是</span><br><span class="line">    int A = 1; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="接口可以包含什么"><a href="#接口可以包含什么" class="headerlink" title="接口可以包含什么"></a>接口可以包含什么</h4><ul>
<li>若干个方法(默认 public)</li>
<li>若干个常量(默认 public static final)</li>
<li>extends 接口</li>
<li>默认方法<ul>
<li>Since Java8</li>
<li>一种妥协的产物</li>
<li>可以用来实现 minxin</li>
<li>菱形继承</li>
</ul>
</li>
</ul>
<blockquote>
<p>在经典的接口里，java8之前，接口里的方法不能有方法体的 java8之后可以了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">在 C++ 中 允许多继承</span><br><span class="line">class A&#123;</span><br><span class="line">    f()&#123; ....&#125;</span><br><span class="line">&#125;</span><br><span class="line">class B&#123;</span><br><span class="line">    f()&#123; ....&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C extends A,B&#123;</span><br><span class="line">    // </span><br><span class="line">&#125;</span><br><span class="line">// 菱形继承</span><br><span class="line">new C().f(); // 调用的是谁？此时产生了歧义</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 而 java 是单根继承(不够灵活)，于是提出了 “接口”允许多实现。</span><br><span class="line">// 把接口的功能理解为一种能力</span><br><span class="line">// 那如何区分 类继承体系和接口呢？</span><br><span class="line">// 假设你是个老板Boss 你想找几个人干活，对于class来说就是找几个“人”来干活</span><br><span class="line">// 对于interface来说就是 找几个“能干活”的人来</span><br><span class="line">interface A&#123;</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br><span class="line">interface B&#123;</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br><span class="line">class C implements A,B&#123;</span><br><span class="line">    f()&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 而在java8 之后，这种现象被改变了。妥协了</span><br><span class="line">// 当一个接口发布出去 就不能在改了，不能增添或减少成员，因为一旦成型，再次添加方法后，导致所有实现类都报错。必须实现接口的所有方法。</span><br><span class="line"></span><br><span class="line">// 由于这种向后兼容性。所以这种发布之后，再也不修改的情况是个天真的想法——人的认知是有限的</span><br><span class="line">// 所以在 java 工作体系运行20年之后，突然发现某些接口 如 List 想给当年的List添加一个 sort(); 但是很不幸 你不能打破“向后兼容性”， 这样导致 List的实现类全报错了，必须实现 sort方法才行，问题升级，你老板非要实现，但是你要改 N 多地方。</span><br><span class="line"></span><br><span class="line">// 于是产生了一个妥协的产物——默认方法</span><br><span class="line">这个 sort 就在 List 中</span><br><span class="line">// 因为无法变成抽象方法，所以必须写实现，所以 sort 有一个默认的实现使得之前没有实现 sort方法的实现类也能正常工作</span><br><span class="line"></span><br><span class="line">default void sort(Comparator&lt;? super E&gt; c)&#123;</span><br><span class="line">    Object[] a = this.toArray();</span><br><span class="line">    Array.sort(a,(Comparator) c);</span><br><span class="line">    ListIterator&lt;E&gt; i = this.listIterator();</span><br><span class="line">    for(Object e : a)&#123;</span><br><span class="line">        i.next();</span><br><span class="line">        i.set((E) e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h4></blockquote>
<ul>
<li><p>java8 之前</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;</span><br><span class="line">    void a();</span><br><span class="line">    void b();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>java8 之后</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;</span><br><span class="line">    void a();</span><br><span class="line">    void b();</span><br><span class="line">    default void  c()&#123;</span><br><span class="line">        // 实现</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 这样原来实现 A 接口的实现类就可以得到兼容</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="java8-接口默认方法引出的问题"><a href="#java8-接口默认方法引出的问题" class="headerlink" title="java8 接口默认方法引出的问题"></a>java8 接口默认方法引出的问题</h4></blockquote>
<ul>
<li>当年极力避免的 <code>C++ 的多继承，导致父类有相同f();的问题出现了</code></li>
<li>当年极力避免的 <strong>“二义性”</strong> 现在又妥协了<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;</span><br><span class="line">    void a();</span><br><span class="line">    default void  c()&#123;</span><br><span class="line">        // 实现</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface B&#123;</span><br><span class="line">    void a();</span><br><span class="line">    default void  c()&#123;</span><br><span class="line">        // 实现</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class C implatements A,B&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        c(); // 此时报错了</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口和抽象类总结"><a href="#接口和抽象类总结" class="headerlink" title="接口和抽象类总结"></a>接口和抽象类总结</h3><blockquote>
<p>共同点</p>
</blockquote>
<ul>
<li>抽象的，不可实例化</li>
<li>可包含抽象方法(没有方法体，非 static/private/final )</li>
</ul>
<blockquote>
<p>不同点</p>
</blockquote>
<ul>
<li>抽象类是类可以包含类的一切，接口只能包含受限的成员(public static final)和方法(public abstract,java8之后可以 default的)</li>
<li>抽象类只能单一继承，接口可以多实现</li>
</ul>
<blockquote>
<p>instanceof 不仅能检查是不是一个类的实例还可以检测是不是一个接口实现类的实例</p>
</blockquote>
<blockquote>
<p>什么是 API(application program interface)</p>
</blockquote>
<blockquote>
<p>什么是UI(User interface)</p>
</blockquote>
<h4 id="多态实战"><a href="#多态实战" class="headerlink" title="多态实战"></a>多态实战</h4><p>Files.walkFileTree 当你用一个不知道意思的方法的时候，你最好看一下JDK文档 JDK的文档是最好的教材</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Walks a file tree.</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; This method walks a file tree rooted at a given starting file. The</span><br><span class="line">    * file tree traversal is &lt;em&gt;depth-first&lt;/em&gt; with the given &#123;@link</span><br><span class="line">    * FileVisitor&#125; invoked for each file encountered. 看到这就够了</span><br><span class="line"></span><br><span class="line">    public static Path walkFileTree(Path start,</span><br><span class="line">                                    Set&lt;FileVisitOption&gt; options,</span><br><span class="line">                                    int maxDepth,</span><br><span class="line">                                    FileVisitor&lt;? super Path&gt; visitor)</span><br><span class="line">        throws IOException</span><br><span class="line">    &#123; ... &#125;</span><br><span class="line">    - 沿着给定的一个 目录</span><br><span class="line">    - 深度优先 </span><br><span class="line"></span><br><span class="line">    FileVisitor 是什么？就是一个接口，如果你实现它，就可以在访问文件的过程中进行自定义控制</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FileVisitor接口</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public interface FileVisitor&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    // 文件夹访问之前</span><br><span class="line">    FileVisitResult preVisitDirectory(T dir, BasicFileAttributes attrs)</span><br><span class="line">        throws IOException;</span><br><span class="line"></span><br><span class="line">    // 访问文件夹做什么</span><br><span class="line">    FileVisitResult visitFile(T file, BasicFileAttributes attrs)</span><br><span class="line">        throws IOException;</span><br><span class="line"></span><br><span class="line">    // 访问失败做什么</span><br><span class="line">    FileVisitResult visitFileFailed(T file, IOException exc)</span><br><span class="line">        throws IOException;</span><br><span class="line"></span><br><span class="line">    // 访问文件夹之后</span><br><span class="line">    FileVisitResult postVisitDirectory(T dir, IOException exc)</span><br><span class="line">        throws IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FileVisitResult 访问文件的4个结果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public enum FileVisitResult &#123;</span><br><span class="line">    CONTINUE,</span><br><span class="line">    TERMINATE,// 终止</span><br><span class="line">    SKIP_SUBTREE, // 忽略子树</span><br><span class="line">    SKIP_SIBLINGS; // 忽略所有兄弟</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MyFileVisitor"><a href="#MyFileVisitor" class="headerlink" title="MyFileVisitor"></a>MyFileVisitor</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.file.*;</span><br><span class="line">import java.nio.file.attribute.BasicFileAttributes;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class FileFilter &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        Path testRootDir = projectDir.resolve(&quot;test-root&quot;);</span><br><span class="line">        if (!testRootDir.toFile().isDirectory()) &#123;</span><br><span class="line">            throw new IllegalStateException(testRootDir.toAbsolutePath().toString() + &quot;不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filteredFileNames = filter(testRootDir, &quot;.csv&quot;);</span><br><span class="line">        System.out.println(filteredFileNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 实现一个按照扩展名过滤文件的功能</span><br><span class="line">     *</span><br><span class="line">     * @param rootDirectory 要过滤的文件夹</span><br><span class="line">     * @param extension 要过滤的文件扩展名，例如 .txt</span><br><span class="line">     * @return 所有该文件夹（及其后代子文件夹中）匹配指定扩展名的文件的名字</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;String&gt; filter(Path rootDirectory, String extension) throws IOException &#123;</span><br><span class="line">        Files.walkFileTree(rootDirectory,new MyFileVisitor());</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 分割线，另一个 java文件里</span><br><span class="line">// MyFileVisitor.java</span><br><span class="line">public class MyFileVisitor implements FileVisitor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult preVisitDirectory(Object dir, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">        System.out.println(dir);</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult visitFile(Object file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult visitFileFailed(Object file, IOException exc) throws IOException &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult postVisitDirectory(Object dir, IOException exc) throws IOException &#123;</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除此之外，我们可以找到 FileVisitor 的实现类(骨架类)，因为我们不需要实现所有的接口</p>
</blockquote>
<ul>
<li>找到了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class FileFilterVisitor extends SimpleFileVisitor&lt;Path&gt;&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需求添加，我们需要知道过滤文件的扩展名，和返回过滤后的集合</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.file.*;</span><br><span class="line">import java.nio.file.attribute.BasicFileAttributes;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class FileFilter &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        Path testRootDir = projectDir.resolve(&quot;test-root&quot;);</span><br><span class="line">        if (!testRootDir.toFile().isDirectory()) &#123;</span><br><span class="line">            throw new IllegalStateException(testRootDir.toAbsolutePath().toString() + &quot;不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filteredFileNames = filter(testRootDir, &quot;.csv&quot;);</span><br><span class="line">        System.out.println(filteredFileNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;String&gt; filter(Path rootDirectory, String extension) throws IOException &#123;</span><br><span class="line">        FileFilterVisitor visitor = new FileFilterVisitor(extension);</span><br><span class="line">        Files.walkFileTree(rootDirectory,visitor);</span><br><span class="line">        return visitor.getFilterNames();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 分割线，另一个 java文件里</span><br><span class="line">// FileFilterVisitor.java</span><br><span class="line">// 使用骨架实现</span><br><span class="line">public class FileFilterVisitor extends SimpleFileVisitor&lt;Path&gt;&#123;</span><br><span class="line">    private String extension;</span><br><span class="line">    private List&lt;String&gt; filterNames = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public FileFilterVisitor(String extension) &#123;</span><br><span class="line">        this.extension = extension;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;String&gt; getFilterNames() &#123;</span><br><span class="line">        return filterNames;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        if(file.getFileName().toString().endsWith(extension))&#123;</span><br><span class="line">            filterNames.add(file.getFileName().toString());</span><br><span class="line">        &#125;</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="再次升级需求：问题如下"><a href="#再次升级需求：问题如下" class="headerlink" title="再次升级需求：问题如下"></a>再次升级需求：问题如下</h4></blockquote>
<ul>
<li>你的 <code>FileFilterVisitor</code> 不在一个文件里，看代码要分屏看两个文件，而且还需要定制构造器 传递<code>extension</code>参数</li>
</ul>
<p>于是你把 <code>FileFilterVisitor.java</code> 移到 <code>FileFilter.java</code> 里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.polymorphism;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.file.*;</span><br><span class="line">import java.nio.file.attribute.BasicFileAttributes;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class FileFilter &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        Path testRootDir = projectDir.resolve(&quot;test-root&quot;);</span><br><span class="line">        if (!testRootDir.toFile().isDirectory()) &#123;</span><br><span class="line">            throw new IllegalStateException(testRootDir.toAbsolutePath().toString() + &quot;不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filteredFileNames = filter(testRootDir, &quot;.csv&quot;);</span><br><span class="line">        System.out.println(filteredFileNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;String&gt; filter(Path rootDirectory, String extension) throws IOException &#123;</span><br><span class="line">        FileFilterVisitor visitor = new FileFilterVisitor(extension);</span><br><span class="line">        Files.walkFileTree(rootDirectory,visitor);</span><br><span class="line">        return visitor.getFilterNames();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FileFilterVisitor extends SimpleFileVisitor&lt;Path&gt;&#123;</span><br><span class="line">    private String extension;</span><br><span class="line">    private List&lt;String&gt; filterNames = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public FileFilterVisitor(String extension) &#123;</span><br><span class="line">        this.extension = extension;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;String&gt; getFilterNames() &#123;</span><br><span class="line">        return filterNames;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        if(file.getFileName().toString().endsWith(extension))&#123;</span><br><span class="line">            filterNames.add(file.getFileName().toString());</span><br><span class="line">        &#125;</span><br><span class="line">        return FileVisitResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>即使移到了一个java文件里，但是你还是觉得麻烦</strong></p>
<h4 id="内部类-一个类包含在另一类中"><a href="#内部类-一个类包含在另一类中" class="headerlink" title="内部类(一个类包含在另一类中)"></a>内部类(一个类包含在另一类中)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class FileFilter &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        Path testRootDir = projectDir.resolve(&quot;test-root&quot;);</span><br><span class="line">        if (!testRootDir.toFile().isDirectory()) &#123;</span><br><span class="line">            throw new IllegalStateException(testRootDir.toAbsolutePath().toString() + &quot;不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filteredFileNames = filter(testRootDir, &quot;.csv&quot;);</span><br><span class="line">        System.out.println(filteredFileNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;String&gt; filter(Path rootDirectory, String extension) throws IOException &#123;</span><br><span class="line">        FileFilterVisitor visitor = new FileFilterVisitor(extension);</span><br><span class="line">        Files.walkFileTree(rootDirectory,visitor);</span><br><span class="line">        return visitor.getFilterNames();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 内部类</span><br><span class="line">    static class FileFilterVisitor extends SimpleFileVisitor&lt;Path&gt;&#123;</span><br><span class="line">        private String extension;</span><br><span class="line">        private List&lt;String&gt; filterNames = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        public FileFilterVisitor(String extension) &#123;</span><br><span class="line">            this.extension = extension;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public List&lt;String&gt; getFilterNames() &#123;</span><br><span class="line">            return filterNames;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">            System.out.println(file);</span><br><span class="line">            if(file.getFileName().toString().endsWith(extension))&#123;</span><br><span class="line">                filterNames.add(file.getFileName().toString());</span><br><span class="line">            &#125;</span><br><span class="line">            return FileVisitResult.CONTINUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>还是觉得麻烦，因为要传递<code>extension</code></strong></p>
<blockquote>
<h4 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h4></blockquote>
<p><strong>好处</strong></p>
<ul>
<li>相近的两块逻辑组合到一起，避免两个逻辑在两个文件中，所带来的注意力不集中问题</li>
<li>参数 <code>extension</code> 不需要构造器来传递了。可以直接在匿名内部类中访问<ul>
<li>匿名内部类可以毫无障碍的访问 外围的变量</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class FileFilter &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Path projectDir = Paths.get(System.getProperty(&quot;user.dir&quot;));</span><br><span class="line">        Path testRootDir = projectDir.resolve(&quot;test-root&quot;);</span><br><span class="line">        if (!testRootDir.toFile().isDirectory()) &#123;</span><br><span class="line">            throw new IllegalStateException(testRootDir.toAbsolutePath().toString() + &quot;不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; filteredFileNames = filter(testRootDir, &quot;.csv&quot;);</span><br><span class="line">        System.out.println(filteredFileNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 匿名内部类</span><br><span class="line">    public static List&lt;String&gt; filter(Path rootDirectory, String extension) throws IOException &#123;</span><br><span class="line">        List&lt;String&gt; names = new ArrayList&lt;&gt;();</span><br><span class="line">        Files.walkFileTree(rootDirectory,new SimpleFileVisitor&lt;Path&gt;()&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException &#123;</span><br><span class="line">                System.out.println(file);</span><br><span class="line">                if(file.getFileName().toString().endsWith(extension))&#123;</span><br><span class="line">                    names.add(file.getFileName().toString());</span><br><span class="line">                &#125;</span><br><span class="line">                return FileVisitResult.CONTINUE;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return names;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上就是<strong>多态</strong>的应用</p>
<ul>
<li>通过修改一小块的功能去完成一个更加灵活性的功能</li>
<li><p>通过去覆盖(重写)一个方法来实现更加灵活的功能</p>
</li>
<li><p><a href="https://github.com/hcsp/refactor-filters" target="_blank" rel="noopener">代码参考</a></p>
</li>
<li><a href="https://github.com/hcsp/file-filter/pull/10" target="_blank" rel="noopener">我的pr</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/09/ZB-014-java接口和抽象类01/" data-id="ckovg9eux010q8yjk1sqtk9od" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/15/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/55/">55</a><a class="extend next" rel="next" href="/page/17/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 13.91px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 14.35px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.3px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.48px;">M01</a> <a href="/tags/M02/" style="font-size: 15.22px;">M02</a> <a href="/tags/M03/" style="font-size: 15.65px;">M03</a> <a href="/tags/M04/" style="font-size: 16.09px;">M04</a> <a href="/tags/M06/" style="font-size: 18.26px;">M06</a> <a href="/tags/M07/" style="font-size: 17.83px;">M07</a> <a href="/tags/M08/" style="font-size: 16.96px;">M08</a> <a href="/tags/M09/" style="font-size: 11.74px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 15.65px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.7px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.52px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15.22px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.78px;">TS入门</a> <a href="/tags/Webpack/" style="font-size: 11.3px;">Webpack</a> <a href="/tags/express/" style="font-size: 10.43px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.83px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.17px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.13px;">java</a> <a href="/tags/linux/" style="font-size: 10.87px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.3px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.61px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.61px;">mysql</a> <a href="/tags/node/" style="font-size: 10.43px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.39px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.04px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/前端知识点/" style="font-size: 19.57px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/05/18/Win平台软件技巧01/">Win平台软件技巧01</a>
          </li>
        
          <li>
            <a href="/2021/02/28/Webpack-03loader/">Webpack-03loader</a>
          </li>
        
          <li>
            <a href="/2021/02/27/Webpack-02打包器/">Webpack-02打包器</a>
          </li>
        
          <li>
            <a href="/2021/02/27/Webpack-01AST-Babel-依赖/">Webpack-01AST_Babel_依赖</a>
          </li>
        
          <li>
            <a href="/2021/02/26/Webpack-00前置内容理解webpack/">Webpack-00前置内容理解webpack</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>