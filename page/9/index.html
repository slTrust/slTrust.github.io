<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Almost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/9/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">
  
    <link rel="alternate" href="/atom.xml" title="Almost" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Almost</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-ZB-034-03MyBatis动态sql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/01/ZB-034-03MyBatis动态sql/" class="article-date">
  <time datetime="2019-11-01T01:26:27.000Z" itemprop="datePublished">2019-11-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/01/ZB-034-03MyBatis动态sql/">ZB-034-03MyBatis动态sql</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="动态sql——MyBatis的灵魂"><a href="#动态sql——MyBatis的灵魂" class="headerlink" title="动态sql——MyBatis的灵魂"></a>动态sql——MyBatis的灵魂</h3><ul>
<li><code>&lt;if&gt;</code></li>
<li><code>&lt;choose&gt;</code></li>
<li><code>&lt;foreach&gt;</code></li>
<li><code>&lt;script&gt;</code></li>
</ul>
<blockquote>
<p><a href="https://mybatis.org/mybatis-3/dynamic-sql.html" target="_blank" rel="noopener">Dynamic SQL</a></p>
</blockquote>
<blockquote>
<p>selectUserByName需求</p>
</blockquote>
<ul>
<li><code>if</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 如果你这样 ，name 没有时会报错</span><br><span class="line">&lt;select id=&quot;selectUserByName&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">    where</span><br><span class="line">    &lt;if test=&quot;name != null&quot;&gt;</span><br><span class="line">        name like #&#123;name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line"># 它会拼成这样</span><br><span class="line"># select * from user where</span><br><span class="line"></span><br><span class="line"># 你可以这样</span><br><span class="line">&lt;select id=&quot;selectUserByName&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">    &lt;if test=&quot;name != null&quot;&gt;</span><br><span class="line">        where name like #&#123;name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>choose</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;chooseUser&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">    &lt;choose&gt;</span><br><span class="line">        &lt;when test=&quot;name ==&apos;wangwu&apos;&quot;&gt;</span><br><span class="line">            where name = &apos;wangwu&apos;</span><br><span class="line">        &lt;/when&gt;</span><br><span class="line">        &lt;otherwise&gt;</span><br><span class="line">            where name = &apos;zhangsan&apos;</span><br><span class="line">        &lt;/otherwise&gt;</span><br><span class="line">    &lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">// 这里的坑在这</span><br><span class="line">&lt;when test=&quot;name ==&apos;wangwu&apos;&quot;&gt; </span><br><span class="line"></span><br><span class="line">不要写成这样 </span><br><span class="line">不要写成这样 </span><br><span class="line">不要写成这样 </span><br><span class="line">&lt;when test=&quot;name ==wangwu&quot;&gt;</span><br><span class="line">这样它会在运行时把 wangwu 当作查询User的字段而不是字符串</span><br></pre></td></tr></table></figure>
<ul>
<li><code>where / set</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">如果条件都不满足就会导致语法错误</span><br><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br><span class="line"></span><br><span class="line">正确的做法是</span><br><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">如果条件不满足它就没有where</span><br></pre></td></tr></table></figure>
<p>set语句也能动态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateAuthorIfNecessary&quot;&gt;</span><br><span class="line">  update Author</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">      &lt;if test=&quot;username != null&quot;&gt;username=#&#123;username&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;password != null&quot;&gt;password=#&#123;password&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;email != null&quot;&gt;email=#&#123;email&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;bio != null&quot;&gt;bio=#&#123;bio&#125;&lt;/if&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>批量操作 <code>foreach</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// UserMapper.xml</span><br><span class="line">&lt;select id=&quot;selectIds&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select *</span><br><span class="line">    from user where id in</span><br><span class="line">    &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;ids&quot;</span><br><span class="line">             open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">      #&#123;item&#125;</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">// Sql.java</span><br><span class="line">Map&lt;String,Object&gt; param = new HashMap&lt;&gt;();</span><br><span class="line">param.put(&quot;ids&quot;, Arrays.asList(1,2));</span><br><span class="line">List&lt;User&gt; resUser = session.selectList(&quot;com.sql.xml.UserMapper.selectIds&quot;,param);</span><br><span class="line">System.out.println(resUser);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>script</code> 不常用</li>
</ul>
<p><strong>把xml里的内容放在注解里</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Update(&#123;&quot;&lt;script&gt;&quot;,</span><br><span class="line">  &quot;update Author&quot;,</span><br><span class="line">  &quot;  &lt;set&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test=&apos;username != null&apos;&gt;username=#&#123;username&#125;,&lt;/if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test=&apos;password != null&apos;&gt;password=#&#123;password&#125;,&lt;/if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test=&apos;email != null&apos;&gt;email=#&#123;email&#125;,&lt;/if&gt;&quot;,</span><br><span class="line">  &quot;    &lt;if test=&apos;bio != null&apos;&gt;bio=#&#123;bio&#125;&lt;/if&gt;&quot;,</span><br><span class="line">  &quot;  &lt;/set&gt;&quot;,</span><br><span class="line">  &quot;where id=#&#123;id&#125;&quot;,</span><br><span class="line">  &quot;&lt;/script&gt;&quot;&#125;)</span><br><span class="line">void updateAuthorValues(Author author);</span><br></pre></td></tr></table></figure>
<h3 id="MyBatis实战"><a href="#MyBatis实战" class="headerlink" title="MyBatis实战"></a>MyBatis实战</h3><ul>
<li><a href="https://github.com/hcsp/mybatis-in-action" target="_blank" rel="noopener">克隆项目</a></li>
<li>运行<code>mvn initialize</code></li>
<li><a href="https://github.com/hcsp/mybatis-in-action/pull/6" target="_blank" rel="noopener">我的PR</a></li>
</ul>
<blockquote>
<p>涵盖内容</p>
</blockquote>
<ul>
<li>CRUD</li>
<li>联表操作</li>
<li>association 关系映射</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/01/ZB-034-03MyBatis动态sql/" data-id="ckkmr2k9900tbfp91vxxdd1ot" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-034-01MyBatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/ZB-034-01MyBatis/" class="article-date">
  <time datetime="2019-10-31T14:08:50.000Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/ZB-034-01MyBatis/">ZB-034-01MyBatis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="MyBatis是什么"><a href="#MyBatis是什么" class="headerlink" title="MyBatis是什么"></a>MyBatis是什么</h3><ul>
<li>一个ORM框架</li>
<li>国内基本都在用</li>
<li>好处就是：简单/方便</li>
</ul>
<h4 id="为什么需要MyBatis"><a href="#为什么需要MyBatis" class="headerlink" title="为什么需要MyBatis?"></a>为什么需要MyBatis?</h4><blockquote>
<p><a href="https://github.com/hcsp/practise-select-sql" target="_blank" rel="noopener">之前的JDBC sql练习</a></p>
</blockquote>
<p><strong>注意是裸的sql</strong> 还用了<code>PreparedStatement</code></p>
<p><a href="https://github.com/hcsp/practise-select-sql/blob/dev_hjx/src/main/java/com/github/hcsp/sql/Sql.java" target="_blank" rel="noopener">我的PR</a></p>
<ul>
<li>过程非常痛苦</li>
<li>不感受到痛苦就没动力学新技术</li>
</ul>
<h3 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h3><ul>
<li>对象关系映射<ul>
<li>自动完成对象到数据库的映射</li>
</ul>
</li>
<li>Association<ul>
<li>自动装配对象</li>
</ul>
</li>
</ul>
<h3 id="从零开始MyBatis"><a href="#从零开始MyBatis" class="headerlink" title="从零开始MyBatis"></a>从零开始MyBatis</h3><ul>
<li>看<a href="https://mybatis.org/mybatis-3/" target="_blank" rel="noopener">官网</a>就够了</li>
<li>首先配置日志框架，可以极大的提高排查问题的效率</li>
<li>然后配置数据源</li>
<li>Mapper:接口由MyBatis动态代理<ul>
<li>优点：方便</li>
<li>缺点：SQL复杂的时候不够方便</li>
</ul>
</li>
<li>Mapper:用XML编写复杂SQL<ul>
<li>优点：可以方便地使用MyBatis强大功能</li>
<li>缺点：SQL和代码分离</li>
</ul>
</li>
</ul>
<blockquote>
<p>数据库到底是什么</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">数据库实际就是一个URL</span><br><span class="line"></span><br><span class="line">你的webApp应用</span><br><span class="line">-------------</span><br><span class="line">| JVM       |</span><br><span class="line">|           |  url</span><br><span class="line">|           |-------&gt; Database</span><br><span class="line">|           | 连接串</span><br><span class="line">-------------</span><br><span class="line"></span><br><span class="line">那 MyBatis呢？ </span><br><span class="line"></span><br><span class="line">你的webApp应用</span><br><span class="line">-------------</span><br><span class="line">| JVM       |</span><br><span class="line">|           |  url</span><br><span class="line">|           |-------&gt; Database</span><br><span class="line">|    MyBatis| 连接串</span><br><span class="line">-------------</span><br><span class="line">MyBatis它只是JVM里运行的一小段程序而已</span><br><span class="line">它通过底层调用JDBC和数据库进行交互</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ---------</span><br><span class="line">obj --&gt; |       |</span><br><span class="line">        |MyBatis| --&gt; sql语句</span><br><span class="line">obj &lt;-- |       |</span><br><span class="line">        ---------</span><br></pre></td></tr></table></figure>
<h4 id="MyBatis从零开始"><a href="#MyBatis从零开始" class="headerlink" title="MyBatis从零开始"></a>MyBatis从零开始</h4><ul>
<li>拷贝项目<a href="https://github.com/hcsp/practise-select-sql" target="_blank" rel="noopener">在这个项目的基础上进行MyBatis配置</a></li>
<li><a href="https://mybatis.org/mybatis-3/" target="_blank" rel="noopener">打开官网</a> 直接看英文</li>
<li>点击 <a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">Getting Started</a></li>
<li><p>看到第一段就是让你添加依赖到 pom.xml里</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;x.x.x&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后 搜索  <a href="https://mvnrepository.com/artifact/org.mybatis" target="_blank" rel="noopener">mybatis maven</a></p>
</li>
<li><p>选择最近版的就行</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">添加到pom.xml里 刷新一下</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Building SqlSessionFactory from XML</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// 文档提供了例子代码</span><br><span class="line">String resource = &quot;org/mybatis/example/mybatis-config.xml&quot;;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory =</span><br><span class="line">  new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">  </span><br><span class="line">// 新建一个配置文件  </span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">    &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">      &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">      &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">      &lt;/dataSource&gt;</span><br><span class="line">    &lt;/environment&gt;</span><br><span class="line">  &lt;/environments&gt;</span><br><span class="line">  &lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意 maven的项目约定就是一切资源放在 resources 下 (图片/配置等)</p>
</li>
<li>所以我们在 src/main/resources/db/myBatis/config.xml 内容同上</li>
<li>运行 <code>mvn initialize</code> 初始化数据</li>
<li>修改我们的配置文件<code>src/main/resources/db/myBatis/config.xml</code> 的内容</li>
<li>因为我们的数据库是 h2 </li>
<li>搜h2 database driver classname 得到 <code>org.h2.Driver</code></li>
<li>修改配置为</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;org.h2.Driver&quot;/&gt;</span><br><span class="line">                &lt;!--</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:h2:file:&lt;你的项目文件夹地址&gt;/target/test&quot;/&gt;</span><br><span class="line">                --&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;Jxi1Oxc92qSj&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;!-- 先注释掉这句 因为你还没配置 --&gt;</span><br><span class="line">        &lt;!-- &lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt; --&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>到<code>src/main/java/com.github.hcsp.sql.Sql.java</code></li>
<li>修改一下</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class Sql &#123;</span><br><span class="line">    // 用户信息</span><br><span class="line">    public static class User &#123;</span><br><span class="line">        Integer id;</span><br><span class="line">        String name;</span><br><span class="line">        String tel;</span><br><span class="line">        String address;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public String toString() &#123;</span><br><span class="line">            return &quot;User&#123;&quot; + &quot;id=&quot; + id + &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; + &quot;, tel=&apos;&quot; + tel + &apos;\&apos;&apos; + &quot;, address=&apos;&quot; + address + &apos;\&apos;&apos; + &apos;&#125;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interface UserMapper&#123;</span><br><span class="line">        @Select(&quot;select * from user&quot;)</span><br><span class="line">        List&lt;User&gt; getUsers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 注意，运行这个方法之前，请先运行mvn initialize把测试数据灌入数据库</span><br><span class="line">    public static void main(String[] args) throws SQLException, IOException &#123;</span><br><span class="line">        String resource = &quot;db/myBatis/config.xml&quot;;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory =</span><br><span class="line">                new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line">        try (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">            UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">            System.out.println(mapper.getUsers());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 报错了</span><br><span class="line">Exception in thread &quot;main&quot; org.apache.ibatis.binding.BindingException: Type interface com.github.hcsp.sql.Sql$UserMapper is not known to the MapperRegistry.</span><br><span class="line">	at org.apache.ibatis.binding.MapperRegistry.getMapper(MapperRegistry.java:47)</span><br><span class="line">	at org.apache.ibatis.session.Configuration.getMapper(Configuration.java:779)</span><br><span class="line">	at org.apache.ibatis.session.defaults.DefaultSqlSession.getMapper(DefaultSqlSession.java:291)</span><br><span class="line">	at com.github.hcsp.sql.Sql.main(Sql.java:233)</span><br><span class="line"></span><br><span class="line">直接搜索这个错误 得到答案 https://stackoverflow.com/questions/4263832/type-interface-is-not-known-to-the-mapperregistry-exception-using-mybatis?r=SearchResults</span><br><span class="line">意思是你要注册一下在xml里</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;mapper class=&quot;com.github.hcsp.sql.Sql$UserMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">注意 内部类要用 $ </span><br><span class="line"></span><br><span class="line">此时成功查询出了数据</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>此时你该惊叹它的强大</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface UserMapper&#123;</span><br><span class="line">    @Select(&quot;select * from user&quot;)</span><br><span class="line">    List&lt;User&gt; getUsers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">你就写了一个接口，都没去写实现，就能拿到List&lt;User&gt;</span><br></pre></td></tr></table></figure>
<h4 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a><a href="https://mybatis.org/mybatis-3/logging.html" target="_blank" rel="noopener">配置日志</a></h4><p>在我们的 config.xml里添加官方的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;settings&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;/settings&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">添加到我们的代码里</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;org.h2.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:h2:file:/Users/admin/Desktop/practise-select-sql/target/test&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;Jxi1Oxc92qSj&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper class=&quot;com.github.hcsp.sql.Sql$UserMapper&quot;/&gt;</span><br><span class="line">        &lt;!--&lt;mapper resource=&quot;org/db.myBatis/example/BlogMapper.xml&quot;/&gt;--&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">结果 &lt;configuration&gt; 飙红了 为什么？</span><br><span class="line">踩坑不够多</span><br><span class="line"></span><br><span class="line">答案是 settings要放在最前面</span><br><span class="line">如下</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;org.h2.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:h2:file:/Users/admin/Desktop/practise-select-sql/target/test&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;Jxi1Oxc92qSj&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper class=&quot;com.github.hcsp.sql.Sql$UserMapper&quot;/&gt;</span><br><span class="line">        &lt;!--&lt;mapper resource=&quot;org/db.myBatis/example/BlogMapper.xml&quot;/&gt;--&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">运行我们的程序，结果报错了</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.apache.log4j.Priority</span><br><span class="line">意思你引入了配置 但是没告诉这个类在哪 所以找不到</span><br><span class="line">搜索 maven org.apache.log4j.Priority</span><br><span class="line">得到 https://mvnrepository.com/artifact/log4j/log4j</span><br><span class="line"></span><br><span class="line">复制它的坐标 到 pom.xml里</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">继续运行项目 成功  但是打印了警告信息</span><br></pre></td></tr></table></figure>
<p>继续看文档，说要配置一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">新建 src/main/resources/log4j.properties 文件</span><br><span class="line"></span><br><span class="line"># Global logging configuration</span><br><span class="line">log4j.rootLogger=ERROR, stdout</span><br><span class="line"># MyBatis logging configuration...</span><br><span class="line">log4j.logger.org.mybatis.example.BlogMapper=TRACE</span><br><span class="line"># Console output...</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure>
<p>继续运行项目，发现警告消失了</p>
<blockquote>
<p>日志是需要系统学习的，因为他有不同的等级</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">之所以刚刚没有任何信息打印是因为 日志等级是 ERROR</span><br><span class="line"></span><br><span class="line">我们修改为 DEBUG</span><br><span class="line"></span><br><span class="line">log4j.rootLogger=DEBUG, stdout</span><br><span class="line"></span><br><span class="line">运行项目，此时能清楚的看到sql语句执行过程</span><br><span class="line">DEBUG [main] - Logging initialized using &apos;class org.apache.ibatis.logging.log4j.Log4jImpl&apos; adapter.</span><br><span class="line">DEBUG [main] - Logging initialized using &apos;class org.apache.ibatis.logging.log4j.Log4jImpl&apos; adapter.</span><br><span class="line">DEBUG [main] - PooledDataSource forcefully closed/removed all connections.</span><br><span class="line">DEBUG [main] - PooledDataSource forcefully closed/removed all connections.</span><br><span class="line">DEBUG [main] - PooledDataSource forcefully closed/removed all connections.</span><br><span class="line">DEBUG [main] - PooledDataSource forcefully closed/removed all connections.</span><br><span class="line">DEBUG [main] - Opening JDBC Connection</span><br><span class="line">DEBUG [main] - Created connection 1848125895.</span><br><span class="line">DEBUG [main] - Setting autocommit to false on JDBC Connection [conn0: url=jdbc:h2:file:/Users/admin/Desktop/practise-select-sql/target/test user=ROOT]</span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: select * from user </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: 4</span><br><span class="line">[User&#123;id=1, name=&apos;zhangsan&apos;, tel=&apos;tel1&apos;, address=&apos;beijing&apos;&#125;, User&#123;id=2, name=&apos;lisi&apos;, tel=&apos;tel2&apos;, address=&apos;shanghai&apos;&#125;, User&#123;id=3, name=&apos;wangwu&apos;, tel=&apos;tel3&apos;, address=&apos;shanghai&apos;&#125;, User&#123;id=4, name=&apos;zhangsan&apos;, tel=&apos;tel4&apos;, address=&apos;shenzhen&apos;&#125;]</span><br><span class="line">DEBUG [main] - Resetting autocommit to true on JDBC Connection [conn0: url=jdbc:h2:file:/Users/admin/Desktop/practise-select-sql/target/test user=ROOT]</span><br><span class="line">DEBUG [main] - Closing JDBC Connection [conn0: url=jdbc:h2:file:/Users/admin/Desktop/practise-select-sql/target/test user=ROOT]</span><br><span class="line">DEBUG [main] - Returned connection 1848125895 to pool.</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/ZB-034-01MyBatis/" data-id="ckkmr2k9700t7fp91aovanin9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-034-02MyBatis的xml方式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/31/ZB-034-02MyBatis的xml方式/" class="article-date">
  <time datetime="2019-10-31T14:08:26.000Z" itemprop="datePublished">2019-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/31/ZB-034-02MyBatis的xml方式/">ZB-034-02MyBatis的xml方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Mapper核心有两种实现"><a href="#Mapper核心有两种实现" class="headerlink" title="Mapper核心有两种实现"></a>Mapper核心有两种实现</h3><ul>
<li>Mapper:接口由MyBatis动态代理 (上一篇就是这种方式)<ul>
<li>优点：方便</li>
<li>缺点：SQL复杂的时候不够方便</li>
</ul>
</li>
<li>Mapper:用XML编写复杂SQL<ul>
<li>优点：可以方便地使用MyBatis强大功能</li>
<li>缺点：SQL和代码分离</li>
</ul>
</li>
</ul>
<blockquote>
<h4 id="使用xml写复杂sql"><a href="#使用xml写复杂sql" class="headerlink" title="使用xml写复杂sql"></a>使用xml写复杂sql</h4></blockquote>
<ul>
<li>继续看<a href="https://mybatis.org/mybatis-3/getting-started.html" target="_blank" rel="noopener">文档的Exploring Mapped SQL Statements部分</a></li>
<li><p>新建 <code>src/main/resources/db/myBatis/UserMapper.xml</code><br>  内容如下</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;org.mybatis.example.BlogMapper&quot;&gt;</span><br><span class="line">  &lt;select id=&quot;selectBlog&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改内容</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;!-- namespace 这个随便写 就是用来管理你的mapper--&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把我们的<code>UserMapper.xml</code> 添加到config.xml里</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">    &lt;!--&lt;mapper class=&quot;com.github.hcsp.sql.Sql$UserMapper&quot;/&gt;--&gt;</span><br><span class="line">    &lt;mapper resource=&quot;db/myBatis/UserMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如何用这个xml呢？ 很明显 <strong>xml里的sql和代码分离了，让你来回找目录</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws SQLException, IOException &#123;</span><br><span class="line">    String resource = &quot;db/myBatis/config.xml&quot;;</span><br><span class="line">    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">    SqlSessionFactory sqlSessionFactory =</span><br><span class="line">            new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line">    try (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">     </span><br><span class="line">        // xml方式</span><br><span class="line">        System.out.println( session.selectList(&quot;com.sql.xml.UserMapper.selectUser&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如果报错可能你没添加这个 UserMapper.xml到 config.xml里</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Mapper的一切"><a href="#Mapper的一切" class="headerlink" title="Mapper的一切"></a>Mapper的一切</h3><ul>
<li>parameterType<ul>
<li>参数的 <code>${} 和 #{}</code></li>
<li>参数是按照 JavaBean约定读取的 getter/setter</li>
</ul>
</li>
<li><p>resultType</p>
<ul>
<li><p>typeAlias 简化 resultType</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># 在UserMapper.xml resultType 很长</span><br><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;com.github.hcsp.sql.Sql$User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># typeAlias 帮你做一个映射 别名 注意它必须放在前面</span><br><span class="line"># 第一步修改 config.xml </span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;!-- 添加别名映射 --&gt;</span><br><span class="line">    &lt;typeAliases&gt;</span><br><span class="line">        &lt;typeAlias alias=&quot;User&quot; type=&quot;com.github.hcsp.sql.Sql$User&quot;/&gt;</span><br><span class="line">    &lt;/typeAliases&gt;</span><br><span class="line">    &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">                &lt;property name=&quot;driver&quot; value=&quot;org.h2.Driver&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:h2:file:/Users/huangjiaxi/Downloads/practise-select-sql/target/test&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">                &lt;property name=&quot;password&quot; value=&quot;Jxi1Oxc92qSj&quot;/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;db/myBatis/UserMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># 第二步修改 UserMapper.xml</span><br><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>写参数是按照 Java Bean约定的 getter/setter</p>
</li>
</ul>
</li>
<li>Association</li>
</ul>
<blockquote>
<p>返回为map</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 修改UserMapper.xml</span><br><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">      select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"># 此时返回的是 map</span><br><span class="line"># 如下</span><br><span class="line">[</span><br><span class="line">&#123;CREATED_AT=2019-10-31 21:30:05.072, ADDRESS=beijing, TEL=tel1, UPDATED_AT=2019-10-31 21:30:05.072, ID=1, NAME=zhangsan&#125;, </span><br><span class="line">&#123;CREATED_AT=2019-10-31 21:30:05.072, ADDRESS=shanghai, TEL=tel2, UPDATED_AT=2019-10-31 21:30:05.072, ID=2, NAME=lisi&#125;, </span><br><span class="line">&#123;CREATED_AT=2019-10-31 21:30:05.072, ADDRESS=shanghai, TEL=tel3, UPDATED_AT=2019-10-31 21:30:05.072, ID=3, NAME=wangwu&#125;,</span><br><span class="line">&#123;CREATED_AT=2019-10-31 21:30:05.072, ADDRESS=shenzhen, TEL=tel4, UPDATED_AT=2019-10-31 21:30:05.072, ID=4, NAME=zhangsan&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我想返回的是一个User</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 修改UserMapper.xml</span><br><span class="line"># com.github.hcsp.sql.Sql$User  &quot;$&quot;代表连接的是内部类</span><br><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;com.github.hcsp.sql.Sql$User&quot;&gt;</span><br><span class="line">      select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line"># 返回数据为</span><br><span class="line">[</span><br><span class="line">User&#123;id=1, name=&apos;zhangsan&apos;, tel=&apos;tel1&apos;, address=&apos;beijing&apos;&#125;, </span><br><span class="line">User&#123;id=2, name=&apos;lisi&apos;, tel=&apos;tel2&apos;, address=&apos;shanghai&apos;&#125;, </span><br><span class="line">User&#123;id=3, name=&apos;wangwu&apos;, tel=&apos;tel3&apos;, address=&apos;shanghai&apos;&#125;, </span><br><span class="line">User&#123;id=4, name=&apos;zhangsan&apos;, tel=&apos;tel4&apos;, address=&apos;shenzhen&apos;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="他们的值是怎么设置进去的？"><a href="#他们的值是怎么设置进去的？" class="headerlink" title="他们的值是怎么设置进去的？"></a>他们的值是怎么设置进去的？</h4><p>答案是：<strong>Java Bean</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果没有 setId() 会咋样？</span><br><span class="line"></span><br><span class="line">答案是 扫这个 Bean 是否是 id 这个 field</span><br></pre></td></tr></table></figure>
<h4 id="需求变更，我要找id-1的用户"><a href="#需求变更，我要找id-1的用户" class="headerlink" title="需求变更，我要找id=1的用户"></a>需求变更，我要找id=1的用户</h4><blockquote>
<p>修改 UserMapper.xml</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;com.sql.xml.UserMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectUser&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">      select * from user where id=#&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">修改 之前的查询语句</span><br><span class="line">public static void main(String[] args) throws SQLException, IOException &#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    try (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line"></span><br><span class="line">        User user = new User();</span><br><span class="line">        user.id = 3;</span><br><span class="line">        // 传递一个 user 对象进去</span><br><span class="line">        System.out.println( session.selectList(</span><br><span class="line">                    &quot;com.sql.xml.UserMapper.selectUser&quot;,</span><br><span class="line">                        user</span><br><span class="line">                    )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 返回</span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: select * from user where id=? </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: 3(Integer)</span><br><span class="line">DEBUG [main] - &lt;==      Total: 1</span><br><span class="line">[User&#123;id=3, name=&apos;wangwu&apos;, tel=&apos;tel3&apos;, address=&apos;shanghai&apos;&#125;]</span><br></pre></td></tr></table></figure>
<h4 id="参数的-和-的区别"><a href="#参数的-和-的区别" class="headerlink" title="参数的 ${} 和 #{}的区别"></a>参数的 <code>${} 和 #{}</code>的区别</h4><ul>
<li><code>#{}</code> 把传入的值带入， <strong>防sql注入</strong></li>
<li><code>${}</code> 替换这个值,它会带来 “注入” 问题</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">User user = new User();</span><br><span class="line">user.name = &quot;wangwu&quot;;</span><br><span class="line">// 传递一个 user 对象进去</span><br><span class="line">System.out.println( session.selectList(</span><br><span class="line">            &quot;com.sql.xml.UserMapper.selectUser&quot;,</span><br><span class="line">                user</span><br><span class="line">            )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 如果 sql是这样</span><br><span class="line">select * from user where name=#&#123;name&#125;</span><br><span class="line">select * from user where name=&quot;wangwu&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如果 sql是这样</span><br><span class="line">select * from user where name=$&#123;name&#125;</span><br><span class="line">select * from user where name=wangwu // 这会报错的</span><br><span class="line">你只能这样</span><br><span class="line">select * from user where name=&apos;$&#123;name&#125;&apos;</span><br></pre></td></tr></table></figure>
<h4 id="这个User对象是必须的吗？"><a href="#这个User对象是必须的吗？" class="headerlink" title="这个User对象是必须的吗？"></a>这个User对象是必须的吗？</h4><p>不是：你可以用map</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; param = new HashMap&lt;&gt;();</span><br><span class="line">param.put(&quot;name&quot;,&quot;wangwu&quot;);</span><br><span class="line">System.out.println( session.selectList(</span><br><span class="line">        &quot;com.sql.xml.UserMapper.selectUser&quot;,</span><br><span class="line">        param</span><br><span class="line">        )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/31/ZB-034-02MyBatis的xml方式/" data-id="ckkmr2k9800t8fp91mv837ifj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-033-02注解如何工作的" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/30/ZB-033-02注解如何工作的/" class="article-date">
  <time datetime="2019-10-30T15:26:45.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/30/ZB-033-02注解如何工作的/">ZB-033-02注解如何工作的</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="注解是如何⼯作的？"><a href="#注解是如何⼯作的？" class="headerlink" title="注解是如何⼯作的？"></a>注解是如何⼯作的？</h3><ul>
<li>注解仅仅是⼀段信息，它⾃⼰⽆法⼯作</li>
<li>换句话说，没有东⻄处理它们的话，注解没有任何卵⽤</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/30/ZB-033-02注解如何工作的/" data-id="ckkmr2k9600t4fp912jz2juq0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-033-01注解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/30/ZB-033-01注解/" class="article-date">
  <time datetime="2019-10-30T12:22:40.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/30/ZB-033-01注解/">ZB-033-01注解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="注解是什么"><a href="#注解是什么" class="headerlink" title="注解是什么"></a>注解是什么</h3><ul>
<li>还记得Class是什么么？<ul>
<li>Class是Java类的说明书(堆里的某个地方存着)</li>
<li>你（还可以通过反射）或者JVM通过阅读该说明书，创建类的实例</li>
</ul>
</li>
<li>注解就是说明书中的⼀⼩段信息/⽂本/标记/标签<ul>
<li>Annotation</li>
<li>可以携带参数</li>
<li>可以在运⾏时被阅读</li>
</ul>
</li>
</ul>
<p>举例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">你的衣服里，有个说明书写着 涤纶 不可水洗... 一些洗涤信息</span><br><span class="line"></span><br><span class="line">狼人杀 的身份 狼人/村民... </span><br><span class="line">王者荣耀的位置  打野/法师/射手/ADC/肉</span><br><span class="line">渣男 ... </span><br><span class="line"></span><br><span class="line">这些都是一种标签</span><br></pre></td></tr></table></figure>
<p>例子代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class AuthController &#123;</span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    private AuthenticationManager authentionManager;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    public AuthController(UserService userService , AuthenticationManager authentionManager) &#123;</span><br><span class="line">        this.userService = userService;</span><br><span class="line">        this.authentionManager = authentionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/auth&quot;)</span><br><span class="line">    @ResponseBody //方法的返回值限定在 response body里</span><br><span class="line">    public Object auth()&#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是注解的一切。</p>
<blockquote>
<p>为什么加了<code>@xxx</code> 之后就莫名其妙成功了？</p>
</blockquote>
<ul>
<li>注解就是一小段信息，至于怎么处理注解这段信息，不是注解关心的问题</li>
</ul>
<h3 id="注解的写法"><a href="#注解的写法" class="headerlink" title="注解的写法"></a>注解的写法</h3><ul>
<li>新建⼀个类的时候选择注解</li>
<li>元注解<ul>
<li>@Rentention</li>
<li>@Target</li>
<li>@Documented</li>
<li>@Inherited  继承 子类还可以看到这个注解 没卵用</li>
<li>@Repeatable  可以重复 平时用不到</li>
</ul>
</li>
</ul>
<blockquote>
<p>写一个我们的注解</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com;</span><br><span class="line"></span><br><span class="line">@interface SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class MyApplication &#123;</span><br><span class="line"></span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    private String user;</span><br><span class="line"></span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    public void OrderService()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 可以加在 Class上</span><br><span class="line">// 可以加在 成员变量上</span><br><span class="line">// 可以加在 方法上</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注解 <code>@Target</code> 和 <code>@</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// 只允许放在方法上</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@interface SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Target(&#123;</span><br><span class="line">        ElementType.METHOD, // 只允许放在方法上</span><br><span class="line">        ElementType.CONSTRUCTOR,// 只允许放在构造器上</span><br><span class="line">        ElementType.FIELD,// 只允许放在 字段上</span><br><span class="line">        ElementType.TYPE ,// 只允许放在 类型上</span><br><span class="line">        ElementType.PARAMETER, // 只允许放在 参数上</span><br><span class="line">        ElementType.TYPE_PARAMETER, // 类型参数</span><br><span class="line">         ElementType.PACKAGE , // 放在包上</span><br><span class="line">&#125;)</span><br><span class="line">@interface SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class MyApplication &#123;</span><br><span class="line"></span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    public MyApplication(String user) &#123;</span><br><span class="line">        this.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    private String user;</span><br><span class="line"></span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    public void OrderService(@SpringBootApplication String xx)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Retention(RetentionPolicy.CLASS) </span><br><span class="line">@interface SpringBootApplication &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// RetentionPolicy.SOURCE 注解会被编译器丢弃</span><br><span class="line">// RetentionPolicy.CLASS 默认行为，会被虚拟机记录下来 记录在 class文件里 但不会被虚拟机运行的时候保留</span><br><span class="line">// RetentionPolicy.RUNTIME 注解会被记录在编译器也会在 虚拟机运行时 保留</span><br><span class="line"></span><br><span class="line">// 反射拿不到 SOURCE/CLASS 等级的注解信息</span><br></pre></td></tr></table></figure>
<h3 id="注解的属性"><a href="#注解的属性" class="headerlink" title="注解的属性"></a>注解的属性</h3><blockquote>
<p>可以有哪些？</p>
<ul>
<li>基本数据类型+String+类以及它们的数组</li>
<li>默认值</li>
<li>名为value的属性</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">比如一件外套 </span><br><span class="line">它的说明书(注解)</span><br><span class="line"></span><br><span class="line">@洗涤手段([干洗])</span><br><span class="line">class 外套</span><br><span class="line"></span><br><span class="line">@洗涤手段([水洗])</span><br><span class="line">class 毛衣</span><br><span class="line"></span><br><span class="line">看代码</span><br><span class="line">package com;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">@Target(&#123;</span><br><span class="line">        ElementType.METHOD,</span><br><span class="line">        ElementType.CONSTRUCTOR,</span><br><span class="line">        ElementType.FIELD,</span><br><span class="line">        ElementType.TYPE,</span><br><span class="line">        ElementType.PARAMETER,</span><br><span class="line">        ElementType.TYPE_PARAMETER,</span><br><span class="line">        ElementType.PACKAGE</span><br><span class="line">&#125;)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">@interface 洗涤手段 &#123;</span><br><span class="line"></span><br><span class="line">    // 属性仅仅支持 基本数据类型 + String + 类 以及它们的数组</span><br><span class="line">    String value() default &quot;干洗&quot;;</span><br><span class="line">    // 成分</span><br><span class="line">    String[] 成分() default &quot;纯棉&quot;;</span><br><span class="line">    </span><br><span class="line">    // 还可以这样 Class a();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@洗涤手段(value =&quot;水洗&quot;,成分=&#123;&quot;纯棉&quot;,&quot;涤纶&quot;&#125;)</span><br><span class="line">public class 毛衣 &#123;</span><br><span class="line"></span><br><span class="line">    @洗涤手段</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @洗涤手段</span><br><span class="line">    public void 洗衣服(@洗涤手段 String xx)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="JDK的⾃带注解-了解即可"><a href="#JDK的⾃带注解-了解即可" class="headerlink" title="JDK的⾃带注解(了解即可)"></a>JDK的⾃带注解(了解即可)</h4><ul>
<li>@Deprecated 提示你这是个被废弃的方法</li>
<li>@Override</li>
<li>@SuppressWarnings  忽略警告</li>
<li>@FunctionalInterface  标记警告 仅仅用来标记 删了也能正常工作</li>
</ul>
<blockquote>
<p>@Override 目的是防止你犯错误</p>
</blockquote>
<ul>
<li>它不是强制的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    static class Animal&#123;</span><br><span class="line">        void xxxx1234567890()&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Cat extends Animal&#123;</span><br><span class="line">        @Override</span><br><span class="line">        void xxxx1234567890() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 没有注解 你拼错了 以为自己重写了 实际没有</span><br><span class="line">        void xxxx12345678901() &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>@SuppressWarnings</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 忽略警告</span><br><span class="line">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    List list = new ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">    list.add(0);</span><br><span class="line">    list.get(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="扩展链接"><a href="#扩展链接" class="headerlink" title="扩展链接"></a>扩展链接</h4></blockquote>
<ul>
<li><a href="https://blog.csdn.net/qq1404510094/article/details/80577555" target="_blank" rel="noopener">https://blog.csdn.net/qq1404510094/article/details/80577555</a></li>
<li><a href="https://www.cnblogs.com/yangming1996/p/9295168.html" target="_blank" rel="noopener">https://www.cnblogs.com/yangming1996/p/9295168.html</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/30/ZB-033-01注解/" data-id="ckkmr2k9600t3fp91mbnpl0hf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-032-02范型的绑定" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/30/ZB-032-02范型的绑定/" class="article-date">
  <time datetime="2019-10-30T12:21:30.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/30/ZB-032-02范型的绑定/">ZB-032-02范型的绑定</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>先看这样的代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static Integer max(Integer a , Integer b)&#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static Long max(Long a , Long b)&#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static Double max(Double a , Double b)&#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 很啰嗦很重复</span><br></pre></td></tr></table></figure>
<p>有了范型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 第一步简化代码成这样</span><br><span class="line">public static T max (T a, T b)&#123;</span><br><span class="line">    // 此时 范型类型实际是 Object 因此 是不能用 &gt; 或者 &lt; 的</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line">// 第二步 你知道 Integer/Long/Double 都是 Number的子类型 它们都是实现了Comparable接口 因此是可以比较的</span><br><span class="line"></span><br><span class="line">// 定义传递的范型的一个约定 是 继承 Comparable 的因此可以 compareTo 的</span><br><span class="line">public static &lt;T extends Comparable&gt; T max (T a, T b)&#123;</span><br><span class="line">    return a.compareTo(b) &gt;= 0 ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">max(1.0,2.0); // 你传递的是 Double 因此返回是 Double</span><br><span class="line">max(1,2); // 你传递的是 Integer 因此返回是 Integer</span><br><span class="line">max(1L,2L); // 你传递的是 Long 因此返回是 Long</span><br><span class="line">max(&quot;aaa&quot;,&quot;bbb&quot;); // 你传递的是 String 因此返回是 String</span><br></pre></td></tr></table></figure>
<blockquote>
<p>让你疑惑的地方 <code>max(&quot;aaa&quot;,1)</code> 竟然通过了编译为什么？</p>
</blockquote>
<ul>
<li>范型的约束条件是 <code>&lt;T extends Comparable&gt;</code></li>
<li>String/Integer 都是 Comparable 的实现类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T extends Comparable&gt; T max (T a, T b)&#123;</span><br><span class="line">    return a.compareTo(b) &gt;= 0 ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">max(&quot;aaa&quot;,1)</span><br><span class="line">// 等价于 max(Comparable,Comparable)</span><br></pre></td></tr></table></figure>
<p><strong>虽然能通过编译，但是运行会报错，在本文最后会解释</strong></p>
<blockquote>
<p>传递多个类型</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;A extends Comparable,B extends Comparable,C extends Comparable&gt; A max2 (A a,  B b, C c)&#123;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>取第一个list第一个元素</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static String first(List&lt;String&gt; list)&#123;</span><br><span class="line">    return list.get(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static Integer first(List&lt;Integer&gt; list)&#123;</span><br><span class="line">    return list.get(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用范型后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T&gt; T first(List&lt;T&gt; list)&#123;</span><br><span class="line">    return list.get(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="范型的绑定"><a href="#范型的绑定" class="headerlink" title="范型的绑定"></a>范型的绑定</h3><ul>
<li><code>? extends</code>要求范型是某种类型及其子类型</li>
<li><code>? super</code> 要求范型是某种类型及其父类型</li>
<li><code>Collections.sort</code></li>
</ul>
<blockquote>
<p>按照参数绑定</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T extends Comparable&gt; T max (T a, T b)&#123;</span><br><span class="line">    return a.compareTo(b) &gt;= 0 ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>按照返回值绑定</p>
</blockquote>
<p>让一个方法的返回值根据接受者动态的去改变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        String s = cast(&quot;&quot;);</span><br><span class="line">        Object o = cast(new Object());</span><br><span class="line">        Integer i = cast(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static &lt;T&gt; T cast(Object obj)&#123;</span><br><span class="line">        return (T) obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>? super xx</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package com.loder.demo;</span><br><span class="line"></span><br><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    static class Animal&#123;&#125;</span><br><span class="line"></span><br><span class="line">    static class Cat extends Animal&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static &lt;T&gt; void sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c)&#123;</span><br><span class="line">        list.sort(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class AnimalComparator implements Comparator&lt;Animal&gt;&#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int compare(Animal o1, Animal o2) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class CatComparator implements Comparator&lt;Cat&gt;&#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int compare(Cat o1, Cat o2) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // List&lt;T&gt; list, Comparator&lt;? super T&gt; c</span><br><span class="line">        // 除了 Cat 还可以是 Cat 的父类型</span><br><span class="line">        sort(new ArrayList&lt;Cat&gt;(),new CatComparator());</span><br><span class="line">        sort(new ArrayList&lt;Cat&gt;(),new AnimalComparator());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="翻车问题重现"><a href="#翻车问题重现" class="headerlink" title="翻车问题重现"></a>翻车问题重现</h3><blockquote>
<p><code>max(&quot;aa&quot;,1)</code> 通过编译，但是运行报错？</p>
</blockquote>
<ul>
<li>通过编译时因为刚才说了 <code>String/Integer都是 Comparable 的子类型</code></li>
<li>报错是因为Comparable没有范型参数 导致传入的是一个裸类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static &lt;T extends Comparable&gt; T max (T a, T b)&#123;</span><br><span class="line">        return a.compareTo(b) &gt;= 0 ? a : b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       max(&quot;aa&quot;,1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 报错</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String</span><br></pre></td></tr></table></figure>
<p>修改代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T extends Comparable&lt;T&gt;&gt; T max (T a, T b)&#123;</span><br><span class="line">    return a.compareTo(b) &gt;= 0 ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 此时 编译期就报错了</span><br><span class="line"> max(&quot;aa&quot;,1);</span><br></pre></td></tr></table></figure>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p><a href="https://github.com/hcsp/make-method-generic" target="_blank" rel="noopener">将方法范型化</a></p>
</blockquote>
<ul>
<li><a href="https://github.com/hcsp/make-method-generic/pull/14" target="_blank" rel="noopener">PR</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    // 这里有四个结构、功能非常相似的方法，请尝试将其范型化，以简化代码</span><br><span class="line">    // 范型化之后的方法签名应该如下所示：</span><br><span class="line">    // public static boolean inAscOrder(T a, T b, T c)</span><br><span class="line">    public static boolean inAscOrder1(int a, int b, int c) &#123;</span><br><span class="line">        return a &lt;= b &amp;&amp; b &lt;= c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static boolean inAscOrder2(long a, long b, long c) &#123;</span><br><span class="line">        return a &lt;= b &amp;&amp; b &lt;= c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static boolean inAscOrder3(double a, double b, double c) &#123;</span><br><span class="line">        return a &lt;= b &amp;&amp; b &lt;= c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static &lt;T extends Comparable&lt;T&gt;&gt; boolean inAscOrder(T a, T b, T c)&#123;</span><br><span class="line">        return a.compareTo(b) &lt;= 0 &amp;&amp; b.compareTo(c) &lt;= 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(inAscOrder1(1, 2, 3));</span><br><span class="line">        System.out.println(inAscOrder2(1L, 2L, 3L));</span><br><span class="line">        System.out.println(inAscOrder3(1d, 2d, 3d));</span><br><span class="line"></span><br><span class="line">        System.out.println(inAscOrder(1, 2, 3));</span><br><span class="line">        System.out.println(inAscOrder(1L, 2L, 3L));</span><br><span class="line">        System.out.println(inAscOrder(1d, 2d, 3d));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://github.com/hcsp/generic-binary-tree" target="_blank" rel="noopener">范型化的二叉树</a></p>
</blockquote>
<ul>
<li><a href="https://github.com/hcsp/generic-binary-tree/pull/12" target="_blank" rel="noopener">PR</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package com.github.hcsp.generics;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class Main &#123;</span><br><span class="line">    static class IntBinaryTreeNode &#123;</span><br><span class="line">        int value;</span><br><span class="line">        IntBinaryTreeNode left;</span><br><span class="line">        IntBinaryTreeNode right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class StringBinaryTreeNode &#123;</span><br><span class="line">        String value;</span><br><span class="line">        StringBinaryTreeNode left;</span><br><span class="line">        StringBinaryTreeNode right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class DoubleBinaryTreeNode &#123;</span><br><span class="line">        double value;</span><br><span class="line">        DoubleBinaryTreeNode left;</span><br><span class="line">        DoubleBinaryTreeNode right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 你看，上面三种&quot;二叉树节点&quot;结构相似，内容重复，请将其范型化，以节省代码</span><br><span class="line">    static class BinaryTreeNode&lt;T&gt; &#123;</span><br><span class="line">        T value;</span><br><span class="line">        BinaryTreeNode&lt;T&gt; left;</span><br><span class="line">        BinaryTreeNode&lt;T&gt; right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 范型化之后，请再编写一个算法，对二叉树进行中序遍历，返回中序遍历的结果</span><br><span class="line">    public static &lt;T&gt; List&lt;T&gt; inorderTraversal(BinaryTreeNode&lt;T&gt; root) &#123;</span><br><span class="line">        ArrayList&lt;T&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        collectValue(root, list);</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static &lt;T&gt; void collectValue(BinaryTreeNode&lt;T&gt; node, ArrayList&lt;T&gt; list) &#123;</span><br><span class="line">        if (node == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // 中序遍历递归 先左 再root 最后右</span><br><span class="line">        collectValue(node.left, list);</span><br><span class="line">        list.add(node.value);</span><br><span class="line">        collectValue(node.right, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/30/ZB-032-02范型的绑定/" data-id="ckkmr2k9500t0fp91bbmtayhm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-032-01范型的由来和范型擦除" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/30/ZB-032-01范型的由来和范型擦除/" class="article-date">
  <time datetime="2019-10-30T12:20:49.000Z" itemprop="datePublished">2019-10-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/30/ZB-032-01范型的由来和范型擦除/">ZB-032-01范型的由来和范型擦除</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="没有范型之前实现类型安全"><a href="#没有范型之前实现类型安全" class="headerlink" title="没有范型之前实现类型安全"></a>没有范型之前实现类型安全</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    // 只能存放字符串 的 list</span><br><span class="line">    public static class StringList&#123;</span><br><span class="line">        public List list = new ArrayList();</span><br><span class="line"></span><br><span class="line">        public void add(String s)&#123;</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String get(int i)&#123;</span><br><span class="line">            return (String) list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int size()&#123;</span><br><span class="line">            return list.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 只能存放整数 的 list</span><br><span class="line">    public static class IntList&#123;</span><br><span class="line">        public List list = new ArrayList();</span><br><span class="line"></span><br><span class="line">        public void add(Integer s)&#123;</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Integer get(int i)&#123;</span><br><span class="line">            return (int) list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int size()&#123;</span><br><span class="line">            return list.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 从 String 到 Object 的映射</span><br><span class="line">    public static class StringObjectMap&#123;</span><br><span class="line">        Map map = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        public void put(String key,Object value)&#123;</span><br><span class="line">            map.put(key,value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public Object get(String key)&#123;</span><br><span class="line">            return map.get(key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        StringList stringList = new StringList();</span><br><span class="line">        stringList.add(&quot;a&quot;);</span><br><span class="line">        stringList.add(&quot;b&quot;);</span><br><span class="line"></span><br><span class="line">        IntList intList = new IntList();</span><br><span class="line">        intList.add(1);</span><br><span class="line">        intList.add(2);</span><br><span class="line"></span><br><span class="line">        StringObjectMap map = new StringObjectMap();</span><br><span class="line">        map.put(&quot;name&quot;,&quot;xxx&quot;);</span><br><span class="line">        map.put(&quot;age&quot;,18);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>很麻烦对不对~</li>
<li>在上古时代 用刀耕火种的手段达到 类型安全的目的</li>
<li>没有范型的年代 非常累  <a href="https://www.zhihu.com/question/62991191/answer/367617001" target="_blank" rel="noopener">go 语言到现在都没有范型(2019-10-30)</a></li>
</ul>
<h4 id="java1-5之后范型出现了"><a href="#java1-5之后范型出现了" class="headerlink" title="java1.5之后范型出现了"></a>java1.5之后范型出现了</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; stringList2 = new ArrayList&lt;&gt;();</span><br><span class="line">        stringList.add(&quot;a&quot;);</span><br><span class="line">        stringList.add(&quot;b&quot;);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Integer&gt; intList2 = new ArrayList&lt;&gt;();</span><br><span class="line">        intList2.add(1);</span><br><span class="line">        intList2.add(2);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String,Object&gt; map2 = new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;name&quot;,&quot;xxx&quot;);</span><br><span class="line">        map.put(&quot;age&quot;,18);</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时你再也不用写之前麻烦的代码</p>
<h4 id="看一看范型类-ArrayList-的定义"><a href="#看一看范型类-ArrayList-的定义" class="headerlink" title="看一看范型类 ArrayList 的定义"></a>看一看范型类 ArrayList 的定义</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="ArrayList-lt-E-gt-里的E是什么"><a href="#ArrayList-lt-E-gt-里的E是什么" class="headerlink" title="ArrayList&lt;E&gt; 里的E是什么"></a><code>ArrayList&lt;E&gt;</code> 里的E是什么</h4></blockquote>
<ul>
<li>一个范型有一个类型声明(声明在类上) <code>ArrayList&lt;E&gt;</code> E </li>
<li>可以通过传递一个参数进去，把这个类型变成全新的类型  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt;</span><br><span class="line">ArrayList&lt;Integer&gt;</span><br><span class="line">ArrayList&lt;Cat&gt;</span><br><span class="line">ArrayList&lt;Dog&gt;</span><br><span class="line">// 你传递什么类型 它就变成什么类型</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<h4 id="问题来了"><a href="#问题来了" class="headerlink" title="问题来了"></a>问题来了</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = new ArrayList&lt;&gt;();</span><br><span class="line">ArrayList&lt;Integer&gt; list2 = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">list1.add(1); // 报错  只能添加 String 类型</span><br><span class="line">list2.add(&quot;1&quot;); // 报错 只能添加 Integer 类型</span><br><span class="line">// 报错 不能相互赋值</span><br><span class="line">ArrayList&lt;Integer&gt; list1 = new ArrayList&lt;String&gt;();</span><br></pre></td></tr></table></figure>
<ul>
<li>它俩的区别，它们还是同一个类吗？</li>
</ul>
<p>答案是：<strong>它们是同一个类，也不是同一个类</strong></p>
<blockquote>
<p>它是同一个类，因为有 <strong>擦除</strong></p>
</blockquote>
<blockquote>
<p>它不是同一个类，因为不能相互赋值</p>
</blockquote>
<h4 id="范型好处"><a href="#范型好处" class="headerlink" title="范型好处"></a>范型好处</h4><ul>
<li>类型安全</li>
<li>方便</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">HashMap hashMap = new HashMap();</span><br><span class="line">// 它的 key是 String, value 也是 String</span><br><span class="line">hashMap.put(&quot;name&quot;,&quot;abc&quot;);</span><br><span class="line">hashMap.put(&quot;age&quot;,&quot;18&quot;);</span><br><span class="line"></span><br><span class="line">for (Object key: hashMap.keySet()) &#123;</span><br><span class="line">    String stringKey = (String)key;</span><br><span class="line">    String stringValue = (String)hashMap.get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如果你用的是范型就不需要这样转换类型</span><br><span class="line">HashMap&lt;String,String&gt; hashMap2 = new HashMap();</span><br><span class="line">// 它的 key是 String, value 也是 String</span><br><span class="line">hashMap2.put(&quot;name&quot;,&quot;abc&quot;);</span><br><span class="line">hashMap2.put(&quot;age&quot;,&quot;18&quot;);</span><br><span class="line"></span><br><span class="line">for (String key: hashMap2.keySet()) &#123;</span><br><span class="line">    String key2 = key;</span><br><span class="line">    String value2 = hashMap2.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="因此有了范型"><a href="#因此有了范型" class="headerlink" title="因此有了范型"></a>因此有了范型</h3><ul>
<li>从此，我们可以省力的方法编写类型安全的代码</li>
<li>List<string></string></li>
<li>Map&lt;String,Object&gt;</li>
<li>Map&lt;Stirng,List<object>&gt;</object></li>
</ul>
<blockquote>
<p>从无范型的世界1.4到有范型的世界1.5，那我们还要支持无范型的“原始类型”的容器吗？</p>
</blockquote>
<p>答案是：我们不想支持，但是不得不支持！</p>
<p>因为<strong>向后兼容</strong>。这样的好处是 JDK1.0可以无缝在最新的JDK上运行 而且已经过了20多年了</p>
<p>反观 Python2 / Python3 它为了更好的语法特性或改正一些缺陷放弃了向后兼容性，而java为了向后兼容性放弃了更好地语法特性</p>
<h4 id="因为向后兼容性带来的问题"><a href="#因为向后兼容性带来的问题" class="headerlink" title="因为向后兼容性带来的问题"></a>因为向后兼容性带来的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List list = new ArrayList();</span><br><span class="line">list.add(new Object());</span><br><span class="line">list.add(1);</span><br><span class="line">list.add(&quot;123&quot;);</span><br><span class="line">// 假设穿越到95年</span><br><span class="line">// list 可以添加任何类型没有限制</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.zhihu.com/question/28665443" target="_blank" rel="noopener">java向后兼容性</a></li>
<li>为了兼容性，只有两个选择<ul>
<li>1擦除 java的选择</li>
<li>2搞一套全新的API，C#的选择</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么选择擦除</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">JDK1.0的时候就存在的容器 </span><br><span class="line">它们是被废弃的容器</span><br><span class="line">Vector</span><br><span class="line">HashTable</span><br><span class="line">JDK1.2已经分裂了一次</span><br><span class="line"></span><br><span class="line">JDK1.5 范型的时候 如果在分裂 不是不行就是有点丑</span><br></pre></td></tr></table></figure>
<h4 id="怎么实现擦除的"><a href="#怎么实现擦除的" class="headerlink" title="怎么实现擦除的"></a>怎么实现擦除的</h4><p>Main.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">    </span><br><span class="line">        String[] arr = new String[2];</span><br><span class="line">        ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后 Main.class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public Main() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        String[] arr = new String[2];</span><br><span class="line">        new ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时查看它的字节码文件 (IDEA顶部工具栏view -&gt; ShowByte code)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// class version 52.0 (52)</span><br><span class="line">// access flags 0x21</span><br><span class="line">public class com/loder/demo/Main &#123;</span><br><span class="line"></span><br><span class="line">  // compiled from: Main.java</span><br><span class="line"></span><br><span class="line">  // access flags 0x1</span><br><span class="line">  public &lt;init&gt;()V</span><br><span class="line">   L0</span><br><span class="line">    LINENUMBER 5 L0</span><br><span class="line">    ALOAD 0</span><br><span class="line">    INVOKESPECIAL java/lang/Object.&lt;init&gt; ()V</span><br><span class="line">    RETURN</span><br><span class="line">   L1</span><br><span class="line">    LOCALVARIABLE this Lcom/loder/demo/Main; L0 L1 0</span><br><span class="line">    MAXSTACK = 1</span><br><span class="line">    MAXLOCALS = 1</span><br><span class="line"></span><br><span class="line">  // access flags 0x9</span><br><span class="line">  public static main([Ljava/lang/String;)V</span><br><span class="line">   L0</span><br><span class="line">    LINENUMBER 9 L0</span><br><span class="line">    ICONST_2</span><br><span class="line">    ANEWARRAY java/lang/String</span><br><span class="line">    ASTORE 1</span><br><span class="line">   L1</span><br><span class="line">    LINENUMBER 10 L1</span><br><span class="line">    NEW java/util/ArrayList</span><br><span class="line">    DUP</span><br><span class="line">    INVOKESPECIAL java/util/ArrayList.&lt;init&gt; ()V</span><br><span class="line">    ASTORE 2</span><br><span class="line">   L2</span><br><span class="line">    LINENUMBER 12 L2</span><br><span class="line">    RETURN</span><br><span class="line">   L3</span><br><span class="line">    LOCALVARIABLE args [Ljava/lang/String; L0 L3 0</span><br><span class="line">    LOCALVARIABLE arr [Ljava/lang/String; L1 L3 1</span><br><span class="line">    LOCALVARIABLE list Ljava/util/ArrayList; L2 L3 2</span><br><span class="line">    // signature Ljava/util/ArrayList&lt;Ljava/lang/String;&gt;;</span><br><span class="line">    // declaration: list extends java.util.ArrayList&lt;java.lang.String&gt;</span><br><span class="line">    MAXSTACK = 2</span><br><span class="line">    MAXLOCALS = 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 你会惊讶的看到 ArrayList&lt;String&gt;上的 String 怎么没了</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为什么说java的范型是一个假范型</p>
</blockquote>
<ul>
<li>因为java的运行只看字节码，而字节码里ArrayList没有范型信息 String (它被擦除了)</li>
</ul>
<p>这就是为什么说java是假范型的原因</p>
<p>因此称这个过程为 <strong>类型擦除</strong></p>
<h4 id="擦除带来的问题"><a href="#擦除带来的问题" class="headerlink" title="擦除带来的问题"></a>擦除带来的问题</h4><ul>
<li>Java的范型是编译器的范型<ul>
<li>范型信息在运行期完全不保留<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = new ArrayList&lt;&gt;();</span><br><span class="line">list1.add(1); // 编译器报错 提示你不能添加 不是 String的类型到 list1</span><br><span class="line"></span><br><span class="line">List list = new ArrayList();</span><br><span class="line">list.add(new Object()); // 此时编译器会给你警告 说你声明的list没有范型</span><br><span class="line">list.add(1);</span><br><span class="line">list.add(&quot;123&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="编译器的警告"><a href="#编译器的警告" class="headerlink" title="编译器的警告"></a>编译器的警告</h4><blockquote>
<h4 id="使用限定符List-lt-gt-的"><a href="#使用限定符List-lt-gt-的" class="headerlink" title="使用限定符List&lt;?&gt; 的"></a>使用限定符<code>List&lt;?&gt;</code> 的</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List list = new ArrayList(); </span><br><span class="line">list.add(new Object());</span><br><span class="line">list.add(1);</span><br><span class="line">list.add(&quot;123&quot;);</span><br><span class="line"></span><br><span class="line">//你可以这样</span><br><span class="line">List&lt;?&gt; list = new ArrayList();</span><br><span class="line">// 此时编译器标红 </span><br><span class="line">list.add(new Object());</span><br><span class="line"></span><br><span class="line">//你可以 alt + enter 代码就变成了这样</span><br><span class="line">List&lt;Object&gt; list = new ArrayList();</span><br><span class="line">list.add(new Object());</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="利用类型擦除绕过编译器检查"><a href="#利用类型擦除绕过编译器检查" class="headerlink" title="利用类型擦除绕过编译器检查"></a>利用类型擦除绕过编译器检查</h4></blockquote>
<blockquote>
<p><code>List&lt;String&gt;并不是 List&lt;Object&gt;</code>的子类型</p>
</blockquote>
<ul>
<li><code>类比String/Object,String[]/Object[]</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    static class Animal&#123;&#125;</span><br><span class="line"></span><br><span class="line">    static class Cat extends Animal&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static void foo(Animal a)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static void foo(Animal[] a)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static void foo(List&lt;Animal&gt; l)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 可以传递子类型进入</span><br><span class="line">        foo(new Animal());</span><br><span class="line">        foo(new Cat());</span><br><span class="line"></span><br><span class="line">        // 即使是数组也可以传递 子类型数组</span><br><span class="line">        foo(new Animal[2]);</span><br><span class="line">        foo(new Cat[2]);</span><br><span class="line"></span><br><span class="line">        foo(new ArrayList&lt;Animal&gt;());</span><br><span class="line">        foo(new ArrayList&lt;Cat&gt;()); // 报错 此时竟然不能传递子类型的容器</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因是：类型擦除你实际传递的是 <code>new ArrayList()</code></p>
<blockquote>
<p>另一个问题</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void foo(List&lt;Animal&gt; l)&#123;&#125;</span><br><span class="line"></span><br><span class="line">public static void foo(List l)&#123;&#125;</span><br><span class="line"></span><br><span class="line">// 看上去不一样，但是会报错，因为范型是有抹去的(擦除)</span><br><span class="line">实际它们都是</span><br><span class="line">public static void foo(List l)&#123;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>绕过编译器检查</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Animal&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">// 你可以这样</span><br><span class="line">ArrayList rawList = list;</span><br><span class="line">rawList.add(&quot;&quot;);</span><br><span class="line">rawList.add(1);</span><br><span class="line">rawList.add(new Object());</span><br><span class="line"></span><br><span class="line">// 还可以这样</span><br><span class="line">ArrayList&lt;Cat&gt; catArrayList = (ArrayList) list;</span><br></pre></td></tr></table></figure>
<h4 id="数组是真范型"><a href="#数组是真范型" class="headerlink" title="数组是真范型"></a>数组是真范型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        </span><br><span class="line">        String[] s = new String[2];</span><br><span class="line">        // 通过了检查</span><br><span class="line">        testStringArray(s);</span><br><span class="line">    &#125;</span><br><span class="line">    // 数组是真范型，即使你通过了编译期的类型检查，但是运行还是会报错</span><br><span class="line"></span><br><span class="line">    public static void testStringArray(Object[] o)&#123;</span><br><span class="line">        // 这里修改为 int 类型</span><br><span class="line">        o[0] = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 运行报错</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ArrayStoreException: java.lang.Integer</span><br></pre></td></tr></table></figure>
<blockquote>
<p>但是如果是 List 就不会报错</p>
</blockquote>
<ul>
<li>意思是只要通过编译器检查，就万事大吉了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        testListSafety((ArrayList)list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void testListSafety(List&lt;Object&gt; o)&#123;</span><br><span class="line">        // 这里添加 int 类型</span><br><span class="line">        o.add(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 不报错</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结论</p>
</blockquote>
<p>所谓的java范型是编译期的，运行时就完全没了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/30/ZB-032-01范型的由来和范型擦除/" data-id="ckkmr2k9400szfp915881tq6l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-031-01为什么需要范型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/29/ZB-031-01为什么需要范型/" class="article-date">
  <time datetime="2019-10-29T12:39:40.000Z" itemprop="datePublished">2019-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/29/ZB-031-01为什么需要范型/">ZB-031-01为什么需要范型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="为什么需要范型"><a href="#为什么需要范型" class="headerlink" title="为什么需要范型"></a>为什么需要范型</h3><p>其实它不是一开始就有的，基本所有编程语言在开始都是没范型的，如GO</p>
<p>java范型是1.5引入的</p>
<blockquote>
<p>java生产力的核心是类型安全</p>
</blockquote>
<h4 id="没有范型的年代是怎么实现类型安全的呢？"><a href="#没有范型的年代是怎么实现类型安全的呢？" class="headerlink" title="没有范型的年代是怎么实现类型安全的呢？"></a>没有范型的年代是怎么实现类型安全的呢？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package com.io.demo;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class WhiteCat extends Cat &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        List list = new ArrayList();</span><br><span class="line">        list.add(9);</span><br><span class="line">        list.add(new Object());</span><br><span class="line">        list.add(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 上古时代的 类型安全的 String  List</span><br><span class="line">    public static class StringList&#123;</span><br><span class="line">        List list = new ArrayList();</span><br><span class="line"></span><br><span class="line">        void add(String s)&#123;</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int size()&#123;</span><br><span class="line">            return list.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String get(int i)&#123;</span><br><span class="line">            return (String)list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 只能存放 Integer的 集合</span><br><span class="line">    public static class IntegerList&#123;</span><br><span class="line">        List list = new ArrayList();</span><br><span class="line"></span><br><span class="line">        void add(Integer s)&#123;</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        int size()&#123;</span><br><span class="line">            return list.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Integer get(int i)&#123;</span><br><span class="line">            return (Integer)list.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/29/ZB-031-01为什么需要范型/" data-id="ckkmr2k9300swfp91o0xhplsv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-030-05反射详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/28/ZB-030-05反射详解/" class="article-date">
  <time datetime="2019-10-28T15:53:04.000Z" itemprop="datePublished">2019-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/28/ZB-030-05反射详解/">ZB-030-05反射详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、Java-反射机制"><a href="#一、Java-反射机制" class="headerlink" title="一、Java 反射机制"></a>一、Java 反射机制</h3><p>Java 反射机制在程序运行时，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性。这种 <strong>动态的获取信息</strong> 以及 <strong>动态调用对象的方法</strong> 的功能称为 <strong>java 的反射机制</strong>。</p>
<p>反射机制很重要的一点就是“运行时”，其使得我们可以在程序运行时加载、探索以及使用编译期间完全未知的 .class 文件。换句话说，Java 程序可以加载一个运行时才得知名称的 .class 文件，然后获悉其完整构造，并生成其对象实体、或对其 fields（变量）设值、或调用其 methods（方法）。</p>
<h3 id="二、使用反射获取类的信息"><a href="#二、使用反射获取类的信息" class="headerlink" title="二、使用反射获取类的信息"></a>二、使用反射获取类的信息</h3><p>为使得测试结果更加明显，我首先定义了一个 <code>FatherClass</code> 类（默认继承自 Object 类），然后定义一个继承自 <code>FatherClass</code> 类的 <code>SonClass</code> 类，如下所示。可以看到测试类中变量以及方法的访问权限不是很规范，是为了更明显得查看测试结果而故意设置的，实际项目中不提倡这么写。</p>
<p><strong>FatherClass.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class FatherClass &#123;</span><br><span class="line">    public String mFatherName;</span><br><span class="line">    public int mFatherAge;</span><br><span class="line"></span><br><span class="line">    public void printFatherMsg()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SonClass.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class SonClass extends FatherClass&#123;</span><br><span class="line"></span><br><span class="line">    private String mSonName;</span><br><span class="line">    protected int mSonAge;</span><br><span class="line">    public String mSonBirthday;</span><br><span class="line"></span><br><span class="line">    public void printSonMsg()&#123;</span><br><span class="line">        System.out.println(&quot;Son Msg - name : &quot;</span><br><span class="line">                + mSonName + &quot;; age : &quot; + mSonAge);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setSonName(String name)&#123;</span><br><span class="line">        mSonName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setSonAge(int age)&#123;</span><br><span class="line">        mSonAge = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int getSonAge()&#123;</span><br><span class="line">        return mSonAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String getSonName()&#123;</span><br><span class="line">        return mSonName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-获取类的所有变量信息"><a href="#1-获取类的所有变量信息" class="headerlink" title="1.获取类的所有变量信息"></a>1.获取类的所有变量信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过反射获取类的所有变量</span><br><span class="line"> */</span><br><span class="line">private static void printFields()&#123;</span><br><span class="line">    //1.获取并输出类的名称</span><br><span class="line">    Class mClass = SonClass.class;</span><br><span class="line">    System.out.println(&quot;类的名称：&quot; + mClass.getName());</span><br><span class="line"></span><br><span class="line">    //2.1 获取所有 public 访问权限的变量</span><br><span class="line">    // 包括本类声明的和从父类继承的</span><br><span class="line">    Field[] fields = mClass.getFields();</span><br><span class="line"></span><br><span class="line">    //2.2 获取所有本类声明的变量（不问访问权限）</span><br><span class="line">    //Field[] fields = mClass.getDeclaredFields();</span><br><span class="line"></span><br><span class="line">    //3. 遍历变量并输出变量信息</span><br><span class="line">    for (Field field :</span><br><span class="line">            fields) &#123;</span><br><span class="line">        //获取访问权限并输出</span><br><span class="line">        int modifiers = field.getModifiers();</span><br><span class="line">        System.out.print(Modifier.toString(modifiers) + &quot; &quot;);</span><br><span class="line">        //输出变量的类型及变量名</span><br><span class="line">        System.out.println(field.getType().getName()</span><br><span class="line">                 + &quot; &quot; + field.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码注释很详细，就不再解释了。需要注意的是注释中 2.1 的 <code>getFields()</code> 与 2.2的 <code>getDeclaredFields()</code> 之间的区别，下面分别看一下两种情况下的输出。看之前强调一下：<code>SonClass extends FatherClass extends  Object</code> ：</p>
<ul>
<li><p>调用 <code>getFields()</code> 方法，输出 <code>SonClass</code> 类以及其所继承的父类( 包括 <code>FatherClass</code> 和 Object ) 的 public 方法。注：Object 类中没有成员变量，所以没有输出</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">类的名称：obj.SonClass</span><br><span class="line">public java.lang.String mSonBirthday</span><br><span class="line">public java.lang.String mFatherName</span><br><span class="line">public int mFatherAge</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用 <code>getDeclaredFields()</code> ， 输出 SonClass 类的所有成员变量，不问访问权限。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">类的名称：obj.SonClass</span><br><span class="line">private java.lang.String mSonName</span><br><span class="line">protected int mSonAge</span><br><span class="line">public java.lang.String mSonBirthday</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-获取类的所有方法信息"><a href="#2-获取类的所有方法信息" class="headerlink" title="2. 获取类的所有方法信息"></a>2. 获取类的所有方法信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过反射获取类的所有方法</span><br><span class="line"> */</span><br><span class="line">private static void printMethods()&#123;</span><br><span class="line">    //1.获取并输出类的名称</span><br><span class="line">    Class mClass = SonClass.class;</span><br><span class="line">    System.out.println(&quot;类的名称：&quot; + mClass.getName());</span><br><span class="line"></span><br><span class="line">    //2.1 获取所有 public 访问权限的方法</span><br><span class="line">    //包括自己声明和从父类继承的</span><br><span class="line">    Method[] mMethods = mClass.getMethods();</span><br><span class="line"></span><br><span class="line">    //2.2 获取所有本类的的方法（不问访问权限）</span><br><span class="line">    //Method[] mMethods = mClass.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">    //3.遍历所有方法</span><br><span class="line">    for (Method method :</span><br><span class="line">            mMethods) &#123;</span><br><span class="line">        //获取并输出方法的访问权限（Modifiers：修饰符）</span><br><span class="line">        int modifiers = method.getModifiers();</span><br><span class="line">        System.out.print(Modifier.toString(modifiers) + &quot; &quot;);</span><br><span class="line">        //获取并输出方法的返回值类型</span><br><span class="line">        Class returnType = method.getReturnType();</span><br><span class="line">        System.out.print(returnType.getName() + &quot; &quot;</span><br><span class="line">                + method.getName() + &quot;( &quot;);</span><br><span class="line">        //获取并输出方法的所有参数</span><br><span class="line">        Parameter[] parameters = method.getParameters();</span><br><span class="line">        for (Parameter parameter:</span><br><span class="line">             parameters) &#123;</span><br><span class="line">            System.out.print(parameter.getType().getName()</span><br><span class="line">                    + &quot; &quot; + parameter.getName() + &quot;,&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        //获取并输出方法抛出的异常</span><br><span class="line">        Class[] exceptionTypes = method.getExceptionTypes();</span><br><span class="line">        if (exceptionTypes.length == 0)&#123;</span><br><span class="line">            System.out.println(&quot; )&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            for (Class c : exceptionTypes) &#123;</span><br><span class="line">                System.out.println(&quot; ) throws &quot;</span><br><span class="line">                        + c.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同获取变量信息一样，需要注意注释中 2.1 与 2.2 的区别，下面看一下打印输出：</p>
<ul>
<li><p>调用 <code>getMethods()</code> 方法</p>
<ul>
<li><p>获取 SonClass 类所有 public 访问权限的方法，包括从父类继承的。打印信息中，printSonMsg() 方法来自 SonClass 类， printFatherMsg() 来自 FatherClass 类，其余方法来自 Object 类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">类的名称：obj.SonClass</span><br><span class="line">public void printSonMsg(  )</span><br><span class="line">public void printFatherMsg(  )</span><br><span class="line">public final void wait(  ) throws java.lang.InterruptedException</span><br><span class="line">public final void wait( long arg0,int arg1, ) throws java.lang.InterruptedException</span><br><span class="line">public final native void wait( long arg0, ) throws java.lang.InterruptedException</span><br><span class="line">public boolean equals( java.lang.Object arg0, )</span><br><span class="line">public java.lang.String toString(  )</span><br><span class="line">public native int hashCode(  )</span><br><span class="line">public final native java.lang.Class getClass(  )</span><br><span class="line">public final native void notify(  )</span><br><span class="line">public final native void notifyAll(  )</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>调用 <code>getDeclaredMethods()</code> 方法</p>
<ul>
<li>打印信息中，输出的都是 <code>SonClass</code> 类的方法，不问访问权限。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">类的名称：obj.SonClass</span><br><span class="line">private int getSonAge(  )</span><br><span class="line">private void setSonAge( int arg0, )</span><br><span class="line">public void printSonMsg(  )</span><br><span class="line">private void setSonName( java.lang.String arg0, )</span><br><span class="line">private java.lang.String getSonName(  )</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="三、访问或操作类的私有变量和方法"><a href="#三、访问或操作类的私有变量和方法" class="headerlink" title="三、访问或操作类的私有变量和方法"></a>三、访问或操作类的私有变量和方法</h3><p>在上面，我们成功获取了类的变量和方法信息，验证了在运行时   <strong>动态的获取信息</strong>  的观点。那么，仅仅是获取信息吗？我们接着往后看。</p>
<p>都知道，对象是无法访问或操作类的私有变量和方法的，但是，通过反射，我们就可以做到。没错，反射可以做到！下面，让我们一起探讨如何利用反射访问 <strong>类对象的私有方法</strong> 以及修改 <strong>私有变量或常量</strong>。</p>
<p>老规矩，先上测试类。</p>
<p>注：</p>
<ol>
<li>请注意看测试类中变量和方法的修饰符（访问权限）；</li>
<li>测试类仅供测试，不提倡实际开发时这么写 : )</li>
</ol>
<p><strong>TestClass.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class TestClass &#123;</span><br><span class="line"></span><br><span class="line">    private String MSG = &quot;Original&quot;;</span><br><span class="line"></span><br><span class="line">    private void privateMethod(String head , int tail)&#123;</span><br><span class="line">        System.out.print(head + tail);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMsg()&#123;</span><br><span class="line">        return MSG;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-1-访问私有方法"><a href="#3-1-访问私有方法" class="headerlink" title="3.1 访问私有方法"></a>3.1 访问私有方法</h4><p>以访问 <code>TestClass</code> 类中的私有方法 <code>privateMethod(...)</code> 为例，方法加参数是为了考虑最全的情况，很贴心有木有？先贴代码，看注释，最后我会重点解释部分代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 访问对象的私有方法</span><br><span class="line"> * 为简洁代码，在方法上抛出总的异常，实际开发别这样</span><br><span class="line"> */</span><br><span class="line">private static void getPrivateMethod() throws Exception&#123;</span><br><span class="line">    //1. 获取 Class 类实例</span><br><span class="line">    TestClass testClass = new TestClass();</span><br><span class="line">    Class mClass = testClass.getClass();</span><br><span class="line"></span><br><span class="line">    //2. 获取私有方法</span><br><span class="line">    //第一个参数为要获取的私有方法的名称</span><br><span class="line">    //第二个为要获取方法的参数的类型，参数为 Class...，没有参数就是null</span><br><span class="line">    //方法参数也可这么写 ：new Class[]&#123;String.class , int.class&#125;</span><br><span class="line">    Method privateMethod =</span><br><span class="line">            mClass.getDeclaredMethod(&quot;privateMethod&quot;, String.class, int.class);</span><br><span class="line"></span><br><span class="line">    //3. 开始操作方法</span><br><span class="line">    if (privateMethod != null) &#123;</span><br><span class="line">        //获取私有方法的访问权</span><br><span class="line">        //只是获取访问权，并不是修改实际权限</span><br><span class="line">        privateMethod.setAccessible(true);</span><br><span class="line"></span><br><span class="line">        //使用 invoke 反射调用私有方法</span><br><span class="line">        //privateMethod 是获取到的私有方法</span><br><span class="line">        //testClass 要操作的对象</span><br><span class="line">        //后面两个参数传实参</span><br><span class="line">        privateMethod.invoke(testClass, &quot;Java Reflect &quot;, 666);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，第3步中的 <code>setAccessible(true)</code> 方法，是获取私有方法的访问权限，如果不加会报异常 <strong>IllegalAccessException</strong>，因为当前方法访问权限是“private”的，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalAccessException: Class MainClass can not access a member of class obj.TestClass with modifiers &quot;private&quot;</span><br></pre></td></tr></table></figure>
<p>正常运行后，打印如下，调用私有方法成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Java Reflect 666</span><br></pre></td></tr></table></figure>
<h4 id="3-2-修改私有变量"><a href="#3-2-修改私有变量" class="headerlink" title="3.2 修改私有变量"></a>3.2 修改私有变量</h4><p>以修改 <code>TestClass</code> 类中的私有变量 <code>MSG</code> 为例，其初始值为 “Original” ，我们要修改为 “Modified”。老规矩，先上代码看注释。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 修改对象私有变量的值</span><br><span class="line"> * 为简洁代码，在方法上抛出总的异常</span><br><span class="line"> */</span><br><span class="line">private static void modifyPrivateFiled() throws Exception &#123;</span><br><span class="line">    //1. 获取 Class 类实例</span><br><span class="line">    TestClass testClass = new TestClass();</span><br><span class="line">    Class mClass = testClass.getClass();</span><br><span class="line"></span><br><span class="line">    //2. 获取私有变量</span><br><span class="line">    Field privateField = mClass.getDeclaredField(&quot;MSG&quot;);</span><br><span class="line"></span><br><span class="line">    //3. 操作私有变量</span><br><span class="line">    if (privateField != null) &#123;</span><br><span class="line">        //获取私有变量的访问权</span><br><span class="line">        privateField.setAccessible(true);</span><br><span class="line"></span><br><span class="line">        //修改私有变量，并输出以测试</span><br><span class="line">        System.out.println(&quot;Before Modify：MSG = &quot; + testClass.getMsg());</span><br><span class="line"></span><br><span class="line">        //调用 set(object , value) 修改变量的值</span><br><span class="line">        //privateField 是获取到的私有变量</span><br><span class="line">        //testClass 要操作的对象</span><br><span class="line">        //&quot;Modified&quot; 为要修改成的值</span><br><span class="line">        privateField.set(testClass, &quot;Modified&quot;);</span><br><span class="line">        System.out.println(&quot;After Modify：MSG = &quot; + testClass.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处代码和访问私有方法的逻辑差不多，就不再赘述，从输出信息看出 <strong>修改私有变量</strong> 成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Before Modify：MSG = Original</span><br><span class="line">After Modify：MSG = Modified</span><br></pre></td></tr></table></figure>
<h4 id="3-3-修改私有常量"><a href="#3-3-修改私有常量" class="headerlink" title="3.3 修改私有常量"></a>3.3 修改私有常量</h4><blockquote>
<p>01.真的能修改吗？</p>
</blockquote>
<p>常量是指使用 <code>final</code> 修饰符修饰的成员属性，与变量的区别就在于有无 final 关键字修饰。在说之前，先补充一个知识点。<br>Java 虚拟机（JVM）在编译 .java 文件得到 .class 文件时，会优化我们的代码以提升效率。其中一个优化就是：JVM 在编译阶段会把引用常量的代码替换成具体的常量值，如下所示（部分代码）。</p>
<p>编译前的 .java 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//注意是 String  类型的值</span><br><span class="line">private final String FINAL_VALUE = &quot;hello&quot;;</span><br><span class="line"></span><br><span class="line">if(FINAL_VALUE.equals(&quot;world&quot;))&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后得到的 .class 文件（当然，编译后是没有注释的）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private final String FINAL_VALUE = &quot;hello&quot;;</span><br><span class="line">//替换为&quot;hello&quot;</span><br><span class="line">if(&quot;hello&quot;.equals(&quot;world&quot;))&#123;</span><br><span class="line">    //do something</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是，并不是所有常量都会优化。经测试对于 int 、long 、boolean 以及 String 这些基本类型 JVM 会优化，而对于 Integer 、Long 、Boolean 这种包装类型，或者其他诸如 Date 、Object 类型则不会被优化。</p>
<p>总结来说：<strong>对于基本类型的静态常量，JVM 在编译阶段会把引用此常量的代码替换成具体的常量值。</strong></p>
<p>这么说来，在实际开发中，如果我们想修改某个类的常量值，恰好那个常量是基本类型的，岂不是无能为力了？反正我个人认为除非修改源码，否则真没办法！</p>
<p>这里所谓的无能为力是指：<strong>我们在程序运行时刻依然可以使用反射修改常量的值（后面会代码验证），但是 JVM 在编译阶段得到的 .class 文件已经将常量优化为具体的值，在运行阶段就直接使用具体的值了，所以即使修改了常量的值也已经毫无意义了。</strong></p>
<p>下面我们验证这一点，在测试类 TestClass 类中添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//String 会被 JVM 优化</span><br><span class="line">private final String FINAL_VALUE = &quot;FINAL&quot;;</span><br><span class="line"></span><br><span class="line">public String getFinalValue()&#123;</span><br><span class="line">    //剧透，会被优化为: return &quot;FINAL&quot; ,拭目以待吧</span><br><span class="line">    return FINAL_VALUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，是修改常量的值，先上代码，请仔细看注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 修改对象私有常量的值</span><br><span class="line"> * 为简洁代码，在方法上抛出总的异常，实际开发别这样</span><br><span class="line"> */</span><br><span class="line">private static void modifyFinalFiled() throws Exception &#123;</span><br><span class="line">    //1. 获取 Class 类实例</span><br><span class="line">    TestClass testClass = new TestClass();</span><br><span class="line">    Class mClass = testClass.getClass();</span><br><span class="line"></span><br><span class="line">    //2. 获取私有常量</span><br><span class="line">    Field finalField = mClass.getDeclaredField(&quot;FINAL_VALUE&quot;);</span><br><span class="line"></span><br><span class="line">    //3. 修改常量的值</span><br><span class="line">    if (finalField != null) &#123;</span><br><span class="line"></span><br><span class="line">        //获取私有常量的访问权</span><br><span class="line">        finalField.setAccessible(true);</span><br><span class="line"></span><br><span class="line">        //调用 finalField 的 getter 方法</span><br><span class="line">        //输出 FINAL_VALUE 修改前的值</span><br><span class="line">        System.out.println(&quot;Before Modify：FINAL_VALUE = &quot;</span><br><span class="line">                + finalField.get(testClass));</span><br><span class="line"></span><br><span class="line">        //修改私有常量</span><br><span class="line">        finalField.set(testClass, &quot;Modified&quot;);</span><br><span class="line"></span><br><span class="line">        //调用 finalField 的 getter 方法</span><br><span class="line">        //输出 FINAL_VALUE 修改后的值</span><br><span class="line">        System.out.println(&quot;After Modify：FINAL_VALUE = &quot;</span><br><span class="line">                + finalField.get(testClass));</span><br><span class="line"></span><br><span class="line">        //使用对象调用类的 getter 方法</span><br><span class="line">        //获取值并输出</span><br><span class="line">        System.out.println(&quot;Actually ：FINAL_VALUE = &quot;</span><br><span class="line">                + testClass.getFinalValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码不解释了，注释巨详细有木有！特别注意一下第3步的注释，然后来看看输出，已经迫不及待了，擦亮双眼：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Before Modify：FINAL_VALUE = FINAL</span><br><span class="line">After Modify：FINAL_VALUE = Modified</span><br><span class="line">Actually ：FINAL_VALUE = FINAL</span><br></pre></td></tr></table></figure>
<p>结果出来了:</p>
<p>第一句打印修改前 FINAL_VALUE 的值，没有异议；</p>
<p>第二句打印修改后常量的值，说明FINAL_VALUE确实通过反射修改了；</p>
<p>第三句打印通过   getFinalValue() 方法获取的 FINAL_VALUE 的值，但还是初始值，导致修改无效！</p>
<p>这结果你觉得可信吗？什么，你还不信？问我怎么知道 JVM 编译后会优化代码？那要不这样吧，一起来看看 TestClass.java 文件编译后得到的 TestClass.class 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class TestClass &#123;</span><br><span class="line">    private final String FINAL_VALUE = &quot;FINAL&quot;;</span><br><span class="line"></span><br><span class="line">    public TestClass() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFinalValue() &#123;</span><br><span class="line">        return &quot;FINAL&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到了吧，getFinalValue() 方法直接 return “FINAL”！同时也说明了，<strong>程序运行时是根据编译后的 .class 来执行的</strong>。</p>
<p>顺便提一下，如果你有时间，可以换几个数据类型试试，正如上面说的，有些数据类型是不会优化的。你可以修改数据类型后，根据我的思路试试，看输出觉得不靠谱就直接看 .classs 文件，一眼就能看出来哪些数据类型优化了 ，哪些没有优化。下面说下一个知识点。</p>
<h4 id="02-我就是要修改常量！"><a href="#02-我就是要修改常量！" class="headerlink" title="02.我就是要修改常量！"></a>02.我就是要修改常量！</h4><blockquote>
<p>方法一</p>
</blockquote>
<p>事实上，Java 允许我们声明常量时不赋值，但必须在构造函数中赋值。你可能会问我为什么要说这个，这就解释：</p>
<p>我们修改一下 TestClass 类，在声明常量时不赋值，然后添加构造函数并为其赋值，大概看一下修改后的代码（部分代码 ）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class TestClass &#123;</span><br><span class="line"></span><br><span class="line">    //......</span><br><span class="line">    private final String FINAL_VALUE;</span><br><span class="line"></span><br><span class="line">    //构造函数内为常量赋值 </span><br><span class="line">    public TestClass()&#123;</span><br><span class="line">        this.FINAL_VALUE = &quot;FINAL&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    //......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们再调用上面贴出的修改常量的方法，发现输出是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Before Modify：FINAL_VALUE = FINAL</span><br><span class="line">After Modify：FINAL_VALUE = Modified</span><br><span class="line">Actually ：FINAL_VALUE = Modified</span><br></pre></td></tr></table></figure>
<p>纳尼，最后一句输出修改后的值了？对，修改成功了！还得看编译后的 TestClass.class </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class TestClass &#123;</span><br><span class="line">    private final String FINAL_VALUE = &quot;FINAL&quot;;</span><br><span class="line"></span><br><span class="line">    public TestClass() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getFinalValue() &#123;</span><br><span class="line">        return this.FINAL_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下：我们将赋值放在构造函数中，构造函数是我们运行时 new 对象才会调用的，所以就不会像之前直接为常量赋值那样，在编译阶段将 getFinalValue() 方法优化为返回常量值，而是指向 FINAL_VALUE ，这样我们在运行阶段通过反射修改敞亮的值就有意义啦。但是，看得出来，程序还是有优化的，将构造函数中的赋值语句优化了。再想想那句 程序运行时是根据编译后的 .class 来执行的 ，相信你一定明白为什么这么输出了！</p>
<blockquote>
<p>方法二</p>
</blockquote>
<p>请你务必将上面捋清楚了再往下看。接下来再说一种改法，不使用构造函数，也可以成功修改常量的值，但原理上都一样。去掉构造函数，将声明常量的语句改为使用三目表达式赋值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private final String FINAL_VALUE</span><br><span class="line">        = null == null ? &quot;FINAL&quot; : null;</span><br></pre></td></tr></table></figure>
<p>其实，上述代码等价于直接为 <code>FINAL_VALUE</code> 赋值 “FINAL”，但是他就是可以！至于为什么，你这么想：<code>null == null ? &quot;FINAL&quot; : null</code> 是在运行时刻计算的，在编译时刻不会计算，也就不会被优化，所以你懂得。</p>
<p>总结来说，不管使用构造函数还是三目表达式，根本上都是<strong>避免在编译时刻被优化</strong>，这样我们通过反射修改常量之后才有意义！好了，这一小部分到此结束！</p>
<blockquote>
<p>最后的强调：</p>
</blockquote>
<p>必须提醒你的是，无论<strong>直接为常量赋值 、 通过构造函数为常量赋值</strong> 还是 <strong>使用三目运算符</strong>，实际上我们都能通过反射成功修改常量的值。而我在上面说的修改”成功”与否是指：<strong>我们在程序运行阶段通过反射肯定能修改常量值，但是实际执行优化后的 .class 文件时，修改的后值真的起到作用了吗？换句话说，就是编译时是否将常量替换为具体的值了？如果替换了，再怎么修改常量的值都不会影响最终的结果了，不是吗</strong>？。</p>
<p>其实，你可以直接这么想：<strong>反射肯定能修改常量的值，但修改后的值是否有意义</strong>？</p>
<h3 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h3><ul>
<li><a href="https://juejin.im/post/5c04892351882516e70dcc9b" target="_blank" rel="noopener">老大难的 Java ClassLoader 再不理解就老了</a></li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ul>
<li><a href="https://github.com/hcsp/map-bean-converter" target="_blank" rel="noopener">q使用反射实现一个Java Bean到Map的转换器</a></li>
<li><a href="https://github.com/hcsp/map-bean-converter/pull/18" target="_blank" rel="noopener">a</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/28/ZB-030-05反射详解/" data-id="ckkmr2k9100ssfp91h6a85vts" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ZB-030-04ClassLoader详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/28/ZB-030-04ClassLoader详解/" class="article-date">
  <time datetime="2019-10-28T15:52:36.000Z" itemprop="datePublished">2019-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/10/28/ZB-030-04ClassLoader详解/">ZB-030-04ClassLoader详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ClassLoader-做什么的？"><a href="#ClassLoader-做什么的？" class="headerlink" title="ClassLoader 做什么的？"></a>ClassLoader 做什么的？</h3><p>顾名思义，它是用来 <strong>加载 Class 的</strong> 。</p>
<p>它负责将 Class 的字节码形式转换成内存形式的 Class 对象。</p>
<blockquote>
<p>字节码的来源</p>
</blockquote>
<ul>
<li>来自于磁盘文件 *.class</li>
<li>jar 包里的 *.class</li>
<li>来自远程服务器提供的字节流</li>
</ul>
<p>字节码的本质就是一个字节数组 []byte，它有特定的复杂的内部格式。</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_030_01.png" alt="占位"></p>
<p>有很多字节码加密技术就是依靠定制 ClassLoader 来实现的。先使用工具对字节码文件进行加密，运行时使用定制的 ClassLoader 先解密文件内容再加载这些解密后的字节码。</p>
<p>每个 Class 对象的内部都有一个 classLoader 字段来标识自己是由哪个 ClassLoader 加载的。ClassLoader 就像一个容器，里面装了很多已经加载的 Class 对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Class&lt;T&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  private final ClassLoader classLoader;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h3><p>JVM 运行并不是一次性加载所需要的全部类的，它是按需加载，也就是延迟加载。程序在运行的过程中会逐渐遇到很多不认识的新类，这时候就会调用 ClassLoader 来加载这些类。加载完成后就会将 Class 对象存在 ClassLoader 里面，下次就不需要重新加载了。</p>
<p>比如你在调用某个类的静态方法时，首先这个类肯定是需要被加载的，但是并不会触及这个类的实例字段，那么实例字段的类别 Class 就可以暂时不必去加载，但是它可能会加载静态字段相关的类别，因为静态方法会访问静态字段。而实例字段的类别需要等到你实例化对象的时候才可能会加载。</p>
<h3 id="各司其职"><a href="#各司其职" class="headerlink" title="各司其职"></a>各司其职</h3><blockquote>
<p>JVM 运行实例中会存在多个 ClassLoader，不同的 ClassLoader 会从不同的地方加载字节码文件</p>
</blockquote>
<ul>
<li>它可以从不同的文件目录加载，</li>
<li>也可以从不同的 jar 文件中加载</li>
<li>也可以从网络上不同的静态文件服务器来下载字节码再加载。</li>
</ul>
<blockquote>
<h4 id="JVM-中内置了三个重要的-ClassLoader，分别是"><a href="#JVM-中内置了三个重要的-ClassLoader，分别是" class="headerlink" title="JVM 中内置了三个重要的 ClassLoader，分别是"></a>JVM 中内置了三个重要的 ClassLoader，分别是</h4></blockquote>
<ul>
<li>BootstrapClassLoader</li>
<li>ExtensionClassLoader</li>
<li>AppClassLoader。</li>
</ul>
<blockquote>
<h5 id="BootstrapClassLoader"><a href="#BootstrapClassLoader" class="headerlink" title="BootstrapClassLoader"></a>BootstrapClassLoader</h5></blockquote>
<p>负责加载 JVM 运行时核心类，这些类位于 <code>$JAVA_HOME/lib/rt.jar</code> 文件中，我们常用内置库 <code>java.xxx.*</code> 都在里面，比如 java.util.、java.io.、java.nio.、java.lang. 等等。这个 ClassLoader 比较特殊，它是由 C 代码实现的，我们将它称之为「根加载器」。</p>
<blockquote>
<h5 id="ExtensionClassLoader"><a href="#ExtensionClassLoader" class="headerlink" title="ExtensionClassLoader"></a>ExtensionClassLoader</h5></blockquote>
<p>负责加载 JVM 扩展类，比如 swing 系列、内置的 js 引擎、xml 解析器 等等，这些库名通常以 javax 开头，它们的 jar 包位于 <code>$JAVA_HOME/lib/ext/*.jar</code> 中，有很多 jar 包。</p>
<blockquote>
<h5 id="AppClassLoader"><a href="#AppClassLoader" class="headerlink" title="AppClassLoader"></a>AppClassLoader</h5></blockquote>
<p>才是直接面向我们用户的加载器，它会加载 Classpath 环境变量里定义的路径中的 jar 包和目录。我们自己编写的代码以及使用的第三方 jar 包通常都是由它来加载的。</p>
<blockquote>
<h5 id="URLClassLoader"><a href="#URLClassLoader" class="headerlink" title="URLClassLoader"></a>URLClassLoader</h5></blockquote>
<p>那些位于网络上静态文件服务器提供的 jar 包和 class文件，jdk 内置了一个 URLClassLoader，用户只需要传递规范的网络路径给构造器，就可以使用  URLClassLoader 来加载远程类库了。</p>
<p>URLClassLoader 不但可以加载远程类库，还可以加载本地路径的类库，取决于构造器中不同的地址形式。</p>
<p>ExtensionClassLoader 和 AppClassLoader 都是 URLClassLoader 的子类，它们都是从本地文件系统里加载类库。</p>
<p>AppClassLoader 可以由 ClassLoader 类提供的静态方法 getSystemClassLoader() 得到，它就是我们所说的「系统类加载器」，我们用户平时编写的类代码通常都是由它加载的。当我们的 main 方法执行的时候，这第一个用户类的加载器就是 AppClassLoader。</p>
<h3 id="ClassLoader-传递性"><a href="#ClassLoader-传递性" class="headerlink" title="ClassLoader 传递性"></a>ClassLoader 传递性</h3><p>程序在运行过程中，遇到了一个未知的类，它会选择哪个 ClassLoader 来加载它呢？虚拟机的策略是使用调用者 Class 对象的 ClassLoader 来加载当前未知的类。何为调用者 Class 对象？就是在遇到这个未知的类时，虚拟机肯定正在运行一个方法调用（静态方法或者实例方法），这个方法挂在哪个类上面，那这个类就是调用者 Class 对象。前面我们提到每个 Class 对象里面都有一个 classLoader 属性记录了当前的类是由谁来加载的。</p>
<p>因为 ClassLoader 的传递性，所有延迟加载的类都会由初始调用 main 方法的这个 ClassLoader 全全负责，它就是 AppClassLoader。</p>
<h3 id="双亲委派"><a href="#双亲委派" class="headerlink" title="双亲委派"></a>双亲委派</h3><p>前面我们提到 AppClassLoader 只负责加载 Classpath 下面的类库，如果遇到没有加载的系统类库怎么办，AppClassLoader 必须将系统类库的加载工作交给 BootstrapClassLoader 和 ExtensionClassLoader 来做，这就是我们常说的「双亲委派」。</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_030_02.png" alt="占位"></p>
<blockquote>
<h4 id="加载过程"><a href="#加载过程" class="headerlink" title="加载过程"></a>加载过程</h4></blockquote>
<p>AppClassLoader 在加载一个未知的类名时，它并不是立即去搜寻 Classpath，它会首先将这个类名称交给 ExtensionClassLoader 来加载，如果 ExtensionClassLoader 可以加载，那么 AppClassLoader 就不用麻烦了。否则它就会搜索 Classpath 。<br>而 ExtensionClassLoader 在加载一个未知的类名时，它也并不是立即搜寻 ext 路径，它会首先将类名称交给 BootstrapClassLoader 来加载，如果 BootstrapClassLoader 可以加载，那么 ExtensionClassLoader 也就不用麻烦了。否则它就会搜索 ext 路径下的 jar 包。</p>
<p>这三个 ClassLoader 之间形成了级联的父子关系，每个 ClassLoader 都很懒，尽量把工作交给父亲做，父亲干不了了自己才会干。每个 ClassLoader 对象内部都会有一个 parent 属性指向它的父加载器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class ClassLoader &#123;</span><br><span class="line">  ...</span><br><span class="line">  private final ClassLoader parent;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>值得注意的是图中的 ExtensionClassLoader 的 parent 指针画了虚线，这是因为它的 parent 的值是 null，当 parent 字段是 null 时就表示它的父加载器是「根加载器」。如果某个 Class 对象的 classLoader 属性值是 null，那么就表示这个类也是「根加载器」加载的。注意这里的 parent 不是 super 不是父类，只是 ClassLoader 内部的字段。</p>
<h3 id="Class-forName"><a href="#Class-forName" class="headerlink" title="Class.forName"></a>Class.forName</h3><p>当我们在使用 jdbc 驱动时，经常会使用 Class.forName 方法来动态加载驱动类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br></pre></td></tr></table></figure>
<p>其原理是 mysql 驱动的 Driver 类里有一个静态代码块，它会在 Driver 类被加载的时候执行。这个静态代码块会将 mysql 驱动实例注册到全局的 jdbc 驱动管理器里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Driver &#123;</span><br><span class="line">  static &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">       java.sql.DriverManager.registerDriver(new Driver());</span><br><span class="line">    &#125; catch (SQLException E) &#123;</span><br><span class="line">       throw new RuntimeException(&quot;Can&apos;t register driver!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>forName 方法同样也是使用调用者 Class 对象的 ClassLoader 来加载目标类。不过 forName 还提供了多参数版本，可以指定使用哪个 ClassLoader 来加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; forName(String name, boolean initialize, ClassLoader cl)</span><br></pre></td></tr></table></figure></p>
<p>通过这种形式的 forName 方法可以突破内置加载器的限制，通过使用自定类加载器允许我们自由加载其它任意来源的类库。根据 ClassLoader 的传递性，目标类库传递引用到的其它类库也将会使用自定义加载器加载。</p>
<h3 id="自定义加载器"><a href="#自定义加载器" class="headerlink" title="自定义加载器"></a>自定义加载器</h3><p>ClassLoader 里面有三个重要的方法 loadClass()、findClass() 和 defineClass()。</p>
<p>loadClass() 方法是加载目标类的入口，它首先会查找当前 ClassLoader 以及它的双亲里面是否已经加载了目标类，如果没有找到就会让双亲尝试加载，如果双亲都加载不了，就会调用 findClass() 让自定义加载器自己来加载目标类。ClassLoader 的 findClass() 方法是需要子类来覆盖的，不同的加载器将使用不同的逻辑来获取目标类的字节码。拿到这个字节码之后再调用 defineClass() 方法将字节码转换成 Class 对象。下面我使用伪代码表示一下基本过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">class ClassLoader &#123;</span><br><span class="line"></span><br><span class="line">  // 加载入口，定义了双亲委派规则</span><br><span class="line">  Class loadClass(String name) &#123;</span><br><span class="line">    // 是否已经加载了</span><br><span class="line">    Class t = this.findFromLoaded(name);</span><br><span class="line">    if(t == null) &#123;</span><br><span class="line">      // 交给双亲</span><br><span class="line">      t = this.parent.loadClass(name)</span><br><span class="line">    &#125;</span><br><span class="line">    if(t == null) &#123;</span><br><span class="line">      // 双亲都不行，只能靠自己了</span><br><span class="line">      t = this.findClass(name);</span><br><span class="line">    &#125;</span><br><span class="line">    return t;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 交给子类自己去实现</span><br><span class="line">  Class findClass(String name) &#123;</span><br><span class="line">    throw ClassNotFoundException();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 组装Class对象</span><br><span class="line">  Class defineClass(byte[] code, String name) &#123;</span><br><span class="line">    return buildClassFromCode(code, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CustomClassLoader extends ClassLoader &#123;</span><br><span class="line"></span><br><span class="line">  Class findClass(String name) &#123;</span><br><span class="line">    // 寻找字节码</span><br><span class="line">    byte[] code = findCodeFromSomewhere(name);</span><br><span class="line">    // 组装Class对象</span><br><span class="line">    return this.defineClass(code, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义类加载器不易破坏双亲委派规则，不要轻易覆盖 loadClass 方法。否则可能会导致自定义加载器无法加载内置的核心类库。在使用自定义加载器时，要明确好它的父加载器是谁，将父加载器通过子类的构造器传入。如果父类加载器是 null，那就表示父加载器是「根加载器」。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ClassLoader 构造器</span><br><span class="line">protected ClassLoader(String name, ClassLoader parent);</span><br></pre></td></tr></table></figure>
<p>双亲委派规则可能会变成三亲委派，四亲委派，取决于你使用的父加载器是谁，它会一直递归委派到根加载器.</p>
<h3 id="Class-forName-vs-ClassLoader-loadClass"><a href="#Class-forName-vs-ClassLoader-loadClass" class="headerlink" title="Class.forName vs ClassLoader.loadClass"></a>Class.forName vs ClassLoader.loadClass</h3><p>这两个方法都可以用来加载目标类，它们之间有一个小小的区别，那就是 Class.forName() 方法可以获取原生类型的 Class，而 ClassLoader.loadClass() 则会报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; x = Class.forName(&quot;[I&quot;);</span><br><span class="line">System.out.println(x);</span><br><span class="line"></span><br><span class="line">x = ClassLoader.getSystemClassLoader().loadClass(&quot;[I&quot;);</span><br><span class="line">System.out.println(x);</span><br><span class="line"></span><br><span class="line">---------------------</span><br><span class="line">class [I</span><br><span class="line"></span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ClassNotFoundException: [I</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="钻石依赖"><a href="#钻石依赖" class="headerlink" title="钻石依赖"></a>钻石依赖</h3><p>项目管理上有一个著名的概念叫着「钻石依赖」，是指软件依赖导致同一个软件包的两个版本需要共存而不能冲突。</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_030_03.png" alt></p>
<p>我们平时使用的 maven 是这样解决钻石依赖的，它会从多个冲突的版本中选择一个来使用，如果不同的版本之间兼容性很糟糕，那么程序将无法正常编译运行。Maven 这种形式叫「扁平化」依赖管理。</p>
<p>使用 ClassLoader 可以解决钻石依赖问题。不同版本的软件包使用不同的 ClassLoader 来加载， <strong>位于不同 ClassLoader 中名称一样的类实际上是不同的类</strong>。 下面让我们使用 URLClassLoader 来尝试一个简单的例子，它默认的父加载器是 AppClassLoader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/source/jcl/v1/Dep.java</span><br><span class="line">public class Dep &#123;</span><br><span class="line">	public void print() &#123;</span><br><span class="line">		System.out.println(&quot;v1&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ cat ~/source/jcl/v2/Dep.java</span><br><span class="line">public class Dep &#123;</span><br><span class="line"> public void print() &#123;</span><br><span class="line">  System.out.println(&quot;v1&quot;);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ cat ~/source/jcl/Test.java</span><br><span class="line">public class Test &#123;</span><br><span class="line">	public static void main(String[] args) throws Exception &#123;</span><br><span class="line">		String v1dir = &quot;file:///Users/qianwp/source/jcl/v1/&quot;;</span><br><span class="line">		String v2dir = &quot;file:///Users/qianwp/source/jcl/v2/&quot;;</span><br><span class="line">		URLClassLoader v1 = new URLClassLoader(new URL[]&#123;new URL(v1dir)&#125;);</span><br><span class="line">		URLClassLoader v2 = new URLClassLoader(new URL[]&#123;new URL(v2dir)&#125;);</span><br><span class="line">		</span><br><span class="line">  Class&lt;?&gt; depv1Class = v1.loadClass(&quot;Dep&quot;);</span><br><span class="line">		Object depv1 = depv1Class.getConstructor().newInstance();</span><br><span class="line">		depv1Class.getMethod(&quot;print&quot;).invoke(depv1);</span><br><span class="line"></span><br><span class="line">		Class&lt;?&gt; depv2Class = v2.loadClass(&quot;Dep&quot;);</span><br><span class="line">		Object depv2 = depv2Class.getConstructor().newInstance();</span><br><span class="line">		depv2Class.getMethod(&quot;print&quot;).invoke(depv2);</span><br><span class="line">	 </span><br><span class="line">  System.out.println(depv1Class.equals(depv2Class));</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在运行之前，我们需要对依赖的类库进行编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/source/jcl/v1</span><br><span class="line">$ javac Dep.java</span><br><span class="line">$ cd ~/source/jcl/v2</span><br><span class="line">$ javac Dep.java</span><br><span class="line">$ cd ~/source/jcl</span><br><span class="line">$ javac Test.java</span><br><span class="line">$ java Test</span><br><span class="line">v1</span><br><span class="line">v2</span><br><span class="line">false</span><br></pre></td></tr></table></figure>
<p>在这个例子中如果两个 URLClassLoader 指向的路径是一样的，下面这个表达式还是 false，因为即使是同样的字节码用不同的 ClassLoader 加载出来的类都不能算同一个类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">depv1Class.equals(depv2Class)</span><br></pre></td></tr></table></figure>
<p>我们还可以让两个不同版本的 Dep 类实现同一个接口，这样可以避免使用反射的方式来调用 Dep 类里面的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; depv1Class = v1.loadClass(&quot;Dep&quot;);</span><br><span class="line">IPrint depv1 = (IPrint)depv1Class.getConstructor().newInstance();</span><br><span class="line">depv1.print()</span><br></pre></td></tr></table></figure>
<p>ClassLoader 固然可以解决依赖冲突问题，不过它也限制了不同软件包的操作界面必须使用反射或接口的方式进行动态调用。Maven 没有这种限制，它依赖于虚拟机的默认懒惰加载策略，运行过程中如果没有显示使用定制的 ClassLoader，那么从头到尾都是在使用 AppClassLoader，而不同版本的同名类必须使用不同的 ClassLoader 加载，所以 Maven 不能完美解决钻石依赖。<br>如果你想知道有没有开源的包管理工具可以解决钻石依赖的，我推荐你了解一下 sofa-ark，它是蚂蚁金服开源的轻量级类隔离框架。</p>
<h3 id="分工与合作"><a href="#分工与合作" class="headerlink" title="分工与合作"></a>分工与合作</h3><p>这里我们重新理解一下 ClassLoader 的意义，它相当于类的命名空间，起到了类隔离的作用。位于同一个 ClassLoader 里面的类名是唯一的，不同的 ClassLoader 可以持有同名的类。ClassLoader 是类名称的容器，是类的沙箱。</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/java/zb_030_04.png" alt></p>
<p>不同的 ClassLoader 之间也会有合作，它们之间的合作是通过 parent 属性和双亲委派机制来完成的。parent 具有更高的加载优先级。除此之外，parent 还表达了一种共享关系，当多个子 ClassLoader 共享同一个 parent 时，那么这个 parent 里面包含的类可以认为是所有子 ClassLoader 共享的。这也是为什么 BootstrapClassLoader 被所有的类加载器视为祖先加载器，JVM 核心类库自然应该被共享。</p>
<h3 id="Thread-contextClassLoader"><a href="#Thread-contextClassLoader" class="headerlink" title="Thread.contextClassLoader"></a>Thread.contextClassLoader</h3><p>如果你稍微阅读过 Thread 的源代码，你会在它的实例字段中发现有一个字段非常特别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Thread &#123;</span><br><span class="line">  ...</span><br><span class="line">  private ClassLoader contextClassLoader;</span><br><span class="line">  </span><br><span class="line">  public ClassLoader getContextClassLoader() &#123;</span><br><span class="line">    return contextClassLoader;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  public void setContextClassLoader(ClassLoader cl) &#123;</span><br><span class="line">    this.contextClassLoader = cl;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>contextClassLoader「线程上下文类加载器」，这究竟是什么东西？</p>
<p>首先 contextClassLoader 是那种需要显示使用的类加载器，如果你没有显示使用它，也就永远不会在任何地方用到它。你可以使用下面这种方式来显示使用它</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.currentThread().getContextClassLoader().loadClass(name);</span><br></pre></td></tr></table></figure>
<p>这意味着如果你使用 forName(string name) 方法加载目标类，它不会自动使用 contextClassLoader。那些因为代码上的依赖关系而懒惰加载的类也不会自动使用 contextClassLoader来加载。</p>
<p>其次线程的 contextClassLoader 默认是从父线程那里继承过来的，所谓父线程就是创建了当前线程的线程。程序启动时的 main 线程的 contextClassLoader 就是 AppClassLoader。这意味着如果没有人工去设置，那么所有的线程的 contextClassLoader 都是 AppClassLoader。</p>
<p>那这个 contextClassLoader 究竟是做什么用的？我们要使用前面提到了类加载器分工与合作的原理来解释它的用途。</p>
<p>它可以做到跨线程共享类，只要它们共享同一个 contextClassLoader。父子线程之间会自动传递 contextClassLoader，所以共享起来将是自动化的。</p>
<p>如果不同的线程使用不同的 contextClassLoader，那么不同的线程使用的类就可以隔离开来。</p>
<p>如果我们对业务进行划分，不同的业务使用不同的线程池，线程池内部共享同一个 contextClassLoader，线程池之间使用不同的 contextClassLoader，就可以很好的起到隔离保护的作用，避免类版本冲突。</p>
<p>如果我们不去定制 contextClassLoader，那么所有的线程将会默认使用 AppClassLoader，所有的类都将会是共享的。</p>
<p>线程的 contextClassLoader 使用场合比较罕见，如果上面的逻辑晦涩难懂也不必过于计较。</p>
<p>JDK9 增加了模块功能之后对类加载器的结构设计做了一定程度的修改，不过类加载器的原理还是类似的，作为类的容器，它起到类隔离的作用，同时还需要依靠双亲委派机制来建立不同的类加载器之间的合作关系。</p>
<h3 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h3><ul>
<li><a href="https://juejin.im/post/5c04892351882516e70dcc9b" target="_blank" rel="noopener">老大难的 Java ClassLoader 再不理解就老了</a></li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>-<a href="https://github.com/hcsp/implement-a-classloader" target="_blank" rel="noopener">q实现一个自定义的ClassLoader</a></p>
<p>-<a href="https://github.com/hcsp/implement-a-classloader/pull/8" target="_blank" rel="noopener">a</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/10/28/ZB-030-04ClassLoader详解/" data-id="ckkmr2k9200svfp919ribsyp2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oak/">oak</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6速学/">ES6速学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS不知深浅/">JS不知深浅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M01/">M01</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M02/">M02</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M03/">M03</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M04/">M04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M06/">M06</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M07/">M07</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M08/">M08</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/M09/">M09</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeWeb/">NodeWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node后端/">Node后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactWheels/">ReactWheels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React入门/">React入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TS入门/">TS入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/express/">express</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node每日精进/">node每日精进</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oak/">oak</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vultr/">vultr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web性能优化/">web性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web面经/">web面经</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端知识点/">前端知识点</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 14.09px;">CSS</a> <a href="/tags/ES6速学/" style="font-size: 13.64px;">ES6速学</a> <a href="/tags/JS不知深浅/" style="font-size: 11.36px;">JS不知深浅</a> <a href="/tags/M01/" style="font-size: 13.64px;">M01</a> <a href="/tags/M02/" style="font-size: 15px;">M02</a> <a href="/tags/M03/" style="font-size: 15.45px;">M03</a> <a href="/tags/M04/" style="font-size: 15.91px;">M04</a> <a href="/tags/M06/" style="font-size: 18.18px;">M06</a> <a href="/tags/M07/" style="font-size: 17.73px;">M07</a> <a href="/tags/M08/" style="font-size: 16.82px;">M08</a> <a href="/tags/M09/" style="font-size: 11.82px;">M09</a> <a href="/tags/NodeWeb/" style="font-size: 12.27px;">NodeWeb</a> <a href="/tags/Node后端/" style="font-size: 18.64px;">Node后端</a> <a href="/tags/ReactWheels/" style="font-size: 16.36px;">ReactWheels</a> <a href="/tags/React入门/" style="font-size: 15px;">React入门</a> <a href="/tags/TS入门/" style="font-size: 14.55px;">TS入门</a> <a href="/tags/express/" style="font-size: 10.45px;">express</a> <a href="/tags/fullstack/" style="font-size: 17.73px;">fullstack</a> <a href="/tags/http/" style="font-size: 12.27px;">http</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/java/" style="font-size: 19.09px;">java</a> <a href="/tags/linux/" style="font-size: 10.91px;">linux</a> <a href="/tags/mobile/" style="font-size: 11.36px;">mobile</a> <a href="/tags/mongodb/" style="font-size: 12.73px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 12.73px;">mysql</a> <a href="/tags/node/" style="font-size: 10.45px;">node</a> <a href="/tags/node每日精进/" style="font-size: 10px;">node每日精进</a> <a href="/tags/oak/" style="font-size: 20px;">oak</a> <a href="/tags/python/" style="font-size: 17.27px;">python</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/vue/" style="font-size: 13.18px;">vue</a> <a href="/tags/vultr/" style="font-size: 10px;">vultr</a> <a href="/tags/web性能优化/" style="font-size: 10px;">web性能优化</a> <a href="/tags/web面经/" style="font-size: 10px;">web面经</a> <a href="/tags/前端知识点/" style="font-size: 19.55px;">前端知识点</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/20/HTTP06密码学到https流程/">HTTP06密码学到https流程</a>
          </li>
        
          <li>
            <a href="/2021/01/19/HTTP05缓存控制/">HTTP05缓存控制</a>
          </li>
        
          <li>
            <a href="/2021/01/18/HTTP04报文和http状态码/">HTTP04报文和http状态码</a>
          </li>
        
          <li>
            <a href="/2021/01/17/HTTP03http常用方法/">HTTP03http常用方法</a>
          </li>
        
          <li>
            <a href="/2021/01/16/HTTP02三次握手四度挥手/">HTTP02三次握手四度挥手</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Stevin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>