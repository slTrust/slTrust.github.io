
 <!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  
    <title>Almost</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Stevin">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Almost">
<meta property="og:url" content="http://yoursite.com/page/23/index.html">
<meta property="og:site_name" content="Almost">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Almost">

    
    <link rel="alternative" href="/atom.xml" title="Almost" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Almost" title="Almost"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Almost">Almost</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/17/React入门006之ContextApi02/" title="React入门006之ContextApi02" itemprop="url">React入门006之ContextApi02</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-17T13:41:14.000Z" itemprop="datePublished"> Published 2019-01-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p> 继续上一篇内容 </p>
</blockquote>
<h3 id="ContextApi"><a href="#ContextApi" class="headerlink" title="ContextApi"></a>ContextApi</h3><blockquote>
<h4 id="如果我想修改传递的n呢？"><a href="#如果我想修改传递的n呢？" class="headerlink" title="如果我想修改传递的n呢？"></a>如果我想修改传递的n呢？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line"></span><br><span class="line">function F1() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      1111</span><br><span class="line">      &lt;F2 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F2() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      2222</span><br><span class="line">      &lt;F3 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F3() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      3333</span><br><span class="line">      &lt;nContext.Consumer&gt;</span><br><span class="line">        &#123;xxx =&gt; &lt;F4 n4=&#123;xxx.n&#125; setN=&#123;xxx.setN&#125; /&gt;&#125;</span><br><span class="line">      &lt;/nContext.Consumer&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F4(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      4444,&#123;props.n4&#125;</span><br><span class="line">      &lt;button onClick=&#123;props.setN&#125;&gt;Click ME&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const nContext = React.createContext();</span><br><span class="line"></span><br><span class="line">class App extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      x: &#123;</span><br><span class="line">        n: 100,</span><br><span class="line">        setN: () =&gt; &#123;</span><br><span class="line">          this.setState(&#123;</span><br><span class="line">            x: &#123;</span><br><span class="line">              ...this.state.x,</span><br><span class="line">              n: this.state.x.n + 1</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;nContext.Provider value=&#123;this.state.x&#125;&gt;</span><br><span class="line">          &lt;F1 /&gt;</span><br><span class="line">        &lt;/nContext.Provider&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/o7opop6m5q" target="_blank" rel="noopener">代码链接</a></li>
</ul>
<blockquote>
<p>以前我们传递值</p>
</blockquote>
<ul>
<li>需要一层一层的传递</li>
</ul>
<blockquote>
<p>现在有了 ContextAPI</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//在根节点包裹一个 nContext</span><br><span class="line">return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &lt;nContext.Provider value=&#123;obj&#125;&gt;</span><br><span class="line">        &lt;F1 /&gt;</span><br><span class="line">    &lt;/nContext.Provider&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">obj&#123;</span><br><span class="line">    store,</span><br><span class="line">    setStore()</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// 后代任意层级想要使用  只需要包裹一个 </span><br><span class="line">&lt;nContext.Consumer&gt;</span><br><span class="line">    &#123;(obj)=&gt;&#123;return &lt;div&gt;&#123;obj&#125;&lt;/div&gt;&#125;&#125;</span><br><span class="line">&lt;/nContext.Consumer&gt;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/16/React入门006之ContextApi/" title="React入门006之ContextApi" itemprop="url">React入门006之ContextApi</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-16T14:43:56.000Z" itemprop="datePublished"> Published 2019-01-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="预习内容"><a href="#预习内容" class="headerlink" title="预习内容"></a>预习内容</h3><ul>
<li><a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">Context</a></li>
<li><a href="https://react.docschina.org/docs/context.html#when-to-use-context" target="_blank" rel="noopener">Context中文版</a></li>
</ul>
<blockquote>
<p>在线IDE</p>
</blockquote>
<ul>
<li><a href="https://codesandbox.io/" target="_blank" rel="noopener">CodeSandBox</a></li>
</ul>
<blockquote>
<h4 id="先看代码"><a href="#先看代码" class="headerlink" title="先看代码"></a>先看代码</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function f1() &#123;</span><br><span class="line">  console.log(1);</span><br><span class="line">  f2();</span><br><span class="line">&#125;</span><br><span class="line">function f2() &#123;</span><br><span class="line">  console.log(2);</span><br><span class="line">  f3();</span><br><span class="line">&#125;</span><br><span class="line">function f3() &#123;</span><br><span class="line">  console.log(3);</span><br><span class="line">  f4();</span><br><span class="line">&#125;</span><br><span class="line">function f4() &#123;</span><br><span class="line">  console.log(4);</span><br><span class="line">&#125;</span><br><span class="line">f1();</span><br><span class="line">console.log(&quot;done&quot;);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">done</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>再看</p>
<blockquote>
<p>f1多了一个 参数 n1<br> 我想要后面的每一个函数都能获取这个 n1<br> 咋办？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function f1(n1) &#123;</span><br><span class="line">  console.log(1,n1);</span><br><span class="line">  f2(n1);</span><br><span class="line">&#125;</span><br><span class="line">function f2(n2) &#123;</span><br><span class="line">  //这里的 n2就是 f1里的 n1</span><br><span class="line">  console.log(2,n2);</span><br><span class="line">  f3(n2);</span><br><span class="line">&#125;</span><br><span class="line">function f3(n3) &#123;</span><br><span class="line">  console.log(3,n3);</span><br><span class="line">  f4(n3);</span><br><span class="line">&#125;</span><br><span class="line">function f4(n4) &#123;</span><br><span class="line">  console.log(4,n4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    let n = 100;</span><br><span class="line">    f1( n );</span><br><span class="line">    console.log(&quot;done&quot;);</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">函数里的函数 得到n</span><br><span class="line">现在则需要 层层传递</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/l9rrqj8zyz" target="_blank" rel="noopener">VanillaJS版本</a></li>
</ul>
<blockquote>
<p>react 4层组件里实现上面的逻辑</p>
</blockquote>
<ul>
<li><a href="https://codesandbox.io/s/jp647nl355" target="_blank" rel="noopener">React版本</a></li>
</ul>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line"></span><br><span class="line">function F1(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;1111,&#123;props.n1&#125;</span><br><span class="line">      &lt;F2 n2=&#123;props.n1&#125;&gt;&lt;/F2&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F2(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;2222,&#123;props.n2&#125;</span><br><span class="line">      &lt;F3 n3=&#123;props.n2&#125;&gt;&lt;/F3&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F3(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;3333,&#123;props.n3&#125;</span><br><span class="line">      &lt;F4 n4=&#123;props.n3&#125;&gt;&lt;/F4&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F4(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;4444,&#123;props.n4&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;    </span><br><span class="line">class App extends React.Component &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      n: 99</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;F1 n1=&#123;this.state.n&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<p>这样很麻烦需要层层传递</p>
<blockquote>
<p>如果 F4想单独拿到 n呢？</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// 唯一的办法将 n提取到外部</span><br><span class="line">function f1() &#123;</span><br><span class="line">  console.log(1);</span><br><span class="line">  f2();</span><br><span class="line">&#125;</span><br><span class="line">function f2() &#123;</span><br><span class="line">  //这里的 n2就是 f1里的 n1</span><br><span class="line">  console.log(2);</span><br><span class="line">  f3();</span><br><span class="line">&#125;</span><br><span class="line">function f3() &#123;</span><br><span class="line">  console.log(3);</span><br><span class="line">  f4();</span><br><span class="line">&#125;</span><br><span class="line">function f4() &#123;</span><br><span class="line">  console.log(4,n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let n = 100;</span><br><span class="line">&#123;</span><br><span class="line">    f1( n );</span><br><span class="line">    console.log(&quot;done&quot;);</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">f4单独 得到n 不想层层传递</span><br><span class="line">现在则需要 将 n放在全局</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>如果将 n 放在全局就回导致容易被篡改</p>
<ul>
<li>全局变量慎用</li>
</ul>
<blockquote>
<h4 id="改良：-局部的全局变量"><a href="#改良：-局部的全局变量" class="headerlink" title="改良： 局部的全局变量"></a>改良： 局部的全局变量</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    let x = &#123;&#125;;</span><br><span class="line">    window.setX = function(key,value)&#123;</span><br><span class="line">        x[key] = value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    window.f1 = function f1() &#123;</span><br><span class="line">        console.log(1);</span><br><span class="line">        f2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    window.f2 = function f2() &#123;</span><br><span class="line">    //这里的 n2就是 f1里的 n1</span><br><span class="line">        console.log(2);</span><br><span class="line">        f3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    window.f3 = function f3() &#123;</span><br><span class="line">        console.log(3);</span><br><span class="line">        f4();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    window.f4 = function f4() &#123;</span><br><span class="line">        console.log(4,x[&apos;n&apos;]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;   </span><br><span class="line">    window.setX(&apos;n&apos;,100)</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        window.f1();        </span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    console.log(&quot;done&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个 x 就叫 context</li>
<li>setX 就是 setContext</li>
<li>他就是对于组件来使用的——局部的全局变量</li>
<li>避免了 层层传递props</li>
</ul>
<blockquote>
<h4 id="用Context-改写-React例子"><a href="#用Context-改写-React例子" class="headerlink" title="用Context 改写 React例子"></a>用Context 改写 React例子</h4></blockquote>
<p>style.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">  border: 1px solid red;</span><br><span class="line">  padding: 10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">import &quot;./styles.css&quot;;</span><br><span class="line"></span><br><span class="line">function F1() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      1111</span><br><span class="line">      &lt;F2 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F2() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      2222</span><br><span class="line">      &lt;F3 /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F3() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;box&quot;&gt;</span><br><span class="line">      3333</span><br><span class="line">      &lt;nContext.Consumer&gt;&#123;xxx =&gt; &lt;F4 n4=&#123;xxx&#125; /&gt;&#125;&lt;/nContext.Consumer&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function F4(props) &#123;</span><br><span class="line">  return &lt;div className=&quot;box&quot;&gt;4444,&#123;props.n4&#125;&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const nContext = React.createContext();</span><br><span class="line"></span><br><span class="line">class App extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;nContext.Provider value=&quot;999&quot;&gt;</span><br><span class="line">          &lt;F1 /&gt;</span><br><span class="line">        &lt;/nContext.Provider&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/jny7mn8415" target="_blank" rel="noopener">React版本</a></li>
</ul>
<blockquote>
<p>理解代码</p>
</blockquote>
<p>JSX</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&lt;/div&gt; </span><br><span class="line">//翻译成</span><br><span class="line">React.createElement(&apos;div&apos;,null)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ------------------------------------</span><br><span class="line">&lt;div className=&quot;x&quot; title=&quot;hi&quot;&gt;&lt;/div&gt; </span><br><span class="line">//翻译成</span><br><span class="line">React.createElement(&apos;div&apos;,&#123;className:&apos;x&apos;,title:&apos;hi&apos;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ------------------------------------</span><br><span class="line">&lt;div className=&quot;x&quot; title=&quot;hi&quot;&gt;aaaa&lt;/div&gt; </span><br><span class="line">//翻译成</span><br><span class="line">React.createElement(&apos;div&apos;,&#123;className:&apos;x&apos;,title:&apos;hi&apos;&#125;,&apos;aaaa&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ------------------------------------</span><br><span class="line">function F1()&#123;</span><br><span class="line">    return &apos;1111&apos;</span><br><span class="line">&#125;</span><br><span class="line">&lt;div className=&quot;x&quot; title=&quot;hi&quot;&gt;</span><br><span class="line">    &lt;F1&gt;&lt;/F1&gt;</span><br><span class="line">&lt;/div&gt; </span><br><span class="line"></span><br><span class="line">//翻译成 当你用标签写的时候 永远会在 前面加上一个React.createElement</span><br><span class="line">React.createElement(</span><br><span class="line">    &apos;div&apos;,&#123;className:&apos;x&apos;,title:&apos;hi&apos;&#125;,</span><br><span class="line">    React.createElement(F1,null)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// ------------------------------------</span><br><span class="line">function F1()&#123;</span><br><span class="line">    return &apos;1111&apos;</span><br><span class="line">&#125;</span><br><span class="line">&lt;div className=&quot;x&quot; title=&quot;hi&quot;&gt;</span><br><span class="line">    F1</span><br><span class="line">    &#123;F1&#125;</span><br><span class="line">    &lt;F1/&gt;</span><br><span class="line">&lt;/div&gt; </span><br><span class="line">//翻译成 </span><br><span class="line">//当你写F1就是 字符串 &quot;F1&quot; </span><br><span class="line">//当你用标签写的时候 永远会在 前面加上一个React.createElement</span><br><span class="line">React.createElement(</span><br><span class="line">    &apos;div&apos;,&#123;className:&apos;x&apos;,title:&apos;hi&apos;&#125;,</span><br><span class="line">    &apos;F1&apos;,</span><br><span class="line">    F1, //这是个函数 但是React并不知道怎么用</span><br><span class="line">    React.createElement(F1,null)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="实现一个接受函数的组件——-Consumer原理"><a href="#实现一个接受函数的组件——-Consumer原理" class="headerlink" title="实现一个接受函数的组件——(Consumer原理)"></a>实现一个接受函数的组件——(Consumer原理)</h4></blockquote>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import ReactDOM from &quot;react-dom&quot;;</span><br><span class="line"></span><br><span class="line">// Ccc就是 Consumer</span><br><span class="line">function Ccc(props) &#123;</span><br><span class="line"></span><br><span class="line">  /* </span><br><span class="line">  props.children 可以获取 Ccc里得内容 &lt;Ccc&gt;&#123;fn&#125;&lt;Ccc/&gt;</span><br><span class="line">  如果 传递一个函数</span><br><span class="line">  props.children 就是那个函数 fn</span><br><span class="line">  传递 &lt;Ccc&gt;&#123;fn&#125;&#123;fn2&#125;&lt;Ccc/&gt;</span><br><span class="line">  那么 props.children 就是 [fn,fn2]</span><br><span class="line">  */</span><br><span class="line">  </span><br><span class="line">  let info = 100;</span><br><span class="line">  let result = props.children(info);</span><br><span class="line">  return &lt;div&gt;&#123;result&#125;&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Ccc c1=&quot;c1&quot;&gt;</span><br><span class="line">        &#123;msg =&gt; &#123;</span><br><span class="line">          console.log(`我得到的信息是$&#123;msg&#125;`);</span><br><span class="line">          return &lt;div&gt;我得到的数据是：&#123;msg&#125;&lt;/div&gt;;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;/Ccc&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rootElement = document.getElementById(&quot;root&quot;);</span><br><span class="line">ReactDOM.render(&lt;App /&gt;, rootElement);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://codesandbox.io/s/wwp6kkxno5" target="_blank" rel="noopener">代码地址</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/16/React入门005之Redux是什么03/" title="React入门005之Redux是什么03" itemprop="url">React入门005之Redux是什么03</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-16T13:21:50.000Z" itemprop="datePublished"> Published 2019-01-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h3><ul>
<li><a href="https://react-redux.js.org/" target="_blank" rel="noopener">https://react-redux.js.org/</a></li>
<li>它就是让你不用每曾都传递 store,随时都可以使用store，避免混乱问题</li>
</ul>
<p>核心就几个东西</p>
<ul>
<li>Provider</li>
<li>connect</li>
<li>connectAdvanced</li>
</ul>
<p>我直接拿上一篇的例子复制了一份目录在</p>
<ul>
<li>demo-react-redux-2</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装 react-redux</span><br><span class="line">yarn add react-redux</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">// step1 引入Provider</span><br><span class="line">// step2 用 Provider 包裹App 并传递 store</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import * as serviceWorker from &apos;./serviceWorker&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;</span><br><span class="line"></span><br><span class="line">import &#123;createStore&#125; from &apos;redux&apos;;</span><br><span class="line">const stateChanger = (state,action)=&gt;&#123;</span><br><span class="line">  if (state === undefined)&#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">      var newState =state + action.payload;</span><br><span class="line">      return newState;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      return state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return newState;</span><br><span class="line">&#125;</span><br><span class="line">const store = createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line"></span><br><span class="line">//render不传递参数</span><br><span class="line">store.subscribe(render)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">//render传递参数</span><br><span class="line">store.subscribe(()=&gt;&#123;</span><br><span class="line">  render(参数)</span><br><span class="line">&#125;)</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">function add3()&#123;</span><br><span class="line">  if(store.getState()%2 === 1)&#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function add4()&#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)</span><br><span class="line">  &#125;, 2000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App/&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">    , document.getElementById(&apos;root&apos;));</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>普及基础知识</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 这是啥意思？  一个函数返回值是函数</span><br><span class="line">function xx(a)&#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">    return function(b)&#123;</span><br><span class="line">        console.log(a + b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xx(1)(2);</span><br><span class="line">// xx()叫做 偏函数 (参数不全)</span><br></pre></td></tr></table></figure>
<p>App.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">// step1 引入 connect</span><br><span class="line">// step2 connect()(App) 传递App给 connect</span><br><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;</span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    console.log(this.props);</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            你点击了&lt;span id=&quot;value&quot;&gt;&#123;this.props.n&#125;&lt;/span&gt;次</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button id=&quot;add1&quot; onClick=&#123;()=&gt;this.props.add1()&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">                &lt;button id=&quot;add2&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">                &lt;button id=&quot;add1IfOdd&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">                &lt;button id=&quot;addAfter2Ses&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> 这个 x 就是 把 store里的东西拿出来 放到 this.props上</span><br><span class="line"> 所以如果 store = &#123;n:0&#125;传递到这里</span><br><span class="line"> 就变成了 this.props.n = 0</span><br><span class="line"> function x(state)&#123;</span><br><span class="line">  return&#123;</span><br><span class="line">    n:state.n</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line">// 映射 state===&gt;props</span><br><span class="line">/*</span><br><span class="line">// mapStateToProps 必须是一个函数</span><br><span class="line">接受一个参数 state 还有一个不常用的参数</span><br><span class="line">*/</span><br><span class="line">function mapStateToProps(state)&#123;</span><br><span class="line">  return&#123;</span><br><span class="line">    n:state.n</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如何 add 呢？ 产生一个action 通过这个connect你就不用 store.dispatch</span><br><span class="line">// 把dispatch映射到 Props</span><br><span class="line">/*</span><br><span class="line">mapDispatchToProps</span><br><span class="line">可以是个函数也可以是个对象</span><br><span class="line">function mapDispatchToProps(dispatch)&#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    add1:()=&gt;dispatch(&#123;type:&apos;add&apos;,payload:1&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">const mapDispatchToProps = &#123;</span><br><span class="line">  add1:()=&gt;&#123;</span><br><span class="line">    return &#123;type:&apos;add&apos;,payload:1&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default connect(mapStateToProps,mapDispatchToProps)(App);</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import * as serviceWorker from &apos;./serviceWorker&apos;;</span><br><span class="line"></span><br><span class="line">import &#123; Provider &#125; from &apos;react-redux&apos;</span><br><span class="line"></span><br><span class="line">import &#123;createStore&#125; from &apos;redux&apos;;</span><br><span class="line">const stateChanger = (state,action)=&gt;&#123;</span><br><span class="line">  if (state === undefined)&#123;</span><br><span class="line">    return &#123;n:0&#125;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">      var newState =&#123;n:state.n + action.payload&#125;</span><br><span class="line">      return newState;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      return state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const store = createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App/&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">    , document.getElementById(&apos;root&apos;));</span><br><span class="line"></span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/15/React入门005之Redux是什么02/" title="React入门005之Redux是什么02" itemprop="url">React入门005之Redux是什么02</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-15T14:16:17.000Z" itemprop="datePublished"> Published 2019-01-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Redux-React"><a href="#Redux-React" class="headerlink" title="Redux+React"></a>Redux+React</h3><blockquote>
<p>安装 react脚手架工具</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm i -g create-react-app@2.1.1</span><br><span class="line"></span><br><span class="line"># 新建目录</span><br><span class="line">mkdir demo-react-redux-1</span><br><span class="line"># 切换目录下</span><br><span class="line">cd demo-react-redux-1</span><br><span class="line"># 当前目录新建一个 生成一个react项目</span><br><span class="line">create-react-app .</span><br><span class="line"># 安装成功</span><br><span class="line">yarn start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编辑 app.js</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          你点击了&lt;span id=&quot;value&quot;&gt;0&lt;/span&gt;次</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">              &lt;button id=&quot;add1&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add2&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add1IfOdd&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;addAfter2Ses&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>
<p>实现我们上一篇的雏形</p>
<blockquote>
<p>引入 redux</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 踩坑了</span><br><span class="line">npm i redux</span><br><span class="line"># 因为我们默认使用 yarn install的</span><br><span class="line"></span><br><span class="line"># 如果你混着用 就会导致重新 安装所有依赖</span><br><span class="line"></span><br><span class="line"># 所以 还是 用yarn</span><br><span class="line">yarn add redux</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="渲染-store"><a href="#渲染-store" class="headerlink" title="渲染 store "></a>渲染 store </h3></blockquote>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import * as serviceWorker from &apos;./serviceWorker&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;createStore&#125; from &apos;redux&apos;;</span><br><span class="line">const stateChanger = (state,action)=&gt;&#123;</span><br><span class="line">  if (state === undefined)&#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">      var newState =state + action.payload;</span><br><span class="line">      return newState;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      return state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return newState;</span><br><span class="line">&#125;</span><br><span class="line">const store = createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">// 根节点传递 store</span><br><span class="line">ReactDOM.render(&lt;App value=&#123;store.getState()&#125;/&gt;, document.getElementById(&apos;root&apos;));</span><br><span class="line"></span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>
<p>App.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// props使用 根结点传递的store</span><br><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          你点击了&lt;span id=&quot;value&quot;&gt;&#123;this.props.value&#125;&lt;/span&gt;次</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">              &lt;button id=&quot;add1&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add2&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add1IfOdd&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;addAfter2Ses&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>新问题 点击 add的问题</p>
</blockquote>
<ul>
<li>store是从props里取的 在App.js里根本拿不到</li>
<li>只能继续从 index.js里 传递相应的 事件处理函数</li>
</ul>
<p>App.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  add1()&#123;</span><br><span class="line">    this.props.onAdd1();</span><br><span class="line">  &#125;</span><br><span class="line">  add2()&#123;</span><br><span class="line">    this.props.onAdd2();</span><br><span class="line">  &#125;</span><br><span class="line">  add3()&#123;</span><br><span class="line">    this.props.onAdd3();</span><br><span class="line">  &#125;</span><br><span class="line">  add4()&#123;</span><br><span class="line">    this.props.onAdd4();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          你点击了&lt;span id=&quot;value&quot;&gt;&#123;this.props.value&#125;&lt;/span&gt;次</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">              &lt;button id=&quot;add1&quot; onClick=&#123;()=&gt;this.add1()&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add2&quot; onClick=&#123;()=&gt;this.add2()&#125;&gt;+2&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;add1IfOdd&quot; onClick=&#123;()=&gt;this.add3()&#125;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">              &lt;button id=&quot;addAfter2Ses&quot; onClick=&#123;()=&gt;this.add4()&#125;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import * as serviceWorker from &apos;./serviceWorker&apos;;</span><br><span class="line"></span><br><span class="line">import &#123;createStore&#125; from &apos;redux&apos;;</span><br><span class="line">const stateChanger = (state,action)=&gt;&#123;</span><br><span class="line">  if (state === undefined)&#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">      var newState =state + action.payload;</span><br><span class="line">      return newState;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      return state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return newState;</span><br><span class="line">&#125;</span><br><span class="line">const store = createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line"></span><br><span class="line">//render不传递参数</span><br><span class="line">store.subscribe(render)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">//render传递参数</span><br><span class="line">store.subscribe(()=&gt;&#123;</span><br><span class="line">  render(参数)</span><br><span class="line">&#125;)</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">function add3()&#123;</span><br><span class="line">  if(store.getState()%2 === 1)&#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function add4()&#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)</span><br><span class="line">  &#125;, 2000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 传递每个修改store的处理函数,因为App.js里 没法获取操作 store</span><br><span class="line">function render()&#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;App value=&#123;store.getState()&#125;</span><br><span class="line">      onAdd1=&#123;()=&gt;&#123;store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)&#125;&#125;</span><br><span class="line">      onAdd2=&#123;()=&gt;&#123;store.dispatch(&#123;type:&apos;add&apos;,payload: 2&#125;)&#125;&#125;</span><br><span class="line">      onAdd3=&#123;add3&#125;</span><br><span class="line">      onAdd4=&#123;add4&#125;</span><br><span class="line">    /&gt;, document.getElementById(&apos;root&apos;));</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="对比-Redux-VanillaJS-和-Redux-React"><a href="#对比-Redux-VanillaJS-和-Redux-React" class="headerlink" title="对比 Redux+VanillaJS 和 Redux+React"></a>对比 Redux+VanillaJS 和 Redux+React</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Redux + VanillaJS 每次点击按钮 整体 render</span><br><span class="line"></span><br><span class="line">Redux + React 每次点击按钮 只更新包含数字的span</span><br></pre></td></tr></table></figure>
<ul>
<li>这就是React的好处 让你每次不需要整体更新div,它通过dom diff 找该更新的地方</li>
</ul>
<h4 id="尽管如此-Redux-React的写法依然很恶心"><a href="#尽管如此-Redux-React的写法依然很恶心" class="headerlink" title="尽管如此 Redux+React的写法依然很恶心"></a>尽管如此 Redux+React的写法依然很恶心</h4><ul>
<li>需要根节点把action的函数传递下去</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// index.js里</span><br><span class="line">&lt;App value=&#123;store.getState()&#125;</span><br><span class="line">      onAdd1=&#123;()=&gt;&#123;store.dispatch(&#123;type:&apos;add&apos;,payload: 1&#125;)&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// App.js里</span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  add1()&#123;</span><br><span class="line">    this.props.onAdd1();</span><br><span class="line">    //为什么不能直接在这里  派发action呢？</span><br><span class="line">    // store.dispatch()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>有一个办法就是在根节点传递 store</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;App value=&#123;store.getState()&#125;</span><br><span class="line">     store=&#123;store&#125;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">//这样 App.js里就可以</span><br><span class="line">store.dispatch()</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="但是"><a href="#但是" class="headerlink" title="但是"></a>但是</h4><h4 id="但是-1"><a href="#但是-1" class="headerlink" title="但是"></a>但是</h4><h4 id="但是-2"><a href="#但是-2" class="headerlink" title="但是"></a>但是</h4></blockquote>
<p>虽然不用一层一层的往上调用，但是需要一层一层的往下传递store</p>
<p>假设 App内还有组件  就要每次都往子元素里传递</p>
<blockquote>
<p>解决方案 React-Redux</p>
</blockquote>
<p>注意是 React-Redux 跟 Redux是不同的</p>
<p>详情见下一篇</p>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/15/React入门005之Redux是什么01/" title="React入门005之Redux是什么01" itemprop="url">React入门005之Redux是什么01</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-15T13:01:00.000Z" itemprop="datePublished"> Published 2019-01-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h3><h3 id="一个不错的Redux中文文档"><a href="#一个不错的Redux中文文档" class="headerlink" title="一个不错的Redux中文文档"></a><a href="https://cn.redux.js.org/docs/basics/Reducers.html" target="_blank" rel="noopener">一个不错的Redux中文文档</a></h3><p>- 建议直接看</p>
<p><a href="https://cn.redux.js.org/docs/introduction/Examples.html" target="_blank" rel="noopener">示例</a></p>
<blockquote>
<h3 id="里面有个-Counter-Vanilla示例"><a href="#里面有个-Counter-Vanilla示例" class="headerlink" title="里面有个 Counter Vanilla示例"></a>里面有个 Counter Vanilla示例</h3></blockquote>
<ul>
<li>Vanilla是什么 (英文意思香草)</li>
</ul>
<p>what</p>
<blockquote>
<h4 id="VanillaJS就代表-原生JS"><a href="#VanillaJS就代表-原生JS" class="headerlink" title="VanillaJS就代表 原生JS"></a>VanillaJS就代表 原生JS</h4></blockquote>
<p>因为有很多前端程序员上来就学框架，根本不懂底层原理只会用库或框架，于是很多人上手就学vue,此时让它用 原生他不会，于是有人为了嘲讽这些不会原生JS的人 发明了一个新的框架就叫 VanillaJS</p>
<ul>
<li><p><a href="http://vanilla-js.com/" target="_blank" rel="noopener">VanillaJS官网</a> 需要翻墙 (而且你点击download里任何一个，下载大小都是0 bytes)</p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000000355277?utm_source=tag-newest" target="_blank" rel="noopener">sf解释</a></p>
</li>
</ul>
<blockquote>
<p>Counter Vanilla就是 没有用任何的库(用redux结合原生JS)</p>
</blockquote>
<ul>
<li><a href="https://github.com/reduxjs/redux/blob/master/examples/counter-vanilla/index.html" target="_blank" rel="noopener">示例地址</a></li>
</ul>
<blockquote>
<h4 id="我们的需求-实现几个按钮点击触发-1-1的功能"><a href="#我们的需求-实现几个按钮点击触发-1-1的功能" class="headerlink" title="我们的需求 实现几个按钮点击触发+1/-1的功能"></a>我们的需求 实现几个按钮点击触发+1/-1的功能</h4></blockquote>
<p>初始化如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.1/redux.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function render()&#123;</span><br><span class="line">    var app = document.querySelector(&apos;#app&apos;);</span><br><span class="line">    app.innerHTML = `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        你点击了&lt;span id=&quot;value&quot;&gt;0&lt;/span&gt;次</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button id=&quot;add1&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add2&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add1IfOdd&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;addAfter2Ses&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    `;</span><br><span class="line">&#125;</span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用redux怎么做呢？</p>
</blockquote>
<p>根据<a href="https://github.com/reduxjs/redux/blob/master/examples/counter-vanilla/index.html" target="_blank" rel="noopener">示例</a></p>
<ol>
<li>我们第一步要创建一个store 存这个0 </li>
<li>这个store需要接受一个参数(更新store的函数)。</li>
<li><p>这个参数是一个函数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(接受两个参数)</span><br><span class="line">第一个是上一次 store的状态</span><br><span class="line">第二个是 具体的操作</span><br><span class="line"></span><br><span class="line">var store = Redux.createStroe(函数xx)</span><br><span class="line">function 函数xx(之前的状态,操作)&#123;</span><br><span class="line">    return 新的状态</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这个函数是用来更新store的</p>
</li>
</ol>
<ul>
<li>step1 dispatch 派发一个action</li>
<li>step2 根据操作生成新的 state 触发一个事件</li>
<li>step3 接受 事件重新 render</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.1/redux.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function add1()&#123;</span><br><span class="line">    // step1 dispatch 派发一个action</span><br><span class="line">    // 触发一个事件</span><br><span class="line">    // 派发一个动作</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render(store)&#123;</span><br><span class="line">    var app = document.querySelector(&apos;#app&apos;);</span><br><span class="line">    app.innerHTML = `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        你点击了&lt;span id=&quot;value&quot;&gt;$&#123;store.getState()&#125;&lt;/span&gt;次</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button id=&quot;add1&quot; onclick=&quot;add1()&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add2&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add1IfOdd&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;addAfter2Ses&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    `;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stateChanger(state,action)&#123; </span><br><span class="line">    if(state === undefined)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">            var newState = state + 1;</span><br><span class="line">            return newState;</span><br><span class="line">            // step2 根据操作生成新的 state 触发一个事件</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//初始化 store</span><br><span class="line">var store = Redux.createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">render(store);</span><br><span class="line"></span><br><span class="line">//监听 store的变化 然后触发render</span><br><span class="line">store.subscribe(()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    // step3 接受 事件重新 render</span><br><span class="line">    render(store) </span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>store 和 state的关系</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">state    ------&gt; store存储了 state</span><br><span class="line">获取 state ------&gt; store.getState()</span><br><span class="line"></span><br><span class="line">store    ------&gt; Redux.create(函数)</span><br><span class="line">更新 state -----&gt; 触发 action 也就是 dispatch(&#123;type:&apos;操作&apos;&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="完善其他按钮的功能"><a href="#完善其他按钮的功能" class="headerlink" title="完善其他按钮的功能"></a>完善其他按钮的功能</h4></blockquote>
<ul>
<li>新增payload使用</li>
<li>异步调用 action</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.1/redux.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function add1()&#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload:1&#125;)</span><br><span class="line">&#125;</span><br><span class="line">function add2()&#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add&apos;,payload:2&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function add1IfOdd()&#123;</span><br><span class="line">    var oldState = store.getState()</span><br><span class="line">    if(oldState % 2 ===1)&#123;</span><br><span class="line">        store.dispatch(&#123;type:&apos;add&apos;,payload:1&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addAfter2Ses()&#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        store.dispatch(&#123;type:&apos;add&apos;,payload:1&#125;)</span><br><span class="line">    &#125;, 2000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render(store)&#123;</span><br><span class="line">    var app = document.querySelector(&apos;#app&apos;);</span><br><span class="line">    app.innerHTML = `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        你点击了&lt;span id=&quot;value&quot;&gt;$&#123;store.getState()&#125;&lt;/span&gt;次</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;button id=&quot;add1&quot; onclick=&quot;add1()&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add2&quot; onclick=&quot;add2()&quot;&gt;+2&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;add1IfOdd&quot; onclick=&quot;add1IfOdd()&quot;&gt;如果单数就+1&lt;/button&gt;</span><br><span class="line">            &lt;button id=&quot;addAfter2Ses&quot; onclick=&quot;addAfter2Ses()&quot;&gt;2秒后+1&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    `;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stateChanger(state,action)&#123; </span><br><span class="line">    if(state === undefined)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        console.log(&apos;add&apos;)</span><br><span class="line">        if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">            var newState = state + action.payload;</span><br><span class="line">            return newState;</span><br><span class="line">            // step2 根据操作生成新的 state 触发一个事件</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//初始化 store</span><br><span class="line">var store = Redux.createStore(stateChanger)</span><br><span class="line"></span><br><span class="line">render(store);</span><br><span class="line"></span><br><span class="line">//监听 store的变化 然后触发render</span><br><span class="line">store.subscribe(()=&gt;&#123;</span><br><span class="line">    // step3 接受 事件重新 render</span><br><span class="line">    render(store) </span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><h3 id="一个坑，就是异步更新-store的问题"><a href="#一个坑，就是异步更新-store的问题" class="headerlink" title="一个坑，就是异步更新 store的问题"></a>一个坑，就是异步更新 store的问题</h3></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 新手经常犯的错误 ,把异步逻辑写在 </span><br><span class="line">function asyncAdd2()&#123;</span><br><span class="line">    store.dispatch(&#123;type:&apos;add2&apos;,payload:2&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function stateChanger(state,action)&#123; </span><br><span class="line">    if(state === undefined)&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if(action.type === &apos;add&apos;)&#123;</span><br><span class="line">            var newState = state + action.payload;</span><br><span class="line">            return newState;</span><br><span class="line">            // step2 根据操作生成新的 state 触发一个事件</span><br><span class="line">        &#125;else if(action.type ===&apos;add2&apos;)&#123;</span><br><span class="line">             setTimeout(() =&gt; &#123;</span><br><span class="line">                var newState = state + action.payload;</span><br><span class="line">                return newState;</span><br><span class="line">            &#125;, 2000);</span><br><span class="line"></span><br><span class="line">            // 此时 setTimeout里函数的return是 箭头函数的返回值</span><br><span class="line">            /*</span><br><span class="line">            而这个 </span><br><span class="line">            else if(action.type ===&apos;add2&apos;)&#123;</span><br><span class="line">                //没写 return</span><br><span class="line">                // 相当于 return undefined</span><br><span class="line">            &#125;</span><br><span class="line">            */</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/14/React入门004之React通信Redux代替eventHub/" title="React入门004之React通信Redux代替eventHub.html" itemprop="url">React入门004之React通信Redux代替eventHub.html</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-14T14:36:38.000Z" itemprop="datePublished"> Published 2019-01-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="eventHub模式的理解"><a href="#eventHub模式的理解" class="headerlink" title="eventHub模式的理解"></a>eventHub模式的理解</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            money.amount -= data</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>特点</p>
</blockquote>
<ol>
<li>所有的数据放在顶层 上一篇我们的money放在了 app中 Redux 推荐把所有数据放归置在一个地方，然后把数据传递给最顶层组件(App)</li>
</ol>
<blockquote>
<p>此时有一个问题发生了,假如我有多个数据呢？ 你就要一个一个属性的传下去</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line">var user = &#123;</span><br><span class="line">    id:321312,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 此时需要在app里</span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money:money,</span><br><span class="line">            user:user</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.money&#125;</span><br><span class="line">                user=&#123;this.state.user&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="eventHub-深入"><a href="#eventHub-深入" class="headerlink" title="eventHub 深入"></a>eventHub 深入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var user = &#123;</span><br><span class="line">    id:3213123,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var store = &#123;</span><br><span class="line">    money:money,</span><br><span class="line">    user:user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;  //订阅 subscribe</span><br><span class="line">            store.money.amount -= data // reducer 对数据的变动</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            store:store</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.store.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.state.store.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        // active       </span><br><span class="line">        eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        eventHub.on(&apos;我要花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                money:money</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>store 就是 集中管理数据的地方</li>
<li>action 就是事件 </li>
<li>我要花钱就是  action type</li>
<li>100金额 就是 payload 载荷</li>
<li>reducer 对数据的变动</li>
<li>subscribe 订阅</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var user = &#123;</span><br><span class="line">    id:3213123,</span><br><span class="line">    nickName:&apos;土豪&apos;</span><br><span class="line">&#125;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var store = &#123;</span><br><span class="line">    money:money,</span><br><span class="line">    user:user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line"></span><br><span class="line">eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;  //订阅 subscribe</span><br><span class="line">    store.money.amount -= data // reducer 对数据的变动</span><br><span class="line">    render();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="用-Redux代替-eventHub"><a href="#用-Redux代替-eventHub" class="headerlink" title="用 Redux代替 eventHub"></a>用 Redux代替 eventHub</h3><ul>
<li>bootcdn  里 搜索 redux 并引入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.0/redux.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>由于我们是 JS引入 和 webpack或许有差异</li>
<li>此时我们不知道咋用，咋办？ crm</li>
</ul>
<ol>
<li>谷歌搜 Redux  科学上网的重要性</li>
<li><a href="https://cn.redux.js.org/" target="_blank" rel="noopener">https://cn.redux.js.org/</a> (翻墙可看)</li>
<li>找到 例子   示例 –&gt; <a href="https://cn.redux.js.org/docs/introduction/Examples.html" target="_blank" rel="noopener">https://cn.redux.js.org/docs/introduction/Examples.html</a></li>
<li>Counter 例子 <a href="https://github.com/reduxjs/redux/tree/master/examples/counter" target="_blank" rel="noopener">https://github.com/reduxjs/redux/tree/master/examples/counter</a></li>
<li>crm</li>
<li><p>抄它怎么调的redux <a href="https://github.com/reduxjs/redux/blob/master/examples/counter/src/index.js" target="_blank" rel="noopener">https://github.com/reduxjs/redux/blob/master/examples/counter/src/index.js</a></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;</span><br><span class="line">import &#123; createStore &#125; from &apos;redux&apos;</span><br><span class="line">import Counter from &apos;./components/Counter&apos;</span><br><span class="line">import counter from &apos;./reducers&apos;</span><br><span class="line"></span><br><span class="line">const store = createStore(counter)</span><br><span class="line">const rootEl = document.getElementById(&apos;root&apos;)</span><br><span class="line"></span><br><span class="line">const render = () =&gt; ReactDOM.render(</span><br><span class="line">&lt;Counter</span><br><span class="line">    value=&#123;store.getState()&#125;</span><br><span class="line">    onIncrement=&#123;() =&gt; store.dispatch(&#123; type: &apos;INCREMENT&apos; &#125;)&#125;</span><br><span class="line">    onDecrement=&#123;() =&gt; store.dispatch(&#123; type: &apos;DECREMENT&apos; &#125;)&#125;</span><br><span class="line">/&gt;,</span><br><span class="line">rootEl</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">render()</span><br><span class="line">store.subscribe(render)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//别忘记引入redux.js</span><br><span class="line">// 通过抄别人的  我们造出了 自己的store</span><br><span class="line">let createStore = Redux.createStore;</span><br><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amoune:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;a&apos;:</span><br><span class="line">            return state + 1</span><br><span class="line">        case &apos;b&apos;:</span><br><span class="line">            return state - 1</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducers);</span><br><span class="line">console.log(store.getState())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时之前的 eventHub 和 管家都不需要了</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/redux/4.0.0/redux.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">let createStore = Redux.createStore;</span><br><span class="line"></span><br><span class="line">//管家 ——一个函数 他会得到（之前的state，花钱的动作）</span><br><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    //初始化</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amount:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;我想花钱&apos;:</span><br><span class="line">            return &#123;</span><br><span class="line">                money:&#123;</span><br><span class="line">                    amount:state.money.amount - action.payload</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = createStore(reducers);</span><br><span class="line">console.log(store.getState())</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.props.store.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.props.store.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        // active       </span><br><span class="line">        // eventHub.trigger(&apos;我想花钱&apos; /* action type */,100) //100叫做 payload</span><br><span class="line">        store.dispatch(&#123;type:&apos;我想花钱&apos;,payload:100&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App store=&#123;store.getState()&#125;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render()</span><br><span class="line">// 订阅数据的改变同步更新</span><br><span class="line">store.subscribe(render)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>是不是觉得Redux很啰嗦</p>
</blockquote>
<ul>
<li>eventHub能看懂</li>
<li>用 redux反而很恶心</li>
</ul>
<blockquote>
<h4 id="Redux为啥这样做"><a href="#Redux为啥这样做" class="headerlink" title="Redux为啥这样做"></a>Redux为啥这样做</h4></blockquote>
<ul>
<li>所有的框架都有一个使命——防呆(怕你的队友是个猪队友)</li>
<li>所以Redux最大的功能就是防呆</li>
</ul>
<blockquote>
<p>eventHub的问题</p>
</blockquote>
<ul>
<li><p>事件名可能任意的，分散在各处，而你用redux强制要求你集中的在 switch里</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let reducers = (state = 0 ,action)=&gt;&#123;</span><br><span class="line">    //初始化</span><br><span class="line">    state = state ||&#123;</span><br><span class="line">        money:&#123; amount:100000 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    switch(action.type)&#123;</span><br><span class="line">        case &apos;我想花钱&apos;:</span><br><span class="line">            return &#123;</span><br><span class="line">                money:&#123;</span><br><span class="line">                    amount:state.money.amount - action.payload</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        default:</span><br><span class="line">            return state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>redux的约束 你必须每个事件给我一个事件名和 payload 并且列在一起</p>
</li>
<li><p>你只能用 props的方式 使用 store={store.getState()}</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//getState()只读的方式告诉你  不要修改</span><br><span class="line">//因为通过 props能防猪队友 </span><br><span class="line"></span><br><span class="line">// 猪队友</span><br><span class="line">// 通过引用修改数据</span><br><span class="line">this.props.money.amount -= 200</span><br><span class="line">// 即使用redux 依然也是可以通过引用改的</span><br><span class="line">这是 JS的 bug</span><br></pre></td></tr></table></figure>
</li>
<li><p>redux可以让不懂英语的前端 走远一点</p>
</li>
<li>比如 payload 实际就是个 data </li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/13/React入门004之React通信eventHub/" title="React入门004之React通信eventHub" itemprop="url">React入门004之React通信eventHub</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-13T09:25:41.000Z" itemprop="datePublished"> Published 2019-01-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="组件通信的回顾"><a href="#组件通信的回顾" class="headerlink" title="组件通信的回顾"></a>组件通信的回顾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            msg :&apos;你好！&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    changeMsg()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            msg:&apos;你也好！&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;Box msg=&#123;this.state.msg&#125; </span><br><span class="line">                        fn=&#123;this.changeMsg.bind(this)&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Box(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;得到父组件的消息为&#123;props.msg&#125;&lt;/h2&gt;</span><br><span class="line">            &lt;div onClick=&#123;props.fn&#125;&gt;回复&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="一个家族的通信模型"><a href="#一个家族的通信模型" class="headerlink" title="一个家族的通信模型"></a>一个家族的通信模型</h3><ul>
<li>打开jsbin</li>
<li>添加react支持的库文件</li>
<li>Javascript选择 React(JSX)</li>
</ul>
<p>如图<br><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-01.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function FirstFather(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">            &lt;div&gt;大爸&lt;/div&gt;</span><br><span class="line">            &lt;Son1/&gt;</span><br><span class="line">            &lt;Son2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function SecondFather(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">            &lt;div&gt;二爸&lt;/div&gt;</span><br><span class="line">            &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子1</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">function Son2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子2</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son3()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子3</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son4()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">            儿子4</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个家族里爷爷留给后代的所有财产 100000元，后代们一起使用</p>
</blockquote>
<ol>
<li>二儿子用100 其他人怎么同步余额</li>
<li>把所有金额通知给所有人</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1/&gt;</span><br><span class="line">                &lt;Son2/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        money.amount -= 100</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.state.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在点击消费按钮，只有二儿子的数据更新了</p>
</blockquote>
<ul>
<li>虽然用的是同一个 money 对象</li>
<li>但是这些组件你都没有去调用它的setState方法，所以它们不知道你消费的动作，所以一直保留旧的金额</li>
</ul>
<blockquote>
<p>一种假设 假如 大儿子 二儿子 都是败家子 </p>
</blockquote>
<ol>
<li>二儿子去酒店把100000  花完了</li>
<li>大儿子不知道钱已经没了 还觉得有10万块，去夜店消费 ，消费后发现 没钱了——被暴打了一顿</li>
<li>这样就很不好</li>
</ol>
<blockquote>
<p>如果用上一篇的办法就会导致，用如下迂回的方式</p>
</blockquote>
<ol>
<li>二儿子消费了100后,通知它大爸</li>
<li>大爸通知大儿子 通知二爸 </li>
<li>二爸通知三儿子 二爸通知四儿子</li>
</ol>
<ul>
<li>这样一看就很垃圾</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-02.png" alt></p>
<blockquote>
<h4 id="有木有一种方案让任意两个组件之间都可以通信"><a href="#有木有一种方案让任意两个组件之间都可以通信" class="headerlink" title="有木有一种方案让任意两个组件之间都可以通信"></a>有木有一种方案让任意两个组件之间都可以通信</h4></blockquote>
<ul>
<li>雇一个管家 让他专门管理财务</li>
<li>此时二儿子通知管家我要花钱  如果是小金额 管家直接给了</li>
<li>如果是大金额 管家就通知 大爸 这钱能不能给二儿子 大爸说可以  就把钱给 二儿子</li>
<li>这就是我们现实生活中所有人共用一个数据 矛盾的情况</li>
</ul>
<blockquote>
<p>雇一个人专门管这件事</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-03.png" alt></p>
<h3 id="发布订阅模式-EventHub"><a href="#发布订阅模式-EventHub" class="headerlink" title="发布订阅模式(EventHub)"></a>发布订阅模式(EventHub)</h3><p>代码实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//订阅的事件</span><br><span class="line">var eventMap = &#123;</span><br><span class="line">    // 蒙牛:[&apos;张三&apos;,&apos;李四&apos;,&apos;王五&apos;],</span><br><span class="line">    // 光明:[&apos;熊大&apos;,&apos;光头强&apos;]</span><br><span class="line">&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 订阅——事件</span><br><span class="line">eventHub.on(&apos;我要用钱&apos;,function fn1(data)&#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 发布——事件</span><br><span class="line">eventHub.trigger(&apos;我要用钱&apos;,100)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码修改如下 二儿子花钱了 通知 三儿子</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather/&gt;</span><br><span class="line">                &lt;SecondFather/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1/&gt;</span><br><span class="line">                &lt;Son2/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.state.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3/&gt;</span><br><span class="line">            &lt;Son4/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        money.amount -= 100</span><br><span class="line">        eventHub.trigger(&apos;我要花钱&apos;,100)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.state.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">        eventHub.on(&apos;我要花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                money:money</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money : money</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.state.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="新问题：如果-大爸-二爸-二儿子的兄弟-都想知道呢？"><a href="#新问题：如果-大爸-二爸-二儿子的兄弟-都想知道呢？" class="headerlink" title="新问题：如果 大爸 二爸 二儿子的兄弟 都想知道呢？"></a>新问题：如果 大爸 二爸 二儿子的兄弟 都想知道呢？</h4></blockquote>
<ul>
<li>总不能每个组件都 监听这个 事件吧，这样就太麻烦了</li>
</ul>
<blockquote>
<h4 id="之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息"><a href="#之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息" class="headerlink" title="之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息"></a>之所以会这样是因为：你们这些人自己随便花钱，二儿子花了钱谁也不告诉，直接把钱花了，然后在发信息</h4></blockquote>
<ul>
<li>先斩后奏(不行)</li>
<li>该如何处理呢？</li>
</ul>
<blockquote>
<h4 id="这个钱你们谁也不准改"><a href="#这个钱你们谁也不准改" class="headerlink" title="这个钱你们谁也不准改"></a>这个钱你们谁也不准改</h4></blockquote>
<ol>
<li>花钱必须通知管家，(你不能把钱花了在告诉管家，管家帮你擦屁股)</li>
<li>所有组件不能修改money</li>
<li>不能修改money我咋花钱呢？ 花钱可以——发消息</li>
<li>移除所有组件里 money的引用 也就是不要用 state</li>
<li>改用 props 放在 顶层的app里</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .root&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            padding:10px;</span><br><span class="line">            border:1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line">        .papa&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">        .son&#123;</span><br><span class="line">            border:1px solid grey;</span><br><span class="line">            padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var money = &#123;</span><br><span class="line">    amount : 100000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var eventMap = &#123;&#125;;</span><br><span class="line">var eventHub = &#123;</span><br><span class="line">    trigger(eventName,data)&#123;</span><br><span class="line">        let fnList = eventMap[eventName];</span><br><span class="line">        if(!fnList) return </span><br><span class="line">        for(var i=0;i&lt;fnList.length;i++)&#123;</span><br><span class="line">            fnList[i](data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    on(eventName,fn)&#123;</span><br><span class="line">        if(!eventMap[eventName])&#123;</span><br><span class="line">            eventMap[eventName] = []</span><br><span class="line">        &#125;</span><br><span class="line">        eventMap[eventName].push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var 管家 = &#123;</span><br><span class="line">    init()&#123;</span><br><span class="line">        eventHub.on(&apos;我想花钱&apos;,(data)=&gt;&#123;</span><br><span class="line">            money.amount -= data</span><br><span class="line">            // 此时要调用render才能实现 数据的同步</span><br><span class="line">            render();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">管家.init()</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            money:money</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;root&quot;&gt;</span><br><span class="line">                &lt;div&gt;app&lt;/div&gt;</span><br><span class="line">                &lt;FirstFather money=&#123;this.state.money&#125;/&gt;</span><br><span class="line">                &lt;SecondFather money=&#123;this.state.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FirstFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;大爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son1 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son2 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class SecondFather extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;papa&quot;&gt;</span><br><span class="line">                &lt;div&gt;二爸 &#123;this.props.money.amount&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Son3 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">                &lt;Son4 money=&#123;this.props.money&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子1 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    x()&#123;</span><br><span class="line">        eventHub.trigger(&apos;我想花钱&apos;,100)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子2 &#123;this.props.money.amount&#125;</span><br><span class="line">                &lt;button onClick=&#123;()=&gt;this.x()&#125;&gt;消费&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son3 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子3 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Son4 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div className=&quot;son&quot;&gt;</span><br><span class="line">                儿子4 &#123;this.props.money.amount&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>点击消费按钮时候——如何触发的更新呢？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome里查看dom解构，只有文字改变了元素还在</span><br><span class="line"></span><br><span class="line">这就是 React的 NB之处——只更新需要更新的地方 DOM diff</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="这就是——单向数据流"><a href="#这就是——单向数据流" class="headerlink" title="这就是——单向数据流"></a>这就是——单向数据流</h4></blockquote>
<ul>
<li>数据放在顶层</li>
<li>通过props一层层的传递下去</li>
</ul>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-05.png" alt></p>
<p>以前我们只能这样：有上有下 (就不是单向数据流)</p>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study004-04.png" alt></p>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/13/React入门003之React通信/" title="React入门003之React通信" itemprop="url">React入门003之React通信</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-13T02:50:28.000Z" itemprop="datePublished"> Published 2019-01-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="生趣例子——龟兔赛跑"><a href="#生趣例子——龟兔赛跑" class="headerlink" title="生趣例子——龟兔赛跑"></a>生趣例子——龟兔赛跑</h3><ul>
<li>请使用 jsbin</li>
<li>拷贝对应代码到对应区域</li>
<li>JavaScript 选择 (React)Javascript</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    .header&#123;</span><br><span class="line">    display:flex;</span><br><span class="line">    justify-content:center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .track&#123;</span><br><span class="line">    border:1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1/&gt;</span><br><span class="line">        &lt;Track2/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">function Track1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div&gt;🐰&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">function Track2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div&gt;🐢&lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="需求2：如何让兔子动？"><a href="#需求2：如何让兔子动？" class="headerlink" title="需求2：如何让兔子动？"></a>需求2：如何让兔子动？</h3><ul>
<li>css就可以做到</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">只要让 Track1里的  </span><br><span class="line">&lt;div style=&quot;transform: translateX(12%);&quot;&gt;🐰&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>新问题:让兔子动就要改变 这个div的style===》如何改变div的style</li>
</ul>
<ol>
<li>你不能在内部改变函数组件的东西</li>
<li>你需要把 Track1变成一个 class组件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            progress:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&quot;transfrom:translateX(0%);&quot;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>卡壳了：React如何设置 style</p>
</blockquote>
<p>google搜 react style</p>
<p>得到一个结果 <a href="https://zhenyong.github.io/react/tips/inline-styles.html" target="_blank" rel="noopener"> Inline Styles | React</a>点进去</p>
<p>给了个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var divStyle = &#123;</span><br><span class="line">  color: &apos;white&apos;,</span><br><span class="line">  backgroundImage: &apos;url(&apos; + imgUrl + &apos;)&apos;,</span><br><span class="line">  WebkitTransition: &apos;all&apos;, // note the capital &apos;W&apos; here</span><br><span class="line">  msTransition: &apos;all&apos; // &apos;ms&apos; is the only lowercase vendor prefix</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;div style=&#123;divStyle&#125;&gt;Hello World!&lt;/div&gt;, mountNode);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>继续改写我们的 Track</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX(20%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>定时器让 兔子 动</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 1</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,100)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>兔子速度快一点，乌龟跑的慢一点（改写两个track）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        setInterval(()=&gt;&#123;</span><br><span class="line">            n += 1</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么一跳一跳的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 线性匀速</span><br><span class="line">.player&#123;</span><br><span class="line">    transition:all 1s linear;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>跑到终点就停下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重点环节-通信"><a href="#重点环节-通信" class="headerlink" title="重点环节 (通信)"></a>重点环节 (通信)</h3><blockquote>
<p> 跑到终点告诉裁判我停了</p>
</blockquote>
<ul>
<li>父组件传递监听的事件 success1/success2</li>
<li>props传递属性 success</li>
<li>事件完成后 调用 props.success()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    let success1 = ()=&gt;&#123;console.log(&apos;兔子跑完了&apos;)&#125;</span><br><span class="line">    let success2 = ()=&gt;&#123;console.log(&apos;乌龟跑完了&apos;)&#125;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">        &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;0&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 10</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 5</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一个小bug就是 兔子没跑到终点就打印了 跑完了 因为 css里的 线性动画( 移除 player样式即可)</p>
</blockquote>
<blockquote>
<p>跑到终点所用时间</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    let t0 = new Date();</span><br><span class="line"></span><br><span class="line">    let success1 = ()=&gt;&#123;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;)</span><br><span class="line">        console.log(new Date() - t0)</span><br><span class="line">    &#125;</span><br><span class="line">    let success2 = ()=&gt;&#123;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;)</span><br><span class="line">        console.log(new Date() - t0)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ...</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="将结束时间更新到-Time1-Time2上"><a href="#将结束时间更新到-Time1-Time2上" class="headerlink" title="将结束时间更新到 Time1/Time2上"></a>将结束时间更新到 Time1/Time2上</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">            &lt;Time1 result=&#123;&#125;/&gt;</span><br><span class="line">            &lt;Judge/&gt;</span><br><span class="line">            &lt;Time2/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">        &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如何单独把结果render 到Timer1呢？</li>
<li>不好意思函数组件是做不到的</li>
</ul>
<blockquote>
<p>用 class组件改写 app</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;)</span><br><span class="line">        console.log(new Date() - this.t0)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;)</span><br><span class="line">        console.log(new Date() - this.t0)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Track1 success=&#123;this.success1.bind(this)&#125;/&gt;</span><br><span class="line">                &lt;Track2 success=&#123;this.success2.bind(this)&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>完整版</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        let t1 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;,t1)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result1:t1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        let t2 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;,t2)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result2:t2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result2&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Track1 success=&#123;this.success1.bind(this)&#125;/&gt;</span><br><span class="line">                &lt;Track2 success=&#123;this.success2.bind(this)&#125;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 25</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 15</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><blockquote>
<p>请问 React的父子组件如何通信</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">父组件通过props传递一个函数给子元素 </span><br><span class="line">子元素在恰当的时候调用这个函数</span><br></pre></td></tr></table></figure>
<h3 id="需求变更-添加操场"><a href="#需求变更-添加操场" class="headerlink" title="需求变更(添加操场)"></a>需求变更(添加操场)</h3><ul>
<li>App里是 操场 Playground</li>
<li>操场Playground里有跑道Track</li>
</ul>
<blockquote>
<p>咋办呢？ 很简单 把success传递给 操场<br>然后在操场里通过 props接受 再次传递给 Track</p>
</blockquote>
<p>代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">    *&#123;margin:0;padding:0;box-sizing: border-box;&#125;</span><br><span class="line">    .header&#123;</span><br><span class="line">        display:flex;</span><br><span class="line">        justify-content:center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .track&#123;</span><br><span class="line">        border:1px solid black;</span><br><span class="line">    &#125;</span><br><span class="line">    .player&#123;</span><br><span class="line">        transition:all 1s linear;</span><br><span class="line">    &#125;</span><br><span class="line">    .playground&#123;</span><br><span class="line">        border:1px solid black;</span><br><span class="line">        background: green;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">class App extends React.Component&#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            result1:0,</span><br><span class="line">            result2:0</span><br><span class="line">        &#125;</span><br><span class="line">        this.t0 = new Date()</span><br><span class="line">    &#125;</span><br><span class="line">    success1()&#123;</span><br><span class="line">        let t1 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;兔子跑完了&apos;,t1)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result1:t1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    success2()&#123;</span><br><span class="line">        let t2 = new Date() - this.t0;</span><br><span class="line">        console.log(&apos;乌龟跑完了&apos;,t2)</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            result2:t2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">                    &lt;Time1 result=&#123;this.state.result1&#125;/&gt;</span><br><span class="line">                    &lt;Judge/&gt;</span><br><span class="line">                    &lt;Time2 result=&#123;this.state.result2&#125;/&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;Playground success1=&#123;this.success1.bind(this)&#125;</span><br><span class="line">                            success2=&#123;this.success2.bind(this)&#125;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Playground(props)&#123;</span><br><span class="line">    let success1 = props.success1</span><br><span class="line">    let success2 = props.success2</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;playground&quot;&gt;</span><br><span class="line">            &lt;Track1 success=&#123;success1&#125;/&gt;</span><br><span class="line">            &lt;Track2 success=&#123;success2&#125;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time1(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐰用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计时器</span><br><span class="line">function Time2(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;🐢用时&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;&#123;props.result&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 裁判</span><br><span class="line">function Judge()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;裁判&lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 25</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐰&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 跑道</span><br><span class="line">class Track2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super() // 必须调用 super 否则报错</span><br><span class="line">        let n = 0;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            style:&#123;</span><br><span class="line">                transform:`translateX($&#123;n&#125;%)`</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        let timerId = setInterval(()=&gt;&#123;</span><br><span class="line">            n += 15</span><br><span class="line">            this.setState(&#123;</span><br><span class="line">                style:&#123;transform:`translateX($&#123;n&#125;%)`&#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            if(n&gt;=100)&#123;</span><br><span class="line">                window.clearInterval(timerId)</span><br><span class="line">                //通知 我跑完了</span><br><span class="line">                this.props.success()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,1000)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123; </span><br><span class="line">        return(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div class=&quot;player&quot; style=&#123;this.state.style&#125;&gt;🐢&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;track&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="面试肯定问爷孙通信是咋实现的"><a href="#面试肯定问爷孙通信是咋实现的" class="headerlink" title="面试肯定问爷孙通信是咋实现的"></a>面试肯定问爷孙通信是咋实现的</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就像上面一样 Playground 从 App哪里把属性props传递下来(继承下来) 传递给 Track</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果是曾爷爷怎么办</p>
</blockquote>
<p>当然是顺着这个家族在多传递一次了</p>
<blockquote>
<h4 id="思考？如果是-兄弟之间如何通信呢？"><a href="#思考？如果是-兄弟之间如何通信呢？" class="headerlink" title="思考？如果是 兄弟之间如何通信呢？"></a>思考？如果是 兄弟之间如何通信呢？</h4></blockquote>
<p>下一篇我们来解决</p>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/11/React入门002之React组件/" title="React入门002之React组件" itemprop="url">React入门002之React组件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-11T12:54:17.000Z" itemprop="datePublished"> Published 2019-01-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h3><p>上一篇文章我们实现了 JSX语法写 html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="假如我们写淘宝页面呢？"><a href="#假如我们写淘宝页面呢？" class="headerlink" title="假如我们写淘宝页面呢？"></a>假如我们写淘宝页面呢？</h3></blockquote>
<ul>
<li>1000行铁定不够的</li>
<li>总不能在一个render里 写1000行以上这样的结构吧</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            .... 写xxx行</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">                &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="于是React作者就在想，如何能避免所有代码写在一坨呢？"><a href="#于是React作者就在想，如何能避免所有代码写在一坨呢？" class="headerlink" title="于是React作者就在想，如何能避免所有代码写在一坨呢？"></a>于是React作者就在想，如何能避免所有代码写在一坨呢？</h4></blockquote>
<ul>
<li>最简单的方法就是用一个——函数 来把代码包裹起来</li>
</ul>
<blockquote>
<h3 id="看看我们的代码-请使用jsbin"><a href="#看看我们的代码-请使用jsbin" class="headerlink" title="看看我们的代码(请使用jsbin)"></a>看看我们的代码(请使用jsbin)</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 使用这个</span><br><span class="line">https://jsbin.com/</span><br><span class="line"></span><br><span class="line"># 引入</span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">&lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"># javascript选择 (JSX)React 否则报错</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="一个非常大的坑-return-后面不要直接换行——-那样返回的是-undefined"><a href="#一个非常大的坑-return-后面不要直接换行——-那样返回的是-undefined" class="headerlink" title="一个非常大的坑 return 后面不要直接换行—— 那样返回的是 undefined"></a>一个非常大的坑 return 后面不要直接换行—— 那样返回的是 undefined</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 返回的是 undefined</span><br><span class="line">// 返回的是 undefined</span><br><span class="line">// 返回的是 undefined</span><br><span class="line">function App()&#123;</span><br><span class="line">    return </span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;span&gt;&#123;number&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="我就想换行咋办-加"><a href="#我就想换行咋办-加" class="headerlink" title="我就想换行咋办,加()"></a>我就想换行咋办,加()</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;span&gt;&#123;number&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="看代码"><a href="#看代码" class="headerlink" title="看代码"></a>看代码</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">  number += 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">  number -= 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">        &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        React.createElement(App),</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ------华丽的分割线---------------------------------------------------</span><br><span class="line">// render里 React.createElement(App), 是不是很丑</span><br><span class="line">// 由于我们用的是 JSX</span><br><span class="line">// 你可以这样</span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 或者</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App&gt;&lt;/App&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>JSX语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;App&gt;&lt;/App&gt;  &lt;==等价于==&gt;  React.createElement(App)</span><br><span class="line"></span><br><span class="line">标签还可以再次简写为 ，因为它不是 html语法 它是 xml语法(标签里没有任何东西，可以自闭合)</span><br><span class="line">&lt;App/&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>优化一下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">  number += 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">  number -= 1;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Box1/&gt;</span><br><span class="line">        &lt;Box2/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2()&#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;App/&gt;,</span><br><span class="line">    document.querySelector(&apos;#root&apos;)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="以上就是组件的萌芽想法"><a href="#以上就是组件的萌芽想法" class="headerlink" title="以上就是组件的萌芽想法"></a>以上就是组件的萌芽想法</h3></blockquote>
<h3 id="如何给-标签传递参数呢？"><a href="#如何给-标签传递参数呢？" class="headerlink" title="如何给 标签传递参数呢？"></a>如何给 标签传递参数呢？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">let number = 0 ;</span><br><span class="line">let add = ()=&gt;&#123;</span><br><span class="line">    number += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus = ()=&gt;&#123;</span><br><span class="line">    number -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>react的作者非常聪明，他把属性理解为对象的一个key/value</li>
</ul>
<blockquote>
<p>React的创举就是</p>
</blockquote>
<ul>
<li>虚拟dom</li>
<li>标签就是函数，函数就是对象，标签的属性就是函数的参数</li>
</ul>
<h3 id="上述代码的Box1和Box2有一个bug"><a href="#上述代码的Box1和Box2有一个bug" class="headerlink" title="上述代码的Box1和Box2有一个bug"></a>上述代码的Box1和Box2有一个bug</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">点击 Box1的 &quot;+&quot; Box2的数字也增加了。</span><br><span class="line"></span><br><span class="line">因为点击 Box1的 时候 触发了 add 导致 number++ 然后 render() </span><br><span class="line"></span><br><span class="line">在render()的时候重新渲染了，而且 Box1 和 Box2使用的是同一个 number</span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时你肯定想，既然能给组件传递参数，那我们传递一个number 这样 Box1和Box2就互不影响了</p>
</blockquote>
<ul>
<li>答案是不行，因为React规定了一个事——不允许修改别人传递给你的参数</li>
<li>我就要改，会给你一个警告。</li>
<li>永远不要修改别人给你的属性，你修改了，不会有什么后果，但是后果自负。肯定会有bug,可能你现在不会觉得有bug，但是过了几个月一定会有bug</li>
</ul>
<blockquote>
<p>最朴素的想法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">let number1 = 0 ;</span><br><span class="line">let add1 = ()=&gt;&#123;</span><br><span class="line">    number1 += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus1 = ()=&gt;&#123;</span><br><span class="line">    number1 -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let number2 = 0 ;</span><br><span class="line">let add2 = ()=&gt;&#123;</span><br><span class="line">    number2 += 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">let minus2 = ()=&gt;&#123;</span><br><span class="line">    number2 -= 1;</span><br><span class="line">    render();</span><br><span class="line">&#125;</span><br><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number1 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add1 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus1 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number2 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add2 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="虽然不相互影响了"><a href="#虽然不相互影响了" class="headerlink" title="虽然不相互影响了"></a>虽然不相互影响了</h4></blockquote>
<ul>
<li>但是多出了很多无用变量</li>
<li>如果是100个组件呢？ 声明100个这样的岂不是疯了</li>
</ul>
<blockquote>
<p>卡壳了</p>
</blockquote>
<ul>
<li>我不能修改别人给我的属性</li>
<li>如果有100个组件就要100个这样的重复声明，一看页面要懵了</li>
</ul>
<blockquote>
<p>又想到一个好办法，将 number属性内置</p>
</blockquote>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">render()</span><br><span class="line"></span><br><span class="line">function App()&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;加一&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;加二&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box1(obj)&#123;</span><br><span class="line">    let number1 = 0 ;</span><br><span class="line">    console.log(&apos;把number变成 0&apos;,number1)</span><br><span class="line">    let add1 = ()=&gt;&#123;</span><br><span class="line">        number1 += 1;</span><br><span class="line">        console.log(&apos;把number变成 1&apos;,number1)</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    let minus1 = ()=&gt;&#123;</span><br><span class="line">        number1 -= 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number1 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add1 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus1 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Box2(obj)&#123;</span><br><span class="line">    let number2 = 0 ;</span><br><span class="line">    let add2 = ()=&gt;&#123;</span><br><span class="line">        number2 += 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    let minus2 = ()=&gt;&#123;</span><br><span class="line">        number2 -= 1;</span><br><span class="line">        render();</span><br><span class="line">    &#125;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            我的name是&#123;obj.name&#125;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number2 &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; add2 &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; minus2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">思路是没错的</span><br><span class="line">错就错在了 render </span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>此时 点击 add 没反应了</p>
</blockquote>
<ul>
<li>思路很好将变量内置</li>
<li>错就错在 render了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">点击 add 触发 number+=1 </span><br><span class="line">然后 调用 render()</span><br><span class="line">render 执行会调用 Box1</span><br><span class="line">Box1里  let number = 0 </span><br><span class="line">所以你怎么点击 都是0</span><br><span class="line"></span><br><span class="line">--------------------------------</span><br><span class="line">虽然思路非常好，但是现实把你打败了，你做不到，因为函数的功能过于单一了</span><br><span class="line">此时再次陷入窘境</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们为什么出错,因为这个render，一render就render整个页面</p>
</blockquote>
<blockquote>
<p>如果不render整个页面，只render自己呢？</p>
</blockquote>
<ul>
<li>肯定不能用函数来搞组件了</li>
<li>不能render整个app</li>
</ul>
<blockquote>
<p>react作者想到，什么比函数高级呢？——类</p>
</blockquote>
<h3 id="class组件"><a href="#class组件" class="headerlink" title="class组件"></a>class组件</h3><p>语法规定</p>
<ul>
<li>继承React.Component</li>
<li>必须实现 render方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;app2&lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="传递参数呢？"><a href="#传递参数呢？" class="headerlink" title="传递参数呢？"></a>传递参数呢？</h4></blockquote>
<ul>
<li>注意！ 我们管接受到的参数叫 props</li>
<li>注意！ 我们管接受到的参数叫 props</li>
<li>注意！ 我们管接受到的参数叫 props</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 之前传递参数</span><br><span class="line">function App(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            app &#123;props.name&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 现在使用参数</span><br><span class="line">// 这个 props 是由父类React.Component构造的 你不继承就没有</span><br><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    render()&#123; // 局部 render</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;app2 &#123;this.props.name&#125; &#123;this.props.age&#125;&lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2 name=&quot;hjx&quot; age=&quot;18&quot;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br><span class="line">// 注意在 html里 没有 数字 只有字符串</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="组件的局部变量呢？可以了这次"><a href="#组件的局部变量呢？可以了这次" class="headerlink" title="组件的局部变量呢？可以了这次"></a>组件的局部变量呢？可以了这次</h4></blockquote>
<ul>
<li>文档规定局部变量必须在 constructor 里设置</li>
<li>this.state = {k:v,k2:v2}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">// 规定组件的参数叫做 props </span><br><span class="line">class App2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">        //报错</span><br><span class="line">        this.state.number +=1</span><br><span class="line">        // 而且这里的this 是 undefined</span><br><span class="line">        // 因为react 调用 onClick的时候是这样调用的</span><br><span class="line">        onClick = add.call(undefined, 参数)</span><br><span class="line">        React强制把this变成 undefined</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">        // 这样也是不能修改的</span><br><span class="line">        // this.state.number +=1</span><br><span class="line">        // 必须要用 setState</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                app2&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">        // 新手必犯错 onClick = &#123;this.add()&#125;  </span><br><span class="line">        // add()是函数的返回值</span><br><span class="line">        // &lt;button onClick=&#123;this.add()&#125;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">        // 绑定this有两种方式</span><br><span class="line">        /*</span><br><span class="line">        第一种 bind(this)</span><br><span class="line">        onClick=&#123;this.add.bind(this)&#125;</span><br><span class="line">        第二种 箭头函数</span><br><span class="line">        onClick=&#123;()=&gt;this.add&#125;</span><br><span class="line">        */</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App2 name=&quot;hjx&quot;/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="使用class组件的限制"><a href="#使用class组件的限制" class="headerlink" title="使用class组件的限制"></a>使用class组件的限制</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 必须继承  React.Component</span><br><span class="line">2. 想自定义属性，必须写 constructor() constructor必须接受一个 props参数</span><br><span class="line">3.  在 constructor里 必须用super(props) 这是 js规定的</span><br><span class="line">4. 必须在 constructor 初始化 state</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            x:0,</span><br><span class="line">            y:1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">你的事件可以放到 class内部</span><br><span class="line"></span><br><span class="line">你必须要有一个render函数 同时 render必须 返回一个标签 而且这个标签只能有一个根元素</span><br><span class="line"></span><br><span class="line">如果你在标签里想用porps必须 是 &#123;this.props.xxx&#125;</span><br><span class="line">如果你想用state 必须是 &#123;this.state.xxx&#125;</span><br><span class="line"></span><br><span class="line">如果你想用 onClick 事件 必须 自己绑定this</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="用class组件实现-box1-box2"><a href="#用class组件实现-box1-box2" class="headerlink" title="用class组件实现 box1 box2"></a>用class组件实现 box1 box2</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">class Box1 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    minus()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number - 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                Box1-&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                    &lt;button onClick=&#123;this.minus.bind(this)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Box2 extends React.Component&#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            number:0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    add()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number + 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    minus()&#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            number:this.state.number - 1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                Box2-&#123;this.props.name&#125;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;this.state.number&#125;</span><br><span class="line">                    &lt;button onClick=&#123;this.add.bind(this)&#125;&gt;+&lt;/button&gt;</span><br><span class="line">                    &lt;button onClick=&#123;this.minus.bind(this)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App(props)&#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;Box1 name=&quot;hjx1&quot;/&gt;</span><br><span class="line">            &lt;Box2 name=&quot;hjx2&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;App/&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="你的疑惑为什么更新数据要-setState-而不是直接改？"><a href="#你的疑惑为什么更新数据要-setState-而不是直接改？" class="headerlink" title="你的疑惑为什么更新数据要 setState 而不是直接改？"></a>你的疑惑为什么更新数据要 setState 而不是直接改？</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add()&#123;</span><br><span class="line">    //为什么是 setState</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">    为什么不是这样写，这样更方便理解啊！</span><br><span class="line">    this.state.number += 1</span><br><span class="line">    render()</span><br><span class="line">    */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="setState-优点"><a href="#setState-优点" class="headerlink" title="setState 优点"></a>setState 优点</h4></blockquote>
<ul>
<li><p>setState可以对更新进行优化，有的时候你自己render很容易 重复调用，这样页面就卡了,减少更新的损耗</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this.state.number +=1</span><br><span class="line">render()</span><br><span class="line">this.state.name = &apos;aa&apos;</span><br><span class="line">render()</span><br><span class="line">this.state.age = 19</span><br><span class="line">render()</span><br></pre></td></tr></table></figure>
</li>
<li><p>setState会将 大批量的更新合并为一次更新</p>
</li>
</ul>
<blockquote>
<p>Box2的 点击 加二 或者 减二</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// 这个肯定没问题</span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 我能不能分两次 setState呢？</span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    this.setState(&#123;</span><br><span class="line">        number:this.state.number + 1</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 答案是不行的</span><br><span class="line">假设初始的时候 number = 0</span><br><span class="line">第一次 setState</span><br><span class="line">this.setState(&#123;</span><br><span class="line">    number:this.state.number + 1</span><br><span class="line">&#125;)</span><br><span class="line">但是第二次 setState 时候 this.state.number到底是0还是1呢？</span><br><span class="line"></span><br><span class="line">你会说 不是已经 setState 过了吗？</span><br><span class="line"></span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br><span class="line">注意！由于 setState 会合并，它有可能并不会马上执行(异步更新)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如何解决 add函数内两次 setState呢？ —— 函数回调</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">add()&#123;</span><br><span class="line">    this.setState((state)=&gt;&#123;</span><br><span class="line">        return &#123;number:state.number+1&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    this.setState((state)=&gt;&#123;</span><br><span class="line">        return &#123;number:state.number+1&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 但是明显你不会这么智障的写代码</span><br><span class="line"></span><br><span class="line">add()&#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">       number:this.state.number + 2</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>至此我们知道我们有个 应用App 它内部有两个盒子 Box1和 Box2,然后你就去看Box1的实现，又继续去看Box2的实现，此时代码非常的模块化</p>
</blockquote>
<blockquote>
<p>而且 Box1中 点击 add就会 number+=1 然后自己调用 render，而且render只会更新 Box1 里的div 而且只会更新你改的number</p>
</blockquote>
<blockquote>
<p>Box1的 render过程每次都会去跟上一次对比 发现 span里的number变了 ,那么就找到这个位置只改 <span>内的 {this.state.number}</span></p>
</blockquote>
<h4 id="寻找两次render结果不同之处的过程-叫做——-DOM-diff"><a href="#寻找两次render结果不同之处的过程-叫做——-DOM-diff" class="headerlink" title="寻找两次render结果不同之处的过程 叫做—— DOM diff"></a>寻找两次render结果不同之处的过程 叫做—— DOM diff</h4><ul>
<li>如果面试官问你 dom diff的细节，就要看给多少工资 你给10K以下，你就呸，我会这个还跟你来面试</li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/01/09/React入门001之React诞生/" title="React入门001之React诞生" itemprop="url">React入门001之React诞生</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Stevin" target="_blank" itemprop="author">Stevin</a>
		
  <p class="article-time">
    <time datetime="2019-01-09T14:41:19.000Z" itemprop="datePublished"> Published 2019-01-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="简单的-add-reduce-需求"><a href="#简单的-add-reduce-需求" class="headerlink" title="简单的 add / reduce 需求"></a>简单的 add / reduce 需求</h3><ul>
<li>实现 页面显示 一个数字 </li>
<li>点击add +1 </li>
<li>点击reduce -1</li>
</ul>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;span id=&quot;result&quot;&gt;0&lt;/span&gt;</span><br><span class="line">        &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button id=&quot;minus&quot;&gt;-&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    let result = document.querySelector(&apos;#result&apos;);</span><br><span class="line">    let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line">    let minus = document.querySelector(&apos;#minus&apos;);</span><br><span class="line"></span><br><span class="line">    add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let number = parseInt(result.innerText,10);</span><br><span class="line">        number += 1;</span><br><span class="line">        result.innerText = number;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    minus.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">        let number = parseInt(result.innerText,10);</span><br><span class="line">        number -= 1;</span><br><span class="line">        result.innerText = number;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-01.png" alt></p>
<blockquote>
<p>如上代码无论如何优化,本质没有改变，过程如下</p>
</blockquote>
<ul>
<li>获取节点元素的值,js中修改元素的值</li>
<li>获取节点元素的值,js中回填修改后的值</li>
</ul>
<blockquote>
<p>如果是你呢？</p>
</blockquote>
<ul>
<li>要么把获取值(num = xx.innerText)干掉 (不去获取了，直接更新dom)</li>
<li>要么把回填值(xx.innerText = xxx)干掉 (不现实，这样就js无法通知页面了)</li>
</ul>
<h3 id="React诞生"><a href="#React诞生" class="headerlink" title="React诞生"></a>React诞生</h3><blockquote>
<h3 id="React的思路"><a href="#React的思路" class="headerlink" title="React的思路"></a>React的思路</h3></blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-02.png" alt></p>
<ul>
<li>在一开始页面就什么都没有</li>
<li>先声明一个变量叫 number=0</li>
<li>js里生成 一个 <span>0</span>(虚拟的span) 并把它同步到页面中   <span>0</span>(真实的span)</li>
<li>number+=1</li>
<li>此时重新生成一个 <span>1</span>(虚拟的span) 并把它同步到页面中   <span>1</span>(真实的span)</li>
</ul>
<blockquote>
<p>此时永远不需要去页面获取 number了，同时页面里显示的数字永远是我number的最新值</p>
</blockquote>
<blockquote>
<p>实现我们刚刚的需求</p>
</blockquote>
<ul>
<li>在 <a href="https://www.bootcdn.cn/" target="_blank" rel="noopener">https://www.bootcdn.cn/</a> 里 搜索react</li>
<li>添加 umd格式的react   <a href="https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js" target="_blank" rel="noopener">https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js</a></li>
<li>添加 umd格式react-dom  <a href="https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js" target="_blank" rel="noopener">https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line"></span><br><span class="line">        let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">        ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line"></span><br><span class="line">        let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line"></span><br><span class="line">        add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">            number += 1;</span><br><span class="line"></span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现在我们的span没有任何的获取元素,只有从虚拟的span到 页面真实的span</p>
</blockquote>
<p>优化一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button id=&quot;add&quot;&gt;+&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line"></span><br><span class="line">        render()</span><br><span class="line"></span><br><span class="line">        let add = document.querySelector(&apos;#add&apos;);</span><br><span class="line"></span><br><span class="line">        add.addEventListener(&apos;click&apos;,function()&#123;</span><br><span class="line">            number += 1;</span><br><span class="line">            render()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        function render()&#123;</span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            ReactDOM.render(span,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>再也不用 querySelector后 取它爸爸取它儿子了</p>
<blockquote>
<h3 id="再次优化，按钮也在render里"><a href="#再次优化，按钮也在render里" class="headerlink" title="再次优化，按钮也在render里"></a>再次优化，按钮也在render里</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;root&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react/16.7.0-alpha.2/umd/react.development.js&quot;&gt;&lt;/script&gt;  </span><br><span class="line">    &lt;script src=&quot;https://cdn.bootcss.com/react-dom/16.7.0-alpha.2/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let number = 0 ;</span><br><span class="line">        let onClickButton = ()=&gt;&#123;</span><br><span class="line">            number += 1;</span><br><span class="line">            render();</span><br><span class="line">        &#125;</span><br><span class="line">        let onClickButton2 = ()=&gt;&#123;</span><br><span class="line">            number -= 1;</span><br><span class="line">            render();</span><br><span class="line">        &#125;</span><br><span class="line">        render()</span><br><span class="line"></span><br><span class="line">        function render()&#123;</span><br><span class="line">            let span = React.createElement(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">            let button = React.createElement(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;);</span><br><span class="line">            let button2 = React.createElement(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;);</span><br><span class="line">            let div = React.createElement(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,span,button,button2);</span><br><span class="line">            ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>千万不要以为 render的时候是重新造了一个 dom</p>
</blockquote>
<ul>
<li>react没那么傻</li>
<li>它是局部刷新, 不会整个更新<blockquote>
<p>点击add后 虚拟的 <span>1</span> 会和 页面里<span>0</span> 比较后发现只变了 中间部分的文案 其他没变</p>
</blockquote>
</li>
</ul>
<h3 id="JSX的发明"><a href="#JSX的发明" class="headerlink" title="JSX的发明"></a>JSX的发明</h3><blockquote>
<h4 id="第一次优化"><a href="#第一次优化" class="headerlink" title="第一次优化"></a>第一次优化</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    let h = React.createElement;</span><br><span class="line">    let span = h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number);</span><br><span class="line">    let button = h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;);</span><br><span class="line">    let button2 = h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;);</span><br><span class="line">    let div = h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">                    span,</span><br><span class="line">                    button,</span><br><span class="line">                    button2</span><br><span class="line">                );</span><br><span class="line">    ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="第二次优化，移除临时变量-直接用函数嵌套"><a href="#第二次优化，移除临时变量-直接用函数嵌套" class="headerlink" title="第二次优化，移除临时变量,直接用函数嵌套"></a>第二次优化，移除临时变量,直接用函数嵌套</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function render()&#123;</span><br><span class="line">    let h = React.createElement;</span><br><span class="line">    let div = h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">                h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number),</span><br><span class="line">                h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;),</span><br><span class="line">                h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;)</span><br><span class="line">            );</span><br><span class="line">    ReactDOM.render(div,document.querySelector(&apos;#root&apos;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="第三次优化-最重要的优化"><a href="#第三次优化-最重要的优化" class="headerlink" title="第三次优化(最重要的优化)"></a>第三次优化(最重要的优化)</h4></blockquote>
<p>此时的解构已经蕴含了 html解构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h(&apos;div&apos;,&#123;className:&apos;container&apos;&#125;,</span><br><span class="line">    h(&apos;span&apos;,&#123;className:&apos;red&apos;&#125;,number),</span><br><span class="line">    h(&apos;button&apos;,&#123;onClick:onClickButton&#125;,&apos;+&apos;),</span><br><span class="line">    h(&apos;button&apos;,&#123;onClick:onClickButton2&#125;,&apos;-&apos;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt;number&lt;/span&gt;</span><br><span class="line">    &lt;button onClick=onClickButton&gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick=onClickButton2&gt;-&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>React开发者惊讶的发现自己代码和html没什么区别</p>
</blockquote>
<ul>
<li>想能不能以这种形式写代码，然后用程序翻译成上面的代码呢？</li>
</ul>
<blockquote>
<h3 id="JSX语法"><a href="#JSX语法" class="headerlink" title="JSX语法"></a>JSX语法</h3></blockquote>
<p>用html的形式写js,终于这种形式被babel采纳了(招安)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 所有变量的地方====&gt; &#123; 变量 &#125;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">    &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">    &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">// 以上代码被翻译为</span><br><span class="line">React.createElement(</span><br><span class="line">    &quot;div&quot;,</span><br><span class="line">    &#123; class:&quot;container&quot; &#125;,</span><br><span class="line">    React.createElement(&quot;span&quot;,&#123; class:&quot;red&quot;&#125;,number),</span><br><span class="line">    React.createElement(&quot;button&quot;,&#123; onClick: onClickButton&#125;,&quot;+&quot;),</span><br><span class="line">    React.createElement(&quot;button&quot;,&#123; onClick: onClickButton2&#125;,&quot;-&quot;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="但是，我们这样写是运行不了的，有两种方法可以支持我们这样写"><a href="#但是，我们这样写是运行不了的，有两种方法可以支持我们这样写" class="headerlink" title="但是，我们这样写是运行不了的，有两种方法可以支持我们这样写"></a>但是，我们这样写是运行不了的，有两种方法可以支持我们这样写</h4></blockquote>
<ul>
<li>webpack</li>
<li>用jsbin</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 注意 render2是无法运行的  必须webpack 编译 或者 用jsbin 添加jsx模式</span><br><span class="line">function render2()&#123;</span><br><span class="line">    ReactDOM.render(</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;red&quot;&gt; &#123; number &#125; &lt;/span&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton &#125; &gt;+&lt;/button&gt;</span><br><span class="line">            &lt;button onClick= &#123; onClickButton2 &#125; &gt;-&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;,</span><br><span class="line">        document.querySelector(&apos;#root&apos;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="很多人疑惑为什么-onClickButton-不加-呢？"><a href="#很多人疑惑为什么-onClickButton-不加-呢？" class="headerlink" title="很多人疑惑为什么 onClickButton 不加()呢？"></a>很多人疑惑为什么 onClickButton 不加()呢？</h4></blockquote>
<ul>
<li>加()代表这个 函数的返回值传递给 onClick</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onClick= &#123; onClickButton &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>再次回到之前那张图</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-01.png" alt></p>
<ul>
<li>我们以前不管用原生js还是 jquery都是 取对应元素节点 获取节点的值,然后对值进行一些逻辑处理，然后回填页面</li>
</ul>
<blockquote>
<p>React的思路</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/slTrust/note/master/react/react-study001-02.png" alt></p>
<ul>
<li>页面你先给我空着</li>
<li>所有的东西都通过对象表示，然后把对象放到页面里，你想修改就直接改值，然后更新下这个对象</li>
<li>就是 改值 render / 改值 render / 改值 render</li>
</ul>
<blockquote>
<h4 id="由于-dom-API太难用了"><a href="#由于-dom-API太难用了" class="headerlink" title="由于 dom API太难用了"></a>由于 dom API太难用了</h4></blockquote>
<ul>
<li>React不择手段的做到：不去访问dom,只用你更新数据，构造出一个虚拟dom(就是不是真实的dom)</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>虚拟dom就是一个对象，没有什么特别之处(如果你不知道你就console.log打印啊)</li>
<li>JSX：就是用html的形式写 JS(js的扩展)</li>
<li>虚拟dom：非真实的dom，表示dom节点的对象</li>
</ul>
<p><a href="https://github.com/slTrust/React-study" target="_blank" rel="noopener">代码仓库</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/React入门/">React入门</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/22/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/53/">53</a><a class="extend next" rel="next" href="/page/24/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/oak/" title="oak">oak<sup>71</sup></a></li>
			
		
			
				<li><a href="/tags/前端知识点/" title="前端知识点">前端知识点<sup>43</sup></a></li>
			
		
			
				<li><a href="/tags/java/" title="java">java<sup>37</sup></a></li>
			
		
			
				<li><a href="/tags/Node后端/" title="Node后端">Node后端<sup>36</sup></a></li>
			
		
			
				<li><a href="/tags/M06/" title="M06">M06<sup>29</sup></a></li>
			
		
			
				<li><a href="/tags/fullstack/" title="fullstack">fullstack<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/M07/" title="M07">M07<sup>27</sup></a></li>
			
		
			
				<li><a href="/tags/python/" title="python">python<sup>26</sup></a></li>
			
		
			
				<li><a href="/tags/M08/" title="M08">M08<sup>25</sup></a></li>
			
		
			
				<li><a href="/tags/ReactWheels/" title="ReactWheels">ReactWheels<sup>24</sup></a></li>
			
		
			
				<li><a href="/tags/M04/" title="M04">M04<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/M03/" title="M03">M03<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/M02/" title="M02">M02<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/React入门/" title="React入门">React入门<sup>17</sup></a></li>
			
		
			
				<li><a href="/tags/TS入门/" title="TS入门">TS入门<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/CSS/" title="CSS">CSS<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/ES6速学/" title="ES6速学">ES6速学<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/M01/" title="M01">M01<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/vue/" title="vue">vue<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/mongodb/" title="mongodb">mongodb<sup>7</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021 
		
		<a href="/about" target="_blank" title="Stevin">Stevin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
